!function(e){function t(t){for(var r,i,s=t[0],c=t[1],l=t[2],p=0,d=[];p<s.length;p++)i=s[p],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&d.push(a[i][0]),a[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(u&&u(t);d.length;)d.shift()();return n.push.apply(n,l||[]),o()}function o(){for(var e,t=0;t<n.length;t++){for(var o=n[t],r=!0,s=1;s<o.length;s++){var c=o[s];0!==a[c]&&(r=!1)}r&&(n.splice(t--,1),e=i(i.s=o[0]))}return e}var r={},a={0:0},n=[];function i(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=r,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(o,r,function(t){return e[t]}.bind(null,r));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="./";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;n.push([92,1]),o()}([,function(e,t,o){"use strict";var r=o(0),a=o(5),n=o(4);function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){c(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function c(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function l(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==o)return;var r,a,n=[],i=!0,s=!1;try{for(o=o.call(e);!(i=(r=o.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(s)throw a}}return n}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return d(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var f={default:new r.TextStyle({fontStyle:"normal",fill:"#ffffff",stroke:"blue",fontFamily:"sans-serif",strokeThickness:1,breakWords:!0}),calText:function(e,t,o){var a=this.getTextStyle(t,o),n=new r.Text(e,a),i=n.width,s=n.height;return n.destroy(),{width:i,height:s}},getTextStyle:function(e,t){if(!t){if(e instanceof r.TextStyle)return e;var o=this.default.clone();return e instanceof Object&&Object.keys(e).forEach((function(t){o["_".concat(t)]=e[t]})),o}if(!(e instanceof r.TextStyle))return this.default.clone();var a=e.clone();return t instanceof Object&&Object.keys(t).forEach((function(e){a["_".concat(e)]=t[e]})),a}},m={TextStyle:{default:f.defaultTextStyle,damage:f.getTextStyle({fontWeight:"bold",fontSize:"11px",textBaseline:"alphabetic",strokeThickness:2}),tip:f.getTextStyle({fontWeight:"normal",fontSize:"17px",textBaseline:"alphabetic",strokeThickness:0}),main:f.getTextStyle({fill:"white",strokeThickness:0}),statusBar:f.getTextStyle({fontSize:"20px",textBaseline:"alphabetic"}),toolBar:f.getTextStyle()},calText:function(){return f.calText.apply(f,arguments)},getTextStyle:function(e,t){return f.getTextStyle(e,t)},getTexture:function(e){var t=window.pixi.textures;return e instanceof r.Texture?e:t[e]||t.error},getBlockNode:function(e){var t=pixi.Block;return t.isBlock(e)||(e=t.get(e,0,0)),e.getNode()},getTextureHeight:function(e){return e instanceof r.Texture?e.height:e instanceof Array&&e[0]instanceof r.Texture?e[0].height:null},resizeTo:function(e,t,o){if(e instanceof Object&&t instanceof Object&&!e._destroyed&&!t._destroyed){var r,a;t.anchor?(r=t.x-t.anchor.x*t.width,a=t.y-t.anchor.y*t.height):(r=t.x,a=t.y),e.anchor&&e.anchor.set(0,0);var n=u(this.getPadding(o),4),i=n[0],s=n[1],c=n[2],l=n[3];e.x=r-l,e.y=a-i,e.width=t.width+l+s,e.height=t.height+c+i}},drawConfirmBox:function(e,t,o){core.lockControl(),e=core.replaceText(e||""),"action"!=core.status.event.id&&(core.status.event.id="confirmBox",core.status.event.ui=e,core.status.event.data={yes:t,no:o}),0!=core.status.event.selection&&(core.status.event.selection=1);var r=pixi.scenes.getScene("ui"),a=e.split("\n"),n=core.ui._drawConfirmBox_getRect(a);pixi.ui.fillRect(r,n.left,n.top,n.width,n.height,{fillAlpha:.6,radius:.2});var i=pixi.ui.getTextStyle({}),s=(core.calWidth("ui","确定"),r.addNode("border",{radius:.2,zone:[0,0,60,30],lineColor:"rgb(255, 215, 0)",init:function(){this.loop({alpha:.3},{alpha:1},500)}}));for(var c in a)r.addNode("text",{text:a[c],style:i,data:{x:core.ui.HPIXEL,y:n.top+50+30*c,anchor:{x:.5,y:.5}}});var l=r.addNode("text",{text:"确定",style:i,data:{x:core.ui.HPIXEL-38,y:n.bottom-35,anchor:{x:.5,y:.5}},event:{pointertap:function(){pixi.ui.resizeTo(s,this),console.log("you Click ok")}}});window.yes=l;var u=r.addNode("text",{text:"取消",style:i,data:{x:core.ui.HPIXEL+38,y:n.bottom-35,anchor:{x:.5,y:.5}},event:{pointertap:function(){pixi.ui.resizeTo(s,this),console.log("you Click no")}}}),p=core.status.event.selection?l:u;this.resizeTo(s,p)},splitTexture:function(e,t,o){var a=this;if(!(e instanceof r.Texture))return null;var n=e.orig,i=n.width,s=n.height;return this._splitTexture(s,t,(function(t,r){return a._splitTexture(i,o,(function(o,n){return a.split(e,n*o,r*t,o,t)}))}))},splitTextureByCol:function(e,t,o){var a=this;if(!(e instanceof r.Texture))return null;var n=e.orig,i=n.width,s=n.height;return this._splitTexture(i,t,(function(t,r){return a._splitTexture(s,o,(function(o,n){return a.split(e,r*t,n*o,t,o)}))}))},_splitTexture:function(e,t,o){var r;if(t instanceof Array){r={};var a=e/t.length;t.forEach((function(e,t){r[e]=o(a,t)}))}else{r=[];for(var n=e/t,i=0;i<t;i++)r[i]=o(n,i)}return r},split:function(e,t,o,a,n){var i=this;if(e instanceof Array){var s=[];return e.forEach((function(e){return s.push(i.split(e,t,o,a,n))})),s}if(!(e instanceof r.Texture))return null;var c=e._frame,l=e.orig,u=e.trim,p=e._rotate;if(!u)return new r.Texture(e,p?new r.Rectangle(c.x+l.height-o-n,c.y+t,n,a):new r.Rectangle(c.x+t,c.y+o,a,n),new r.Rectangle(0,0,a,n),null,p);var d=new r.Rectangle(t,o,a,n).fit(u),f=d.x-u.x,m=d.y-u.y;d.x-=t,d.y-=o;var h=p?new r.Rectangle(c.x+(u.height-m-d.height),c.y+f,d.height,d.width):new r.Rectangle(c.x+f,c.y+m,d.width,d.height),y=new r.Rectangle(0,0,a,n);return new r.Texture(e,h,y,d,p)},getHeroTexture:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"down",o=a.a.parseName(e),n=u(o,2),i=n[0],s=(n[1],this.getTexture(i));if(s instanceof r.Texture){var c=this.splitTexture(s,["down","left","right","up"],4);return pixi.textures[i]=c,c[t][0]}return s[t][0]},setHero:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pixi.game.getScene("event"),o=pixi,a=o.hero;a.sprite&&a.sprite.remove();var n=this.getTexture(e);if(n instanceof r.Texture){var i=this.splitTexture(n,["down","left","right","up"],4);return pixi.textures[e]=i,this.setHero(e)}return a.sprite=t.addNode("hero",{texture:n,data:{anchor:{x:.5,y:.5}}}),a.speed&&(a.sprite.animationSpeed=a.speed),core.drawHero(),null},getNode:function(e,t,o,r,a){var i=n.a.getNode("sprite",{texture:this.split(e,t,o,r,a),disable:!0});return i.destroyOptions={texture:!0},i},drawImage:function(e,t,o,r,a,i,s,c,l,u){var p;return"string"==typeof t&&(t=this.getTexture(t)),arguments.length>6?p=this.getNode(t,o,r,a,i):(p=n.a.getNode("sprite",{texture:t,disable:!0}),s=o,c=r,l=a,u=i),e.addNode(p),p.position.set(s,c),l&&p.width!==l&&(p.width=l),u&&p.height!==u&&(p.height=u),p},fillRect:function(e,t,o,r,n){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},s=i.radius,c=void 0===s?0:s,l=i.fillAlpha,u=void 0===l?1:l,p=i.fillColor,d=void 0===p?0:p;return e.addNode("graphics",{init:function(){return d&&!Number.isInteger(d)&&(d=a.a.getColor(d)),this.beginFill(d,u),c?(Number.isInteger(c)||(c*=Math.min(r,n)),this.drawRoundedRect(0,0,r,n,c)):this.drawRect(0,0,r,n),this.endFill(),this.position.set(t,o),!0}})},drawText:function(e,t,o,r,a){var n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},i=this.getTextStyle(o),s=e.addNode("text",{text:t,style:i,disable:!0}),c=n.anchor;return c&&s.anchor.set(c.x,c.y),s.position.set(r,a),s},drawRoute:function(e){console.log(e)},drawTip:function(){},setMask:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.container.zone,n=new r.Graphics;n.beginFill(a.a.getColor(t)),n.drawRect.apply(n,l(o)),n.endFill(),e.container.mask=n},drawAnimate:function(e,t,o,r,a){e instanceof Object||(e=core.material.animates[e]),t instanceof Object||(t=pixi.scenes.getScene(t)),a.async?this.setAsyncAnimate((function(n){e.play(t,o,r,s(s({},a),{},{onComplete:function(){a.onComplete instanceof Function&&a.onComplete.apply(this),n()}}))})):e.play(t,o,r,a)},setAsyncAnimate:function(e){var t=a.a.getId();core.animateFrame.asyncId[t]=!0,e((function(){delete core.animateFrame.asyncId[t]}))},getHeroDrawObj:function(){var e=this,t=core.material.icons.hero,o=[],r=core.status.hero,a=0;o.push({sprite:this.getTexture("hero"),heroIcon:t[direction],direction:r.loc.direction,x:r.loc.x,y:r.loc.y,index:a++}),(core.status.hero.followers||[]).forEach((function(r){o.push({texture:e.getTexture(r.name),heroIcon:t[r.direction],direction:r.direction,x:r.x,y:r.y,index:a++})}))},setLoc:function(e,t,o,r,a,n){if(!n){if(!e.parent)return;n=n||e.parent.zone}e.anchor&&e.anchor.set(0,0),Number.isInteger(t)||(t*=e.width),Number.isInteger(o)||(o*=e.height),Number.isInteger(r)||(r*=n[2]),Number.isInteger(a)||(a*=n[3]),e.x=r-t,e.y=a-o},getPadding:function(e){if(e instanceof Array){var t,o,r,a;if(1===e.length)t=o=r=a=e[0];else if(2===e.length)r=a=e[0],t=o=e[1];else if(3===e.length)a=e[0],t=o=e[1],r=e[2];else{if(4!==e.length)return!1;var n=u(e,4);a=n[0],o=n[1],r=n[2],t=n[3]}return[a,o,r,t]}return[0,0,0,0]},fitZone:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=u(t,4),n=a[0],i=a[1],s=a[2],c=a[3];if(r.padding){var p=this.getPadding(r.padding),d=u(p,4),f=d[0],m=d[1],h=d[2],y=d[3];n+=y,i+=f,s-=y+m,c-=f+h}var g=Math.min(c/e.height,s/e.width);if(r.maxRatio&&(g=Math.min(g,r.maxRatio)),r.minRatio&&(g=Math.max(g,r.minRatio)),e.scale.set(g,g),o instanceof Array)return this.setPosition.apply(this,[e,[n,i,s,c]].concat(l(o)));var v={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1]},_=v[o];if(!_)throw new Error("应填数组或center、left、right、top、bottom");return this.setPosition.apply(this,[e,[n,i,s,c]].concat(l(_)))},setPosition:function(e,t,o,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:r,i=u(t,4),s=i[0],c=i[1],l=i[2],p=i[3];e.anchor.set(o,r),e.position.set(s+l*a,c+p*n)},center:function(e,t,o,r,a){var n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},i=this.getPadding(n.padding),s=u(i,4),c=s[0],l=s[1],p=s[2],d=s[3];t+=d,o+=c,r=r-d-l,a=a-c-p;var f=Math.min(a/e.height,r/e.width);if(n.maxRatio&&(f=Math.min(f,n.maxRatio)),n.minRatio&&(f=Math.max(f,n.minRatio)),e.scale.set(f,f),e.anchor)return e.anchor.set(.5,.5),void e.position.set(t+r/2,o+a/2);e.x=t+r/2-e.width/2,e.y=o+a/2-e.height/2}};t.a=m},function(e,t,o){"use strict";o.d(t,"a",(function(){return s})),o.d(t,"d",(function(){return c})),o.d(t,"c",(function(){return p})),o.d(t,"e",(function(){return l})),o.d(t,"b",(function(){return d}));var r=o(0),a=o(9),n=o(3),i=o(1),s=new r.Application({width:100,height:100,antialias:!0,transparent:!1,resolution:1});s.view.style.position="absolute";var c=new a.a("main","main",{container:s.stage,constant:!0}),l=c.addScene("statusBar","statusBar",{constant:!0}),u=c.addScene("toolBar","toolBar",{constant:!0}),p=c.addScene("game","game",{constant:!0});p.stopAction(),p.addScene(["bg","event","fg","damage"],void 0,{constant:!0});c.addScene("show","game",{constant:!0});c.addScene("weather","main",{constant:!0}).stopAction();c.addScene("ui","game");c.show();var d=c.addNode("text");l.on("show",(function(){var e=pixi.resize.style,t=e.game,o=e.statusBar,r=e.toolBar,a=pixi.resize.style,n=a.borderWidth,s=this.addNode("sprite",{});s.interactiveChildren=!1,s.addNode("border",{zone:t}),s.addNode("border",{zone:o}),s.addNode("border",{zone:r});var c=i.a.getTexture("ground");s.addNode("tilingSprite",{texture:c,width:a.statusBar[2],height:a.statusBar[3],data:{x:a.statusBar[0]-n,y:a.statusBar[1]-n}}),s.addNode("tilingSprite",{texture:c,width:a.toolBar[2],height:a.toolBar[3],data:{x:a.toolBar[0]-n,y:a.toolBar[1]-n}})})),n.a.on("resetGame",(function(){l.flash(),u.flash()})),n.a.on("drawMap",(function(){console.log("flash"),p.flash()}))},function(e,t,o){"use strict";var r=o(0),a=o(17);function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,r=u(e);if(t){var a=u(this).constructor;o=Reflect.construct(r,arguments,a)}else o=r.apply(this,arguments);return l(this,o)}}function l(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(l,e);var t,o,r,n=c(l);function l(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(e=n.call(this)).freshList={},e}return t=l,(o=[{key:"setFresh",value:function(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),r=1;r<t;r++)o[r-1]=arguments[r];return this.freshList[e]=a.a.get.apply(a.a,o),this.freshList[e]}},{key:"fresh",value:function(e){if(this.freshList[e]instanceof Object){for(var t,o=arguments.length,r=new Array(o>1?o-1:0),a=1;a<o;a++)r[a-1]=arguments[a];return(t=this.freshList[e]).dirty.apply(t,r)}return null}}])&&i(t.prototype,o),r&&i(t,r),l}(r.utils.EventEmitter));t.a=p},function(e,t,o){"use strict";var r=o(0),a=o(7),n=o(5);function i(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==o)return;var r,a,n=[],i=!0,s=!1;try{for(o=o.call(e);!(i=(r=o.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(s)throw a}}return n}(e,t)||c(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return l(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var p={frames:0,activeNodes:[],animationList:{},types:{},Renders:{},addAnimation:function(e,t){var o=this.animationList,r=o[e];r||(r=[],o[e]=r),t instanceof Array?r.concat(t):r.push(t)},update:function(){this.frames+=1;var e=this.activeNodes;0!==e.length&&(this.activeNodes=e.filter((function(e){return!e._destroyed&&(null===e.parent||(e._update(),!0))})),this.updateAnimation())},updateAnimation:function(){var e=this,t=this.animationList,o=n.a.filter;Object.keys(t).forEach((function(r){if(e.frames%r==0){var a=t[r];o(a,(function(e){return!e._destroyed&&(null===e.parent||(e.updateOneFrame(),!0))})),0===a.length&&delete t[r]}}))},default:{getTween:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this.tweens||(this.tweens=[]);var r=new a.a.Tween(o).to(e,t);return this.tweens.push(r),r},changeTo:function(e,t,o,r){this.tweens=this.tweens||[];var n=arguments.length;n<=2||3===n&&"function"==typeof o?(r=o,o=t,t=e):Object.assign(this,e);var i=new a.a.Tween(this).to(t,o);return r&&i.onComplete(r),i.start(),this.tweens.push(i),i},loop:function(e,t,o){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.tweens=this.tweens||[],Object.assign(this,e);var n=new a.a.Tween(this).to(t,o).repeat(r).yoyo(!0);return n.start(),this.tweens.push(n),n},remove:function(e,t){var o=this;return this._removing?null:(this._removing=!0,"function"==typeof e?e((function(){o._remove(t)})):this._remove())},_remove:function(e){var t=this.parent,o=this.tweens,r=this.destroyOptions,a=this.children;if(0!==a.length)for(var n=this.removeChildren(0,a.length),i=0;i<n.length;++i)n[i].remove();t&&t.removeChild(this),"function"==typeof e&&e(),o&&(o.forEach((function(e){e.destroy()})),this.tweens=null),this.destroy(r)},addNode:function(e,t){var o=e instanceof r.Sprite?e:pixi.nodes.getNode(e,t);return 0===o.zIndex||this.sortableChildren||(this.sortableChildren=!0),this.addChild(o),o},destroyOptions:{children:!0,texture:!1,baseTexture:!1}},register:function(e,t){this.types[e]=t},registerRender:function(e,t,o){var a=this;if(e instanceof Array)return e.forEach((function(e){return a.registerRender(e)}));var n=Object.create(this.default);"object"===u(o)&&(n=Object.assign(n,o)),"function"!=typeof t&&(t=r[t]||r[e]);var i=this.getRender(t);for(var s in n)i.prototype[s]?console.warn("".concat(e,"在注册Render时已有同名属性").concat(s)):i.prototype[s]=n[s];return this.Renders[e]=i,i},getRender:function(e){function t(){for(var t,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];(t=e.constructor).call.apply(t,[this].concat(r))}return e.prototype&&(e=e.prototype),t.prototype=Object.create(e),t.prototype.constructor=t,t},setNode:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t,r=o.start,a=o.event,n=o.data,i=o.update,s=o.destroy,c=o.init;if(s&&(e.destroyOptions=s),"function"==typeof c&&c.apply(e),"function"==typeof r&&(e.parent?r.init(e):e.addListener("added",r)),"function"==typeof i&&(e._update=i,t.added||this.activeNodes.push(e)),"object"===u(a)&&(e.interactive=!0,Object.keys(a).forEach((function(t){e.addListener(t,a[t])}))),"object"===u(n))for(var l in n)"object"===u(n[l])&&e[l]?Object.assign(e[l],n[l]):e[l]=n[l];return t=null,e},getNode:function(e){var t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.types[e];return t="function"==typeof r.Render?r.Render(this.Renders,o):new this.Renders[r.Render],r.init&&r.init.call(t,o)?t:("function"==typeof r.update&&(t._update=r.update,this.activeNodes.push(t),o.added=!0),o.disable?t:this.setNode(t,o))}};p.registerRender(["Sprite","Text","Graphics","TilingSprite"]),p.registerRender("AnimatedSprite",r.AnimatedSprite,{updateOneFrame:function(){var e=this.currentFrame;this._currentTime+=1,this._currentTime>=this._textures.length&&!this.loop?(this._currentTime=this._textures.length-1,this.stop(),this.onComplete&&this.onComplete()):(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<e||this.animationSpeed<0&&this.currentFrame>e)&&this.onLoop(),this.updateTexture())}}),p.register("text",{Render:function(e,t){var o=t.text,r=t.style,a=new e.Text(o,r);return a.resolution=2,a}}),p.register("sprite",{Render:function(e,t){var o,r=t.animate,a=t.texture,n=t.time;return a instanceof Array?(n=n||500,r?(o=new e.AnimatedSprite(a)).animationSpeed=1e3/n/60:(o=new e.AnimatedSprite(a,!1),p.addAnimation(Math.ceil(60*n/1e3),o)),o.play(),o):new e.Sprite(a)}}),p.registerRender("StateSprite",r.AnimatedSprite,{change:function(e){var t=this._frames;if(t){if(!t[e])throw new Error("".concat(e,"不存在"));var o=t[e];o instanceof Array&&(this.textures=o,this.status=e)}}}),p.register("hero",{Render:function(e,t){var o=t.texture;return new e.StateSprite(Object.values(o)[0])},init:function(e){var t=e.texture,o=e.time,r=void 0===o?100:o;this._frames=t,this.animationSpeed=1e3/r/60}}),p.register("tilingSprite",{Render:function(e,t){var o=t.texture;return new e.TilingSprite(o)},init:function(e){var t=this,o=e.width,r=e.height;o||r?(this.width=o,this.height=r):this.addListener("added",(function(){var e=s(t.parent.zone,4),o=(e[0],e[1],e[2]),r=e[3];t.width=o,t.height=r}))}}),p.register("border",{Render:"Graphics",init:function(e){var t=this,o=e.radius,r=e.fillColor,a=e.fillAlpha,i=void 0===a?0:a,c=e.zone,l=e.lineWidth,u=void 0===l?3:l,p=e.lineColor,d=e.lineAlpha,f=void 0===d?1:d,m=e.alignment,h=void 0===m?1:m;return this.addListener("added",(function(){if(!c){var e=t.parent.zone;c=[0,0,e[2],e[3]]}var a=s(c,4),l=a[0],d=a[1],m=a[2],y=a[3];console.log(c),r&&!Number.isInteger(r)&&(r=n.a.getColor(r)),Number.isInteger(p)||(p=n.a.getColor(p||main.borderColor)),t.beginFill(r,i),t.lineStyle(u,p,f,h),o?(Number.isInteger(o)||(o*=Math.min(m,y)),t.drawRoundedRect(0,0,m,y,o)):t.drawRect(0,0,m,y),t.endFill(),t.position.set(l-u,d-u)})),!0}}),p.register("zone",{Render:"Graphics",init:function(e){var t=this,o=e.zone,r=e.color,a=void 0===r?0:r,s=e.alpha,c=void 0===s?0:s;this.addListener("added",(function(){if(t.beginFill(n.a.getColor(a),c),!(o instanceof Array)){var e=t.parent.zone;console.log(t.parent),o=[0,0,e[2],e[3]]}t.drawRect.apply(t,i(o)),t.endFill()}))}}),p.register("graphics",{Render:"Graphics"}),t.a=p},function(e,t,o){"use strict";var r=0,a={scan:{up:{x:0,y:-1},left:{x:-1,y:0},down:{x:0,y:1},right:{x:1,y:0}},filter:function(e,t){for(var o=!1,r=0,a=0,n=e.length,i=0;i<n-a;i++)t(e[i],a+i)?o&&(o=!o,e.splice(r,i-r),a+=i-r,i=r):o||(r=i,o=!o);return o&&e.splice(r,e.length-r),e},clamp:function(e,t,o){var r=Math.min(t,o),a=Math.max(t,o);return Math.min(Math.max(e||0,r),a)},getId:function(){return r+=1},cloneTo:function(e,t){for(var o in t)e[o]=this.clone(t[o])},cloneWith:function(e,t){if(!(e instanceof Object))return e;var o=e instanceof Array?[]:{};for(var r in e){var a=e[r],n=t(a);o[r]=n||(a instanceof Object?this.cloneWith(a,t):a)}return o},clone:function(e){if(!(e instanceof Object))return e;var t=e instanceof Array?[]:{};for(var o in e){var r=e[o];t[o]=r instanceof Object?this.clone(r):r}return t},isInterger:function(e){return"number"==typeof e&&0==(1|e)},tween:function(e,t,o,r,a){var n=new TWEEN.Tween({n:e}).to({n:t},o);r&&n.onUpdate((function(e){r(e.n)})),a&&n.onComplete(a),n.start()},getColor:function(e){if(!e)return 0;if(3===arguments.length)return(arguments[0]<<16)+(arguments[1]<<8)+arguments[2];if(Number.isInteger(e))return e;if(e.startsWith("rgb")){var t=e.split(","),o=parseInt(t[0].split("(")[1]),r=parseInt(t[1]),a=parseInt(t[2].split(")")[0]);return console.log(o,r,a),(o<<16)+(r<<8)+a}return e.startsWith("#")?parseInt(e.slice(1),16):null},debounce:function(e,t){var o,r=this,a=arguments;return function(){clearTimeout(o),o=setTimeout((function(){e.apply(r,a)}),t)}},parseName:function(e){var t=e.lastIndexOf(".");return t>=0?[e.slice(0,t),e.slice(t+1)]:[e]},drawRoundRectPath:function(e,t,o,r){e.beginPath(0),e.arc(t-r,o-r,r,0,Math.PI/2),e.lineTo(r,o),e.arc(r,o-r,r,Math.PI/2,Math.PI),e.lineTo(0,r),e.arc(r,r,r,Math.PI,3*Math.PI/2),e.lineTo(t-r,0),e.arc(t-r,r,r,3*Math.PI/2,2*Math.PI),e.lineTo(t,o-r),e.closePath()},strokeRoundRectfunction:function(e,t,o,r,a,n,i,s){return!(2*n>r||2*n>a)&&(e.save(),e.translate(t,o),this.drawRoundRectPath(e,r,a,n),e.lineWidth=i||2,e.strokeStyle=s||"#000",e.stroke(),e.restore(),!0)},fillRoundRect:function(e,t,o,r,a,n,i){return!(2*n>r||2*n>a)&&(e.save(),e.translate(t,o),this.drawRoundRectPath(e,r,a,n),e.fillStyle=i||"#000",e.fill(),e.restore(),!0)}};t.a=a},function(e,t,o){"use strict";var r=o(3),a=function(e,t){for(var o in t)e[o]=t[o]},n={game:288,__PIXELS__:416,style:{main:[],game:[],statusBar:[],toolBar:[]},init:function(){var e,t,o=document.body,r=o.clientWidth,n=o.clientHeight,i=this.__PIXELS__+6;r>=i+(Math.round(.31*this.__PIXELS__)+3)||r>n&&n<i?(e=!1,t=Math.min(1,n/i)):(e=!0,t=Math.min(1,r/i));var s={isVertical:e,scale:t,clientWidth:r,clientHeight:n,gameWidth:this.__PIXELS__,gameHeight:this.__PIXELS__,borderWidth:3,statusBarHeight:108,toolBarHeight:e?50:116,statusBarWidth:116};s.isVertical!==this.oldIsVertical?s.isVerticalChange=!0:s.isVerticalChange=!1,this.oldIsVertical=s.isVertical;var c=s.borderWidth,l=s.gameWidth,u=s.gameHeight;Object.assign(this.style,s);var p=this.style;return p.isVertical?(p.W=s.gameWidth+2*c,p.H=s.gameHeight+4*c+s.statusBarHeight+s.toolBarHeight,a(p.main,[0,0,p.W,p.H]),a(p.statusBar,[c,c,l,s.statusBarHeight]),a(p.game,[c,2*c+s.statusBarHeight,l,u]),a(p.toolBar,[c,3*c+s.statusBarHeight+u,l,s.toolBarHeight])):(p.W=s.gameWidth+4*c+s.statusBarWidth,p.H=s.gameHeight+2*c,a(p.main,[0,0,p.W,p.H]),a(p.statusBar,[c,c,s.statusBarWidth,u]),a(p.game,[2*c+s.statusBarWidth,c,l,u]),a(p.toolBar,[c,u-c-s.toolBarHeight,s.statusBarWidth,s.toolBarHeight])),p},do:function(){var e=this.init();this.resizeApp(e),e.isVerticalChange&&pixi.scenes.doEmit("reLoc",e),this.resizeCanvas(e)},resizeApp:function(e){pixi.app.renderer.resize(e.W,e.H),pixi.app.stage.zone=[0,0,e.W,e.H];var t=e.W*e.scale,o=e.H*e.scale,r=pixi.app.view;r.style.width="".concat(t,"px"),r.style.height="".concat(o,"px"),r.style.left="".concat((e.clientWidth-t)/2,"px"),r.style.top="".concat((e.clientHeight-o)/2,"px")},resizeCanvas:function(e){var t=e.gameWidth,o=e.gameHeight,r=e.scale,a=e.game,n=t*r,i=o*r,s=(e.clientWidth-e.W*r)/2+a[0]*r,c=(e.clientHeight-e.H*r)/2+a[1]*r;this.canvasLoc={width:n,height:i,left:s,top:c},this.setCanvasLoc([main.dom.ui,main.dom.data]),this.reLocDymCanvas(Object.values(core.dymCanvas))},reLocDymCanvas:function(e){var t=this;if(e instanceof Array)return e.forEach((function(e){return t.reLocDymCanvas(e)}));e instanceof CanvasRenderingContext2D&&(e=e.canvas);var o=this.canvasLoc,r=o.left,a=o.top,n=this.style.scale;return e.style.width="".concat(e.width*n,"px"),e.style.height="".concat(e.height*n,"px"),e.style.left="".concat(r+parseFloat(e.getAttribute("_left"))*n,"px"),e.style.top="".concat(a+parseFloat(e.getAttribute("_top"))*n,"px"),"absolute"!==e.style.position&&(e.style.position="absolute"),e},setCanvasLoc:function(e){var t=this;if(e instanceof Array)return e.forEach((function(e){return t.setCanvasLoc(e)}));e instanceof CanvasRenderingContext2D&&(e=e.canvas);var o=this.canvasLoc,r=o.width,a=o.height,n=o.left,i=o.top;return e.style.width="".concat(r,"px"),e.style.height="".concat(a,"px"),e.style.top="".concat(i,"px"),e.style.left="".concat(n,"px"),"absolute"!==e.style.position&&(e.style.position="absolute"),null}};n.init(),r.a.once("resize",(function(){n.do(),window.addEventListener("resize",(function(){n.do()}))})),t.a=n},,function(e,t,o){"use strict";var r=o(7),a=o(5),n=o(6),i=o(2),s=o(14);o(0);function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==o)return;var r,a,n=[],i=!0,s=!1;try{for(o=o.call(e);!(i=(r=o.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(s)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var u=n.a.style,p=r.a.Easing.Cubic.Out,d=i.c.getScene("bg"),f={sprite:null,time:null,speed:0,_dirty:!1,playing:!1,velocity:{x:0,y:0},tween:null,setRoute:function(e,t,o){var r=s.a.textures.route;d.addNode("sprite",{texture:r[o],data:{x:32*e+16,y:32*t+16,anchor:{x:.5,y:.5}},init:function(){var e=this;this.getTween({alpha:0},500).onComplete((function(){e.remove()})).delay(800).start()}})},setOffset:function(e,t){var o=i.c.container,a=c(o.zone,2),n=a[0]-e,s=a[1]-t;null!==this.tween&&(this.tween.destroy(),this.tween=null),o.x!==n||o.y!==s?this.playing?(this.velocity={x:n-o.x,y:s-o.y},o.position.set(n,s)):this.tween=new r.a.Tween(o).to({x:n,y:s},300).easing(p).start():(this.velocity.x=0,this.velocity.y=0)},updateView:function(){var e=u.gameWidth,t=u.gameHeight,o=core.bigmap,r=32*o.width-e,n=32*o.height-t,i=this.sprite,s=i.x,c=i.y,l=i.height,p=r<=0?0:a.a.clamp(s-e/2,0,r),d=n<=0?0:a.a.clamp(c-t/2+l/2-16,0,n);core.bigmap.offsetX=p,core.bigmap.offsetY=d,this.setOffset(p,d)},dirty:function(){this._dirty||(this.playing?this._dirty=!0:core.moveAction())},draw:function(){var e=this.sprite;if(!e)return null;var t=core.status.hero.loc,o=32*t.x+16,r=32*t.y+32-e.height/2;return e.position.set(o,r),e.status!==t.direction&&e.change(t.direction),this.updateView(),{direction:t.direction,x:t.x,y:t.y}},move:function(e,t){var o=this.draw(),r=o.direction,a=o.x,n=o.y;this.setRoute(a,n,r),this.moveOneStep(r,e,t)},stop:function(){this.sprite.gotoAndStop(0)},moveOneStep:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2?arguments[2]:void 0,n=this.sprite;if(n){o!==this.time&&(this.time=o,this.speed=1e3/o/60*1,n.animationSpeed=this.speed),n.status!==e&&n.change(e),n.playing||n.gotoAndPlay(1),this.playing=!0;var i=n.x,s=n.y,c=a.a.scan[e],l=c.x,u=c.y;n.changeTo({x:i+32*l,y:s+32*u},o,(function(){"function"==typeof r&&r(),t.playing=!1,!t._dirty||(t._dirty=!1,core.status.heroStop)?n.gotoAndStop(0):core.moveAction()})).onUpdate((function(){t.updateView()}))}},moveOneStepFake:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,o=arguments.length>2?arguments[2]:void 0,r=this.sprite;r&&(t!==this.time&&(this.time=t,this.speed=1e3/t/60*4,r.animationSpeed=this.speed),r.status!==e&&r.change(e),null===r.onFrameChange&&(r.loop=!1,r.onFrameChange=function(e){if(this.playing){var t=a.a.scan[this.status],o=t.x,r=t.y;this.x+=8*o,this.y+=8*r,console.log(this.y)}},r.onComplete=function(){this.gotoAndStop(0),this.callback instanceof Function&&this.callback(),delete this.callback}),console.log("do"),r.callback=o,r.gotoAndPlay(0))}};t.a=f},function(e,t,o){"use strict";o.d(t,"a",(function(){return F}));var r=o(0),a=o(4),n=o(6),i=o(1);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function l(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?c(Object(o),!0).forEach((function(t){u(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):c(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function u(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,r=g(e);if(t){var a=g(this).constructor;o=Reflect.construct(r,arguments,a)}else o=r.apply(this,arguments);return h(this,o)}}function h(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return y(e)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==o)return;var r,a,n=[],i=!0,s=!1;try{for(o=o.call(e);!(i=(r=o.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(s)throw a}}return n}(e,t)||w(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e){return function(e){if(Array.isArray(e))return x(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||w(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){if(e){if("string"==typeof e)return x(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?x(e,t):void 0}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var b=function(){0===this.children.length&&(!this.parent||this.scene.constant||this.scene.flashing||(this.parent.removeChild(this),this.scene.nodes=[]),this.scene.hideCallback instanceof Function&&this.scene.hideCallback())},S=function(){if(!this.container.parent){var e=this.parent;null!==e&&e.container.addChild(this.container)}},k=function(){this.active&&(this.flashing=!0,this.emit("hide"),this.emit("show"),this.flashing=!1)},I=function(e){this.hideCallback=e,this.nodes.forEach((function(e){return e.remove()})),this.nodes=[]},A=function(){delete this.container.scene,this.container.destroy(),delete this.container,this.hideCallback=null;var e=this.parent;e&&e.removeScene(this),delete this.parent,this.removeAllListeners(),console.log("destroy ".concat(this.id))},E=function(){var e=this.container,t=_(n.a.style[this.resizeType]);if(this.inRoot||(t[0]=0,t[1]=0),this.position instanceof Array&&(t[0]+=this.position[0],t[1]+=this.position[1],this.position[2]&&(t[2]=this.position[2]),this.position[3]&&(t[3]=this.position[3])),!(e.zone instanceof Array))return e.zone=t,void e.position.set(t[0],t[1]);var o=v(e.zone,4),r=o[0],a=o[1],s=o[2],c=o[3];r===t[0]&&a===t[1]||e.position.set(t[0],t[1]),e.zone=t,!this.active||s===t[2]&&c===t[3]?null!==this.container.mask&&i.a.setMask(this):this.emit("flash")},T=function(e,t){if(e instanceof Array||t instanceof Array){if(!(e instanceof Array))return t;if(!(t instanceof Array))return e;var o=e.x1,r=e.y1,a=e.w1,n=e.h1;return[o+t.x2,r+t.y2,t.w2||a,t.h2||n]}},F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(s,e);var t,o,n,i=m(s);function s(e,t){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=a.container,c=a.parent,l=void 0===c?null:c,u=a.constant,d=void 0!==u&&u,f=a.position,m=a.zIndex;return p(this,s),(o=i.call(this)).id=e,o.disable=!1,o.stopPropagation=!1,o.flashing=!1,o.constant=d,o.resizeType=t,o.position=f,o.container=n||new r.Container,o.container.scene=y(o),o.parent=l,o.nodes=[],o.children=[],o.addListener("show",S),o.addListener("hide",I),o.addListener("flash",k),o.addListener("reLoc",E),o.container.addListener("childRemoved",b),m&&(o.paren&&!o.parent.container.sortableChildren&&(o.parent.container.sortableChildren=!0),o.container.zIndex=m),o.emit("reLoc"),o}return t=s,(o=[{key:"active",get:function(){return null!==this.container.parent}},{key:"inRoot",get:function(){return this.parent&&null===this.parent.parent}},{key:"stopAction",value:function(){this.container.interactive=!1,this.container.interactiveChildren=!1}},{key:"addScene",value:function(e,t){var o=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e instanceof Array)return e.forEach((function(e){return o.addScene(e,t,r)}));var a=T(this.position,r.position),n=new s(e,t||this.resizeType,l(l({},r),{},{parent:this,position:a}));return this.children.push(n),n}},{key:"removeScene",value:function(e){var t=this.children.indexOf(e);t>-1&&this.children.splice(t,1)}},{key:"addNode",value:function(e,t){var o=this;if(e instanceof Array)return e.forEach((function(e){o.addNode(e[0],e[1])}));var n=e instanceof r.DisplayObject?e:a.a.getNode(e,t),i=this.container;return null===i.parent&&null!==this.parent&&this.parent.container.addChild(i),0===n.zIndex||i.sortableChildren||(i.sortableChildren=!0),i.addChild(n),this.nodes.push(n),n}},{key:"getScene",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e instanceof s||e instanceof r.DisplayObject)return e;if(this.id===e)return this;if(t&&o>=t)return!1;for(var a,n=this.children,i=n.length,c=0;c<i;c++)if((a=n[c].getScene(e,t,o+1))instanceof s)return a;return!1}},{key:"doFunc",value:function(e){this.disable||(e.apply(this),this.stopPropagation||this.children.forEach((function(t){return t.doFunc(e)})))}},{key:"doEmit",value:function(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),r=1;r<t;r++)o[r-1]=arguments[r];this.disable||(this.emit.apply(this,[e].concat(o)),this.stopPropagation||this.children.forEach((function(t){return t.doEmit.apply(t,[e].concat(o))})))}},{key:"show",value:function(){this.disable=!1;for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return this.doEmit.apply(this,["show"].concat(t))}},{key:"hide",value:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return this.doEmit.apply(this,["hide"].concat(t))}},{key:"flash",value:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return this.doEmit.apply(this,["flash"].concat(t))}},{key:"reLoc",value:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return this.doEmit.apply(this,["reLoc"].concat(t))}},{key:"destroy",value:function(){this.hide(A)}}])&&d(t.prototype,o),n&&d(t,n),s}(r.utils.EventEmitter)},function(e,t){e.exports={items:{yellowKey:{cls:"keys",name:"黄钥匙",text:"可以打开一扇黄门"},blueKey:{cls:"keys",name:"蓝钥匙",text:"可以打开一扇蓝门"},redKey:{cls:"keys",name:"红钥匙",text:"可以打开一扇红门"},redJewel:{cls:"items",name:"红宝石",text:"'，攻击+${core.values.redJewel}'"},blueJewel:{cls:"items",name:"蓝宝石",text:"'，防御+${core.values.blueJewel}'"},greenJewel:{cls:"items",name:"绿宝石",text:"'，魔防+${core.values.greenJewel}'"},yellowJewel:{cls:"items",name:"黄宝石",text:"可以进行加点"},redPotion:{cls:"items",name:"红血瓶",text:"'，生命+${core.values.redPotion}'"},bluePotion:{cls:"items",name:"蓝血瓶",text:"'，生命+${core.values.bluePotion}'"},yellowPotion:{cls:"items",name:"黄血瓶",text:"'，生命+${core.values.yellowPotion'}"},greenPotion:{cls:"items",name:"绿血瓶",text:"'，生命+${core.values.greenPotion}'"},sword0:{cls:"items",name:"破旧的剑",text:"一把已经生锈的剑",equip:{type:0,atk:0,animate:"sword"}},sword1:{cls:"items",name:"铁剑",text:"一把很普通的铁剑",equip:{type:0,atk:10,animate:"sword"}},sword2:{cls:"items",name:"银剑",text:"一把很普通的银剑",equip:{type:0,atk:20,animate:"sword"}},sword3:{cls:"items",name:"骑士剑",text:"一把很普通的骑士剑",equip:{type:0,atk:40,animate:"sword"}},sword4:{cls:"items",name:"圣剑",text:"一把很普通的圣剑",equip:{type:0,atk:80,animate:"sword"}},sword5:{cls:"items",name:"神圣剑",text:"一把很普通的神圣剑",equip:{type:0,atk:100,animate:"sword"}},shield0:{cls:"items",name:"破旧的盾",text:"一个很破旧的铁盾",equip:{type:1,def:0}},shield1:{cls:"items",name:"铁盾",text:"一个很普通的铁盾",equip:{type:1,def:10}},shield2:{cls:"items",name:"银盾",text:"一个很普通的银盾",equip:{type:1,def:20}},shield3:{cls:"items",name:"骑士盾",text:"一个很普通的骑士盾",equip:{type:1,def:40}},shield4:{cls:"items",name:"圣盾",text:"一个很普通的圣盾",equip:{type:1,def:80}},shield5:{cls:"items",name:"神圣盾",text:"一个很普通的神圣盾",equip:{type:1,def:100,mdef:100}},superPotion:{cls:"items",name:"圣水"},moneyPocket:{cls:"items",name:"金钱袋"},book:{cls:"constants",name:"怪物手册",text:"可以查看当前楼层各怪物属性"},fly:{cls:"constants",name:"楼层传送器",text:"可以自由往来去过的楼层",hideInReplay:!0},coin:{cls:"constants",name:"幸运金币",text:"持有时打败怪物可得双倍金币"},snow:{cls:"constants",name:"冰冻徽章",text:"可以将面前的熔岩变成平地"},cross:{cls:"constants",name:"十字架",text:"持有后无视怪物的无敌属性"},knife:{cls:"constants",name:"屠龙匕首",text:"该道具尚未被定义"},shoes:{cls:"constants",name:"绿鞋",text:"持有时无视负面地形"},bigKey:{cls:"tools",name:"大黄门钥匙",text:"可以开启当前层所有黄门"},greenKey:{cls:"tools",name:"绿钥匙",text:"可以打开一扇绿门"},steelKey:{cls:"tools",name:"铁门钥匙",text:"可以打开一扇铁门"},pickaxe:{cls:"tools",name:"破墙镐",text:"可以破坏勇士面前的墙"},icePickaxe:{cls:"tools",name:"破冰镐",text:"可以破坏勇士面前的一堵冰墙"},bomb:{cls:"tools",name:"炸弹",text:"可以炸掉勇士面前的怪物"},centerFly:{cls:"tools",name:"中心对称飞行器",text:"可以飞向当前楼层中心对称的位置"},upFly:{cls:"tools",name:"上楼器",text:"可以飞往楼上的相同位置"},downFly:{cls:"tools",name:"下楼器",text:"可以飞往楼下的相同位置"},earthquake:{cls:"tools",name:"地震卷轴",text:"可以破坏当前层的所有墙"},poisonWine:{cls:"tools",name:"解毒药水",text:"可以解除中毒状态"},weakWine:{cls:"tools",name:"解衰药水",text:"可以解除衰弱状态"},curseWine:{cls:"tools",name:"解咒药水",text:"可以解除诅咒状态"},superWine:{cls:"tools",name:"万能药水",text:"可以解除所有不良状态"},hammer:{cls:"tools",name:"圣锤",text:"可以炸掉勇士面前的怪物"},lifeWand:{cls:"tools",name:"生命魔杖",text:"可以恢复100点生命值"},jumpShoes:{cls:"tools",name:"跳跃靴",text:"能跳跃到前方两格处"},skill1:{cls:"constants",name:"技能：二倍斩",text:"可以打开或关闭主动技能二倍斩",hideInReplay:!0},wand:{cls:"items",name:"新物品"}},itemEffect:{redJewel:"core.status.hero.atk += core.values.redJewel * ratio",blueJewel:"core.status.hero.def += core.values.blueJewel * ratio",greenJewel:"core.status.hero.mdef += core.values.greenJewel * ratio",yellowJewel:"core.status.hero.hp+=1000;core.status.hero.atk+=6;core.status.hero.def+=6;core.status.hero.mdef+=10;",redPotion:"core.status.hero.hp += core.values.redPotion * ratio",bluePotion:"core.status.hero.hp += core.values.bluePotion * ratio",yellowPotion:"core.status.hero.hp += core.values.yellowPotion * ratio",greenPotion:"core.status.hero.hp += core.values.greenPotion * ratio",sword0:"core.status.hero.atk += 0",sword1:"core.status.hero.atk += 10",sword2:"core.status.hero.atk += 20",sword3:"core.status.hero.atk += 40",sword4:"core.status.hero.atk += 80",sword5:"core.status.hero.atk += 100",shield0:"core.status.hero.def += 0",shield1:"core.status.hero.def += 10",shield2:"core.status.hero.def += 20",shield3:"core.status.hero.def += 40",shield4:"core.status.hero.def += 80",shield5:"core.status.hero.def += 100;core.status.hero.mdef += 100",bigKey:"core.status.hero.items.keys.yellowKey++;core.status.hero.items.keys.blueKey++;core.status.hero.items.keys.redKey++;",superPotion:"core.status.hero.hp *= 2",moneyPocket:"core.status.hero.money += 500"},itemEffectTip:{redJewel:"'，攻击+'+core.values.redJewel * ratio",blueJewel:"'，防御+'+core.values.blueJewel * ratio",greenJewel:"'，魔防+'+core.values.greenJewel * ratio",yellowJewel:"'，全属性提升'",redPotion:"'，生命+'+core.values.redPotion * ratio",bluePotion:"'，生命+'+core.values.bluePotion * ratio",yellowPotion:"'，生命+'+core.values.yellowPotion * ratio",greenPotion:"'，生命+'+core.values.greenPotion * ratio",sword0:"'，攻击+0'",sword1:"'，攻击+10'",sword2:"'，攻击+20'",sword3:"'，攻击+40'",sword4:"'，攻击+80'",sword5:"'，攻击+100'",shield0:"'，防御+0'",shield1:"'，防御+10'",shield2:"'，防御+20'",shield3:"'，防御+40'",shield4:"'，防御+80'",shield5:"'，防御+100，魔防+100'",bigKey:"'，全钥匙+1'",superPotion:"'，生命值翻倍'",moneyPocket:"'，金币+500'"},useItemEffect:{book:"core.ui.drawBook(0);",fly:"core.ui.drawFly(core.floorIds.indexOf(core.status.floorId));",earthquake:"core.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n});",pickaxe:"core.playSound('pickaxe.mp3');\ncore.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n});",icePickaxe:"core.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n});",snow:"core.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n});",bigKey:'(function () {\n\tvar actions = core.status.event.ui.map(function (id) {\n\t\tvar block = core.status.thisMap.blocks[id];\n\t\treturn { "type": "openDoor", "loc": [block.x, block.y], "async": true };\n\t});\n\tactions.push({ "type": "waitAsync" });\n\tactions.push({ "type": "tip", "text": core.material.items[itemId].name + "使用成功" });\n\tcore.insertAction(actions);\n})();',bomb:"core.playSound('bomb.mp3');\ncore.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n\tcore.events.afterUseBomb();\n});",hammer:"core.playSound('bomb.mp3');\ncore.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n\tcore.events.afterUseBomb();\n});",centerFly:"core.playSound('centerFly.mp3');\ncore.clearMap('hero');\ncore.setHeroLoc('x', core.bigmap.width-1-core.getHeroLoc('x'));\ncore.setHeroLoc('y', core.bigmap.height-1-core.getHeroLoc('y'));\ncore.drawHero();\ncore.drawTip(core.material.items[itemId].name + '使用成功');",upFly:'var loc = {\'direction\': core.status.hero.loc.direction, \'x\': core.status.event.ui.x, \'y\': core.status.event.ui.y};\nif (core.status.event.id == \'action\') {\n\tcore.insertAction([\n\t\t{"type": "changeFloor", "loc": [loc.x, loc.y], "direction": loc.direction, "floorId": core.status.event.ui.id},\n\t\t{"type": "tip", "text": core.material.items[itemId].name + \'使用成功\'}\n\t]);\n}\nelse {\n\tcore.changeFloor(core.status.event.ui.id, null, loc, null, function (){\n\tcore.drawTip(core.material.items[itemId].name + \'使用成功\');\n\t\tcore.replay();\n\t});\n}',downFly:'var loc = {\'direction\': core.status.hero.loc.direction, \'x\': core.status.event.ui.x, \'y\': core.status.event.ui.y};\nif (core.status.event.id == \'action\') {\n\tcore.insertAction([\n\t\t{"type": "changeFloor", "loc": [loc.x, loc.y], "direction": loc.direction, "floorId": core.status.event.ui.id},\n\t\t{"type": "tip", "text": core.material.items[itemId].name + \'使用成功\'}\n\t]);\n}\nelse {\n\tcore.changeFloor(core.status.event.ui.id, null, loc, null, function (){\n\tcore.drawTip(core.material.items[itemId].name + \'使用成功\');\n\t\tcore.replay();\n\t});\n}\n',poisonWine:"core.removeFlag('poison');",weakWine:'core.removeFlag(\'weak\');\nif (core.values.weakValue>=1) { // >=1：直接扣数值\n\tcore.status.hero.atk += core.values.weakValue;\n\tcore.status.hero.def += core.values.weakValue;\n}\nelse { // <1：扣比例\n\tcore.addBuff("atk", core.values.weakValue);\n\tcore.addBuff("def", core.values.weakValue);\n}',curseWine:"core.removeFlag('curse');",superWine:"core.removeFlag('poison');\nif (core.hasFlag('weak')) {\n\tcore.removeFlag('weak');\n\tif (core.values.weakValue>=1) { // >=1：直接扣数值\n\t\tcore.status.hero.atk += core.values.weakValue;\n\t\tcore.status.hero.def += core.values.weakValue;\n\t}\n\telse { // <1：扣比例\n\t\tcore.addBuff(\"atk\", core.values.weakValue);\n\t\tcore.addBuff(\"def\", core.values.weakValue);\n\t}\n}\ncore.removeFlag('curse');",lifeWand:'core.insertAction([\n\t{"type": "input", "text": "请输入生命魔杖使用次数：(0-${item:lifeWand})"},\n\t{"type": "if", "condition": "flag:input<=item:lifeWand",\n\t\t"true": [\n\t\t\t{"type": "setValue", "name": "item:lifeWand", "value": "item:lifeWand-flag:input"},\n\t\t\t{"type": "setValue", "name": "status:hp", "value": "status:hp+flag:input*100"},\n\t\t\t"成功使用${flag:input}次生命魔杖，恢复${flag:input*100}点生命。"\n\t\t],\n\t\t"false": ["输入不合法！"]\n\t},\n]);\ncore.addItem(\'lifeWand\', 1);',jumpShoes:'core.insertAction({"type":"jumpHero","loc":[core.nextX(2),core.nextY(2)]});',redPotion:"core.status.hero.hp += core.values.redPotion",bluePotion:"core.status.hero.hp += core.values.bluePotion",greenPotion:"core.status.hero.hp += core.values.greenPotion",yellowPotion:"core.status.hero.hp += core.values.yellowPotion",redJewel:"core.status.hero.atk += core.values.redJewel",blueJewel:"core.status.hero.def += core.values.blueJewel",greenJewel:"core.status.hero.mdef += core.values.greenJewel",yellowJewel:'core.insertAction([\n\t{"type": "choices", "choices": [\n\t\t{"text": "攻击+1", "action": [\n\t\t\t{"type": "setValue", "name": "status:atk", "value": "status:atk+1"}\n\t\t]},\n\t\t{"text": "防御+2", "action": [\n\t\t\t{"type": "setValue", "name": "status:def", "value": "status:def+2"}\n\t\t]},\n\t\t{"text": "生命+200", "action": [\n\t\t\t{"type": "setValue", "name": "status:hp", "value": "status:hp+200"}\n\t\t]},\n\t]}\n]);',skill1:"// 二倍斩的flag:skill为1\nif (core.getFlag('skill', 0)==0) { // 判断当前是否已经开了技能\n\tif (core.getStatus('mana')>=5) { // 这里要写当前能否开技能的条件判断，比如魔力值至少要多少\n\t\tcore.setFlag('skill', 1); // 开技能1\n\t\tcore.setFlag('skillName', '二倍斩'); // 设置技能名\n\t}\n\telse {\n\t\tcore.drawTip(\"魔力不足，无法开启技能\");\n\t}\n}\nelse { // 关闭技能\n\tcore.setFlag('skill', 0); // 关闭技能状态\n\tcore.setFlag('skillName', '无');\n}"},canUseItemEffect:{book:"true",fly:"(function () {\n\treturn core.status.maps[core.status.floorId].canFlyTo;\n})();",pickaxe:"(function() {\n\tvar ids = [], id2s = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && core.nearHero(block.x, block.y) && \n\t\t\t(block.event.canBreak || block.event.id == 'yellowWall' || block.event.id=='whiteWall' || block.event.id=='blueWall')) { // 能破哪些墙\n\t\t\t// 四个方向\n\t\t\tif (core.flags.pickaxeFourDirections || (block.x == core.nextX() && block.y == core.nextY()))\n\t\t\t\tids.push(i);\n\t\t\telse id2s.push(i);\n\t\t}\n\t}\n\tif (ids.length>0) {\n\t\tcore.status.event.ui = ids;\n\t\treturn true;\n\t}\n\telse if (id2s.length==1) {\n\t\tcore.status.event.ui = id2s;\n\t\treturn true;\n\t}\n\treturn false;\n})();",icePickaxe:"(function() {\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && block.x==core.nextX() && block.y==core.nextY() && block.event.id=='ice') {\n\t\t\tcore.status.event.ui = [i];\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n})();",bomb:"(function () {\n\tvar ids = [], id2s = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && block.event.cls.indexOf('enemy')==0 && core.nearHero(block.x, block.y)) {\n\t\t\tvar enemy = core.material.enemys[block.event.id];\n\t\t\tif (core.isset(enemy) && enemy.notBomb) continue;\n\t\t\tif (core.flags.bombFourDirections || (block.x==core.nextX() && block.y==core.nextY()))\n\t\t\t\tids.push(i);\n\t\t\telse\n\t\t\t\tid2s.push(i);\n\t\t}\n\t}\n\tif (ids.length>0) {\n\t\tcore.status.event.ui = ids;\n\t\treturn true;\n\t}\n\tif (id2s.length==1) {\n\t\tcore.status.event.ui = id2s;\n\t\treturn true;\n\t}\n\treturn false;\n})();",hammer:"(function() {\n\tvar ids = [], id2s = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && block.event.cls.indexOf('enemy')==0 && core.nearHero(block.x, block.y)) {\n\t\t\tvar enemy = core.material.enemys[block.event.id];\n\t\t\tif (core.isset(enemy) && enemy.notBomb) continue;\n\t\t\tif (block.x==core.nextX() && block.y==core.nextY())\n\t\t\t\tids.push(i);\n\t\t\telse\n\t\t\t\tid2s.push(i);\n\t\t}\n\t}\n\tif (ids.length>0) {\n\t\tcore.status.event.ui = ids;\n\t\treturn true;\n\t}\n\telse if (id2s.length==1) {\n\t\tcore.status.event.ui = id2s;\n\t\treturn true;\n\t}\n\treturn false;\n})();",earthquake:"(function () {\n\tvar able=false;\n\tvar ids = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable &&\n\t\t\t(block.event.canBreak || block.event.id == 'yellowWall' || block.event.id == 'blueWall' || block.event.id == 'whiteWall')) { // 能炸的墙壁\n\t\t\tids.push(i);\n\t\t}\n\t}\n\tif (ids.length>0) {\n\t\tcore.status.event.ui = ids;\n\t\table=true;\n\t}\n\treturn able;\n})();",centerFly:"(function () {\n\tvar toX = core.bigmap.width-1-core.getHeroLoc('x'), toY = core.bigmap.height-1-core.getHeroLoc('y');\n\tvar id = core.getBlockId(toX, toY);\n\treturn id == null;\n})();",upFly:"(function() {\n\tvar floorId = core.status.floorId, index = core.floorIds.indexOf(floorId);\n\tif (index<core.floorIds.length-1) {\n\t\tvar toId = core.floorIds[index+1], toX = core.getHeroLoc('x'), toY = core.getHeroLoc('y');\n\t\tvar mw = core.floors[toId].width, mh = core.floors[toId].height;\n\t\tif (toX>=0 && toX<mw && toY>=0 && toY<mh && core.getBlock(toX, toY, toId)==null) {\n\t\t\tcore.status.event.ui = {'id': toId, 'x': toX, 'y': toY};\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n})();",downFly:"(function() {\n\tvar floorId = core.status.floorId, index = core.floorIds.indexOf(floorId);\n\tif (index>0) {\n\t\tvar toId = core.floorIds[index-1], toX = core.getHeroLoc('x'), toY = core.getHeroLoc('y');\n\t\tvar mw = core.floors[toId].width, mh = core.floors[toId].height;\n\t\tif (toX>=0 && toX<mw && toY>=0 && toY<mh && core.getBlock(toX, toY, toId)==null) {\n\t\t\tcore.status.event.ui = {'id': toId, 'x': toX, 'y': toY};\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n})();",snow:"(function () {\n\tvar ids = [], id2s = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && block.event.id == 'lava' && core.nearHero(block.x, block.y)) {\n\t\t\tif (core.flags.snowFourDirections || (block.x == core.nextX() && block.y == core.nextY()))\n\t\t\t\tids.push(i);\n\t\t\telse id2s.push(i);\n\t\t}\n\t}\n\tif (ids.length>0) {\n\t\tcore.status.event.ui = ids;\n\t\treturn true;\n\t}\n\tif (id2s.length==1) {\n\t\tcore.status.event.ui = id2s;\n\t\treturn true;\n\t}\n\treturn false;\n})();",bigKey:"(function () {\n\tvar able = false,\n\t\tids = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && block.event.id == 'yellowDoor') {\n\t\t\tids.push(i);\n\t\t}\n\t}\n\tif (ids.length > 0) {\n\t\tcore.status.event.ui = ids;\n\t\table = true;\n\t}\n\treturn able;\n})();",poisonWine:"core.hasFlag('poison');",weakWine:"core.hasFlag('weak');",curseWine:"core.hasFlag('curse');",superWine:"(function() {\n\treturn core.hasFlag('poison') || core.hasFlag('weak') || core.hasFlag('curse');\n})();",lifeWand:"true",jumpShoes:"(function() {\n\tvar nx=core.nextX(2), ny=core.nextY(2);\n\treturn nx>=0 && nx<core.bigmap.width && ny>=0 && ny<core.bigmap.height && core.getBlockId(nx,ny)==null;\n})();",redPotion:"true",bluePotion:"true",greenPotion:"true",yellowPotion:"true",redJewel:"true",blueJewel:"true",greenJewel:"true",yellowJewel:"true",skill1:"true"},equipCondition:{},useItemEvent:{}}},function(module,exports){var functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a={events:{resetGame:function(e,t,o,r,a){for(var n in core.clearStatus(),core.status=core.clone(core.initStatus,(function(e){return"hero"!=e&&"maps"!=e})),core.status.played=!0,core.status.hero=core.clone(e),window.flags=core.status.hero.flags,core.events.setHeroIcon(core.getFlag("heroIcon","hero.png"),!0),core.control._initStatistics(core.animateFrame.totalTime),core.status.hero.statistics.totalTime=core.animateFrame.totalTime=Math.max(core.status.hero.statistics.totalTime,core.animateFrame.totalTime),core.status.hero.statistics.start=null,core.status.hard=t||"",core.status.floorId=o,core.status.maps=r,core.material.enemys=core.enemys.getEnemys(),core.material.items=core.items.getItems(),core.items._resetItems(),core.values=core.clone(core.data.values),a||{})core.values[n]=a[n];core.flags=core.clone(core.data.flags);var i=core.getFlag("globalFlags",{});for(var n in i)core.flags[n]=i[n];core._init_sys_flags(),core.resize(),core.updateGlobalAttribute(),core.hasFlag("hideStatusBar")?core.hideStatusBar(core.hasFlag("showToolbox")):core.showStatusBar(),core.dom.musicBtn.style.display="none",pixi.event.emit("resetGame")},setInitData:function(){"Easy"==core.status.hard&&core.setFlag("hard",1),"Normal"==core.status.hard&&core.setFlag("hard",2),"Hard"==core.status.hard&&core.setFlag("hard",3),"Hell"==core.status.hard&&core.setFlag("hard",4),core.setFlag("__visited__",{})},win:function(e,t,o){o&&(core.status.extraEvent=core.clone(core.status.event)),core.ui.closePanel();var r=core.isReplaying();r&&core.stopReplay(),core.waitHeroToStop((function(){o||(core.clearMap("all"),core.deleteAllCanvas(),core.dom.gif2.innerHTML=""),e=core.replaceText(e),core.drawText(["\t["+(e||"恭喜通关")+"]你的分数是${status:hp}。"],(function(){core.events.gameOver(e||"",r,t)}))}))},lose:function(e){core.ui.closePanel();var t=core.isReplaying();core.stopReplay(),core.waitHeroToStop((function(){core.drawText(["\t["+(e||"结局1")+"]你死了。\n如题。"],(function(){core.events.gameOver(null,t)}))}))},changingFloor:function(e,t,o){var r=core.status.floorId||null;if(core.hasFlag("__leaveLoc__")||core.setFlag("__leaveLoc__",{}),null!=r&&(core.getFlag("__leaveLoc__")[r]=core.status.hero.loc),core.maps.resizeMap(e),o||core.status.maps[e].blocks.forEach((function(e){e.disable&&core.enemys.hasSpecial(e.event.id,23)&&(e.disable=!1)})),core.status.hero.loc=t,core.control.gatherFollowers(),core.drawMap(e),pixi.event.emit("drawMap"),core.status.maps[e].bgm){var a=core.status.maps[e].bgm;a instanceof Array&&(a=a[0]),core.hasFlag("__bgm__")||core.playBgm(a)}var n=core.getFlag("__color__",null);!n&&core.status.maps[e].color&&(n=core.status.maps[e].color),core.clearMap("curtain"),core.status.curtainColor=n,n&&core.fillRect("curtain",0,0,core.__PIXELS__,core.__PIXELS__,core.arrayToRGBA(n));var i=core.getFlag("__weather__",null);!i&&core.status.maps[e].weather&&(i=core.status.maps[e].weather),i?core.setWeather(i[0],i[1]):core.setWeather()},afterChangeFloor:function(e,t){t?(core.events.recoverEvents(core.getFlag("__events__")),core.removeFlag("__events__")):(core.insertAction(core.floors[e].eachArrive),core.hasVisitedFloor(e)||(core.insertAction(core.floors[e].firstArrive),core.visitFloor(e)))},flyTo:function(e,t){var o=core.status.floorId;if(!core.status.maps[o].canFlyTo||!core.status.maps[e].canFlyTo||!core.hasVisitedFloor(e))return core.drawTip("无法飞往"+core.status.maps[e].title+"！"),!1;var r=null,a=null;if(core.flags.flyRecordPosition&&(a=core.getFlag("__leaveLoc__",{})[e]||null),null==a){var n=core.floorIds.indexOf(o),i=core.floorIds.indexOf(e);r=n<=i?"downFloor":"upFloor";n==i&&core.status.maps[o].underGround&&(r="upFloor")}return core.status.route.push("fly:"+e),core.ui.closePanel(),core.changeFloor(e,r,a,null,t),!0},beforeBattle:function(e,t,o){if(null!=t&&null!=o){var r=t+","+o,a=(core.status.checkBlock.cache[r]||{}).guards||[];if(a.length>0){core.setFlag("__guards__"+t+"_"+o,a);var n=[];return a.forEach((function(e){core.push(n,{type:"jump",from:[e[0],e[1]],to:[t,o],time:300,keep:!1,async:!0})})),core.push(n,[{type:"waitAsync"},{type:"trigger",loc:[t,o]}]),core.insertAction(n),!1}}return!0},afterBattle:function(e,t,o,r){var a=core.material.enemys[e],n="hand",i=(core.status.hero.equipment||[])[0];i&&(core.material.items[i].equip||{}).animate&&(n=core.material.items[i].equip.animate),(core.material.animates[n]||{}).se||core.playSound("attack.mp3"),null!=t&&null!=o?core.drawAnimate(n,t,o):core.drawHeroAnimate(n);var s=core.enemys.getDamage(e,t,o);if(null==s&&(s=core.status.hero.hp+1),core.status.hero.hp-=s,core.status.hero.statistics.battleDamage+=s,core.status.hero.statistics.battle++,core.status.hero.hp<=0)return core.status.hero.hp=0,core.updateStatusBar(),void core.events.lose("战斗失败");var c=[];null!=t&&null!=o&&(core.removeBlock(t,o),c=core.getFlag("__guards__"+t+"_"+o,[]),core.removeFlag("__guards__"+t+"_"+o));var l=c.reduce((function(e,t){return e+core.material.enemys[t[2]].money}),a.money);core.hasItem("coin")&&(l*=2),core.hasFlag("curse")&&(l=0),core.status.hero.money+=l,core.status.hero.statistics.money+=l;var u=c.reduce((function(e,t){return e+core.material.enemys[t[2]].experience}),a.experience);core.hasFlag("curse")&&(u=0),core.status.hero.experience+=u,core.status.hero.statistics.experience+=u;var p="打败 "+a.name;core.flags.enableMoney&&(p+="，金币+"+l),core.flags.enableExperience&&(p+="，经验+"+u),core.drawTip(p,a.id);var d=[],f=a.special;(core.enemys.hasSpecial(f,12)&&core.push(d,[{type:"insert",name:"毒衰咒处理",args:[0]}]),core.enemys.hasSpecial(f,13)&&core.push(d,[{type:"insert",name:"毒衰咒处理",args:[1]}]),core.enemys.hasSpecial(f,14)&&core.push(d,[{type:"insert",name:"毒衰咒处理",args:[2]}]),core.flags.hatredDecrease&&core.enemys.hasSpecial(f,17)&&core.setFlag("hatred",Math.floor(core.getFlag("hatred",0)/2)),core.enemys.hasSpecial(f,19)&&(core.status.hero.statistics.battleDamage+=core.status.hero.hp-1,core.status.hero.hp=1),core.enemys.hasSpecial(f,21)&&(core.status.hero.atk-=a.atkValue||0,core.status.hero.def-=a.defValue||0,core.status.hero.atk<0&&(core.status.hero.atk=0),core.status.hero.def<0&&(core.status.hero.def=0)),core.setFlag("hatred",core.getFlag("hatred",0)+core.values.hatred),core.flags.enableSkill)&&(1==core.getFlag("skill",0)&&(core.status.hero.mana-=5),core.setFlag("skill",0),core.setFlag("skillName","无"));var m=core.material.enemys[e].point;core.flags.enableAddPoint&&m>0&&core.push(d,[{type:"insert",name:"加点事件",args:[m]}]),core.push(d,core.floors[core.status.floorId].afterBattle[t+","+o]),d.length>0&&core.insertAction(d,t,o),core.updateStatusBar(),null==core.status.event.id?core.continueAutomaticRoute():core.clearContinueAutomaticRoute(),r&&r()},afterOpenDoor:function(e,t,o,r){var a=[],n=core.floors[core.status.floorId].afterOpenDoor[t+","+o];n&&core.unshift(a,n),a.length>0&&core.insertAction(a,t,o),null==core.status.event.id?core.continueAutomaticRoute():core.clearContinueAutomaticRoute(),r&&r()},afterGetItem:function(e,t,o,r){core.playSound("item.mp3");var a=[],n=core.floors[core.status.floorId].afterGetItem[t+","+o];n&&core.unshift(a,n),a.length>0&&core.insertAction(a,t,o),r&&r()},afterChangeLight:function(e,t){},afterPushBox:function(){core.searchBlock("box").length},afterUseBomb:function(){},afterPassNet:function(e,t,o){},canUseQuickShop:function(e){return!1===core.status.thisMap.canUseQuickShop?"当前楼层不能使用快捷商店。":null}},enemys:{getSpecials:function(){return[[1,"先攻","怪物首先攻击"],[2,"魔攻","怪物无视勇士的防御"],[3,"坚固","勇士每回合最多只能对怪物造成1点伤害"],[4,"2连击","怪物每回合攻击2次"],[5,"3连击","怪物每回合攻击3次"],[6,function(e){return(e.n||4)+"连击"},function(e){return"怪物每回合攻击"+(e.n||4)+"次"}],[7,"破甲","战斗前，怪物附加角色防御的"+Math.floor(100*core.values.breakArmor||0)+"%作为伤害"],[8,"反击","战斗时，怪物每回合附加角色攻击的"+Math.floor(100*core.values.counterAttack||0)+"%作为伤害，无视角色防御"],[9,"净化","战斗前，怪物附加勇士魔防的"+core.values.purify+"倍作为伤害"],[10,"模仿","怪物的攻防和勇士攻防相等"],[11,"吸血",function(e){return"战斗前，怪物首先吸取角色的"+Math.floor(100*e.value||0)+"%生命（约"+Math.floor((e.value||0)*core.getStatus("hp"))+"点）作为伤害"+(e.add?"，并把伤害数值加到自身生命上":"")}],[12,"中毒","战斗后，勇士陷入中毒状态，每一步损失生命"+core.values.poisonDamage+"点"],[13,"衰弱","战斗后，勇士陷入衰弱状态，攻防暂时下降"+(core.values.weakValue>=1?core.values.weakValue+"点":parseInt(100*core.values.weakValue)+"%")],[14,"诅咒","战斗后，勇士陷入诅咒状态，战斗无法获得金币和经验"],[15,"领域",function(e){return"经过怪物周围"+(e.zoneSquare?"九宫格":"十字")+"范围内"+(e.range||1)+"格时自动减生命"+(e.value||0)+"点"}],[16,"夹击","经过两只相同的怪物中间，勇士生命值变成一半"],[17,"仇恨","战斗前，怪物附加之前积累的仇恨值作为伤害"+(core.flags.hatredDecrease?"；战斗后，释放一半的仇恨值":"")+"。（每杀死一个怪物获得"+(core.values.hatred||0)+"点仇恨值）"],[18,"阻击",function(e){return"经过怪物的十字领域时自动减生命"+(e.value||0)+"点，同时怪物后退一格"}],[19,"自爆","战斗后勇士的生命值变成1"],[20,"无敌","勇士无法打败怪物，除非拥有十字架"],[21,"退化",function(e){return"战斗后勇士永久下降"+(e.atkValue||0)+"点攻击和"+(e.defValue||0)+"点防御"}],[22,"固伤",function(e){return"战斗前，怪物对勇士造成"+(e.damage||0)+"点固定伤害，无视勇士魔防。"}],[23,"重生","怪物被击败后，角色转换楼层则怪物将再次出现"],[24,"激光",function(e){return"经过怪物同行或同列时自动减生命"+(e.value||0)+"点"}],[25,"光环",function(e){return"同楼层所有怪物生命提升"+(e.value||0)+"%，攻击提升"+(e.atkValue||0)+"%，防御提升"+(e.defValue||0)+"%，"+(e.add?"可叠加":"不可叠加")}],[26,"支援","当周围一圈的怪物受到攻击时将上前支援，并组成小队战斗。"],[27,"捕捉","当走到怪物周围十字时会强制进行战斗。"]]},getEnemyInfo:function(e,t,o,r,a){a=a||core.status.floorId;core.getRealStatusOrDefault(t,"hp");var n=core.getRealStatusOrDefault(t,"atk"),i=core.getRealStatusOrDefault(t,"def"),s=(core.getRealStatusOrDefault(t,"mdef"),e.hp),c=e.atk,l=e.def,u=e.special,p=e.money,d=e.experience,f=e.point;core.hasSpecial(u,10)&&(c=n,l=i),core.hasSpecial(u,3)&&l<n-1&&(l=n-1);var m=[];if(core.inArray(["MTx"],a)){var h=0,y=0,g=0,v=0,_=null!=o&&null!=r?o+","+r:"floor";core.status.checkBlock||(core.status.checkBlock={}),core.status.checkBlock.cache||(core.status.checkBlock.cache={});var w=core.status.checkBlock.cache[_];w?(h=w.hp_buff,y=w.atk_buff,g=w.def_buff,m=w.guards):(core.status.maps[a].blocks.forEach((function(e){if(!e.disable){var t=e.event.id,a=core.material.enemys[t];a&&core.hasSpecial(a.special,25)&&(a.add||0==v)&&(h+=a.value||0,y+=a.atkValue||0,g+=a.defValue||0,v++),a&&core.hasSpecial(a.special,26)&&null!=o&&null!=r&&Math.abs(e.x-o)<=1&&Math.abs(e.y-r)<=1&&(o!=e.x||r!=e.y)&&m.push([e.x,e.y,t])}})),core.status.checkBlock.cache[_]={hp_buff:h,atk_buff:y,def_buff:g,guards:m}),s*=1+h/100,c*=1+y/100,l*=1+g/100}return{hp:Math.floor(s),atk:Math.floor(c),def:Math.floor(l),money:Math.floor(p),experience:Math.floor(d),point:Math.floor(f),special:u,guards:m}},getDamageInfo:function(e,t,o,r,a){a=a||core.status.floorId;var n=core.getRealStatusOrDefault(t,"hp"),i=core.getRealStatusOrDefault(t,"atk"),s=core.getRealStatusOrDefault(t,"def"),c=core.getRealStatusOrDefault(t,"mdef"),l=core.getStatusOrDefault(t,"hp"),u=core.getStatusOrDefault(t,"atk"),p=core.getStatusOrDefault(t,"def");n=Math.max(0,n),i=Math.max(0,i),s=Math.max(0,s),c=Math.max(0,c);var d=core.enemys.getEnemyInfo(e,t,o,r,a),f=d.hp,m=d.atk,h=d.def,y=d.special;if(1==core.getFlag("skill",0)&&(i*=2),core.hasSpecial(y,20)&&!core.hasItem("cross"))return null;var g=0;if(core.hasSpecial(y,11)){var v=n*e.value;v=Math.floor(v)||0,e.add&&(f+=v),g+=v}var _=m-s;core.hasSpecial(y,2)&&(_=m),_<0&&(_=0),core.hasSpecial(y,4)&&(_*=2),core.hasSpecial(y,5)&&(_*=3),core.hasSpecial(y,6)&&(_*=e.n||4);var w=0;core.hasSpecial(y,8)&&(w+=Math.floor(core.values.counterAttack*i)),core.hasSpecial(y,1)&&(g+=_),core.hasSpecial(y,7)&&(g+=Math.floor(core.values.breakArmor*s)),core.hasSpecial(y,9)&&(g+=Math.floor(core.values.purify*c));var x=Math.max(i-h,0);if(x<=0)return null;var b=Math.ceil(f/x),S=core.getFlag("__guards__"+o+"_"+r,d.guards);if(b+=core.getFlag("__extraTurn__",0),S.length>0){core.setFlag("__extraTurn__",b);for(var k=0;k<S.length;k++){S[k][0],S[k][1];var I=S[k][2],A=core.enemys.getDamageInfo(core.material.enemys[I],{hp:l,atk:u,def:p,mdef:0});if(null==A)return null;core.setFlag("__extraTurn__",A.turn),g+=A.damage}0}core.removeFlag("__extraTurn__");var E=g+(b-1)*_+b*w;return E-=c,core.flags.enableNegativeDamage||(E=Math.max(0,E)),{mon_hp:Math.floor(f),mon_atk:Math.floor(m),mon_def:Math.floor(h),init_damage:Math.floor(g),per_damage:Math.floor(_),hero_per_damage:Math.floor(x),turn:Math.floor(b),damage:Math.floor(E)}}},actions:{onKeyUp:function(e,t){if(!core.isMoving())if(t&&e>=48&&e<=57)core.items.quickLoadEquip(e-48);else switch(e){case 27:core.openSettings(!0);break;case 88:core.openBook(!0);break;case 71:core.useFly(!0);break;case 65:core.doSL("autoSave","load");break;case 83:core.save(!0);break;case 68:core.load(!0);break;case 69:core.ui.drawCursor();break;case 84:core.openToolbox(!0);break;case 81:core.openEquipbox(!0);break;case 90:core.turnHero();break;case 75:case 86:core.openQuickShop(!0);break;case 32:core.getNextItem();break;case 82:core.actions._clickSyncSave_replay();break;case 33:case 34:core.ui.drawMaps();break;case 77:core.ui.drawPaint();break;case 66:core.ui.drawStatistics();break;case 72:core.ui.drawHelp();break;case 78:core.confirmRestart();break;case 79:core.actions._clickGameInfo_openProject();break;case 80:core.actions._clickGameInfo_openComments();break;case 49:core.hasItem("pickaxe")&&(core.canUseItem("pickaxe")?(core.status.route.push("key:49"),core.useItem("pickaxe",!0)):core.drawTip("当前不能使用破墙镐"));break;case 50:core.hasItem("bomb")?core.canUseItem("bomb")?(core.status.route.push("key:50"),core.useItem("bomb",!0)):core.drawTip("当前不能使用炸弹"):core.hasItem("hammer")&&(core.canUseItem("hammer")?(core.status.route.push("key:50"),core.useItem("hammer",!0)):core.drawTip("当前不能使用圣锤"));break;case 51:core.hasItem("centerFly")&&core.ui.drawCenterFly();break;case 52:for(var o=["icePickaxe","snow","earthquake","upFly","downFly","jumpShoes","lifeWand","poisonWine","weakWine","curseWine","superWine"],r=0;r<o.length;r++){var a=o[r];if(core.canUseItem(a)){core.status.route.push("key:52"),core.useItem(a,!0);break}}break;case 55:core.getNextItem();break;case 118:core.debug();break;case 87:core.hasItem("skill1")&&(core.status.route.push("key:87"),core.useItem("skill1",!0))}},onStatusBarClick:function(e,t){core.status.lockControl||core.isMoving()}},control:{saveData:function(){var e={};for(var t in core.values)core.same(core.values[t],core.data.values[t])||(e[t]=core.clone(core.values[t]));var o={floorId:core.status.floorId,hero:core.clone(core.status.hero),hard:core.status.hard,maps:core.maps.saveMap(),route:core.encodeRoute(core.status.route),values:e,shops:{},version:core.firstData.version,time:(new Date).getTime()};for(var r in core.flags.checkConsole&&(o.hashCode=core.utils.hashCode(o.hero)),core.status.shops)o.shops[r]={times:core.status.shops[r].times||0,visited:core.status.shops[r].visited||!1};return o},loadData:function(e,t){for(var o in core.resetGame(e.hero,e.hard,e.floorId,core.maps.loadMap(e.maps),e.values),core.status.route=core.decodeRoute(e.route),core.status.shops)e.shops[o]&&(core.status.shops[o].times=e.shops[o].times,core.status.shops[o].visited=e.shops[o].visited);core.status.textAttribute=core.getFlag("textAttribute",core.status.textAttribute);var r=core.getFlag("globalAttribute",core.status.globalAttribute);core.same(r,core.status.globalAttribute)||(core.status.globalAttribute=r,core.updateGlobalAttribute()),core.events.setVolume(core.getFlag("__volume__",1),0);var a=core.getFlag("heroIcon","hero.png");a=core.getMappedName(a),core.changeFloor(e.floorId,null,e.hero.loc,0,(function(){core.hasFlag("__bgm__")&&core.playBgm(core.getFlag("__bgm__")),t&&t()}),!0)},updateStatusBar:function(){pixi.event.fresh("updateStatusBar")},updateCheckBlock:function(e){if((e=e||core.status.floorId)&&core.status.maps){var t=core.floors[e].width,o=core.floors[e].height,r=core.getMapBlocksObj(e),a={},n={},i={},s={};for(var c in r){var l=r[c],u=l.x,p=l.y,d=l.event.id,f=core.material.enemys[d];if("lavaNet"!=d||"passNet"!=l.event.trigger||core.hasItem("shoes")||(a[c]=(a[c]||0)+core.values.lavaDamage,n[c]="血网伤害"),f&&core.hasSpecial(f.special,15)&&!core.hasFlag("no_zone")){var m=f.range||1,h=!1;null!=f.zoneSquare&&(h=f.zoneSquare);for(var y=-m;y<=m;y++)for(var g=-m;g<=m;g++)if(0!=y||0!=g){var v=(S=u+y)+","+(k=p+g);S<0||S>=t||k<0||k>=o||!h&&Math.abs(y)+Math.abs(g)>m||(a[v]=(a[v]||0)+(f.value||0),n[v]="领域伤害")}}if(f&&core.hasSpecial(f.special,18)&&!core.hasFlag("no_snipe"))for(var _ in core.utils.scan){v=(S=u+core.utils.scan[_].x)+","+(k=p+core.utils.scan[_].y);if(!(S<0||S>=t||k<0||k>=o)){a[v]=(a[v]||0)+(f.value||0),n[v]="阻击伤害";var w=core.reverseDirection(_),x=u+core.utils.scan[w].x,b=p+core.utils.scan[w].y;x>=0&&x<t&&b>=0&&b<o&&null==core.getBlock(x,b,e)&&(i[v]=(i[v]||[]).concat([[u,p,d,w]]))}}if(f&&core.hasSpecial(f.special,24)&&!core.hasFlag("no_laser")){for(var S=0;S<t;S++){v=S+","+p;S!=u&&(a[v]=(a[v]||0)+(f.value||0),n[v]="激光伤害")}for(var k=0;k<o;k++){v=u+","+k;k!=p&&(a[v]=(a[v]||0)+(f.value||0),n[v]="激光伤害")}}if(f&&core.enemys.hasSpecial(f.special,27))for(var _ in core.utils.scan){v=(S=u+core.utils.scan[_].x)+","+(k=p+core.utils.scan[_].y);S<0||S>=t||k<0||k>=o||(s[v]=(s[v]||[]).concat([[u,p,d,_]]))}}if(!core.hasFlag("no_betweenAttack"))for(u=0;u<t;u++)for(p=0;p<o;p++){c=u+","+p;var I=null,A=r[u-1+","+p],E=r[u+1+","+p];A&&E&&A.id==E.id&&core.hasSpecial(A.event.id,16)&&(I=A.event.id);var T=r[u+","+(p-1)],F=r[u+","+(p+1)];if(T&&F&&T.id==F.id&&core.hasSpecial(T.event.id,16)&&(I=T.event.id),null!=I){var B=core.status.hero.hp-(a[c]||0);if(B>1){var C=Math.floor((B+(core.flags.betweenAttackCeil?1:0))/2);if(core.flags.betweenAttackMax){var P=core.getDamage(I,u,p,e);null!=P&&P<C&&(C=P)}C>0&&(a[c]=(a[c]||0)+C,n[c]="夹击伤害")}}}core.status.checkBlock={damage:a,type:n,snipe:i,ambush:s,cache:{}}}},moveOneStep:function(e,t){if(core.setHeroLoc("x",e,!0),core.setHeroLoc("y",t,!0),core.status.hero.steps++,core.updateFollowers(),core.drawHero(),core.hasFlag("poison")&&(core.status.hero.statistics.poisonDamage+=core.values.poisonDamage,core.status.hero.hp-=core.values.poisonDamage,core.status.hero.hp<=0))return core.status.hero.hp=0,core.updateStatusBar(),void core.events.lose()},moveDirectly:function(e,t,o){if(null==o&&(o=core.canMoveDirectly(e,t)),o>=0){core.clearMap("hero");var r=core.status.route[core.status.route.length-1];return["left","right","up","down"].indexOf(r)>=0&&core.setHeroLoc("direction",r),core.setHeroLoc("x",e),core.setHeroLoc("y",t),core.drawHero(),core.status.route.push("move:"+e+":"+t),core.status.hero.statistics.moveDirectly++,core.status.hero.statistics.ignoreSteps+=o,!0}return!1},parallelDo:function parallelDo(timestamp){if(core.isPlaying()&&core.status.floorId)try{eval(core.floors[core.status.floorId].parallelDo)}catch(e){main.log(e)}}},ui:{drawStatusBar:function(){if(core.flags.statusCanvas){var e=core.dom.statusCanvas,t=core.dom.statusCanvasCtx;if(t.clearRect(0,0,e.width,e.height),core.domStyle.showStatusBar){t.fillStyle=core.status.globalAttribute.statusBarColor||core.initStatus.globalAttribute.statusBarColor,t.font="italic bold 18px Verdana";var o=6,r=9,a=39;core.domStyle.isVertical&&(o=6,r=6,a=32);for(var n=["floor","hp","atk","def","mdef","money"],i=0;i<n.length;i++){var s=n[i];t.drawImage(core.statusBar.icons[s],o,r,25,25);var c=(core.statusBar[s]||{}).innerText||" ";/^[-a-zA-Z0-9`~!@#$%^&*()_=+\[{\]}\\|;:'",<.>\/?]*$/.test(c)||(t.font="bold 18px Verdana"),t.fillText(c,o+36,r+20),t.font="italic bold 18px Verdana",core.domStyle.isVertical?i%3!=2?o+=131:(o=6,r+=a):r+=a}t.fillStyle="#FFCCAA",t.fillText(core.statusBar.yellowKey.innerText,o+5,r+20),t.fillStyle="#AAAADD",t.fillText(core.statusBar.blueKey.innerText,o+40,r+20),t.fillStyle="#FF8888",t.fillText(core.statusBar.redKey.innerText,o+75,r+20)}}},drawStatistics:function(){return["yellowDoor","blueDoor","redDoor","greenDoor","steelDoor","yellowKey","blueKey","redKey","greenKey","steelKey","redJewel","blueJewel","greenJewel","yellowJewel","redPotion","bluePotion","greenPotion","yellowPotion","superPotion","pickaxe","bomb","centerFly","icePickaxe","snow","earthquake","upFly","downFly","jumpShoes","lifeWand","poisonWine","weakWine","curseWine","superWine","sword1","sword2","sword3","sword4","sword5","shield1","shield2","shield3","shield4","shield5"]},drawAbout:function(){core.ui.closePanel(),core.lockControl(),core.status.event.id="about";var e=core.__PIXELS__-96,t=core.__PIXELS__-72;core.setAlpha("ui",.85),core.fillRect("ui",48,36,e,t,"#000000"),core.setAlpha("ui",1),core.strokeRect("ui",47,35,e+1,t+1,"#FFFFFF",2);core.setTextAlign("ui","left");var o=(core.status.globalAttribute||core.initStatus.globalAttribute).font;core.fillText("ui","HTML5 魔塔样板",72,71,"#FFD700","bold 22px "+o),core.fillText("ui","版本： "+main.__VERSION__,72,116,"#FFFFFF","bold 17px "+o),core.fillText("ui","作者： 艾之葵",72,148),core.fillText("ui","HTML5魔塔交流群：539113091",72,180)}}};module.exports=functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a},function(e,t,o){"use strict";var r=o(0),a=o(2).c.getScene("event"),n=[],i=[],s=function(e){e.changeTo({alpha:0},500,(function(){e.remove()}))},c=function(e,t){return a.addNode("sprite",{texture:r.Texture.ROUNDWHITE,init:function(){this.scale.set(.3,.3),this.alpha=.6},data:{x:32*e+16,y:32*t+16,anchor:{x:.5,y:.5}}})},l={fillPosWithPoint:function(e){var t=core.bigmap,o=t.offsetX,r=t.offsetY,a=e.x+o/32,i=e.y+r/32;n.push(c(a,i))},drawRoute:function(e){var t=e.length;e.forEach((function(e,o){var n,s;o===t-1?i.push((n=e.x,s=e.y,a.addNode("sprite",{texture:r.Texture.ROUNDWHITE,init:function(){this.loop({alpha:.3},{alpha:.8},400).onUpdate((function(e){e.scale.set(1.5*e.alpha,1.5*e.alpha)}))},data:{x:32*n+16,y:32*s+16,anchor:{x:.5,y:.5}}}))):i.push(c(e.x,e.y))}))},clear:function(){n.forEach((function(e){return s(e)})),n=[],i.forEach((function(e){return s(e)})),i=[]},clearAutomaticRouteNode:function(e,t){0!==i.length&&i.shift().remove()},wrong:function(e,t){var o=c(e,t);o.texture=r.Texture.RED,o.scale.set(1,1),o.changeTo({alpha:0},500,(function(){o.remove()}))}};t.a=l},,function(e,t,o){"use strict";var r=o(0),a=o(7),n=o(3),i=o(2),s=o(1),c=i.d.addScene("loading","main");n.a.once("easingEnd",(function(){c.destroy()})),c.on("show",(function(e){this.addNode("zone"),this.addNode("text",{text:"0.00",style:e.fontStyle,update:function(){this.text=e.progress},start:function(){s.a.setLoc(this,.5,.5,.5,.5)}}),this.addNode("graphics",{start:function(){this.lineStyle(4,16777215),s.a.setLoc(this,.5,.5,.5,.6),this.moveTo(-100,0),this.lineTo(100,0)},update:function(){this.width=3*e._progress}})}));var l=c,u=o(26),p=o(22),d={},f=function e(t,o){if(t instanceof Array)return t.forEach((function(t){return e(t,o)}));var r=d[t];if(!r)return console.warn("未发现id为".concat(t,"的图片"));d[t]=o(r)},m=function(e){d=e;var t={};f(["hero","route"],(function(e){return s.a.splitTexture(e,["down","left","right","up"],4)})),f(["animateDoor"],(function(e){var o=s.a.splitTextureByCol(e,["yellowDoor","blueDoor","redDoor","specialDoor"],4);return Object.keys(o).forEach((function(e){t[e]=new p.a(o[e])})),o}));var o=e.animates;Object.keys(o).forEach((function(e){t[e]=new u.default(e)})),core.material.animates=t,d=null};function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==o)return;var r,a,n=[],i=!0,s=!1;try{for(o=o.call(e);!(i=(r=o.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(s)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function g(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var v=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._progress=0,this.progressWord="",this.length=0,this.textures={},this._tweens=null,this.callback=null,this.packer=t,this.fontStyle=new r.TextStyle({fontStyle:"bold",fill:"white",fontSize:"40px",align:"center",stroke:"blue",strokeThickness:2})}var t,o,i;return t=e,i=[{key:"parseName",value:function(e){var t=e.lastIndexOf(".");return-1===t?[e,""]:[e.slice(0,t),e.slice(t+1)]}},{key:"handleTextures",value:function(e){m(e);var t=e._info;t instanceof Object&&Object.keys(t).forEach((function(o){var a=t[o].animate;if(1!==a){var n=e[o];if(n instanceof r.Texture){var i=h(s.a.splitTexture(n,1,a),1);e[o]=i[0]}}}))}},{key:"handleHero",value:function(e){return s.a.splitTexture(e,["down","left","right","up"],4)}}],(o=[{key:"progress",get:function(){return"".concat(this._progress.toString(10).slice(0,4),"%")}},{key:"start",value:function(){this.loadPacker(this.packer),l.show(this)}},{key:"emitChange",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return null!==this._tweens&&(this._tweens.destroy(),this._tweens=null),e||(e=this._progress+200/this.length/3,o*=5),console.log(e,o),this._tweens=new a.a.Tween(this).to({_progress:e},o).onUpdate((function(e){})).easing(a.a.Easing.Linear.None).start(),r&&e<100?this._tweens.onComplete((function(e){t.emitChange(null,o,!1)})):e>=100&&this._tweens.onComplete((function(e){console.log("Easing end"),n.a.emit("easingEnd")})),this._tweens}},{key:"loadPacker",value:function(t){var o=this,a=this.textures,i={};t.keys().forEach((function(o){var r=o.slice(2),a=h(e.parseName(r),2),n=a[0],s=a[1];i[n]||(i[n]={});var c=i[n];["png","jpg","ico","gif"].includes(s.toLowerCase())?c.image=t(o).default:"json"===s.toLowerCase()&&(c.data=t(o))}));var s=r.Spritesheet,c=new(0,r.Loader),l=Object.keys(i);return this.length=l.length,l.forEach((function(e){var t=i[e];!t.data||t.image?c.add(t.image,(function(o){var r=o.texture.baseTexture;t.data?new s(r,t.data).parse((function(e){Object.assign(a,e)})):a[e]=r})):a[e]=t.data})),c.onProgress.add((function(e){o.emitChange(e.progress)})),c.onComplete.add((function(){e.handleTextures(a),n.a.emit("loadComplete",a),o.complete=!0})),c.load(),this.emitChange(),c}}])&&g(t.prototype,o),i&&g(t,i),e}())(o(58));v.start();t.a=v},function(e,t,o){"use strict";var r=o(3),a=o(14),n=o(5),i=o(9),s=o(4),c=(o(0),{book:function(e){return s.a.setNode(e,{update:function(){this.angle+=1}}),e},fly:function(e){return s.a.setNode(e,{update:function(){this.angle+=1}}),e}});function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=a.a.textures,p=function(){function e(t,o,r,a,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t)return null;var i;if(this.id=t.number,this.x=o,this.y=r,this.event=t,Object.defineProperty(this,"texture",{enumerable:!1,configurable:!0,value:u[t.id]}),a&&(0!==(i=this.event).cls.indexOf("enemy")||i.trigger||(i.trigger="battle"),"items"!==i.cls||i.trigger||(i.trigger="getItem"),null==i.noPass&&"items"!==i.cls&&(i.noPass=!0)),n){this.addEvent((n.events||{})["".concat(o,",").concat(r)]);var s=(n.changeFloor||{})["".concat(o,",").concat(r)];s instanceof Object&&this.addEvent({trigger:"changeFloor",data:s})}}var t,o,r;return t=e,(o=[{key:"disable",get:function(){return this._disable},set:function(e){this._disable=e,e?this.hide():this.show("event")}},{key:"clone",value:function(){var e=new this.constructor;return n.a.cloneTo(e,this),this.texture&&Object.defineProperty(e,"texture",{enumerable:!1,configurable:!0,value:this.texture}),e}},{key:"getInfo",value:function(){var e={number:this.event.number,name:this.name,id:this.event.id,cls:this.event.cls,texture:this.texture,faceIds:this.event.faceIds||{}},t=e.id,o=e.cls;return o.startsWith("enemy")?core.material.enemys[t]&&(e.name=core.material.enemys[t].name):o.startsWith("item")&&core.material.items[t]&&(e.name=core.material.items[t].name),this.texture&&(e.height=this.texture instanceof Array?this.texture[0].height:this.texture.height),e}},{key:"getNode",value:function(){var e=s.a.getNode("sprite",{texture:this.texture,disable:!0});e.anchor.set(.5,.5);var t=this.event.id;return c[t]instanceof Function?c[t].call(this,e):e}},{key:"drawTo",value:function(e){var t=this.x,o=this.y;this.id,e instanceof i.a||(e=pixi.game.getScene(e));var r=this.getNode();return r.position.set(32*t+16,32*o+32-r.height/2),e instanceof i.a&&(this.sprite=r),e.addNode(r),r}},{key:"show",value:function(e){"string"==typeof e&&(e=pixi.game.getScene(e)),e instanceof Object&&this.drawTo(this.scene)}},{key:"hide",value:function(){this.sprite&&this.sprite.remove(),delete this.sprite}},{key:"addEvent",value:function(e){if(e){for(var t in"string"==typeof e?e={data:[e]}:e instanceof Array&&(e={data:e}),e.data=e.data||[],null==this.disable&&null!=e.enable&&(this.disable=!e.enable),!1===e.animate&&(this.animate=1),e)"enable"!==t&&"animate"!==t&&null!=e[t]&&(this.event[t]=core.clone(e[t]));this.event.trigger||(this.event.trigger="action")}}},{key:"destroy",value:function(){delete this.texture,delete this.sprite,this.event=null,this.destroyed=!0}}])&&l(t.prototype,o),r&&l(t,r),e}(),d=o(1);function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return h(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,r=x(e);if(t){var a=x(this).constructor;o=Reflect.construct(r,arguments,a)}else o=r.apply(this,arguments);return w(this,o)}}function w(e,t){if(t&&("object"===f(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var b={_drawAutotile:function(e,t,o){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=o.x,c=o.y,l=o.texture,u=0,p={},d=function(e,o){return r._drawAutotile_getAutotileAroundId(t[c][s],e,o,t)?1:0},f=[];[-1,0,1].forEach((function(e){f[e]=[],[-1,0,1].forEach((function(t){f[e][t]=d(s+e,c+t)}))})),f[-1][-1]+f[0][-1]+f[0][0]+f[-1][0]!=3||f[-1][-1]||(this._drawAutotile_render(e,s*a+n,c*a+i,a,l,u,16),p[0]=!0),f[0][-1]+f[1][-1]+f[1][0]+f[0][0]!=3||f[1][-1]||(this._drawAutotile_render(e,s*a+n+a/2,c*a+i,a,l,u,17),p[1]=!0),f[0][0]+f[1][0]+f[1][1]+f[0][1]!=3||f[1][1]||(this._drawAutotile_render(e,s*a+n+a/2,c*a+i+a/2,a,l,u,18),p[3]=!0),f[-1][0]+f[0][0]+f[0][1]+f[-1][1]!=3||f[-1][1]||(this._drawAutotile_render(e,s*a+n,c*a+i+a/2,a,l,u,19),p[2]=!0);var m=f[0][-1]+2*f[-1][0]+4*f[0][1]+8*f[1][0];this._drawAutotile_render(e,s*a,c*a,a,l,u,m,p)},_drawAutotile_getAutotileAroundId:function(e,t,o,r){return t<0||o<0||t>=r[0].length||o>=r.length?1:e===r[o][t]},_drawAutotile_render:function(e,t,o,r,a,n,i,s){var c=[[[0,0,32,32,t,o,r,r]],[[0,96,16,32,t,o,r/2,r],[80,96,16,32,t+r/2,o,r/2,r]],[[64,32,32,16,t,o,r,r/2],[64,112,32,16,t,o+r/2,r,r/2]],[[64,96,32,32,t,o,r,r]],[[0,32,16,32,t,o,r/2,r],[80,32,16,32,t+r/2,o,r/2,r]],[[0,64,16,32,t,o,r/2,r],[80,64,16,32,t+r/2,o,r/2,r]],[[64,32,32,32,t,o,r,r]],[[64,64,32,32,t,o,r,r]],[[0,32,32,16,t,o,r,r/2],[0,112,32,16,t,o+r/2,r,r/2]],[[0,96,32,32,t,o,r,r]],[[32,32,32,16,t,o,r,r/2],[32,112,32,16,t,o+r/2,r,r/2]],[[32,96,32,32,t,o,r,r]],[[0,32,32,32,t,o,r,r]],[[0,64,32,32,t,o,r,r]],[[32,32,32,32,t,o,r,r]],[[32,64,32,32,t,o,r,r]],[[64,0,16,16,t,o,r/2,r/2]],[[80,0,16,16,t,o,r/2,r/2]],[[80,16,16,16,t,o,r/2,r/2]],[[64,16,16,16,t,o,r/2,r/2]]][i];i>=16?d.a.drawImage(e,a,c[0][0],c[0][1],c[0][2],c[0][3],c[0][4],c[0][5],r/2,r/2):this._drawAutotile_renderCut(e,a,t,o,r,c,s)},_drawAutotile_renderCut:function(e,t,o,r,a,n,i){var s=[];if(i=i||{},2==n.length){var c=0,l=0;for(var u in n)n[u][2]%32?l=0:n[u][3]%32&&(l=1),c=n[u][0]%32||n[u][1]%32?1:0,l?(i[c*=2]||(s[c]=[n[u][0],n[u][1]]),i[c+1]||(s[c+1]=[parseInt(n[u][0])+16,n[u][1]])):(i[c]||(s[c]=[n[u][0],n[u][1]]),i[c+2]||(s[c+2]=[n[u][0],parseInt(n[u][1])+16]))}else i[0]||(s[0]=[n[0][0],n[0][1]]),i[1]||(s[1]=[n[0][0]+16,n[0][1]]),i[2]||(s[2]=[n[0][0],n[0][1]+16]),i[3]||(s[3]=[n[0][0]+16,n[0][1]+16]);for(u=0;u<4;u++){var p=s[u];p&&d.a.drawImage(e,t,p[0],p[1],16,16,o+u%2*a/2,r+parseInt(u/2)*a/2,a/2,a/2)}}},S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(c,e);var t,o,a,n=_(c);function c(){return y(this,c),n.apply(this,arguments)}return t=c,(o=[{key:"getNode",value:function(e){if(e){var t=e.args||[],o=r.a.fresh.apply(r.a,[e.id].concat(m(t))),a=s.a.getNode("sprite",{disable:!0});return b._drawAutotile(a,o,this),a}return d.a.getNode(this.texture,0,0,32,32)}},{key:"drawTo",value:function(e){e instanceof i.a||(e=pixi.game.getScene(e));var t=this.getNode(e);return e.addNode(t),e instanceof i.a&&(this.sprite=t),t}}])&&g(t.prototype,o),a&&g(t,a),c}(p);function k(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function I(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var A=a.a.textures,E=A._info,T=A._maps;r.a.setFresh("bg",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:core.status.floorId;return console.log(e),core.maps._getBgFgMapArray("bg",e,!0)})),r.a.setFresh("fg",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:core.status.floorId;return core.maps._getBgFgMapArray("fg",e,!0)})),r.a.setFresh("event",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:core.status.floorId,t=arguments.length>1?arguments[1]:void 0;t=t||core.status.maps[e].blocks;var o=core.floors[e],r=o.width,a=o.height;return core.maps._getMapArrayFromBlocks(t,r,a)}));var F={};F.get=function(e,t,o,r,a){var n,i=null;if(Number.isInteger(e))n=e;else{if(!e)return null;e.endsWith(":f")?i=!0:e.endsWith(":t")&&(i=!1),n=parseInt(e,10),Number.isNaN(n)&&(n=(E[e]||{}).num)}var s=T[n],c=s instanceof Object?function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?k(Object(o),!0).forEach((function(t){I(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):k(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({},s):{cls:"terrains",id:"none",noPass:!1};c.number=n;var l="autotile"===c.cls?new S(c,t,o,r,a):new p(c,t,o,r,a);return l._disable=i,l},F.getNumberById=function(e){if(Number.isInteger(e))return e;var t=parseInt(e,10);return Number.isNaN(t)&&(t=(E[e]||{}).num),t},F.getBlockByNumber=function(e){return this.isBlock(e)?e:this.get(e,0,0)},F.getInfo=function(e){if(e instanceof p)return e.getInfo();var t=this.get(e);return t?t.getInfo():{}},F.isBlock=function(e){return e instanceof p};t.a=F},function(e,t,o){"use strict";var r=o(0),a=o(3),n=o(4),i=o(15),s=o(1),c=o(5),l={getTexture:function(e){var t=window.pixi.textures;return e instanceof r.Texture?e:t[e]||t.error},addBlock:function(e,t,o){i.a.isBlock(t)||(t=i.a.get(t,0,0));var r=t,a=(r.texture,r.cls,t.drawTo(e));return Object.assign(a,o),a},drawImage:function(e,t,o,a,i,s,c,l,u,p){var d=this.getTexture(t);if(arguments.length>5){var f,m=new r.Rectangle(o,a,i,s);return d instanceof Array?(f=[],d.forEach((function(e){return f.push(new $.Texture(e,m))}))):f=new r.Texture(d,m),node=n.a.addNode("block",{texture:f,x:c,y:l,w:u,h:p}),f=null,node.destroyOptions={texture:!0},node}return node=n.a.addNode("block",{texture:d,x:o,y:a,w:i,h:s}),node},get shouldBlurFg(){return"editor"===main.mode||core.flags.blurFg},drawBgFgMap:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:core.status.floorId,o=arguments.length>2?arguments[2]:void 0,r=core.floors[t],n=r.width,s=r.height,c=(core.maps,a.a.fresh(o,t)),l=null;"fg"===o&&this.shouldBlurFg&&(l=a.a.fresh("event",t));for(var u=0;u<n;u++)for(var p=0;p<s;p++)if(0!==c[p][u]){var d=i.a.get(c[p][u],u,p);d.name=o,null!=l&&0!==l[p][u]?this.addBlock(e,d,{alpha:.6}):this.addBlock(e,d)}},drawBg:function(e,t){var o=window.pixi.textures,r=core.floors[t],a=r.width,n=r.height,i=o[(core.status.maps||core.floors)[t].defaultGround||"ground"];e.addNode("tilingSprite",{texture:i||o.ground,width:32*a,height:32*n}),this.drawBgFgMap(e,t,"bg")},drawEvents:function(e,t,o){var r=this;t.forEach((function(t){t.event&&!t.disable&&r.addBlock(e,t)}))},drawFg:function(e,t){this.drawBgFgMap(e,t,"fg")},drawOneDamage:function(e,t,o,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:s.a.TextStyle.damage,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:core.status.floorId,i={x:0,y:.5},c=e.addNode("sprite");if(core.flags.displayEnemyDamage){var l=core.enemys.getDamageString(t,o,r,n),u=l.damage,p=l.color,d=l.stroke;s.a.drawText(c,u,s.a.getTextStyle(a,{fill:p,stroke:d}),1,31,{anchor:i})}if(core.flags.displayCritical){var f=core.enemys.nextCriticals(t,1,o,r,n);"???"===(f=core.formatBigNumber((f[0]||[])[0],!0))&&(f="?"),s.a.drawText(c,f,a,1,21,{anchor:i})}return c.position.set(32*o,32*r),c},drawDamage:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:core.status.floorId,r=s.a.TextStyle.damage;core.status.maps[o].blocks.forEach((function(a){if(!a.disable&&0===a.event.cls.indexOf("enemy")&&!1!==a.event.displayDamage){var n=a.x,i=a.y,s=a.event.id;t.drawOneDamage(e,s,n,i,r,o)}}))},drawExtraDamage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:core.status.floorId,o=s.a.getTextStyle(s.a.TextStyle.damage,{fill:"#FFaF00"}),r={x:.5,y:.5};if(core.flags.displayExtraDamage){var a=core.floors[t],n=a.width,i=a.height,c=core.status.checkBlock;c.damage=c.damage||{},c.ambush=c.ambush||{};for(var l=0;l<n;l++)for(var u=0;u<i;u++){var p=core.status.checkBlock.damage["".concat(l,",").concat(u)]||0;p>0?(p=core.formatBigNumber(p,!0),s.a.drawText(e,p,o,32*l+16,32*(u+1)-14,{anchor:r})):core.status.checkBlock.ambush["".concat(l,",").concat(u)]&&s.a.drawText(e,"!",o,32*l+16,32*(u+1)-14,{anchor:r})}}},moveBlock:function(e,t,o,r,a){var n=pixi.game.getScene("event"),i=this.addBlock(n,e);return window.node=i,i.removing=r?function(t){var o=e.x,r=e.y;core.setBlock(e.id,o,r),core.showBlock(o,r),t()}:function(e){this.changeTo({alpha:0},500,e)},this.moveBlockOneStep(e,i,t,o,a)},moveBlockOneStep:function(e,t,o,r,a){var n=this,i=o.shift();if(!i)return t.remove(t.removing),void(a instanceof Function&&a());var s=c.a.scan[i],l={};l.x=t.x+32*s.x,l.y=t.y+32*s.y,e.x+=s.x,e.y+=s.y,t.changeTo(l,r,(function(){n.moveBlockOneStep(e,t,o,r,a)}))},clearMap:function(){},clearOneMap:function(){}};t.a=l},function(e,t,o){"use strict";function r(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return a(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e}var c=[],l=function(){function e(t,o){if(n(this,e),!(t instanceof Function))throw new Error("应该为function");this.func=t,this._dirty=!1,this.num=o,this.max=o,this.data=0}return s(e,[{key:"dirty",value:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return this._dirty?this.args.every((function(e,o){return e===t[o]}))||(this.data=this.func.apply(this,t),this.args=t):(this.args=t,this._dirty=!0,this.data=this.func.apply(this,t),this.num=this.max,c.push(this)),this.data}}]),e}(),u=function(){function e(t,o){if(n(this,e),!(t instanceof Function))throw new Error("应该为function");this.func=t,this.num=o,this.max=o,this._dirty=!1,this.data=0}return s(e,[{key:"dirty",value:function(){if(!this._dirty){this._dirty=!0;for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];this.args=t,this.num=this.max,c.push(this)}}}]),e}(),p={get:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"notify",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return"notify"===t?new l(e,o):"debounce"===t?new u(e,o):null},update:function(){0!==c.length&&(c=c.filter((function(e){return e.num-=1,0!==e.num||(e.num=e.max,e._dirty=!1,e instanceof u&&e.func.apply(e,r(e.args)),delete e.args,!1)})))}};t.a=p},function(e,t){e.exports={main:{floorIds:["sample0","sample1","sample2","sample3","MT0"],images:["bg.jpg","winskin.png"],tilesets:["magictower.png"],animates:["hand","sword","zone"],bgms:["bgm.mp3"],sounds:["floor.mp3","attack.mp3","door.mp3","item.mp3","equip.mp3","zone.mp3","jump.mp3","pickaxe.mp3","bomb.mp3","centerFly.mp3"],nameMap:{"背景图.jpg":"bg.jpg","背景音乐.mp3":"bgm.mp3"},startBackground:"bg.jpg",startLogoStyle:"color: black",levelChoose:[["简单","Easy"],["普通","Normal"],["困难","Hard"],["噩梦","Hell"]],equipName:["武器","盾牌"],startBgm:null,statusLeftBackground:null,statusTopBackground:"url(project/images/ground.png) repeat",toolsBackground:"url(project/images/ground.png) repeat",borderColor:"#CCCCCC",statusBarColor:"white",hardLabelColor:"red",floorChangingBackground:"black",floorChangingTextColor:"white",font:"Verdana",startButtonsStyle:"background-color: #32369F; opacity: 0.85; color: #FFFFFF; border: #FFFFFF 2px solid; caret-color: #FFD700;"},firstData:{title:"魔塔样板",name:"template",version:"Ver 2.6.6",floorId:"sample0",hero:{name:"阳光",lv:1,hpmax:9999,hp:1e3,manamax:-1,mana:0,atk:100,def:100,mdef:0,money:0,experience:0,equipment:[],items:{keys:{yellowKey:5,blueKey:5,redKey:5},constants:{book:1},tools:{},equips:{}},loc:{direction:"up",x:6,y:10},flags:{},steps:0},startCanvas:[{type:"comment",text:"在这里可以用事件来自定义绘制标题界面的背景图等"},{type:"comment",text:"也可以直接切换到其他楼层（比如某个开始剧情楼层）进行操作。"},{type:"showImage",code:1,image:"bg.jpg",loc:[0,0],dw:100,dh:100,opacity:1,time:0},{type:"while",condition:"1",data:[{type:"comment",text:"给用户提供选择项，这里简单的使用了choices事件"},{type:"comment",text:"也可以贴按钮图然后使用等待操作来完成"},{type:"choices",choices:[{text:"开始游戏",action:[{type:"comment",text:"检查bgm状态，下同"},{type:"function",function:"function(){\ncore.control.checkBgm()\n}"},{type:"if",condition:"core.flags.startDirectly",true:[{type:"comment",text:"直接开始游戏，设置初始化数据"},{type:"function",function:"function(){\ncore.events.setInitData('')\n}"}],false:[{type:"comment",text:"动态生成难度选择项"},{type:"function",function:'function(){\nvar choices = [];\nmain.levelChoose.forEach(function (one) {\n\tchoices.push({"text": one[0], "action": [\n\t\t{"type": "function", "function": "function() { core.status.hard = \'"+one[1]+"\'; core.events.setInitData(\'"+one[1]+"\'); }"}\n\t]});\n})\ncore.insertAction({"type": "choices", "choices": choices});\n}'}]},{type:"hideImage",code:1,time:0},{type:"comment",text:"成功选择难度"},{type:"break"}]},{text:"读取存档",action:[{type:"function",function:"function(){\ncore.control.checkBgm()\n}"},{type:"comment",text:"简单的使用“呼出读档界面”来处理"},{type:"callLoad"}]},{text:"回放录像",action:[{type:"function",function:"function(){\ncore.control.checkBgm()\n}"},{type:"comment",text:"这段代码会弹框选择录像文件"},{type:"if",condition:"!core.isReplaying()",true:[{type:"function",function:"function(){\ncore.chooseReplayFile()\n}"}],false:[]}]}]}]},{type:"comment",text:"接下来会执行startText中的事件"}],startText:[],shops:[{id:"moneyShop1",name:"贪婪之神",icon:"blueShop",textInList:"1F金币商店",commonTimes:!1,mustEnable:!1,use:"money",need:"20+10*times*(times+1)",text:"勇敢的武士啊，给我${need}金币就可以：",choices:[{text:"生命+800",effect:"status:hp+=800"}]},{id:"expShop1",name:"经验之神",icon:"pinkShop",textInList:"1F经验商店",commonTimes:!1,mustEnable:!1,use:"experience",need:"-1",text:"勇敢的武士啊，给我若干经验就可以：",choices:[{text:"等级+1",need:"100",effect:"status:hp+=1000"}]},{id:"itemShop",item:!0,textInList:"道具商店",mustEnable:!1,choices:[{id:"yellowKey",number:10,money:10}]},{id:"keyShop1",textInList:"回收钥匙商店",mustEnable:!1,commonEvent:"回收钥匙商店"}],levelUp:[{need:"0",title:"",action:[{type:"comment",text:"此处是初始等级，只需填写称号"}]},{need:"20",title:"第二级",action:[{type:"setValue",name:"status:atk",value:"status:atk+10"},{type:"setValue",name:"status:def",value:"status:def+10"}]},{need:"40",title:"",action:[{type:"tip",text:"恭喜升级"}]}]},values:{lavaDamage:100,poisonDamage:10,weakValue:20,redJewel:3,blueJewel:3,greenJewel:5,redPotion:100,bluePotion:250,yellowPotion:500,greenPotion:800,breakArmor:.9,counterAttack:.1,purify:3,hatred:2,moveSpeed:100,animateSpeed:400,floorChangeTime:800},flags:{enableFloor:!0,enableName:!1,enableLv:!1,enableHPMax:!1,enableMana:!1,enableMDef:!0,enableMoney:!0,enableExperience:!1,enableLevelUp:!1,levelUpLeftMode:!1,enableKeys:!0,enablePZF:!1,enableDebuff:!1,enableSkill:!1,flyNearStair:!0,flyRecordPosition:!1,pickaxeFourDirections:!1,bombFourDirections:!1,snowFourDirections:!1,bigKeyIsBox:!1,steelDoorWithoutKey:!1,itemFirstText:!1,equipment:!1,equipboxButton:!1,iconInEquipbox:!1,enableAddPoint:!1,enableNegativeDamage:!1,hatredDecrease:!0,betweenAttackCeil:!1,betweenAttackMax:!1,useLoop:!1,startUsingCanvas:!1,startDirectly:!1,statusCanvas:!1,statusCanvasRowsOnMobile:3,displayEnemyDamage:!0,displayCritical:!0,displayExtraDamage:!0,enableGentleClick:!0,potionWhileRouting:!1,ignoreChangeFloor:!0,canGoDeadZone:!1,enableMoveDirectly:!0,enableDisabledShop:!0,disableShopOnDamage:!1,blurFg:!1,checkConsole:!1}}},function(e,t,o){(function(o){var r,a,n,i;function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}
/*!
    localForage -- Offline Storage, Improved
    Version 1.7.2
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/i=function(){return function e(t,o,r){function a(i,s){if(!o[i]){if(!t[i]){if(n)return n(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=o[i]={exports:{}};t[i][0].call(l.exports,(function(e){return a(t[i][1][e]||e)}),l,l.exports,e,t,o,r)}return o[i].exports}for(var n=!1,i=0;i<r.length;i++)a(r[i]);return a}({1:[function(e,t,r){(function(e){"use strict";function o(){l=!0;for(var e,t,o=u.length;o;){for(t=u,u=[],e=-1;++e<o;)t[e]();o=u.length}l=!1}var r,a=e.MutationObserver||e.WebKitMutationObserver;if(a){var n=0,i=new a(o),s=e.document.createTextNode("");i.observe(s,{characterData:!0}),r=function(){s.data=n=++n%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){o(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(o,0)};else{var c=new e.MessageChannel;c.port1.onmessage=o,r=function(){c.port2.postMessage(0)}}var l,u=[];t.exports=function(e){1!==u.push(e)||l||r()}}).call(this,void 0!==o?o:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,o){"use strict";function r(){}function a(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,e!==r&&l(this,e)}function n(e,t,o){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof o&&(this.onRejected=o,this.callRejected=this.otherCallRejected)}function i(e,t,o){p((function(){var r;try{r=t(o)}catch(t){return d.reject(e,t)}r===e?d.reject(e,new TypeError("Cannot resolve promise with itself")):d.resolve(e,r)}))}function c(e){var t=e&&e.then;if(e&&("object"==s(e)||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function l(e,t){function o(t){a||(a=!0,d.reject(e,t))}function r(t){a||(a=!0,d.resolve(e,t))}var a=!1,n=u((function(){t(r,o)}));"error"===n.status&&o(n.value)}function u(e,t){var o={};try{o.value=e(t),o.status="success"}catch(e){o.status="error",o.value=e}return o}var p=e(1),d={},f=["REJECTED"],m=["FULFILLED"],h=["PENDING"];t.exports=a,a.prototype.catch=function(e){return this.then(null,e)},a.prototype.then=function(e,t){if("function"!=typeof e&&this.state===m||"function"!=typeof t&&this.state===f)return this;var o=new this.constructor(r);return this.state!==h?i(o,this.state===m?e:t,this.outcome):this.queue.push(new n(o,e,t)),o},n.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},n.prototype.otherCallFulfilled=function(e){i(this.promise,this.onFulfilled,e)},n.prototype.callRejected=function(e){d.reject(this.promise,e)},n.prototype.otherCallRejected=function(e){i(this.promise,this.onRejected,e)},d.resolve=function(e,t){var o=u(c,t);if("error"===o.status)return d.reject(e,o.value);var r=o.value;if(r)l(e,r);else{e.state=m,e.outcome=t;for(var a=-1,n=e.queue.length;++a<n;)e.queue[a].callFulfilled(t)}return e},d.reject=function(e,t){e.state=f,e.outcome=t;for(var o=-1,r=e.queue.length;++o<r;)e.queue[o].callRejected(t);return e},a.resolve=function(e){return e instanceof this?e:d.resolve(new this(r),e)},a.reject=function(e){var t=new this(r);return d.reject(t,e)},a.all=function(e){function t(e,t){o.resolve(e).then((function(e){i[t]=e,++s!==a||n||(n=!0,d.resolve(l,i))}),(function(e){n||(n=!0,d.reject(l,e))}))}var o=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var a=e.length,n=!1;if(!a)return this.resolve([]);for(var i=new Array(a),s=0,c=-1,l=new this(r);++c<a;)t(e[c],c);return l},a.race=function(e){function t(e){o.resolve(e).then((function(e){n||(n=!0,d.resolve(s,e))}),(function(e){n||(n=!0,d.reject(s,e))}))}var o=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var a=e.length,n=!1;if(!a)return this.resolve([]);for(var i=-1,s=new this(r);++i<a;)t(e[i]);return s}},{1:1}],3:[function(e,t,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==o?o:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,o){"use strict";function r(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(a){if("TypeError"!==a.name)throw a;for(var o=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)o.append(e[r]);return o.getBlob(t.type)}}function a(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function n(e,t,o){"function"==typeof t&&e.then(t),"function"==typeof o&&e.catch(o)}function i(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function c(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function l(e){for(var t=e.length,o=new ArrayBuffer(t),r=new Uint8Array(o),a=0;a<t;a++)r[a]=e.charCodeAt(a);return o}function u(e){return"boolean"==typeof R?D.resolve(R):function(e){return new D((function(t){var o=e.transaction(M,j),a=r([""]);o.objectStore(M).put(a,"key"),o.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},o.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),o=navigator.userAgent.match(/Edge\//);t(o||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return R=e}))}function p(e){var t=O[e.name],o={};o.promise=new D((function(e,t){o.resolve=e,o.reject=t})),t.deferredOperations.push(o),t.dbReady?t.dbReady=t.dbReady.then((function(){return o.promise})):t.dbReady=o.promise}function d(e){var t=O[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function f(e,t){var o=O[e.name].deferredOperations.pop();if(o)return o.reject(t),o.promise}function m(e,t){return new D((function(o,r){if(O[e.name]=O[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return o(e.db);p(e),e.db.close()}var a=[e.name];t&&a.push(e.version);var n=L.open.apply(L,a);t&&(n.onupgradeneeded=function(t){var o=n.result;try{o.createObjectStore(e.storeName),t.oldVersion<=1&&o.createObjectStore(M)}catch(o){if("ConstraintError"!==o.name)throw o;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),n.onerror=function(e){e.preventDefault(),r(n.error)},n.onsuccess=function(){o(n.result),d(e)}}))}function h(e){return m(e,!1)}function y(e){return m(e,!0)}function g(e,t){if(!e.db)return!0;var o=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,a=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),a||o){if(o){var n=e.db.version+1;n>e.version&&(e.version=n)}return!0}return!1}function v(e){return r([l(atob(e.data))],{type:e.type})}function _(e){return e&&e.__local_forage_encoded_blob}function w(e){var t=this,o=t._initReady().then((function(){var e=O[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return n(o,e,e),o}function x(e,t,o,r){void 0===r&&(r=1);try{var a=e.db.transaction(e.storeName,t);o(null,a)}catch(a){if(r>0&&(!e.db||"InvalidStateError"===a.name||"NotFoundError"===a.name))return D.resolve().then((function(){if(!e.db||"NotFoundError"===a.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),y(e)})).then((function(){return function(e){p(e);for(var t=O[e.name],o=t.forages,r=0;r<o.length;r++){var a=o[r];a._dbInfo.db&&(a._dbInfo.db.close(),a._dbInfo.db=null)}return e.db=null,h(e).then((function(t){return e.db=t,g(e)?y(e):t})).then((function(r){e.db=t.db=r;for(var a=0;a<o.length;a++)o[a]._dbInfo.db=r})).catch((function(t){throw f(e,t),t}))}(e).then((function(){x(e,t,o,r-1)}))})).catch(o);o(a)}}function b(e){var t,o,r,a,n,i=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var l=new ArrayBuffer(i),u=new Uint8Array(l);for(t=0;t<s;t+=4)o=U.indexOf(e[t]),r=U.indexOf(e[t+1]),a=U.indexOf(e[t+2]),n=U.indexOf(e[t+3]),u[c++]=o<<2|r>>4,u[c++]=(15&r)<<4|a>>2,u[c++]=(3&a)<<6|63&n;return l}function S(e){var t,o=new Uint8Array(e),r="";for(t=0;t<o.length;t+=3)r+=U[o[t]>>2],r+=U[(3&o[t])<<4|o[t+1]>>4],r+=U[(15&o[t+1])<<2|o[t+2]>>6],r+=U[63&o[t+2]];return o.length%3==2?r=r.substring(0,r.length-1)+"=":o.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function k(e,t,o,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],o,r)}function I(e,t,o,r,a,n){e.executeSql(o,r,a,(function(e,i){i.code===i.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?n(e,i):k(e,t,(function(){e.executeSql(o,r,a,n)}),n)}),n):n(e,i)}),n)}function A(e,t,o,r){var n=this;e=i(e);var s=new D((function(a,i){n.ready().then((function(){void 0===t&&(t=null);var s=t,c=n._dbInfo;c.serializer.serialize(t,(function(t,l){l?i(l):c.db.transaction((function(o){I(o,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){a(s)}),(function(e,t){i(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void a(A.apply(n,[e,s,o,r-1]));i(t)}}))}))})).catch(i)}));return a(s,o),s}function E(e){return new D((function(t,o){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(o,r){for(var a=[],n=0;n<r.rows.length;n++)a.push(r.rows.item(n).name);t({db:e,storeNames:a})}),(function(e,t){o(t)}))}),(function(e){o(e)}))}))}function T(e,t){var o=e.name+"/";return e.storeName!==t.storeName&&(o+=e.storeName+"/"),o}function F(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}function B(e,t){e[t]=function(){var o=arguments;return e.ready().then((function(){return e[t].apply(e,o)}))}}function C(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var o in t)t.hasOwnProperty(o)&&(pe(t[o])?arguments[0][o]=t[o].slice():arguments[0][o]=t[o])}return arguments[0]}var P="function"==typeof Symbol&&"symbol"==s(Symbol.iterator)?function(e){return s(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":s(e)},L=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();"undefined"==typeof Promise&&e(3);var D=Promise,M="local-forage-detect-blob-support",R=void 0,O={},z=Object.prototype.toString,H="readonly",j="readwrite",N={_driver:"asyncStorage",_initStorage:function(e){function t(){return D.resolve()}var o=this,r={db:null};if(e)for(var a in e)r[a]=e[a];var n=O[r.name];n||(n={forages:[],db:null,dbReady:null,deferredOperations:[]},O[r.name]=n),n.forages.push(o),o._initReady||(o._initReady=o.ready,o.ready=w);for(var i=[],s=0;s<n.forages.length;s++){var c=n.forages[s];c!==o&&i.push(c._initReady().catch(t))}var l=n.forages.slice(0);return D.all(i).then((function(){return r.db=n.db,h(r)})).then((function(e){return r.db=e,g(r,o._defaultConfig.version)?y(r):e})).then((function(e){r.db=n.db=e,o._dbInfo=r;for(var t=0;t<l.length;t++){var a=l[t];a!==o&&(a._dbInfo.db=r.db,a._dbInfo.version=r.version)}}))},_support:function(){try{if(!L)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var o=this,r=new D((function(t,r){o.ready().then((function(){x(o._dbInfo,H,(function(a,n){if(a)return r(a);try{var i=n.objectStore(o._dbInfo.storeName).openCursor(),s=1;i.onsuccess=function(){var o=i.result;if(o){var r=o.value;_(r)&&(r=v(r));var a=e(r,o.key,s++);void 0!==a?t(a):o.continue()}else t()},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},getItem:function(e,t){var o=this;e=i(e);var r=new D((function(t,r){o.ready().then((function(){x(o._dbInfo,H,(function(a,n){if(a)return r(a);try{var i=n.objectStore(o._dbInfo.storeName).get(e);i.onsuccess=function(){var e=i.result;void 0===e&&(e=null),_(e)&&(e=v(e)),t(e)},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},setItem:function(e,t,o){var r=this;e=i(e);var n=new D((function(o,a){var n;r.ready().then((function(){return n=r._dbInfo,"[object Blob]"===z.call(t)?u(n.db).then((function(e){return e?t:function(e){return new D((function(t,o){var r=new FileReader;r.onerror=o,r.onloadend=function(o){var r=btoa(o.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)}))}(t)})):t})).then((function(t){x(r._dbInfo,j,(function(n,i){if(n)return a(n);try{var s=i.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=s.put(t,e);i.oncomplete=function(){void 0===t&&(t=null),o(t)},i.onabort=i.onerror=function(){var e=c.error?c.error:c.transaction.error;a(e)}}catch(e){a(e)}}))})).catch(a)}));return a(n,o),n},removeItem:function(e,t){var o=this;e=i(e);var r=new D((function(t,r){o.ready().then((function(){x(o._dbInfo,j,(function(a,n){if(a)return r(a);try{var i=n.objectStore(o._dbInfo.storeName).delete(e);n.oncomplete=function(){t()},n.onerror=function(){r(i.error)},n.onabort=function(){var e=i.error?i.error:i.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},clear:function(e){var t=this,o=new D((function(e,o){t.ready().then((function(){x(t._dbInfo,j,(function(r,a){if(r)return o(r);try{var n=a.objectStore(t._dbInfo.storeName).clear();a.oncomplete=function(){e()},a.onabort=a.onerror=function(){var e=n.error?n.error:n.transaction.error;o(e)}}catch(e){o(e)}}))})).catch(o)}));return a(o,e),o},length:function(e){var t=this,o=new D((function(e,o){t.ready().then((function(){x(t._dbInfo,H,(function(r,a){if(r)return o(r);try{var n=a.objectStore(t._dbInfo.storeName).count();n.onsuccess=function(){e(n.result)},n.onerror=function(){o(n.error)}}catch(e){o(e)}}))})).catch(o)}));return a(o,e),o},key:function(e,t){var o=this,r=new D((function(t,r){e<0?t(null):o.ready().then((function(){x(o._dbInfo,H,(function(a,n){if(a)return r(a);try{var i=n.objectStore(o._dbInfo.storeName),s=!1,c=i.openCursor();c.onsuccess=function(){var o=c.result;o?0===e||s?t(o.key):(s=!0,o.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},keys:function(e){var t=this,o=new D((function(e,o){t.ready().then((function(){x(t._dbInfo,H,(function(r,a){if(r)return o(r);try{var n=a.objectStore(t._dbInfo.storeName).openCursor(),i=[];n.onsuccess=function(){var t=n.result;t?(i.push(t.key),t.continue()):e(i)},n.onerror=function(){o(n.error)}}catch(e){o(e)}}))})).catch(o)}));return a(o,e),o},dropInstance:function(e,t){t=c.apply(this,arguments);var o=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||o.name,e.storeName=e.storeName||o.storeName);var r,n=this;if(e.name){var i=e.name===o.name&&n._dbInfo.db,s=i?D.resolve(n._dbInfo.db):h(e).then((function(t){var o=O[e.name],r=o.forages;o.db=t;for(var a=0;a<r.length;a++)r[a]._dbInfo.db=t;return t}));r=e.storeName?s.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var o=t.version+1;p(e);var r=O[e.name],a=r.forages;t.close();for(var n=0;n<a.length;n++){var i=a[n];i._dbInfo.db=null,i._dbInfo.version=o}return new D((function(t,r){var a=L.open(e.name,o);a.onerror=function(e){a.result.close(),r(e)},a.onupgradeneeded=function(){a.result.deleteObjectStore(e.storeName)},a.onsuccess=function(){var e=a.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<a.length;t++){var o=a[t];o._dbInfo.db=e,d(o._dbInfo)}})).catch((function(t){throw(f(e,t)||D.resolve()).catch((function(){})),t}))}})):s.then((function(t){p(e);var o=O[e.name],r=o.forages;t.close();for(var a=0;a<r.length;a++)r[a]._dbInfo.db=null;return new D((function(t,o){var r=L.deleteDatabase(e.name);r.onerror=r.onblocked=function(e){var t=r.result;t&&t.close(),o(e)},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){o.db=e;for(var t=0;t<r.length;t++)d(r[t]._dbInfo)})).catch((function(t){throw(f(e,t)||D.resolve()).catch((function(){})),t}))}))}else r=D.reject("Invalid arguments");return a(r,t),r}},U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",W="~~local_forage_type~",V=/^~~local_forage_type~([^~]+)~/,q="__lfsc__:",X=q.length,K="arbf",Z="blob",G="si08",Y="ui08",J="uic8",$="si16",Q="si32",ee="ur16",te="ui32",oe="fl32",re="fl64",ae=X+K.length,ne=Object.prototype.toString,ie={serialize:function(e,t){var o="";if(e&&(o=ne.call(e)),e&&("[object ArrayBuffer]"===o||e.buffer&&"[object ArrayBuffer]"===ne.call(e.buffer))){var r,a=q;e instanceof ArrayBuffer?(r=e,a+=K):(r=e.buffer,"[object Int8Array]"===o?a+=G:"[object Uint8Array]"===o?a+=Y:"[object Uint8ClampedArray]"===o?a+=J:"[object Int16Array]"===o?a+=$:"[object Uint16Array]"===o?a+=ee:"[object Int32Array]"===o?a+=Q:"[object Uint32Array]"===o?a+=te:"[object Float32Array]"===o?a+=oe:"[object Float64Array]"===o?a+=re:t(new Error("Failed to get type for BinaryArray"))),t(a+S(r))}else if("[object Blob]"===o){var n=new FileReader;n.onload=function(){var o=W+e.type+"~"+S(this.result);t(q+Z+o)},n.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(o){console.error("Couldn't convert value into a JSON string: ",e),t(null,o)}},deserialize:function(e){if(e.substring(0,X)!==q)return JSON.parse(e);var t,o=e.substring(ae),a=e.substring(X,ae);if(a===Z&&V.test(o)){var n=o.match(V);t=n[1],o=o.substring(n[0].length)}var i=b(o);switch(a){case K:return i;case Z:return r([i],{type:t});case G:return new Int8Array(i);case Y:return new Uint8Array(i);case J:return new Uint8ClampedArray(i);case $:return new Int16Array(i);case ee:return new Uint16Array(i);case Q:return new Int32Array(i);case te:return new Uint32Array(i);case oe:return new Float32Array(i);case re:return new Float64Array(i);default:throw new Error("Unkown type: "+a)}},stringToBuffer:b,bufferToString:S},se={_driver:"webSQLStorage",_initStorage:function(e){var t=this,o={db:null};if(e)for(var r in e)o[r]="string"!=typeof e[r]?e[r].toString():e[r];var a=new D((function(e,r){try{o.db=openDatabase(o.name,String(o.version),o.description,o.size)}catch(e){return r(e)}o.db.transaction((function(a){k(a,o,(function(){t._dbInfo=o,e()}),(function(e,t){r(t)}))}),r)}));return o.serializer=ie,a},_support:"function"==typeof openDatabase,iterate:function(e,t){var o=this,r=new D((function(t,r){o.ready().then((function(){var a=o._dbInfo;a.db.transaction((function(o){I(o,a,"SELECT * FROM "+a.storeName,[],(function(o,r){for(var n=r.rows,i=n.length,s=0;s<i;s++){var c=n.item(s),l=c.value;if(l&&(l=a.serializer.deserialize(l)),void 0!==(l=e(l,c.key,s+1)))return void t(l)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},getItem:function(e,t){var o=this;e=i(e);var r=new D((function(t,r){o.ready().then((function(){var a=o._dbInfo;a.db.transaction((function(o){I(o,a,"SELECT * FROM "+a.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,o){var r=o.rows.length?o.rows.item(0).value:null;r&&(r=a.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},setItem:function(e,t,o){return A.apply(this,[e,t,o,1])},removeItem:function(e,t){var o=this;e=i(e);var r=new D((function(t,r){o.ready().then((function(){var a=o._dbInfo;a.db.transaction((function(o){I(o,a,"DELETE FROM "+a.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},clear:function(e){var t=this,o=new D((function(e,o){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){I(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){o(t)}))}))})).catch(o)}));return a(o,e),o},length:function(e){var t=this,o=new D((function(e,o){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){I(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,o){var r=o.rows.item(0).c;e(r)}),(function(e,t){o(t)}))}))})).catch(o)}));return a(o,e),o},key:function(e,t){var o=this,r=new D((function(t,r){o.ready().then((function(){var a=o._dbInfo;a.db.transaction((function(o){I(o,a,"SELECT key FROM "+a.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,o){var r=o.rows.length?o.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},keys:function(e){var t=this,o=new D((function(e,o){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){I(t,r,"SELECT key FROM "+r.storeName,[],(function(t,o){for(var r=[],a=0;a<o.rows.length;a++)r.push(o.rows.item(a).key);e(r)}),(function(e,t){o(t)}))}))})).catch(o)}));return a(o,e),o},dropInstance:function(e,t){t=c.apply(this,arguments);var o=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||o.name,e.storeName=e.storeName||o.storeName);var r,n=this;return a(r=e.name?new D((function(t){var r;r=e.name===o.name?n._dbInfo.db:openDatabase(e.name,"","",0),t(e.storeName?{db:r,storeNames:[e.storeName]}:E(r))})).then((function(e){return new D((function(t,o){e.db.transaction((function(r){function a(e){return new D((function(t,o){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){o(t)}))}))}for(var n=[],i=0,s=e.storeNames.length;i<s;i++)n.push(a(e.storeNames[i]));D.all(n).then((function(){t()})).catch((function(e){o(e)}))}),(function(e){o(e)}))}))})):D.reject("Invalid arguments"),t),r}},ce={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var o in e)t[o]=e[o];return t.keyPrefix=T(e,this._defaultConfig),F()?(this._dbInfo=t,t.serializer=ie,D.resolve()):D.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var o=this,r=o.ready().then((function(){for(var t=o._dbInfo,r=t.keyPrefix,a=r.length,n=localStorage.length,i=1,s=0;s<n;s++){var c=localStorage.key(s);if(0===c.indexOf(r)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(a),i++)))return l}}}));return a(r,t),r},getItem:function(e,t){var o=this;e=i(e);var r=o.ready().then((function(){var t=o._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return a(r,t),r},setItem:function(e,t,o){var r=this;e=i(e);var n=r.ready().then((function(){void 0===t&&(t=null);var o=t;return new D((function(a,n){var i=r._dbInfo;i.serializer.serialize(t,(function(t,r){if(r)n(r);else try{localStorage.setItem(i.keyPrefix+e,t),a(o)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||n(e),n(e)}}))}))}));return a(n,o),n},removeItem:function(e,t){var o=this;e=i(e);var r=o.ready().then((function(){var t=o._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return a(r,t),r},clear:function(e){var t=this,o=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,o=localStorage.length-1;o>=0;o--){var r=localStorage.key(o);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return a(o,e),o},length:function(e){var t=this.keys().then((function(e){return e.length}));return a(t,e),t},key:function(e,t){var o=this,r=o.ready().then((function(){var t,r=o._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return a(r,t),r},keys:function(e){var t=this,o=t.ready().then((function(){for(var e=t._dbInfo,o=localStorage.length,r=[],a=0;a<o;a++){var n=localStorage.key(a);0===n.indexOf(e.keyPrefix)&&r.push(n.substring(e.keyPrefix.length))}return r}));return a(o,e),o},dropInstance:function(e,t){if(t=c.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var o=this.config();e.name=e.name||o.name,e.storeName=e.storeName||o.storeName}var r,n=this;return a(r=e.name?new D((function(t){t(e.storeName?T(e,n._defaultConfig):e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var o=localStorage.key(t);0===o.indexOf(e)&&localStorage.removeItem(o)}})):D.reject("Invalid arguments"),t),r}},le=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},ue=function(e,t){for(var o=e.length,r=0;r<o;){if(le(e[r],t))return!0;r++}return!1},pe=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},de={},fe={},me={INDEXEDDB:N,WEBSQL:se,LOCALSTORAGE:ce},he=[me.INDEXEDDB._driver,me.WEBSQL._driver,me.LOCALSTORAGE._driver],ye=["dropInstance"],ge=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ye),ve={description:"",driver:he.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},_e=new(function(){function e(t){for(var o in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),me)if(me.hasOwnProperty(o)){var r=me[o],a=r._driver;this[o]=a,de[a]||this.defineDriver(r)}this._defaultConfig=C({},ve),this._config=C({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":P(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,o){var r=new D((function(t,o){try{var r=e._driver,n=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void o(n);for(var i=ge.concat("_initStorage"),s=0,c=i.length;s<c;s++){var l=i[s];if((!ue(ye,l)||e[l])&&"function"!=typeof e[l])return void o(n)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),o=D.reject(t);return a(o,arguments[arguments.length-1]),o}},o=0,r=ye.length;o<r;o++){var n=ye[o];e[n]||(e[n]=t(n))}}();var u=function(o){de[r]&&console.info("Redefining LocalForage driver: "+r),de[r]=e,fe[r]=o,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(u,o):u(!!e._support):u(!0)}catch(e){o(e)}}));return n(r,t,o),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,o){var r=de[e]?D.resolve(de[e]):D.reject(new Error("Driver not found."));return n(r,t,o),r},e.prototype.getSerializer=function(e){var t=D.resolve(ie);return n(t,e),t},e.prototype.ready=function(e){var t=this,o=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return n(o,e,e),o},e.prototype.setDriver=function(e,t,o){function r(){i._config.driver=i.driver()}function a(e){return i._extend(e),r(),i._ready=i._initStorage(i._config),i._ready}var i=this;pe(e)||(e=[e]);var s=this._getSupportedDrivers(e),c=null!==this._driverSet?this._driverSet.catch((function(){return D.resolve()})):D.resolve();return this._driverSet=c.then((function(){var e=s[0];return i._dbInfo=null,i._ready=null,i.getDriver(e).then((function(e){i._driver=e._driver,r(),i._wrapLibraryMethodsWithReady(),i._initDriver=function(e){return function(){var t=0;return function o(){for(;t<e.length;){var n=e[t];return t++,i._dbInfo=null,i._ready=null,i.getDriver(n).then(a).catch(o)}r();var s=new Error("No available storage method found.");return i._driverSet=D.reject(s),i._driverSet}()}}(s)}))})).catch((function(){r();var e=new Error("No available storage method found.");return i._driverSet=D.reject(e),i._driverSet})),n(this._driverSet,t,o),this._driverSet},e.prototype.supports=function(e){return!!fe[e]},e.prototype._extend=function(e){C(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],o=0,r=e.length;o<r;o++){var a=e[o];this.supports(a)&&t.push(a)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=ge.length;e<t;e++)B(this,ge[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=_e},{3:3}]},{},[4])(4)},"object"==s(t)&&void 0!==e?e.exports=i():(a=[],void 0===(n="function"==typeof(r=i)?r.apply(t,a):r)||(e.exports=n))}).call(this,o(20))},,,function(e,t,o){"use strict";var r=o(0),a=o(9);function n(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(e,t,o){return"function"!=typeof o?console.log("func需为function类型"):(Object.defineProperty(e,t,{configurable:!0,get:function(){var e=o();return Object.defineProperty(this,t,{value:e,writable:!0}),e}}),e)},l=function(){function e(t){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t instanceof Array&&t[0]instanceof r.Texture?(this.textures=t,c(this,"reverse",(function(){return n(o.textures).reverse()})),c(this,"yoyo",(function(){return[].concat(n(o.textures),n(o.reverse))}))):console.warn("动画参数应为Texture的数组")}var t,o,i;return t=e,(o=[{key:"getTexture",value:function(e,t){return t?this.yoyo:e?this.reverse:this.textures}},{key:"play",value:function(e,t,o){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=r.time,i=void 0===n?100:n,s=r.init,c=r.onComplete,l=r.onFrameChange,u=r.update,p=r.reverse,d=void 0!==p&&p,f=r.yoyo,m=void 0!==f&&f,h=r.loop,y=void 0!==h&&h;e instanceof a.a||(e=pixi.game.getScene(e));var g=e.addNode("sprite",{texture:this.getTexture(d,m),time:i,update:u,animate:!0,init:function(){var e=this;if(this.anchor.set(.5,.5),this.position.set(t,o),this.onComplete=function(){"function"==typeof c&&c.apply(this),this.remove()},"function"==typeof l&&(this.onFrameChange=l),y){if(this.loop=!0,!0!==y){var r=parseInt(y,10)||1/0;this.onLoop=function(){0==(r-=1)&&(e.loop=!1)}}}else this.loop=!1;"function"==typeof s&&s.apply(this),this.gotoAndPlay(0)}});return g}}])&&s(t.prototype,o),i&&s(t,i),e}();t.a=l},function(e,t,o){"use strict";var r=o(0),a=o(4),n=o(1),i=o(3),s=o(6);function c(e,t,o){return(c=l()?Reflect.construct:function(e,t,o){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return o&&u(a,o.prototype),a}).apply(null,arguments)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return d(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var f=o(2).d.getScene("weather"),m=s.a.style,h=function(e,t){return e instanceof Array?parseInt(Math.random()*(e[1]-e[0])+e[0],10):Math.random()*(t-e)+e},y={types:{},register:function(e,t){if(this.types[e])throw new Error("已登记".concat(e));var o=t.particleContainer,r=t.update,n=t.Render,i=t.init,s=t.args;delete t.particleContainer,delete t.update,delete t.Render,delete t.init,delete t.args,r instanceof Function&&(t._update=function(){r.apply(this);var e=pixi.hero,t=e.velocity,o=t.x;t.y;e.playing&&(this.x+=o)});var c={particleContainer:o,Render:a.a.registerRender(e,n,t),args:s instanceof Array?s:[s],init:i};this.types[e]=c},getScene:function(e,t){var o=f.getScene("weather-".concat(e),1);if(o)return o;var a=t||this.types[e];if(!a)throw new Error("找不到".concat(e));return f.addScene("weather-".concat(e),"main",{container:a.particleContainer?new r.ParticleContainer(void 0,{scale:!0,position:!0,rotation:!0,uvs:!0,alpha:!0}):new r.Container,zIndex:50})},add:function(e,t){var o=this.getScene(e);o.active||o.emit("show");var r=this.types[e],n=a.a.activeNodes;if(!(r instanceof Object))return null;for(var i=r.args,s=r.init,l=0;l<t;l++){var u=c(r.Render,p(i));s.apply(u,[l]),o.addNode(u),n.push(u)}return o},hide:function(e){if(!e)return pixi.scenes.children.forEach((function(e){e.id.startsWith("weather-")&&e.hide()})),!0;var t=pixi.scenes.getScene("weather-".concat(e),1);return!!t&&(t.hide(),!0)},remove:function(e){if(!e)return pixi.scenes.children.forEach((function(e){e.id.startsWith("weather-")&&e.destroy()})),!1;var t=f.getScene("weather-".concat(e),1);return!!t&&(t.destroy(),!0)}};i.a.once("loadComplete",(function(){y.register("snow",{Render:"Sprite",particleContainer:!0,args:n.a.getTexture("snowNode"),init:function(){this.resize(),this.y=h(0,m.H),this.alpha=0,this.changeTo({alpha:this.maxAlpha},1e3)},resize:function(){this.x=h(0,m.W),this.y=0,this.dy=h(.5,1.5),this.maxAlpha=h(.4,.8);var e=h(.1,.2);this.angleSpeed=h(0,.6),this.scale.set(e,e),this.anchor.set(.5,.5)},update:function(){this.y+=this.dy,this.angle+=this.angleSpeed,this.y>m.H?this.resize():this.x<0?this.x=m.W:this.x>m.W&&(this.x=0)}})})),t.a=y},function(e,t){var o={init:function(){console.log("插件编写测试"),this._afterLoadResources=function(){}},drawLight:function(){this.drawLight=function(e,t,o,r){var a=core.getContextByName(e);if(null==a){if("string"!=typeof e)return;a=core.createCanvas(e,0,0,core.__PIXELS__,core.__PIXELS__,98)}a.mozImageSmoothingEnabled=!1,a.webkitImageSmoothingEnabled=!1,a.msImageSmoothingEnabled=!1,a.imageSmoothingEnabled=!1,core.clearMap(e),null==t&&(t=.9),a.fillStyle="rgba(0,0,0,"+t+")",a.fillRect(0,0,a.canvas.width,a.canvas.height),r=core.clamp(r,0,1),a.globalCompositeOperation="destination-out",o.forEach((function(e){var t=e[0],o=e[1],n=e[2],i=parseInt(n*r),s=a.createRadialGradient(t,o,i,t,o,n);s.addColorStop(0,"rgba(0,0,0,1)"),s.addColorStop(1,"rgba(0,0,0,0)"),a.beginPath(),a.fillStyle=s,a.arc(t,o,n,0,2*Math.PI),a.fill()})),a.globalCompositeOperation="source-over"}},itemShop:function(){var e=null,t=0,o=0,r=0,a=0,n=0,i=0,s=[],c=core.ui._buildFont(20,!1),l=core.ui._buildFont(18,!1);this.drawItemShop=function(){core.ui._createUIEvent(),core.clearMap("uievent"),core.ui._uievent_drawSelector({code:1}),core.ui._uievent_drawSelector({code:2}),core.setTextAlign("uievent","left"),core.setTextBaseline("uievent","top"),core.fillRect("uievent",0,0,416,416,"black"),core.ui._uievent_drawBackground({background:"winskin.png",x:0,y:0,width:416,height:56}),core.ui._uievent_drawBackground({background:"winskin.png",x:0,y:56,width:312,height:56}),core.ui._uievent_drawBackground({background:"winskin.png",x:0,y:112,width:312,height:304}),core.ui._uievent_drawBackground({background:"winskin.png",x:312,y:56,width:104,height:56}),core.ui._uievent_drawBackground({background:"winskin.png",x:312,y:112,width:104,height:304}),core.setFillStyle("uievent","white"),core.setStrokeStyle("uievent","white"),core.fillText("uievent","购买",32,74,"white",c),core.fillText("uievent","卖出",132,74),core.fillText("uievent","离开",232,74),core.fillText("uievent","当前金币",324,66,null,l),core.setTextAlign("uievent","right"),core.fillText("uievent",core.formatBigNumber(core.status.hero.money),405,89),core.setTextAlign("uievent","left"),core.ui._uievent_drawSelector({type:"drawSelector",image:"winskin.png",code:2,x:22+100*t,y:66,width:60,height:33}),null!=o&&(core.setTextAlign("uievent","center"),core.fillText("uievent",0==t?"买入个数":"卖出个数",364,320,null,c),core.fillText("uievent","◀   "+r+"   ▶",364,350),core.fillText("uievent","确定",364,380));var u=core.status.shops[e].choices;s=u.filter((function(e){if(null!=e.condition)try{if(!core.calValue(e.condition))return!1}catch(e){}return 0==t&&null!=e.money||1==t&&null!=e.sell}));if(n=Math.ceil(s.length/6),a=Math.floor((o||0)/6)+1,n>1){core.setTextAlign("uievent","center"),core.fillText("uievent",a+" / "+n,156,388,null,l),a>1&&core.fillText("uievent","上一页",76,388),a<n&&core.fillText("uievent","下一页",236,388)}core.setTextAlign("uievent","left");for(var p=6*(a-1),d=0;d<6;++d){var f=p+d;if(f>=s.length)break;var m=s[f];if(core.drawIcon("uievent",m.id,10,125+40*d),core.setTextAlign("uievent","left"),core.fillText("uievent",core.material.items[m.id].name,50,132+40*d,null,c),core.setTextAlign("uievent","right"),core.fillText("uievent",(0==t?core.calValue(m.money):core.calValue(m.sell))+"金币/个",300,133+40*d,null,l),core.setTextAlign("uievent","left"),f==o){var h=core.material.items[m.id].text||"该道具暂无描述";try{h=core.replaceText(h)}catch(e){}for(var y=20;y>=8;y-=2){var g={left:10,fontSize:y,maxWidth:403,lineHeight:1.4},v=core.getTextContentHeight(h,g);if(v<=50){g.top=(56-v)/2,core.drawTextContent("uievent",h,g);break}}core.ui._uievent_drawSelector({type:"drawSelector",image:"winskin.png",code:1,x:8,y:120+40*d,width:295,height:40}),0==t&&null!=m.number?(core.fillText("uievent","存货",324,132,null,c),core.setTextAlign("uievent","right"),core.fillText("uievent",m.number,406,132,null,null,40)):1==t&&(core.fillText("uievent","数量",324,132,null,c),core.setTextAlign("uievent","right"),core.fillText("uievent",core.itemCount(m.id),406,132,null,null,40)),core.setTextAlign("uievent","left"),core.fillText("uievent","预计金额",324,250),core.setTextAlign("uievent","right"),i=r*(0==t?core.calValue(m.money):core.calValue(m.sell)),core.fillText("uievent",core.formatBigNumber(i),405,280),core.setTextAlign("uievent","left"),core.fillText("uievent",0==t?"已购次数":"已卖次数",324,170),core.setTextAlign("uievent","right"),core.fillText("uievent",(0==t?m.money_count:m.sell_count)||0,405,200)}}core.setTextAlign("uievent","left"),core.setTextBaseline("uievent","alphabetic")};var u=function(e,o){null!=e&&(r=core.clamp(r+o,0,Math.min(0==t?Math.floor(core.status.hero.money/core.calValue(e.money)):core.itemCount(e.id),0==t&&null!=e.number?e.number:Number.MAX_SAFE_INTEGER)))},p=function(e){null!=e&&0!=r&&(0==t?(core.status.hero.money-=i,core.getItem(e.id,r),null!=e.number&&(e.number-=r),e.money_count=(e.money_count||0)+r):(core.status.hero.money+=i,core.removeItem(e.id,r),core.drawTip("成功卖出"+r+"个"+core.material.items[e.id].name,e.id),null!=e.number&&(e.number+=r),e.sell_count=(e.sell_count||0)+r),r=0)};this._performItemShopKeyBoard=function(e){var a=s[o]||null;switch(e){case 38:if(null==o)break;0==o?o=null:o--,r=0;break;case 37:if(null==o){t>0&&t--;break}u(a,-1);break;case 39:if(null==o){t<2&&t++;break}u(a,1);break;case 40:if(null==o){s.length>0&&(o=0);break}if(0==s.length)break;o=Math.min(o+1,s.length-1),r=0;break;case 13:case 32:if(null==o){2==t?core.insertAction({type:"break"}):s.length>0&&(o=0);break}p(a);break;case 27:if(null==o){core.insertAction({type:"break"});break}o=null}},this._performItemShopClick=function(e,i){var c=s[o]||null;if(e>=22&&e<=82&&i>=71&&i<=102)0!=t&&(t=0,o=null,r=0);else if(e>=122&&e<=182&&i>=71&&i<=102)1!=t&&(t=1,o=null,r=0);else{if(e>=222&&e<=282&&i>=71&&i<=102)return core.insertAction({type:"break"});if(e>=318&&e<=341&&i>=348&&i<=376)return u(c,-1);if(e>=388&&e<=416&&i>=348&&i<=376)return u(c,1);if(e>=341&&e<=387&&i>=380&&i<=407)return p(c);if(e>=45&&e<=105&&i>=388)a>1&&(o-=6);else if(e>=208&&e<=268&&i>=388)a<n&&(o=Math.min(o+6,s.length-1));else if(e>=9&&e<=300&&i>=120&&i<360){if(0==s.length)return;var l=parseInt((i-120)/40),d=6*(a-1)+l;return d>=s.length&&(d=s.length-1),void(d!=o&&(o=d,r=0))}}},this.performItemShopAction=function(){return 0==flags.type?this._performItemShopKeyBoard(flags.keycode):this._performItemShopClick(flags.px,flags.py)},this.openItemShop=function(n){e=n,t=0,a=0,o=null,r=0,core.insertAction([{type:"while",condition:"true",data:[{type:"function",function:"function () { core.drawItemShop(); }"},{type:"wait"},{type:"function",function:"function() { core.performItemShopAction(); }"}]},{type:"function",function:'function () { core.deleteCanvas(\'uievent\'); core.ui._uievent_drawSelector({ "code": 1 }); core.ui._uievent_drawSelector({ "code": 2 }); }'}])},core.control.saveData=function(){var e=this.controldata.saveData();for(var t in core.status.shops)core.status.shops[t].item&&(e.shops[t].choices=core.status.shops[t].choices.map((function(e){return{number:e.number,money_count:e.money_count||0,sell_count:e.sell_count||0}})));return e},core.control.loadData=function(e,t){for(var o in this.controldata.loadData(e,t),e.shops)if(e.shops[o].choices)for(var r=0;r<e.shops[o].choices.length;++r)core.status.shops[o].choices[r].number=e.shops[o].choices[r].number,core.status.shops[o].choices[r].money_count=e.shops[o].choices[r].money_count,core.status.shops[o].choices[r].sell_count=e.shops[o].choices[r].sell_count}},smoothCamera:function(){this.__enableSmoothCamera=!1,this.__enableSmoothCamera&&(this.Camera=function(){this.__switchName="smoothCamera",this._cameraNeedRefresh=!0,this._nowOffsetX=0,this._nowOffsetY=0,this._targetOffsetX=0,this._targetOffsetY=0,this._currentFloorId=null,this.resetCamera=function(){this._targetOffsetX=core.bigmap.offsetX,this._targetOffsetY=core.bigmap.offsetY,this._nowOffsetX=this._targetOffsetX,this._nowOffsetY=this._targetOffsetY,this._cameraNeedRefresh=!0},this.setTarget=function(e,t){this._targetOffsetX=e,this._targetOffsetY=t},this.requestCameraUpdate=function(){this._cameraNeedRefresh=!0},this.updateTargetPosition=function(){this._targetOffsetX=core.bigmap.offsetX,this._targetOffsetY=core.bigmap.offsetY},this.updateRefreshFlag=function(){this._nowOffsetX==this._targetOffsetX&&this._nowOffsetY==this._targetOffsetY||(this._cameraNeedRefresh=!0)},this.canDirectMove=function(){return!core.getFlag(this.__switchName,!0)},this.updateCameraPosition=function(){if(this._cameraNeedRefresh){this._cameraNeedRefresh=!1;var e=this._targetOffsetX-this._nowOffsetX,t=this._targetOffsetY-this._nowOffsetY;Math.abs(e)<=2&&Math.abs(t)<=2||this.canDirectMove()?(this._nowOffsetX=this._targetOffsetX,this._nowOffsetY=this._targetOffsetY):(this._nowOffsetX+=e/10,this._nowOffsetY+=t/10);var o=-Math.floor(this._nowOffsetX),r=-Math.floor(this._nowOffsetY);core.bigmap.canvas.forEach((function(e){core.control.setGameCanvasTranslate(e,o,r)})),core.relocateCanvas("route",core.status.automaticRoute.offsetX+o,core.status.automaticRoute.offsetY+r),core.setGameCanvasTranslate("hero",o+this._targetOffsetX,r+this._targetOffsetY)}},this.update=function(){this.updateTargetPosition(),this.updateRefreshFlag(),this.updateCameraPosition()}},control.drawHero=function(e,t){if(core.isPlaying()&&core.status.floorId&&!core.status.gameOver){var o=core.getHeroLoc("x"),r=core.getHeroLoc("y"),a=core.getHeroLoc("direction");e=e||"stop",t=t||0;var n=core.utils.scan[a],i=n.x,s=n.y,c=i*t,l=s*t;core.bigmap.offsetX=core.clamp(32*(o-core.__HALF_SIZE__)+c,0,32*core.bigmap.width-core.__PIXELS__),core.bigmap.offsetY=core.clamp(32*(r-core.__HALF_SIZE__)+l,0,32*core.bigmap.height-core.__PIXELS__),core.clearAutomaticRouteNode(o+i,r+s),core.clearMap("hero"),core.hasFlag("hideHero")||this._drawHero_getDrawObjs(a,o,r,e,t).forEach((function(e){core.drawImage("hero",e.img,e.heroIcon[e.status]*e.width,e.heroIcon.loc*e.height,e.width,e.height,e.posx+(32-e.width)/2,e.posy+32-e.height,e.width,e.height)})),core.control.updateViewport()}},core.drawHero=function(e,t){return core.control.drawHero(e,t)},this.camera=new this.Camera,this.updateCameraEx=function(){this.camera.update()},control.updateViewport=function(){core.plugin.camera.requestCameraUpdate()},events.prototype.changingFloor=function(e,t,o){this.eventdata.changingFloor(e,t,o),core.plugin.camera.resetCamera()},core.registerAnimationFrame("smoothCameraFlash",!0,this.updateCameraEx.bind(this)))}};e.exports=o},function(e,t,o){var r,a=function(){function e(e,t){if(!a[e]){a[e]={};for(var o=0;o<e.length;o++)a[e][e.charAt(o)]=o}return a[e][t]}var t=String.fromCharCode,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",a={},n={compressToBase64:function(e){if(null==e)return"";var t=n._compress(e,6,(function(e){return o.charAt(e)}));switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:n._decompress(t.length,32,(function(r){return e(o,t.charAt(r))}))},compressToUTF16:function(e){return null==e?"":n._compress(e,15,(function(e){return t(e+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:n._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=n.compress(e),o=new Uint8Array(2*t.length),r=0,a=t.length;a>r;r++){var i=t.charCodeAt(r);o[2*r]=i>>>8,o[2*r+1]=i%256}return o},decompressFromUint8Array:function(e){if(null==e)return n.decompress(e);for(var o=new Array(e.length/2),r=0,a=o.length;a>r;r++)o[r]=256*e[2*r]+e[2*r+1];var i=[];return o.forEach((function(e){i.push(t(e))})),n.decompress(i.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":n._compress(e,6,(function(e){return r.charAt(e)}))},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),n._decompress(t.length,32,(function(o){return e(r,t.charAt(o))})))},compress:function(e){return n._compress(e,16,(function(e){return t(e)}))},_compress:function(e,t,o){if(null==e)return"";var r,a,n,i={},s={},c="",l="",u="",p=2,d=3,f=2,m=[],h=0,y=0;for(n=0;n<e.length;n+=1)if(c=e.charAt(n),Object.prototype.hasOwnProperty.call(i,c)||(i[c]=d++,s[c]=!0),l=u+c,Object.prototype.hasOwnProperty.call(i,l))u=l;else{if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(r=0;f>r;r++)h<<=1,y==t-1?(y=0,m.push(o(h)),h=0):y++;for(a=u.charCodeAt(0),r=0;8>r;r++)h=h<<1|1&a,y==t-1?(y=0,m.push(o(h)),h=0):y++,a>>=1}else{for(a=1,r=0;f>r;r++)h=h<<1|a,y==t-1?(y=0,m.push(o(h)),h=0):y++,a=0;for(a=u.charCodeAt(0),r=0;16>r;r++)h=h<<1|1&a,y==t-1?(y=0,m.push(o(h)),h=0):y++,a>>=1}0==--p&&(p=Math.pow(2,f),f++),delete s[u]}else for(a=i[u],r=0;f>r;r++)h=h<<1|1&a,y==t-1?(y=0,m.push(o(h)),h=0):y++,a>>=1;0==--p&&(p=Math.pow(2,f),f++),i[l]=d++,u=String(c)}if(""!==u){if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(r=0;f>r;r++)h<<=1,y==t-1?(y=0,m.push(o(h)),h=0):y++;for(a=u.charCodeAt(0),r=0;8>r;r++)h=h<<1|1&a,y==t-1?(y=0,m.push(o(h)),h=0):y++,a>>=1}else{for(a=1,r=0;f>r;r++)h=h<<1|a,y==t-1?(y=0,m.push(o(h)),h=0):y++,a=0;for(a=u.charCodeAt(0),r=0;16>r;r++)h=h<<1|1&a,y==t-1?(y=0,m.push(o(h)),h=0):y++,a>>=1}0==--p&&(p=Math.pow(2,f),f++),delete s[u]}else for(a=i[u],r=0;f>r;r++)h=h<<1|1&a,y==t-1?(y=0,m.push(o(h)),h=0):y++,a>>=1;0==--p&&(p=Math.pow(2,f),f++)}for(a=2,r=0;f>r;r++)h=h<<1|1&a,y==t-1?(y=0,m.push(o(h)),h=0):y++,a>>=1;for(;;){if(h<<=1,y==t-1){m.push(o(h));break}y++}return m.join("")},decompress:function(e){return null==e?"":""==e?null:n._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(e,o,r){var a,n,i,s,c,l,u,p=[],d=4,f=4,m=3,h="",y=[],g={val:r(0),position:o,index:1};for(a=0;3>a;a+=1)p[a]=a;for(i=0,c=Math.pow(2,2),l=1;l!=c;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=o,g.val=r(g.index++)),i|=(s>0?1:0)*l,l<<=1;switch(i){case 0:for(i=0,c=Math.pow(2,8),l=1;l!=c;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=o,g.val=r(g.index++)),i|=(s>0?1:0)*l,l<<=1;u=t(i);break;case 1:for(i=0,c=Math.pow(2,16),l=1;l!=c;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=o,g.val=r(g.index++)),i|=(s>0?1:0)*l,l<<=1;u=t(i);break;case 2:return""}for(p[3]=u,n=u,y.push(u);;){if(g.index>e)return"";for(i=0,c=Math.pow(2,m),l=1;l!=c;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=o,g.val=r(g.index++)),i|=(s>0?1:0)*l,l<<=1;switch(u=i){case 0:for(i=0,c=Math.pow(2,8),l=1;l!=c;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=o,g.val=r(g.index++)),i|=(s>0?1:0)*l,l<<=1;p[f++]=t(i),u=f-1,d--;break;case 1:for(i=0,c=Math.pow(2,16),l=1;l!=c;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=o,g.val=r(g.index++)),i|=(s>0?1:0)*l,l<<=1;p[f++]=t(i),u=f-1,d--;break;case 2:return y.join("")}if(0==d&&(d=Math.pow(2,m),m++),p[u])h=p[u];else{if(u!==f)return null;h=n+n.charAt(0)}y.push(h),p[f++]=n+h.charAt(0),n=h,0==--d&&(d=Math.pow(2,m),m++)}}};return n}();void 0===(r=function(){return a}.call(t,o,t,e))||(e.exports=r)},function(e,t,o){"use strict";o.r(t);var r=o(0),a=o(4),n=o(9),i=o(22);function s(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function c(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?s(Object(o),!0).forEach((function(t){l(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function u(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(e,t){if(t instanceof Object){var o=t.x,r=t.y,a=t.zoom,n=t.opacity,i=t.mirror,s=t.angle;e.x=e.defaultX+o,e.y=e.defaultY+r;var c=a/100;i?e.scale.set(-c,c):e.scale.set(c,c),e.alpha=n/255,e.angle=s}},d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o=pixi.textures.animates[t];if(!(o instanceof Object))return null;var a=o.bitmaps,n=o.frame_max,s=o.frames,c=o.ratio;this.ratio=c,this.textures=function(e,t){return t.slice(0,t.lastIndexOf(1)+1).map((function(t,o){if(t){var a="".concat(e,"-").concat(o),n=pixi.textures[a];return n?(delete pixi.textures[a],n):r.Texture.EMPTY}return r.Texture.EMPTY}))}(t,a),this.frame=n,this.frames=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=[];return e.forEach((function(e){var r=[];e.forEach((function(e){r.push({index:e[0],x:e[1],y:e[2],zoom:e[3]*t,opacity:e[4],mirror:e[5]||0,angle:e[6]||0})})),o.push(r)})),o}(s,c),this.animations=this.getTexturesArr().map((function(e){return new i.a(e)}))}var t,o,s;return t=e,(o=[{key:"getTexturesArr",value:function(){var e=r.Texture.EMPTY,t=[],o=this.frame,a=this.frames,n=this.textures;return a.forEach((function(r,a){r.forEach((function(r,i){t[i]instanceof Array||(t[i]=new Array(o).fill(e)),t[i][a]=n[r.index]}))})),t}},{key:"play",value:function(e,t,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};a.time=a.time||50;var n=r.Texture.EMPTY,i=this.frames,s=this.frame,l=this.animations.length;this.animations.forEach((function(r,u){var d=c(c({},a),{},{init:function(){this.defaultX=t,this.defaultY=o,a.init instanceof Function&&a.init.apply(this)},onFrameChange:function(e){this.texture!==n&&(p(this,i[e%s][u]),a.onFrameChange instanceof Function&&a.onFrameChange.apply(this,e))}});u===l-1&&a.onComplete instanceof Function&&(d.onComplete=function(){a.onComplete instanceof Function&&a.onComplete.apply(this)}),r.play(e,t,o,d)}))}},{key:"getSprites",value:function(){var e=r.Texture.EMPTY,t=this.frames;return this.texturesArr.map((function(o,r){return a.a.getNode("sprite",{texture:o,time:50,init:function(){var o=this;this.stop(),this.loop=!1,this.anchor.set(.5,.5),this.defaultX=0,this.defaultY=0,this.onFrameChange=function(a){o.texture!==e&&(p(o,t[a][r]),o.frameChangeUpdate instanceof Function&&o.frameChangeUpdate(o,a))},this.onComplete=function(){o.remove(),o.completeCallback instanceof Function&&o.completeCallback(),o.frameChangeUpdate=null,o.completeCallback=null}}})}))}},{key:"play2",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(!(e instanceof n.a||(e=pixi.game.getScene(e))instanceof n.a))return!1;var i=this.getSprites(),s=i.length;return i.forEach((function(n,i){n.x=t,n.y=o,n.defaultX=t,n.defaultY=o,r instanceof Function&&(n.frameChangeUpdate=function(e,t){r(e,t)}),i===s-1&&a instanceof Function&&(n.completeCallback=a),e.addNode(n),n.gotoAndPlay(0)})),!0}}])&&u(t.prototype,o),s&&u(t,s),e}();t.default=d},function(e,t,o){"use strict";var r=o(18),a=o.n(r);function n(){this._init()}t.a=n,n.prototype._init=function(){this.firstData=a.a.firstData,this.values=a.a.values,this.flags=a.a.flags}},,function(module,__webpack_exports__,__webpack_require__){"use strict";var _thirdparty_localforage_min_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(19),_thirdparty_localforage_min_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_thirdparty_localforage_min_js__WEBPACK_IMPORTED_MODULE_0__),_thirdparty_lz_string_min_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(25),_thirdparty_lz_string_min_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_thirdparty_lz_string_min_js__WEBPACK_IMPORTED_MODULE_1__);function utils(){this._init(),this.scan={up:{x:0,y:-1},left:{x:-1,y:0},down:{x:0,y:1},right:{x:1,y:0}}}function lzw_encode(e){for(var t,o={},r=(e+"").split(""),a=[],n=r[0],i=256,s=1;s<r.length;s++)null!=o[n+(t=r[s])]?n+=t:(a.push(n.length>1?o[n]:n.charCodeAt(0)),o[n+t]=i,i++,n=t);a.push(n.length>1?o[n]:n.charCodeAt(0));for(s=0;s<a.length;s++)a[s]=String.fromCharCode(a[s]);return a.join("")}function lzw_decode(e){for(var t,o={},r=(e+"").split(""),a=r[0],n=a,i=[a],s=256,c=1;c<r.length;c++){var l=r[c].charCodeAt(0);t=l<256?r[c]:o[l]?o[l]:n+a,i.push(t),a=t.charAt(0),o[s]=n+a,s++,n=t}return i.join("")}__webpack_exports__.a=utils,utils.prototype._init=function(){"function"!=typeof Object.assign&&(Object.assign=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(e),r=1;r<arguments.length;r++){var a=arguments[r];if(null!=a)for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(o[n]=a[n])}return o}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(0,e.length)===e})},utils.prototype.replaceText=function(e,t,o){return e.replace(/\${(.*?)}/g,(function(e,r){return core.calValue(r,null,t,o)}))},utils.prototype.replaceValue=function(e){return"string"==typeof e&&e.indexOf(":")>=0&&(e.indexOf("status:")>=0&&(e=e.replace(/status:([a-zA-Z0-9_]+)/g,"core.getStatus('$1')")),e.indexOf("item:")>=0&&(e=e.replace(/item:([a-zA-Z0-9_]+)/g,"core.itemCount('$1')")),e.indexOf("flag:")>=0&&(e=e.replace(/flag:([a-zA-Z0-9_\u4E00-\u9FCC]+)/g,"core.getFlag('$1', 0)")),e.indexOf("global:")>=0&&(e=e.replace(/global:([a-zA-Z0-9_\u4E00-\u9FCC]+)/g,"core.getGlobal('$1', 0)")),e.indexOf("enemy:")>=0&&(e=e.replace(/enemy:([a-zA-Z0-9_]+)\.([a-zA-Z0-9_]+)/g,"core.material.enemys['$1'].$2")),e.indexOf("blockId:")>=0&&(e=e.replace(/blockId:(\d+),(\d+)/g,"core.getBlockId($1, $2)")),e.indexOf("blockCls:")>=0&&(e=e.replace(/blockCls:(\d+),(\d+)/g,"core.getBlockCls($1, $2)")),e.indexOf("equip:")>=0&&(e=e.replace(/equip:(\d)/g,"core.getEquip($1)"))),e},utils.prototype.calValue=function(value,prefix,need,times){return core.isset(value)?"string"==typeof value?(value.indexOf(":")>=0&&(value.indexOf(!1)&&(value=value.replace(/switch:([a-zA-Z0-9_]+)/g,"core.getFlag('"+(prefix||":f@x@y")+"@$1', 0)")),value=this.replaceValue(value)),eval(value)):value instanceof Function?value():value:null},utils.prototype.unshift=function(e,t){if(e instanceof Array&&null!=t)return t instanceof Array?core.clone(t).reverse().forEach((function(t){e.unshift(t)})):e.unshift(t),e},utils.prototype.push=function(e,t){if(e instanceof Array&&null!=t)return t instanceof Array?core.clone(t).forEach((function(t){e.push(t)})):e.push(t),e},utils.prototype.decompress=function(e){try{if(t=main.lzw.decode(e))return JSON.parse(t)}catch(e){}try{var t;if(t=_thirdparty_lz_string_min_js__WEBPACK_IMPORTED_MODULE_1___default.a.decompress(e))return JSON.parse(t)}catch(e){}try{return JSON.parse(e)}catch(e){main.log(e)}return null},utils.prototype.setLocalStorage=function(e,t){try{if(null==t)return void this.removeLocalStorage(e);var o=JSON.stringify(t).replace(/[\u007F-\uFFFF]/g,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).substr(-4)})),r=main.lzw.encode(o);return localStorage.setItem("__tmp__",r),main.lzw.decode(localStorage.getItem("__tmp__"))==o?localStorage.setItem(core.firstData.name+"_"+e,r):localStorage.setItem(core.firstData.name+"_"+e,o),localStorage.removeItem("__tmp__"),"autoSave"==e?core.saves.ids[0]=!0:/^save\d+$/.test(e)&&(core.saves.ids[parseInt(e.substring(4))]=!0),!0}catch(e){return main.log(e),!1}},utils.prototype.getLocalStorage=function(e,t){var o=this.decompress(localStorage.getItem(core.firstData.name+"_"+e));return null==o?t:o},utils.prototype.removeLocalStorage=function(e){localStorage.removeItem(core.firstData.name+"_"+e),"autoSave"==e?delete core.saves.ids[0]:/^save\d+$/.test(e)&&delete core.saves.ids[parseInt(e.substring(4))]},utils.prototype.setLocalForage=function(e,t,o,r){if(core.platform.useLocalForage)if(null!=t){var a=main.lzw.encode(JSON.stringify(t).replace(/[\u007F-\uFFFF]/g,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).substr(-4)})));_thirdparty_localforage_min_js__WEBPACK_IMPORTED_MODULE_0___default.a.setItem(core.firstData.name+"_"+e,a,(function(t){t?r&&r(t):("autoSave"==e?core.saves.ids[0]=!0:/^save\d+$/.test(e)&&(core.saves.ids[parseInt(e.substring(4))]=!0),o&&o())}))}else this.removeLocalForage(e);else this.setLocalStorage(e,t)?o&&o():r&&r()},utils.prototype.getLocalForage=function(e,t,o,r){if(core.platform.useLocalForage)_thirdparty_localforage_min_js__WEBPACK_IMPORTED_MODULE_0___default.a.getItem(core.firstData.name+"_"+e,(function(e,a){if(e)r&&r(e);else{if(!o)return;if(null!=a){var n=core.utils.decompress(a);return void o(null==n?t:n)}o(t)}}));else{var a=this.getLocalStorage(e,t);o&&o(a)}},utils.prototype.removeLocalForage=function(e,t,o){if(!core.platform.useLocalForage)return this.removeLocalStorage(e),void(t&&t());_thirdparty_localforage_min_js__WEBPACK_IMPORTED_MODULE_0___default.a.removeItem(core.firstData.name+"_"+e,(function(r){r?o&&o(r):("autoSave"==e?delete core.saves.ids[0]:/^save\d+$/.test(e)&&delete core.saves.ids[parseInt(e.substring(4))],t&&t())}))},utils.prototype.setGlobal=function(e,t){core.isReplaying()||core.setLocalStorage(e,t)},utils.prototype.getGlobal=function(e,t){var o;if(core.isReplaying()){var r=core.status.replay.toReplay.shift();if(0!=r.indexOf("input2:"))return core.control._replay_error(r),core.getLocalStorage(e,t);o=JSON.parse(core.decodeBase64(r.substring(7)))}else o=core.getLocalStorage(e,t);return core.status.route.push("input2:"+core.encodeBase64(JSON.stringify(o))),o},utils.prototype.clone=function(e,t,o){if(!core.isset(e))return null;if(e instanceof Date)return(r=new Date).setTime(e.getTime()),r;if(e instanceof Array){var r=[];for(var a in e)t&&!t(a,e[a])||(r[a]=core.clone(e[a],o?t:null,o));return r}if(e instanceof Function)return e;if(e instanceof Object){r={};for(var a in e)!e.hasOwnProperty(a)||t&&!t(a,e[a])||(r[a]=core.clone(e[a],o?t:null,o));return r}return e},utils.prototype.splitImage=function(e,t,o){if("string"==typeof e&&(e=core.getMappedName(e),e=core.material.images.images[e]),!e)return[];t=t||32,o=o||t;for(var r=document.createElement("canvas"),a=r.getContext("2d"),n=[],i=0;i<e.height;i+=o)for(var s=0;s<e.width;s+=t){var c=Math.min(t,e.width-s),l=Math.min(o,e.height-i);r.width=c,r.height=l,a.drawImage(e,s,i,c,l,0,0,c,l);var u=new Image;u.src=r.toDataURL("image/png"),n.push(u)}return n},utils.prototype.formatDate=function(e){return e||(e=new Date),e.getFullYear()+"-"+core.setTwoDigits(e.getMonth()+1)+"-"+core.setTwoDigits(e.getDate())+" "+core.setTwoDigits(e.getHours())+":"+core.setTwoDigits(e.getMinutes())+":"+core.setTwoDigits(e.getSeconds())},utils.prototype.formatDate2=function(e){return e||(e=new Date),""+e.getFullYear()+core.setTwoDigits(e.getMonth()+1)+core.setTwoDigits(e.getDate())+core.setTwoDigits(e.getHours())+core.setTwoDigits(e.getMinutes())+core.setTwoDigits(e.getSeconds())},utils.prototype.formatTime=function(e){return core.setTwoDigits(parseInt(e/36e5))+":"+core.setTwoDigits(parseInt(e/6e4)%60)+":"+core.setTwoDigits(parseInt(e/1e3)%60)},utils.prototype.setTwoDigits=function(e){return parseInt(e)<10?"0"+e:e},utils.prototype.formatBigNumber=function(e,t){if(e=Math.floor(parseFloat(e)),!core.isset(e))return"???";var o=e<0?"-":"";if((e=Math.abs(e))<=99999||!t&&e<=999999)return o+e;for(var r=[{val:1e20,c:"g"},{val:1e16,c:"j"},{val:1e12,c:"z"},{val:1e8,c:"e"},{val:1e4,c:"w"}],a=0;a<r.length;a++){var n,i=r[a];if(t){if(e>=i.val)return o+(n=e/i.val).toFixed(Math.max(0,Math.floor(3-Math.log10(n+1))))+i.c}else if(e>=10*i.val)return o+(n=e/i.val).toFixed(Math.max(0,Math.floor(4-Math.log10(n+1))))+i.c}return o+e},utils.prototype.arrayToRGB=function(e){return"#"+((1<<24)+(this.clamp(parseInt(e[0]),0,255)<<16)+(this.clamp(parseInt(e[1]),0,255)<<8)+this.clamp(parseInt(e[2]),0,255)).toString(16).slice(1)},utils.prototype.arrayToRGBA=function(e){return null==e[3]&&(e[3]=1),"rgba("+this.clamp(parseInt(e[0]),0,255)+","+this.clamp(parseInt(e[1]),0,255)+","+this.clamp(parseInt(e[2]),0,255)+","+this.clamp(parseFloat(e[3]),0,1)+")"},utils.prototype.encodeRoute=function(e){var t="",o="",r=0;return e.forEach((function(e){"up"==e||"down"==e||"left"==e||"right"==e?(e!=o&&r>0&&(t+=o.substring(0,1).toUpperCase(),r>1&&(t+=r),r=0),o=e,r++):(r>0&&(t+=o.substring(0,1).toUpperCase(),r>1&&(t+=r),r=0),t+=core.utils._encodeRoute_encodeOne(e))})),r>0&&(t+=o.substring(0,1).toUpperCase(),r>1&&(t+=r)),_thirdparty_lz_string_min_js__WEBPACK_IMPORTED_MODULE_1___default.a.compressToBase64(t)},utils.prototype._encodeRoute_id2number=function(e){var t=core.maps.getNumberById(e);return 0==t?e:t},utils.prototype._encodeRoute_encodeOne=function(e){return 0==e.indexOf("item:")?"I"+this._encodeRoute_id2number(e.substring(5))+":":0==e.indexOf("unEquip:")?"u"+e.substring(8):0==e.indexOf("equip:")?"e"+this._encodeRoute_id2number(e.substring(6))+":":0==e.indexOf("fly:")?"F"+e.substring(4)+":":0==e.indexOf("choices:")?"C"+e.substring(8):0==e.indexOf("shop:")?"S"+e.substring(5):"turn"==e?"T":0==e.indexOf("turn:")?"t"+e.substring(5).substring(0,1).toUpperCase()+":":"getNext"==e?"G":0==e.indexOf("input:")?"P"+e.substring(6):0==e.indexOf("input2:")?"Q"+e.substring(7)+":":"no"==e?"N":0==e.indexOf("move:")?"M"+e.substring(5):0==e.indexOf("key:")?"K"+e.substring(4):0==e.indexOf("random:")?"X"+e.substring(7):"("+e+")"},utils.prototype.decodeRoute=function(e){if(!e)return e;try{var t=_thirdparty_lz_string_min_js__WEBPACK_IMPORTED_MODULE_1___default.a.decompressFromBase64(e);null!=t&&/^[-_a-zA-Z0-9+\/=:()]*$/.test(t)&&(""!=t||e.length<8)&&(e=t)}catch(e){}for(var o={route:e,index:0,ans:[]};o.index<o.route.length;)this._decodeRoute_decodeOne(o,o.route.charAt(o.index++));return o.ans},utils.prototype._decodeRoute_getNumber=function(e,t){for(var o="";e.index<e.route.length&&!isNaN(e.route.charAt(e.index));)o+=e.route.charAt(e.index++);return 0==o.length&&(o="1"),t?o:parseInt(o)},utils.prototype._decodeRoute_getString=function(e){for(var t="";e.index<e.route.length&&":"!=e.route.charAt(e.index);)t+=e.route.charAt(e.index++);return e.index++,t},utils.prototype._decodeRoute_number2id=function(e){if(/^\d+$/.test(e)){var t=core.maps.blocksInfo[e];if(t)return t.id}return e},utils.prototype._decodeRoute_decodeOne=function(e,t){if("("==t){var o=e.route.indexOf(")",e.index);if(o>=0)return e.ans.push(e.route.substring(e.index,o)),void(e.index=o+1)}var r="I"==t||"e"==t||"F"==t||"S"==t||"Q"==t||"t"==t?this._decodeRoute_getString(e):this._decodeRoute_getNumber(e),a={U:"up",D:"down",L:"left",R:"right"};switch(t){case"U":case"D":case"L":case"R":for(var n=0;n<r;n++)e.ans.push(a[t]);break;case"I":e.ans.push("item:"+this._decodeRoute_number2id(r));break;case"u":e.ans.push("unEquip:"+r);break;case"e":e.ans.push("equip:"+this._decodeRoute_number2id(r));break;case"F":e.ans.push("fly:"+r);break;case"C":e.ans.push("choices:"+r);break;case"S":e.ans.push("shop:"+r+":"+this._decodeRoute_getNumber(e,!0));break;case"T":e.ans.push("turn");break;case"t":e.ans.push("turn:"+a[r]);break;case"G":e.ans.push("getNext");break;case"P":e.ans.push("input:"+r);break;case"Q":e.ans.push("input2:"+r);break;case"N":e.ans.push("no");break;case"M":++e.index,e.ans.push("move:"+r+":"+this._decodeRoute_getNumber(e));break;case"K":e.ans.push("key:"+r);break;case"X":e.ans.push("random:"+r)}},utils.prototype.isset=function(e){return null!=e&&!("number"==typeof e&&isNaN(e))},utils.prototype.subarray=function(e,t){if(!(e instanceof Array)||!(t instanceof Array)||e.length<t.length)return null;for(var o=core.clone(e),r=core.clone(t);r.length>0;)if(o.shift()!=r.shift())return null;return o},utils.prototype.inArray=function(e,t){return e instanceof Array&&e.indexOf(t)>=0},utils.prototype.clamp=function(e,t,o){var r=Math.min(t,o),a=Math.max(t,o);return Math.min(Math.max(e||0,r),a)},utils.prototype.getCookie=function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?t[2]:null},utils.prototype.setStatusBarInnerHTML=function(e,t,o){if(core.statusBar[e]){var r=!1;"number"==typeof t&&(t=this.formatBigNumber(t),r=!0);var a="font-style: "+(/^[-a-zA-Z0-9`~!@#$%^&*()_=+\[{\]}\\|;:'",<.>\/?]*$/.test(t)?"italic":"normal")+"; ";a+="text-shadow: #000 1px 0 0, #000 0 1px 0, #000 -1px 0 0, #000 0 -1px 0; ";var n=this.strlen(t)||1;a+="font-size: "+Math.min(1,7/n)+"em; ",o&&(a+=o),r?core.statusBar[e].innerHTML="<span class='_status' style='"+a+"'>"+t+"</span>":(core.statusBar[e].innerHTML="<span class='_status' style='"+a+"'></span>",core.statusBar[e].children[0].innerText=t)}},utils.prototype.strlen=function(e){for(var t=0,o=0,r=e.length;o<r;o++)t+=e.charCodeAt(o)<256?1:2;return t},utils.prototype.reverseDirection=function(e){return{left:"right",right:"left",down:"up",up:"down"}[e=e||core.getHeroLoc("direction")]||e},utils.prototype.matchWildcard=function(e,t){return new RegExp("^"+e.split(/\*+/).map((function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")})).join(".*")+"$").test(t)},utils.prototype.encodeBase64=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))})))},utils.prototype.decodeBase64=function(e){return decodeURIComponent(atob(e).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))},utils.prototype.convertBase=function(e,t,o){var r="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~`!@#$%^&*()_-+={}[]\\|:;<>,.?/";if(t==o)return e;for(var a=e.length,n="",i=[],s=0;s<a;s++)i[s]=r.indexOf(e.charAt(s));for(i[a]=0;a>0;){for(s=a;s>=1;s--)i[s-1]+=i[s]%o*t,i[s]=parseInt(i[s]/o);for(n+=r.charAt(i[0]%o),i[0]=parseInt(i[0]/o);a>0&&0==i[a-1];)a--}return n},utils.prototype.rand=function(e){var t=core.getFlag("__rand__");t=this.__next_rand(t),core.setFlag("__rand__",t);var o=t/2147483647;return e&&e>0?Math.floor(o*e):o},utils.prototype.rand2=function(e){var t;if(e=e||2147483648,core.isReplaying()){var o=core.status.replay.toReplay.shift();if(0!=o.indexOf("random:"))return core.control._replay_error(o),0;t=parseInt(o.substring(7))}else t=Math.floor(Math.random()*e);return core.status.route.push("random:"+t),t},utils.prototype.__init_seed=function(){var e=(new Date).getTime()%34834795+3534;e=this.__next_rand(e),e=this.__next_rand(e),e=this.__next_rand(e),core.setFlag("__seed__",e),core.setFlag("__rand__",e)},utils.prototype.__next_rand=function(e){return e=e%127773*16807-2836*~~(e/127773),e+=e<0?2147483647:0},utils.prototype.readFile=function(e,t,o,r){if(core.platform.successCallback=e,core.platform.errorCallback=t,window.jsinterface)window.jsinterface.readFile();else{if(!core.platform.isOnline)return alert("离线状态下不支持文件读取！"),void(t&&t());if(null==core.platform.fileReader)return alert("当前浏览器不支持FileReader！"),void(t&&t());null==core.platform.fileInput&&(core.platform.fileInput=document.createElement("input"),core.platform.fileInput.style.opacity=0,core.platform.fileInput.type="file",core.platform.fileInput.onchange=function(){0!=core.platform.fileInput.files.length?(r?core.platform.fileReader.readAsDataURL(core.platform.fileInput.files[0]):core.platform.fileReader.readAsText(core.platform.fileInput.files[0]),core.platform.fileInput.value=""):core.platform.errorCallback&&core.platform.errorCallback()},o&&(core.platform.fileInput.accept=o)),core.platform.fileInput.click()}},utils.prototype.readFileContent=function(e){var t=null;if("data"!==e.slice(0,4)){try{if(t=JSON.parse(e))return void(core.platform.successCallback&&core.platform.successCallback(t))}catch(e){main.log(e),alert(e)}core.platform.errorCallback&&core.platform.errorCallback()}else core.platform.successCallback&&core.platform.successCallback(e)},utils.prototype.download=function(e,t){if(window.jsinterface)window.jsinterface.download(e,t);else if(core.platform.isOnline)if(core.platform.isIOS)core.copy(t)?alert("iOS平台下不支持直接下载文件！\n所有应下载内容已经复制到您的剪切板，请自行创建空白文件并粘贴。"):alert("iOS平台下不支持下载操作！");else if(core.platform.isPC||core.platform.isChrome&&!core.platform.isQQ&&!core.platform.isWeChat)if(core.platform.isSafari){alert("你当前使用的是Safari浏览器，不支持直接下载文件。\n即将打开一个新窗口为应下载内容，请自行全选复制然后创建空白文件并粘贴。");var o=new Blob([t],{type:"text/plain;charset=utf-8"}),r=window.URL.createObjectURL(o);window.open(r,"_blank");window.URL.revokeObjectURL(r)}else{o=new Blob([t],{type:"text/plain;charset=utf-8"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(o,e);else{r=window.URL.createObjectURL(o);var a=window.document.createElement("a");a.href=r,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(r)}}else core.copy(t)?alert("移动端只有Chrome浏览器支持直接下载文件！\n所有应下载内容已经复制到您的剪切板，请自行创建空白文件并粘贴。"):alert("该平台或浏览器暂不支持下载操作！");else alert("离线状态下不支持下载操作！")},utils.prototype.copy=function(e){if(window.jsinterface)return window.jsinterface.copy(e),!0;if(!core.platform.supportCopy)return!1;var t=document.createElement("textarea");t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="2em",t.style.height="2em",t.style.padding=0,t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e,document.body.appendChild(t),t.focus(),t.setSelectionRange(0,t.value.length);var o=!1;try{o=document.execCommand("copy")}catch(e){o=!1}return document.body.removeChild(t),o},utils.prototype.myconfirm=function(e,t,o){main.dom.inputDiv.style.display="block",main.dom.inputMessage.innerHTML=e.replace(/\n/g,"<br/>"),main.dom.inputBox.style.display="none",main.dom.inputYes.blur(),main.dom.inputNo.blur(),core.status.holdingKeys=[],core.platform.successCallback=t,core.platform.errorCallback=o},utils.prototype.myprompt=function(e,t,o){main.dom.inputDiv.style.display="block",main.dom.inputMessage.innerHTML=e.replace(/\n/g,"<br/>"),main.dom.inputBox.style.display="block",main.dom.inputBox.value=null==t?"":t,main.dom.inputYes.blur(),main.dom.inputNo.blur(),setTimeout((function(){main.dom.inputBox.focus()})),core.status.holdingKeys=[],core.platform.successCallback=core.platform.errorCallback=o},utils.prototype.showWithAnimate=function(e,t,o){if(e.style.display="block",!t||"play"!=main.mode)return e.style.opacity=1,void(o&&o());e.style.opacity=0;var r=0,a=window.setInterval((function(){r+=.03,e.style.opacity=r,r>1&&(clearInterval(a),o&&o())}),t)},utils.prototype.hideWithAnimate=function(e,t,o){if(!t||"play"!=main.mode)return e.style.display="none",void(o&&o());e.style.opacity=1;var r=1,a=window.setInterval((function(){r-=.03,e.style.opacity=r,r<0&&(e.style.display="none",clearInterval(a),o&&o())}),t)},utils.prototype._encodeCanvas=function(e){var t=[],o=e.canvas.width,r=e.canvas.height;e.mozImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1;for(var a=e.getImageData(0,0,o,r),n=0;n<a.data.length;n+=4)t.push(Math.sign(a.data[n+3]));var i=0,s=0,c=[];for(n=0;n<t.length;n++)t[n]!=i&&(c.push(s),i=t[n],s=0),s++;return c.push(s),c},utils.prototype._decodeCanvas=function(e,t,o){var r=core.bigmap.tempCanvas;if(r.canvas.width=t,r.canvas.height=o,r.clearRect(0,0,t,o),!e)return null;var a=0,n=[];e.forEach((function(e){for(var t=0;t<e;t++)n.push(a);a=1-a}));for(var i=r.getImageData(0,0,t,o),s=0;s<i.data.length;s+=4){n[s/4]&&(i.data[s]=255,i.data[s+3]=255)}r.putImageData(i,0,0)},utils.prototype.consoleOpened=function(){if(!core.flags.checkConsole)return!1;if(window.Firebug&&window.Firebug.chrome&&window.Firebug.chrome.isInitialized)return!0;if(!core.platform.isPC)return!1;var e=Math.min(window.outerWidth/window.innerWidth,window.outerHeight/window.innerHeight);return window.outerWidth-e*window.innerWidth>160||window.outerHeight-e*window.innerHeight>160},utils.prototype.hashCode=function(e){if("string"==typeof e){var t,o=0;if(0===e.length)return o;for(t=0;t<e.length;t++)o=(o<<5)-o+e.charCodeAt(t),o|=0;return o}return this.hashCode(JSON.stringify(e).split("").sort().join(""))},utils.prototype.same=function(e,t){if(null==e&&null==t)return!0;if(null==e||null==t)return!1;if(e===t)return!0;if(e instanceof Array&&t instanceof Array){if(e.length!=t.length)return!1;for(var o=0;o<e.length;o++)if(!this.same(e[o],t[o]))return!1;return!0}if(e instanceof Object&&t instanceof Object){for(var o in e)if(!this.same(e[o],t[o]))return!1;for(var o in t)if(!this.same(e[o],t[o]))return!1;return!0}return!1},utils.prototype._export=function(e){e?"all"==e?e=core.clone(core.floorIds):"string"==typeof e&&(e=[e]):e=[core.status.floorId];var t={},o=e.length+"\n"+core.__SIZE__+" "+core.__SIZE__+"\n\n";for(var r in e.forEach((function(e){var r=core.maps._getMapArrayFromBlocks(core.status.maps[e].blocks,core.__SIZE__,core.__SIZE__);o+=r.map((function(e){return e.forEach((function(e){var o=core.maps.getBlockByNumber(e);0==o.event.cls.indexOf("enemy")&&(t[e]=o.event.id)})),e.join("\t")})).join("\n")+"\n\n"})),o+=["redJewel","blueJewel","greenJewel","redPotion","bluePotion","yellowPotion","greenPotion","sword1","shield1"].map((function(e){return core.values[e]||0})).join(" ")+"\n\n",o+=Object.keys(t).length+"\n",t){var a=t[r],n=core.material.enemys[a];o+=r+" "+n.hp+" "+n.atk+" "+n.def+" "+n.money+" "+n.special+"\n"}o+="\n0 0 0 0 0 0\n\n",o+=core.status.hero.hp+" "+core.status.hero.atk+" "+core.status.hero.def+" "+core.status.hero.mdef+" "+core.status.hero.money+" "+core.itemCount("yellowKey")+" "+core.itemCount("blueKey")+" "+core.itemCount("redKey")+" 0 "+core.status.hero.loc.x+" "+core.status.hero.loc.y+"\n",console.log(o)},utils.prototype.unzip=function(e,t,o,r,a){var n=function(e){main.log(e),o&&o(e)};return window.zip?"string"==typeof e?core.http("GET",e,null,(function(e){core.unzip(e,t,o,r)}),n,null,"blob",a):e instanceof Blob?void zip.createReader(new zip.BlobReader(e),(function(e){e.getEntries((function(o){core.utils._unzip_readEntries(o,(function(o){e.close((function(){t&&t(o)}))}),r)}))}),n):n("Should use Blob or URL as input"):n("zip.js not exists!")},utils.prototype._unzip_readEntries=function(e,t,o){var r={};if(null==e)return t(r);var a=e.length;e.forEach((function(e){e.getData(o?new zip.TextWriter("utf8"):new zip.BlobWriter,(function(o){r[e.filename]=o,0==--a&&t(r)}))}))},utils.prototype.http=function(e,t,o,r,a,n,i,s){var c=new XMLHttpRequest;c.open(e,t,!0),n&&c.overrideMimeType(n),i&&(c.responseType=i),c.onload=function(e){200==c.status?r&&r(c.response):a&&a("HTTP "+c.status)},c.onprogress=function(e){e.lengthComputable&&s&&s(e.loaded/e.total)},c.onabort=function(){a&&a("Abort")},c.ontimeout=function(){a&&a("Timeout")},c.onerror=function(){a&&a("Error on Connection")},o?c.send(o):c.send()},utils.lzw={encode:lzw_encode,decode:lzw_decode}},,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";var exports_loader_plugins_bb40132b_638b_4a9f_b028_d3fe47acc8d1_project_plugins__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(24),exports_loader_plugins_bb40132b_638b_4a9f_b028_d3fe47acc8d1_project_plugins__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(exports_loader_plugins_bb40132b_638b_4a9f_b028_d3fe47acc8d1_project_plugins__WEBPACK_IMPORTED_MODULE_0__);function _core(){this.__SIZE__=13,this.__PIXELS__=32*this.__SIZE__,this.__HALF_SIZE__=Math.floor(this.__SIZE__/2),this.material={animates:{},images:{},bgms:{},sounds:{},ground:null,items:{},enemys:{},icons:{}},this.timeout={turnHeroTimeout:null,onDownTimeout:null,sleepTimeout:null},this.interval={heroMoveInterval:null,onDownInterval:null},this.animateFrame={totalTime:0,totalTimeStart:0,globalAnimate:!1,globalTime:0,selectorTime:0,selectorUp:!0,animateTime:0,moveTime:0,lastLegTime:0,leftLeg:!0,weather:{time:0,type:null,nodes:[],data:null,fog:null},tips:{time:0,offset:0,list:[],lastSize:0},asyncId:{}},this.musicStatus={audioContext:null,bgmStatus:!1,soundStatus:!0,playingBgm:null,lastBgm:null,gainNode:null,playingSounds:{},userVolume:1,designVolume:1,cachedBgms:[],cachedBgmCount:4},this.platform={isOnline:!0,isPC:!0,isAndroid:!1,isIOS:!1,string:"PC",isWeChat:!1,isQQ:!1,isChrome:!1,supportCopy:!1,useLocalForage:!0,fileInput:null,fileReader:null,successCallback:null,errorCallback:null},this.domStyle={scale:1,isVertical:!1,showStatusBar:!0,toolbarBtn:!1},this.bigmap={canvas:[],offsetX:0,offsetY:0,width:this.__SIZE__,height:this.__SIZE__,tempCanvas:null},this.paint={},this.saves={saveIndex:null,ids:{},autosave:{data:null,time:0,updated:!1,storage:!0,max:10},favorite:[],favoriteName:{}},this.initStatus={played:!1,gameOver:!1,hero:{},heroCenter:{px:null,py:null},floorId:null,thisMap:null,maps:null,bgmaps:{},fgmaps:{},checkBlock:{},lockControl:!1,heroMoving:0,heroStop:!0,automaticRoute:{autoHeroMove:!1,autoStep:0,movedStep:0,destStep:0,destX:null,destY:null,offsetX:null,offsetY:null,autoStepRoutes:[],moveStepBeforeStop:[],lastDirection:null,cursorX:null,cursorY:null,moveDirectly:!1},downTime:null,ctrlDown:!1,route:[],replay:{replaying:!1,pausing:!1,animate:!1,toReplay:[],totalList:[],speed:1,steps:0,save:[]},shops:{},event:{id:null,data:null,selection:null,ui:null,interval:null},autoEvents:[],textAttribute:{position:"center",offset:0,title:[255,215,0,1],background:[0,0,0,.85],text:[255,255,255,1],titlefont:22,textfont:16,bold:!1,time:0},globalAttribute:{equipName:main.equipName||[],statusLeftBackground:main.statusLeftBackground||"url(project/images/ground.png) repeat",statusTopBackground:main.statusTopBackground||"url(project/images/ground.png) repeat",toolsBackground:main.toolsBackground||"url(project/images/ground.png) repeat",borderColor:main.borderColor||"white",statusBarColor:main.statusBarColor||"white",hardLabelColor:main.hardLabelColor||"red",floorChangingBackground:main.floorChangingBackground||"black",floorChangingTextColor:main.floorChangingTextColor||"white",font:main.font||"Verdana"},curtainColor:null,openingDoor:null,globalAnimateObjs:[],floorAnimateObjs:[],boxAnimateObjs:[],autotileAnimateObjs:{blocks:[],map:null,bgmap:null,fgmap:null},globalAnimateStatus:0,animateObjs:[]},this.status={},this.dymCanvas={}}__webpack_exports__.a=_core,_core.prototype.init=function(e,t){for(var o in this._forwardFuncs(),e)core[o]=e[o];this._init_flags(),this._init_platform(),this._init_others(),this._initPlugins(),core.loader._load((function(){core.extensions._load((function(){core._afterLoadResources(t)}))}))},_core.prototype._init_flags=function(){for(var e in core.flags=core.clone(core.data.flags),core.values=core.clone(core.data.values),core.firstData=core.clone(core.data.firstData),this._init_sys_flags(),document.title=core.firstData.title+" - HTML5魔塔",(core.firstData.shops||[]).forEach((function(e){core.initStatus.shops[e.id]=e})),core.floors){var t=core.floors[e].autoEvent||{};for(var o in t){var r=o.split(","),a=parseInt(r[0]),n=parseInt(r[1]);for(var i in t[o]){var s=core.clone(t[o][i]);s&&s.condition&&s.data&&(s.floorId=e,s.x=a,s.y=n,s.index=i,s.symbol=e+"@"+a+"@"+n+"@"+i,s.condition=core.replaceValue(s.condition),s.data=core.precompile(s.data),core.initStatus.autoEvents.push(s))}}}core.initStatus.autoEvents.sort((function(e,t){return e.priority!=t.priority?t.priority-e.priority:e.floorId!=t.floorId?core.floorIds.indexOf(e.floorId)-core.floorIds.indexOf(t.floorId):e.x!=t.x?e.x-t.x:e.y!=t.y?e.y-t.y:e.index-t.index})),core.maps._setFloorSize(),core.material.enemys=core.enemys.getEnemys(),core.material.items=core.items.getItems(),core.items._resetItems(),core.material.icons=core.icons.getIcons()},_core.prototype._init_sys_flags=function(){core.flags.enableExperience||(core.flags.enableLevelUp=!1),core.flags.enableLevelUp||(core.flags.levelUpLeftMode=!1),core.flags.equipboxButton&&(core.flags.equipment=!0),core.flags.displayEnemyDamage=core.getLocalStorage("enemyDamage",core.flags.displayEnemyDamage),core.flags.displayCritical=core.getLocalStorage("critical",core.flags.displayCritical),core.flags.displayExtraDamage=core.getLocalStorage("extraDamage",core.flags.displayExtraDamage),core.values.moveSpeed=core.getLocalStorage("moveSpeed",core.values.moveSpeed)},_core.prototype._init_platform=function(){core.platform.isOnline=0==location.protocol.indexOf("http"),core.platform.isOnline||alert("请勿直接打开html文件！使用启动服务或者APP进行离线游戏。"),window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;try{core.musicStatus.audioContext=new window.AudioContext,core.musicStatus.gainNode=core.musicStatus.audioContext.createGain(),core.musicStatus.gainNode.connect(core.musicStatus.audioContext.destination)}catch(e){console.log("该浏览器不支持AudioContext"),core.musicStatus.audioContext=null}core.musicStatus.bgmStatus=core.getLocalStorage("bgmStatus",!0),core.musicStatus.soundStatus=core.getLocalStorage("soundStatus",!0),core.musicStatus.userVolume=core.getLocalStorage("userVolume",1),["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"].forEach((function(e){navigator.userAgent.indexOf(e)>=0&&("iPhone"!=e&&"iPad"!=e&&"iPod"!=e||(core.platform.isIOS=!0),"Android"==e&&(core.platform.isAndroid=!0),core.platform.isPC=!1)})),core.platform.string=core.platform.isPC?"PC":core.platform.isAndroid?"Android":core.platform.isIOS?"iOS":"",core.platform.supportCopy=document.queryCommandSupported&&document.queryCommandSupported("copy");var e=/Chrome\/(\d+)\./i.exec(navigator.userAgent);e&&parseInt(e[1])>=50&&(core.platform.isChrome=!0),core.platform.isSafari=/Safari/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent),core.platform.isQQ=/QQ/i.test(navigator.userAgent),core.platform.isWeChat=/MicroMessenger/i.test(navigator.userAgent),this._init_checkLocalForage(),window.FileReader&&(core.platform.fileReader=new FileReader,core.platform.fileReader.onload=function(){core.readFileContent(core.platform.fileReader.result)},core.platform.fileReader.onerror=function(){core.platform.errorCallback&&core.platform.errorCallback()})},_core.prototype._init_checkLocalForage=function(){core.platform.useLocalForage=core.getLocalStorage("useLocalForage",!0);var e=function(e){main.log(e),core.platform.useLocalForage=!1};if(core.platform.useLocalForage)try{core.setLocalForage("__test__",main.lzw.encode("__test__"),(function(){try{core.getLocalForage("__test__",null,(function(t){try{"__test__"!=main.lzw.decode(t)?(console.log("localForage unsupported!"),core.platform.useLocalForage=!1):(console.log("localForage supported!"),core.removeLocalForage("__test__"))}catch(t){e(t)}}),e)}catch(t){e(t)}}),e)}catch(t){e(t)}},_core.prototype._init_others=function(){core.material.groundCanvas=document.createElement("canvas").getContext("2d"),core.material.groundCanvas.canvas.width=core.material.groundCanvas.canvas.height=32,core.material.groundPattern=core.material.groundCanvas.createPattern(core.material.groundCanvas.canvas,"repeat"),core.bigmap.tempCanvas=document.createElement("canvas").getContext("2d"),core.loadImage("fog",(function(e,t){core.animateFrame.weather.fog=t})),core.loadImage("keyboard",(function(e,t){core.material.images.keyboard=t})),core.saves.saveIndex=core.getLocalStorage("saveIndex",1),core.control.getSaveIndexes((function(e){core.saves.ids=e}))},_core.prototype._afterLoadResources=function(e){core.initStatus.maps=core.maps._initMaps(),core.control._setRequestAnimationFrame(),core.plugin._afterLoadResources&&core.plugin._afterLoadResources(),core.showStartAnimate(),e&&e()},_core.prototype._initPlugins=function(){for(var e in core.plugin=new function(){},exports_loader_plugins_bb40132b_638b_4a9f_b028_d3fe47acc8d1_project_plugins__WEBPACK_IMPORTED_MODULE_0___default.a)if(exports_loader_plugins_bb40132b_638b_4a9f_b028_d3fe47acc8d1_project_plugins__WEBPACK_IMPORTED_MODULE_0___default.a[e]instanceof Function)try{exports_loader_plugins_bb40132b_638b_4a9f_b028_d3fe47acc8d1_project_plugins__WEBPACK_IMPORTED_MODULE_0___default.a[e].apply(core.plugin)}catch(t){main.log(t),main.log("无法初始化插件"+e)}core._forwardFunc("plugin")},_core.prototype._forwardFuncs=function(){for(var e=0;e<main.loadList.length;++e){var t=main.loadList[e];"core"!=t&&this._forwardFunc(t)}},_core.prototype._forwardFunc=function(name,funcname){if(null!=funcname)if(core[funcname])console.error("ERROR: 无法转发 "+name+" 中的函数 "+funcname+" 到 core 中！同名函数已存在。");else{var parameterInfo=/^\s*function\s*[\w_$]*\(([\w_,$\s]*)\)\s*\{/.exec(core[name][funcname].toString()),parameters=(null==parameterInfo?"":parameterInfo[1]).replace(/\s*/g,"").replace(/,/g,", ");eval("core."+funcname+" = function ("+parameters+") {\n\treturn core."+name+"."+funcname+"("+parameters+");\n}"),"plugin"==name&&main.log("插件函数转发：core."+funcname+" = core.plugin."+funcname)}else for(funcname in core[name])"_"!=funcname.charAt(0)&&core[name][funcname]instanceof Function&&this._forwardFunc(name,funcname)},_core.prototype.doFunc=function(e,t){return"string"==typeof e&&(e=core.plugin[e],t=core.plugin),e.apply(t,Array.prototype.slice.call(arguments,2))}},function(module,__webpack_exports__,__webpack_require__){"use strict";var exports_loader_functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a_project_functions__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(11),exports_loader_functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a_project_functions__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(exports_loader_functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a_project_functions__WEBPACK_IMPORTED_MODULE_0__);function actions(){this._init(),this.SIZE=core.__SIZE__,this.HSIZE=core.__HALF_SIZE__,this.LAST=this.SIZE-1,this.CHOICES_LEFT=5,this.CHOICES_RIGHT=this.LAST-this.CHOICES_LEFT}__webpack_exports__.a=actions,actions.prototype._init=function(){this.actionsdata=exports_loader_functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a_project_functions__WEBPACK_IMPORTED_MODULE_0___default.a.actions,this.actions={},this.registerAction("onkeyDown","_sys_checkReplay",this._sys_checkReplay,100),this.registerAction("onkeyDown","_sys_onkeyDown",this._sys_onkeyDown,0),this.registerAction("onkeyUp","_sys_onkeyUp_replay",this._sys_onkeyUp_replay,100),this.registerAction("onkeyUp","_sys_onkeyUp",this._sys_onkeyUp,0),this.registerAction("pressKey","_sys_checkReplay",this._sys_checkReplay,100),this.registerAction("pressKey","_sys_pressKey",this._sys_pressKey,0),this.registerAction("keyDown","_sys_checkReplay",this._sys_checkReplay,100),this.registerAction("keyDown","_sys_keyDown_lockControl",this._sys_keyDown_lockControl,50),this.registerAction("keyDown","_sys_keyDown",this._sys_keyDown,0),this.registerAction("keyUp","_sys_keyUp_replay",this._sys_keyUp_replay,100),this.registerAction("keyUp","_sys_keyUp_lockControl",this._sys_keyUp_lockControl,50),this.registerAction("keyUp","_sys_keyUp",this._sys_keyUp,0),this.registerAction("ondown","_sys_checkReplay",this._sys_checkReplay,100),this.registerAction("ondown","_sys_ondown_paint",this._sys_ondown_paint,60),this.registerAction("ondown","_sys_ondown_lockControl",this._sys_ondown_lockControl,30),this.registerAction("ondown","_sys_ondown",this._sys_ondown,0),this.registerAction("onmove","_sys_checkReplay",this._sys_checkReplay,100),this.registerAction("onmove","_sys_onmove_paint",this._sys_onmove_paint,50),this.registerAction("onmove","_sys_onmove_choices",this._sys_onmove_choices,30),this.registerAction("onmove","_sys_onmove",this._sys_onmove,0),this.registerAction("onup","_sys_checkReplay",this._sys_checkReplay,100),this.registerAction("onup","_sys_onup_paint",this._sys_onup_paint,50),this.registerAction("onup","_sys_onup",this._sys_onup,0),this.registerAction("onclick","_sys_checkReplay",this._sys_checkReplay,100),this.registerAction("onclick","_sys_onclick_lockControl",this._sys_onclick_lockControl,50),this.registerAction("onclick","_sys_onclick",this._sys_onclick,0),this.registerAction("onmousewheel","_sys_onmousewheel",this._sys_onmousewheel,0),this.registerAction("keyDownCtrl","_sys_keyDownCtrl",this._sys_keyDownCtrl,0),this.registerAction("longClick","_sys_longClick_lockControl",this._sys_longClick_lockControl,50),this.registerAction("longClick","_sys_longClick",this._sys_longClick,0),this.registerAction("onStatusBarClick","_sys_onStatusBarClick",this._sys_onStatusBarClick,0)},actions.prototype.registerAction=function(e,t,o,r){t&&o&&(r=r||0,this.actions[e]||(this.actions[e]=[]),this.unregisterAction(e,t),this.actions[e].push({action:e,name:t,func:o,priority:r}),this.actions[e]=this.actions[e].sort((function(e,t){return t.priority-e.priority})))},actions.prototype.unregisterAction=function(e,t){this.actions[e]&&(this.actions[e]=this.actions[e].filter((function(e){return e.name!=t})))},actions.prototype.doRegisteredAction=function(e){var t=this.actions[e];if(!t)return!1;for(var o=0;o<t.length;++o)try{if(core.doFunc.apply(core,[t[o].func,this].concat(Array.prototype.slice.call(arguments,1))))return!0}catch(e){main.log(e),main.log("ERROR in actions["+t[o].name+"].")}return!1},actions.prototype._checkReplaying=function(){return!!(core.isReplaying()&&["save","book","book-detail","viewMaps","toolbox","equipbox","text"].indexOf(core.status.event.id)<0)},actions.prototype._sys_checkReplay=function(){if(this._checkReplaying())return!0},actions.prototype.onkeyDown=function(e){this.doRegisteredAction("onkeyDown",e)},actions.prototype._sys_onkeyDown=function(e){if(core.status.holdingKeys=core.status.holdingKeys||[],{37:!0,38:!0,39:!0,40:!0}[e.keyCode]&&!core.status.lockControl){for(var t=0;t<core.status.holdingKeys.length;t++)if(core.status.holdingKeys[t]===e.keyCode)return;e.preventDefault&&e.preventDefault(),core.status.holdingKeys.push(e.keyCode),this.pressKey(e.keyCode)}else 17==e.keyCode&&(core.status.ctrlDown=!0),this.keyDown(e.keyCode)},actions.prototype.onkeyUp=function(e){this.doRegisteredAction("onkeyUp",e)},actions.prototype._sys_onkeyUp_replay=function(e){if(this._checkReplaying())return 27==e.keyCode?core.stopReplay():90==e.keyCode?core.speedDownReplay():88==e.keyCode?core.speedUpReplay():32==e.keyCode?core.triggerReplay():65==e.keyCode?core.rewindReplay():83==e.keyCode?core.saveReplay():67==e.keyCode?core.bookReplay():33==e.keyCode||34==e.keyCode?core.viewMapReplay():78==e.keyCode?core.stepReplay():84==e.keyCode?core.toolboxReplay():81==e.keyCode?core.equipboxReplay():66==e.keyCode?core.drawStatistics():e.keyCode>=49&&e.keyCode<=51?core.setReplaySpeed(e.keyCode-48):52==e.keyCode?core.setReplaySpeed(6):53==e.keyCode?core.setReplaySpeed(12):54==e.keyCode&&core.setReplaySpeed(24),!0},actions.prototype._sys_onkeyUp=function(e){if({37:!0,38:!0,39:!0,40:!0}[e.keyCode]&&!core.status.lockControl){for(var t=0;t<core.status.holdingKeys.length;t++)if(core.status.holdingKeys[t]===e.keyCode){core.status.holdingKeys=core.status.holdingKeys.slice(0,t).concat(core.status.holdingKeys.slice(t+1)),t===core.status.holdingKeys.length&&0!==core.status.holdingKeys.length&&core.pressKey(core.status.holdingKeys.slice(-1)[0]);break}e.preventDefault&&e.preventDefault(),this.keyUp(e.keyCode,e.altKey)}else 17==e.keyCode&&(core.status.ctrlDown=!1),this.keyUp(e.keyCode,e.altKey)},actions.prototype.pressKey=function(e){this.doRegisteredAction("pressKey",e)},actions.prototype._sys_pressKey=function(e){e===core.status.holdingKeys.slice(-1)[0]&&(this.keyDown(e),window.setTimeout((function(){core.pressKey(e)}),30))},actions.prototype.keyDown=function(e){this.doRegisteredAction("keyDown",e)},actions.prototype._sys_keyDown_lockControl=function(e){if(!core.status.lockControl)return!1;if(17==e)return this.keyDownCtrl(),!0;switch(core.status.event.id){case"action":this._keyDownAction(e);break;case"book":this._keyDownBook(e);break;case"fly":this._keyDownFly(e);break;case"viewMaps":this._keyDownViewMaps(e);break;case"equipbox":this._keyDownEquipbox(e);break;case"toolbox":this._keyDownToolbox(e);break;case"save":case"load":case"replayLoad":case"replayRemain":this._keyDownSL(e);break;case"shop":this._keyDownShop(e);break;case"selectShop":case"switchs":case"settings":case"syncSave":case"syncSelect":case"localSaveSelect":case"storageRemove":case"replay":case"gameInfo":this._keyDownChoices(e);break;case"cursor":this._keyDownCursor(e)}return!0},actions.prototype._sys_keyDown=function(e){if(!core.status.played)return!0;switch(e){case 37:core.moveHero("left");break;case 38:core.moveHero("up");break;case 39:core.moveHero("right");break;case 40:core.moveHero("down")}return!0},actions.prototype.keyUp=function(e,t,o){this.doRegisteredAction("keyUp",e,t,o)},actions.prototype._sys_keyUp_replay=function(e,t,o){if(!o&&this._checkReplaying())return!0},actions.prototype._sys_keyUp_lockControl=function(e,t){if(!core.status.lockControl)return!1;var o=function(){return 27==e||88==e||13==e||32==e||67==e};switch(core.status.holdingKeys=[],core.status.event.id){case"text":o()&&core.drawText();break;case"confirmBox":this._keyUpConfirmBox(e);break;case"action":this._keyUpAction(e);break;case"about":case"help":o()&&core.closePanel();break;case"book":this._keyUpBook(e);break;case"book-detail":o()&&this._clickBookDetail();break;case"fly":this._keyUpFly(e);break;case"viewMaps":this._keyUpViewMaps(e);break;case"shop":this._keyUpShop(e);break;case"selectShop":this._keyUpQuickShop(e);break;case"toolbox":this._keyUpToolbox(e);break;case"equipbox":this._keyUpEquipbox(e,t);break;case"save":case"load":case"replayLoad":case"replayRemain":this._keyUpSL(e);break;case"keyBoard":o()&&core.closePanel();break;case"switchs":this._keyUpSwitchs(e);break;case"settings":this._keyUpSettings(e);break;case"syncSave":this._keyUpSyncSave(e);break;case"syncSelect":this._keyUpSyncSelect(e);break;case"localSaveSelect":this._keyUpLocalSaveSelect(e);break;case"storageRemove":this._keyUpStorageRemove(e);break;case"cursor":this._keyUpCursor(e);break;case"replay":this._keyUpReplay(e);break;case"gameInfo":this._keyUpGameInfo(e);break;case"centerFly":this._keyUpCenterFly(e);break;case"paint":this._keyUpPaint(e)}return!0},actions.prototype._sys_keyUp=function(e,t){return!core.status.played||(this.actionsdata.onKeyUp(e,t),core.status.automaticRoute&&core.status.automaticRoute.autoHeroMove&&core.stopAutomaticRoute(),core.status.heroStop=!0,!0)},actions.prototype.ondown=function(e){var t=parseInt(e.x/e.size),o=parseInt(e.y/e.size),r=parseInt(e.x/core.domStyle.scale),a=parseInt(e.y/core.domStyle.scale);this.doRegisteredAction("ondown",t,o,r,a)},actions.prototype._sys_ondown_paint=function(e,t,o,r){if(core.status.played&&"paint"==(core.status.event||{}).id)return this._ondownPaint(o,r),!0},actions.prototype._sys_ondown_lockControl=function(e,t,o,r){return!(core.status.played&&!core.status.lockControl)&&("action"==core.status.event.id&&"wait"==core.status.event.data.type?(core.setFlag("type",1),core.setFlag("x",e),core.setFlag("y",t),core.setFlag("px",o),core.setFlag("py",r),core.status.route.push("input:"+(1e6+1e3*o+r)),core.events.__action_wait_afterGet(core.status.event.data.current),core.doAction()):core.actions.onclick(e,t,[]),null==core.timeout.onDownTimeout&&(core.timeout.onDownTimeout=setTimeout((function(){null==core.interval.onDownInterval&&(core.interval.onDownInterval=setInterval((function(){core.actions.longClick(e,t,!0)||(clearInterval(core.interval.onDownInterval),core.interval.onDownInterval=null)}),40))}),500)),!0)},actions.prototype._sys_ondown=function(e,t,o,r){core.status.downTime=new Date,core.deleteCanvas("route");var a={x:e,y:t};core.status.stepPostfix=[],core.status.stepPostfix.push(a),core.fillPosWithPoint(a)},actions.prototype.onmove=function(e){var t=parseInt(e.x/e.size),o=parseInt(e.y/e.size),r=parseInt(e.x/core.domStyle.scale),a=parseInt(e.y/core.domStyle.scale);this.doRegisteredAction("onmove",t,o,r,a)},actions.prototype._sys_onmove_paint=function(e,t,o,r){if(core.status.played&&"paint"==(core.status.event||{}).id)return core.actions._onmovePaint(o,r),!0},actions.prototype._sys_onmove_choices=function(e,t){if(!core.status.lockControl)return!1;switch(core.status.event.id){case"action":if("choices"!=core.status.event.data.type)break;case"shop":case"selectShop":case"switchs":case"settings":case"syncSave":case"syncSelect":case"localSaveSelect":case"storageRemove":case"replay":case"gameInfo":return this._onMoveChoices(e,t),!0}return!1},actions.prototype._sys_onmove=function(e,t){if((core.status.stepPostfix||[]).length>0){for(var o={x:e,y:t},r=core.status.stepPostfix[core.status.stepPostfix.length-1],a=[o.y-r.y,r.x-o.x,r.y-o.y,o.x-r.x],n=0,i=4,s=0;s<4;s++)a[s]>n&&(i=s,n=a[s]);(o=[{x:0,y:1},{x:-1,y:0},{x:0,y:-1},{x:1,y:0},!1][i])&&(o.x+=r.x,o.y+=r.y,core.status.stepPostfix.push(o),core.fillPosWithPoint(o))}return!0},actions.prototype.onup=function(e){var t=parseInt(e.x/e.size),o=parseInt(e.y/e.size),r=parseInt(e.x/core.domStyle.scale),a=parseInt(e.y/core.domStyle.scale);this.doRegisteredAction("onup",t,o,r,a)},actions.prototype._sys_onup_paint=function(){if(core.status.played&&"paint"==(core.status.event||{}).id)return this._onupPaint(),!0},actions.prototype._sys_onup=function(){if(clearTimeout(core.timeout.onDownTimeout),core.timeout.onDownTimeout=null,clearInterval(core.interval.onDownInterval),core.interval.onDownInterval=null,0==(core.status.stepPostfix||[]).length)return!1;for(var e=[],t={0:{1:"down","-1":"up"},"-1":{0:"left"},1:{0:"right"}},o=1;o<core.status.stepPostfix.length;o++){var r=core.status.stepPostfix[o-1],a=core.status.stepPostfix[o];e.push({direction:t[a.x-r.x][a.y-r.y],x:a.x+parseInt(core.bigmap.offsetX/32),y:a.y+parseInt(core.bigmap.offsetY/32)})}var n=core.status.stepPostfix[0].x,i=core.status.stepPostfix[0].y;return core.status.stepPostfix=[],core.status.lockControl||core.clearMap("ui"),!core.status.lockControl&&0==e.length&&null!=core.status.downTime&&new Date-core.status.downTime>=1e3?core.actions.longClick(n,i):core.actions.onclick(n,i,e),core.status.downTime=null,!0},actions.prototype._getClickLoc=function(e,t){var o=32;o*=pixi.resize.style.scale;var r=core.dom.data;return{x:e-r.offsetLeft,y:t-r.offsetTop,size:o}},actions.prototype.onclick=function(e,t,o){return this.doRegisteredAction("onclick",e,t,o||[])},actions.prototype._sys_onclick_lockControl=function(e,t){if(!core.status.lockControl)return!1;switch(core.status.event.id){case"centerFly":this._clickCenterFly(e,t);break;case"book":this._clickBook(e,t);break;case"book-detail":this._clickBookDetail(e,t);break;case"fly":this._clickFly(e,t);break;case"viewMaps":this._clickViewMaps(e,t);break;case"switchs":this._clickSwitchs(e,t);break;case"settings":this._clickSettings(e,t);break;case"shop":this._clickShop(e,t);break;case"selectShop":this._clickQuickShop(e,t);break;case"equipbox":this._clickEquipbox(e,t);break;case"toolbox":this._clickToolbox(e,t);break;case"save":case"load":case"replayLoad":case"replayRemain":this._clickSL(e,t);break;case"confirmBox":this._clickConfirmBox(e,t);break;case"keyBoard":this._clickKeyBoard(e,t);break;case"action":this._clickAction(e,t);break;case"text":core.drawText();break;case"syncSave":this._clickSyncSave(e,t);break;case"syncSelect":this._clickSyncSelect(e,t);break;case"localSaveSelect":this._clickLocalSaveSelect(e,t);break;case"storageRemove":this._clickStorageRemove(e,t);break;case"cursor":this._clickCursor(e,t);break;case"replay":this._clickReplay(e,t);break;case"gameInfo":this._clickGameInfo(e,t);break;case"about":case"help":core.ui.closePanel()}return!0},actions.prototype._sys_onclick=function(e,t,o){return core.setAutomaticRoute(e+parseInt(core.bigmap.offsetX/32),t+parseInt(core.bigmap.offsetY/32),o),!0},actions.prototype.onmousewheel=function(e){this.doRegisteredAction("onmousewheel",e)},actions.prototype._sys_onmousewheel=function(e){if(this._checkReplaying())return 1==e&&core.speedUpReplay(),void(-1==e&&core.speedDownReplay());if(core.status.lockControl&&"fly"==core.status.event.id)return 1==e&&core.ui.drawFly(this._getNextFlyFloor(1)),void(-1==e&&core.ui.drawFly(this._getNextFlyFloor(-1)));if(core.status.lockControl&&"book"==core.status.event.id)return 1==e&&core.ui.drawBook(core.status.event.data-this.HSIZE),void(-1==e&&core.ui.drawBook(core.status.event.data+this.HSIZE));if(core.status.lockControl&&("save"==core.status.event.id||"load"==core.status.event.id)){var t=10*core.status.event.data.page+core.status.event.data.offset;return 1==e&&core.ui.drawSLPanel(t-10),void(-1==e&&core.ui.drawSLPanel(t+10))}if(core.status.lockControl&&"viewMaps"==core.status.event.id)return 1==e&&this._clickViewMaps(this.HSIZE,this.HSIZE-3),void(-1==e&&this._clickViewMaps(this.HSIZE,this.HSIZE+3));if(core.status.lockControl&&"action"==core.status.event.id&&"wait"==core.status.event.data.type){core.setFlag("type",0);var o=1==e?33:34;return core.setFlag("keycode",o),core.status.route.push("input:"+o),core.events.__action_wait_afterGet(core.status.event.data.current),void core.doAction()}},actions.prototype.keyDownCtrl=function(){this.doRegisteredAction("keyDownCtrl")},actions.prototype._sys_keyDownCtrl=function(){return"text"==core.status.event.id?(core.drawText(),!0):"action"==core.status.event.id&&"text"==core.status.event.data.type?(core.doAction(),!0):"action"!=core.status.event.id||"sleep"!=core.status.event.data.type||core.status.event.data.current.noSkip?void 0:(core.timeout.sleepTimeout&&!core.hasAsync()&&(clearTimeout(core.timeout.sleepTimeout),core.timeout.sleepTimeout=null,core.doAction()),!0)},actions.prototype.longClick=function(e,t,o){return!!core.isPlaying()&&this.doRegisteredAction("longClick",e,t,o)},actions.prototype._sys_longClick_lockControl=function(e,t){return!!core.status.lockControl&&("text"==core.status.event.id?(core.drawText(),!0):"action"==core.status.event.id&&"text"==core.status.event.data.type?(core.doAction(),!0):"fly"!=core.status.event.id||e!=this.SIZE-2&&e!=this.SIZE-3||t!=this.HSIZE-1&&t!=this.HSIZE+3?["save","load","replayLoad","replayRemain"].indexOf(core.status.event.id)>=0&&[this.HSIZE-2,this.HSIZE-3,this.HSIZE+2,this.HSIZE+3].indexOf(e)>=0&&t==this.LAST?(this._clickSL(e,t),!0):"shop"==core.status.event.id&&e>=this.CHOICES_LEFT&&e<=this.CHOICES_RIGHT?this._clickShop(e,t):!("action"!=core.status.event.id||"sleep"!=core.status.event.data.type||core.status.event.data.current.noSkip||!core.timeout.sleepTimeout||core.hasAsync())&&(clearTimeout(core.timeout.sleepTimeout),core.timeout.sleepTimeout=null,core.doAction(),!0):(this._clickFly(e,t),!0))},actions.prototype._sys_longClick=function(e,t,o){return!core.status.lockControl&&!o&&(core.waitHeroToStop((function(){core.ui.drawKeyBoard()})),!0)},actions.prototype.onStatusBarClick=function(e){if(!core.isPlaying())return!1;var t=core.dom.gameGroup.offsetLeft+3,o=core.dom.gameGroup.offsetTop+3,r=parseInt((e.clientX-t)/core.domStyle.scale),a=parseInt((e.clientY-o)/core.domStyle.scale);return this.doRegisteredAction("onStatusBarClick",r,a)},actions.prototype._sys_onStatusBarClick=function(e,t){if(this.actionsdata.onStatusBarClick)return this.actionsdata.onStatusBarClick(e,t)},actions.prototype._selectChoices=function(e,t,o){var r=this.HSIZE-parseInt((e-1)/2)+(core.status.event.ui.offset||0);if(13!=t&&32!=t&&67!=t||o.apply(this,[this.HSIZE,r+core.status.event.selection]),"switchs"!=core.status.event.id||2!=core.status.event.selection&&3!=core.status.event.selection||(37==t&&o.apply(this,[this.HSIZE-2,r+core.status.event.selection]),39==t&&o.apply(this,[this.HSIZE+2,r+core.status.event.selection])),t>=49&&t<=57){var a=t-49;a<e&&o.apply(this,[this.HSIZE,r+a])}},actions.prototype._keyDownChoices=function(e){38==e&&(core.status.event.selection--,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)),40==e&&(core.status.event.selection++,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices))},actions.prototype._onMoveChoices=function(e,t){if(!(e<this.CHOICES_LEFT||e>this.CHOICES_RIGHT)){var o=core.status.event.ui.choices,r=this.HSIZE-parseInt((o.length-1)/2)+(core.status.event.ui.offset||0);if(t>=r&&t<r+o.length){var a=t-r;if(a==core.status.event.selection)return;core.status.event.selection=a,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)}}},actions.prototype._clickCenterFly=function(e,t){var o=core.status.event.data.posX,r=core.status.event.data.posY;core.ui.closePanel(),e==o&&t==r&&(core.canUseItem("centerFly")?core.useItem("centerFly"):core.drawTip("当前不能使用中心对称飞行器"))},actions.prototype._keyUpCenterFly=function(e){core.ui.closePanel(),51!=e&&13!=e&&32!=e&&67!=e||(core.canUseItem("centerFly")?core.useItem("centerFly"):core.drawTip("当前不能使用中心对称飞行器"))},actions.prototype._clickConfirmBox=function(e,t){e!=this.HSIZE-2&&e!=this.HSIZE-1||t!=this.HSIZE+1||!core.status.event.data.yes||core.status.event.data.yes(),e!=this.HSIZE+2&&e!=this.HSIZE+1||t!=this.HSIZE+1||!core.status.event.data.no||core.status.event.data.no()},actions.prototype._keyUpConfirmBox=function(e){if(37==e)return core.status.event.selection=0,void core.ui.drawConfirmBox(core.status.event.ui,core.status.event.data.yes,core.status.event.data.no);if(39==e)return core.status.event.selection=1,void core.ui.drawConfirmBox(core.status.event.ui,core.status.event.data.yes,core.status.event.data.no);if(13==e||32==e||67==e){if(0==core.status.event.selection&&core.status.event.data.yes)return core.status.event.selection=null,void core.status.event.data.yes();if(1==core.status.event.selection&&core.status.event.data.no)return core.status.event.selection=null,void core.status.event.data.no()}},actions.prototype._clickAction=function(e,t){if("text"==core.status.event.data.type)return null!=core.status.event.interval&&core.insertAction({type:"text",text:core.status.event.ui,showAll:!0}),void core.doAction();if("choices"!=core.status.event.data.type)"confirm"!=core.status.event.data.type||(e!=this.HSIZE-2&&e!=this.HSIZE-1||t!=this.HSIZE+1?e!=this.HSIZE+2&&e!=this.HSIZE+1||t!=this.HSIZE+1||(core.status.route.push("choices:1"),core.insertAction(core.status.event.ui.no),core.doAction()):(core.status.route.push("choices:0"),core.insertAction(core.status.event.ui.yes),core.doAction()));else{var o=core.status.event.data.current.choices;if(0==o.length)return;if(e>=this.CHOICES_LEFT&&e<=this.CHOICES_RIGHT){var r=this.HSIZE-parseInt((o.length-1)/2)+(core.status.event.ui.offset||0);t>=r&&t<r+o.length&&(core.status.route.push("choices:"+(t-r)),core.insertAction(o[t-r].action),core.doAction())}}},actions.prototype._keyDownAction=function(e){if("choices"!=core.status.event.data.type)return"confirm"!=core.status.event.data.type||37!=e&&39!=e?void 0:(core.status.event.selection=1-core.status.event.selection,void core.drawConfirmBox(core.status.event.ui.text));this._keyDownChoices(e)},actions.prototype._keyUpAction=function(e){if("text"==core.status.event.data.type&&(13==e||32==e||67==e))return null!=core.status.event.interval&&core.insertAction({type:"text",text:core.status.event.ui,showAll:!0}),void core.doAction();if("wait"==core.status.event.data.type)return core.setFlag("type",0),core.setFlag("keycode",e),core.status.route.push("input:"+e),core.events.__action_wait_afterGet(core.status.event.data.current),void core.doAction();if("choices"!=core.status.event.data.type)return"confirm"!=core.status.event.data.type||13!=e&&32!=e&&67!=e?void 0:(core.status.route.push("choices:"+core.status.event.selection),0==core.status.event.selection?core.insertAction(core.status.event.ui.yes):core.insertAction(core.status.event.ui.no),void core.doAction());var t=core.status.event.data.current.choices;t.length>0&&this._selectChoices(t.length,e,this._clickAction)},actions.prototype._clickBook=function(e,t){if(e!=this.HSIZE-2&&e!=this.HSIZE-3||t!=this.LAST)if(e!=this.HSIZE+2&&e!=this.HSIZE+3||t!=this.LAST)if(e>=this.LAST-2&&t==this.LAST){if(core.events.recoverEvents(core.status.event.interval))return;null!=core.status.event.ui?(core.status.boxAnimateObjs=[],core.ui.drawMaps(core.status.event.ui)):core.ui.closePanel()}else{var o=core.status.event.data;if(null!=o&&t<this.LAST){for(var r=core.ui._drawBook_pageinfo().per_page,a=parseInt(o/r),n=this.LAST/r,i=0;i<r;++i)if(t>=n*i&&t<n*(i+1)){var s=r*a+i;core.ui.drawBook(s),core.ui.drawBookDetail(s);break}}else;}else core.ui.drawBook(core.status.event.data+this.HSIZE);else core.ui.drawBook(core.status.event.data-this.HSIZE)},actions.prototype._keyDownBook=function(e){37==e&&core.ui.drawBook(core.status.event.data-this.HSIZE),38==e&&core.ui.drawBook(core.status.event.data-1),39==e&&core.ui.drawBook(core.status.event.data+this.HSIZE),40==e&&core.ui.drawBook(core.status.event.data+1),33==e&&core.ui.drawBook(core.status.event.data-this.HSIZE),34==e&&core.ui.drawBook(core.status.event.data+this.HSIZE)},actions.prototype._keyUpBook=function(e){if(27!=e&&88!=e)if(13!=e&&32!=e&&67!=e);else{var t=core.status.event.data;null!=t&&core.ui.drawBookDetail(t)}else{if(core.events.recoverEvents(core.status.event.interval))return;null!=core.status.event.ui?(core.status.boxAnimateObjs=[],core.ui.drawMaps(core.status.event.ui)):core.ui.closePanel()}},actions.prototype._clickBookDetail=function(){core.clearMap("data"),core.status.event.id="book"},actions.prototype._clickFly=function(e,t){e!=this.SIZE-2&&e!=this.SIZE-3||t!=this.HSIZE+3||core.ui.drawFly(this._getNextFlyFloor(-1)),e!=this.SIZE-2&&e!=this.SIZE-3||t!=this.HSIZE-1||core.ui.drawFly(this._getNextFlyFloor(1)),e!=this.SIZE-2&&e!=this.SIZE-3||t!=this.HSIZE+4||core.ui.drawFly(this._getNextFlyFloor(-10)),e!=this.SIZE-2&&e!=this.SIZE-3||t!=this.HSIZE-2||core.ui.drawFly(this._getNextFlyFloor(10)),e>=this.HSIZE-1&&e<=this.HSIZE+1&&t==this.LAST&&core.ui.closePanel(),e>=0&&e<=this.HSIZE+3&&t>=3&&t<=this.LAST-1&&core.flyTo(core.floorIds[core.status.event.data])},actions.prototype._keyDownFly=function(e){37==e?core.ui.drawFly(this._getNextFlyFloor(-10)):38==e?core.ui.drawFly(this._getNextFlyFloor(1)):39==e?core.ui.drawFly(this._getNextFlyFloor(10)):40==e&&core.ui.drawFly(this._getNextFlyFloor(-1))},actions.prototype._getNextFlyFloor=function(e,t){if(null==t&&(t=core.status.event.data),0==e)return t;var o=Math.sign(e);e=Math.abs(e);for(var r=t;!((t+=o)<0||t>=core.floorIds.length);){var a=core.floorIds[t];if(core.status.maps[a].canFlyTo&&core.hasVisitedFloor(a)&&(e--,r=t),0==e)break}return r},actions.prototype._keyUpFly=function(e){71!=e&&27!=e&&88!=e||core.ui.closePanel(),13!=e&&32!=e&&67!=e||this._clickFly(this.HSIZE-1,this.HSIZE-1)},actions.prototype._clickViewMaps=function(e,t){if(null!=core.status.event.data){var o=core.floorIds.indexOf(core.status.floorId),r=core.status.event.data.index,a=core.status.event.data.x,n=core.status.event.data.y,i=core.floorIds[r],s=(core.floors[i].width,core.floors[i].height),c=this.HSIZE-4;if(e<=c-2&&t<=c-2)return core.status.event.data.damage=!core.status.event.data.damage,void core.ui.drawMaps(r,a,n);if(e<=c-2&&t>=this.SIZE+1-c)return core.status.event.data.paint=!core.status.event.data.paint,void core.ui.drawMaps(r,a,n);if(e>=this.SIZE+1-c&&t<=c-2)return core.status.event.data.all=!core.status.event.data.all,void core.ui.drawMaps(r,a,n);if(e>=c&&e<=this.LAST-c&&t<=c-1&&s>this.SIZE)core.ui.drawMaps(r,a,n-1);else if(e>=c&&e<=this.LAST-c&&t>=this.SIZE-c&&s>this.SIZE)core.ui.drawMaps(r,a,n+1);else if(e<=c-1&&t>=c&&t<=this.LAST-c)core.ui.drawMaps(r,a-1,n);else if(e>=this.SIZE-c&&t>=c&&t<=this.LAST-c)core.ui.drawMaps(r,a+1,n);else if(t<=this.HSIZE-2&&(s==this.SIZE||e>=c&&e<=this.LAST-c)){for(r++;r<core.floorIds.length&&r!=o&&core.status.maps[core.floorIds[r]].cannotViewMap;)r++;r<core.floorIds.length&&core.ui.drawMaps(r)}else{if(!(t>=this.HSIZE+2&&(s==this.SIZE||e>=c&&e<=this.LAST-c)))return e>=c&&e<=this.LAST-c&&t>=this.HSIZE-1&&t<=this.HSIZE+1?(core.clearMap("data"),void core.ui.closePanel()):void 0;for(r--;r>=0&&r!=o&&core.status.maps[core.floorIds[r]].cannotViewMap;)r--;r>=0&&core.ui.drawMaps(r)}}else core.ui.drawMaps(core.floorIds.indexOf(core.status.floorId))},actions.prototype._keyDownViewMaps=function(e){if(null!=core.status.event.data){var t=core.floorIds[core.status.event.data.index],o=core.floors[t].height;38!=e&&33!=e||this._clickViewMaps(this.HSIZE,this.HSIZE-3),40!=e&&34!=e||this._clickViewMaps(this.HSIZE,this.HSIZE+3),87==e&&o>this.SIZE&&this._clickViewMaps(this.HSIZE,0),65==e&&this._clickViewMaps(0,this.HSIZE),83==e&&o>this.SIZE&&this._clickViewMaps(this.HSIZE,this.LAST),68==e&&this._clickViewMaps(this.LAST,this.HSIZE)}},actions.prototype._keyUpViewMaps=function(e){if(null!=core.status.event.data)return 27==e||13==e||32==e||!core.isReplaying()&&67==e?(core.clearMap("data"),void core.ui.closePanel()):86==e?(core.status.event.data.damage=!core.status.event.data.damage,void core.ui.drawMaps(core.status.event.data)):90==e?(core.status.event.data.all=!core.status.event.data.all,void core.ui.drawMaps(core.status.event.data)):77==e?(core.status.event.data.paint=!core.status.event.data.paint,void core.ui.drawMaps(core.status.event.data)):void((88==e||core.isReplaying()&&67==e)&&(core.isReplaying()?core.bookReplay():core.openBook(!1)));core.ui.drawMaps(core.floorIds.indexOf(core.status.floorId))},actions.prototype._clickShop=function(e,t){var o=core.status.event.data.shop,r=o.choices;if(e>=this.CHOICES_LEFT&&e<=this.CHOICES_RIGHT){var a=this.HSIZE-parseInt(r.length/2)+(core.status.event.ui.offset||0);if(t>=a&&t<a+r.length)return core.events._useShop(o,t-a);if(t!=a+r.length)return!1;core.events._exitShop()}return!0},actions.prototype._keyDownShop=function(e){32!=e||core.status.event.selection==core.status.event.data.shop.choices.length?this._keyDownChoices(e):this._selectChoices(core.status.event.data.shop.choices.length+1,e,this._clickShop)},actions.prototype._keyUpShop=function(e){27!=e&&88!=e?32==e&&core.status.event.selection!=core.status.event.data.shop.choices.length||this._selectChoices(core.status.event.data.shop.choices.length+1,e,this._clickShop):core.events._exitShop()},actions.prototype._clickQuickShop=function(e,t){var o=Object.keys(core.status.shops).filter((function(e){return core.status.shops[e].visited||!core.status.shops[e].mustEnable}));if(e>=this.CHOICES_LEFT&&e<=this.CHOICES_RIGHT){var r=this.HSIZE-parseInt(o.length/2)+(core.status.event.ui.offset||0);if(t>=r&&t<r+o.length){var a=core.events.canUseQuickShop(o[t-r]);if(!core.flags.enableDisabledShop&&a)return void core.drawText(a);core.events.openShop(o[t-r],!0),"shop"==core.status.event.id&&(core.status.event.data.fromList=!0)}else t==r+o.length&&core.ui.closePanel()}else;},actions.prototype._keyUpQuickShop=function(e){if(27!=e&&75!=e&&88!=e&&86!=e){var t=Object.keys(core.status.shops).filter((function(e){return core.status.shops[e].visited||!core.status.shops[e].mustEnable}));this._selectChoices(t.length+1,e,this._clickQuickShop)}else core.ui.closePanel()},actions.prototype._clickToolbox=function(e,t){if(e>=this.LAST-2&&0==t)return core.ui.closePanel(),void(core.isReplaying()?core.equipboxReplay():core.openEquipbox());if(e>=this.LAST-2&&t==this.LAST)core.ui.closePanel();else{var o=core.status.event.data.toolsPage,r=core.status.event.data.constantsPage;e!=this.HSIZE-2&&e!=this.HSIZE-3||(t==this.LAST-5&&o>1&&(core.status.event.data.toolsPage--,core.ui.drawToolbox(core.status.event.selection)),t==this.LAST&&r>1&&(core.status.event.data.constantsPage--,core.ui.drawToolbox(core.status.event.selection))),e!=this.HSIZE+2&&e!=this.HSIZE+3||(t==this.LAST-5&&o<Math.ceil(Object.keys(core.status.hero.items.tools).length/this.LAST)&&(core.status.event.data.toolsPage++,core.ui.drawToolbox(core.status.event.selection)),t==this.LAST&&r<Math.ceil(Object.keys(core.status.hero.items.constants).length/this.LAST)&&(core.status.event.data.constantsPage++,core.ui.drawToolbox(core.status.event.selection)));var a=parseInt(e/2);t==this.LAST-8?a+=0:t==this.LAST-6?a+=this.HSIZE:t==this.LAST-3?a+=this.LAST:t==this.LAST-1?a+=this.LAST+this.HSIZE:a=-1,a>=0&&this._clickToolboxIndex(a)}},actions.prototype._clickToolboxIndex=function(e){var t,o=null;if(e<this.LAST?(t=e+this.LAST*(core.status.event.data.toolsPage-1),o=Object.keys(core.status.hero.items.tools).sort()):(t=e%this.LAST+this.LAST*(core.status.event.data.constantsPage-1),o=Object.keys(core.status.hero.items.constants).sort()),null!=o&&!(t>=o.length)){var r=o[t];if(r==core.status.event.data.selectId){if(core.isReplaying())return;core.events.tryUseItem(r)}else core.ui.drawToolbox(e)}},actions.prototype._keyDownToolbox=function(e){if(null!=core.status.event.data){var t=this.LAST-1,o=Object.keys(core.status.hero.items.tools).sort(),r=Object.keys(core.status.hero.items.constants).sort(),a=core.status.event.selection,n=core.status.event.data.toolsPage,i=core.status.event.data.constantsPage,s=Math.ceil(o.length/this.LAST),c=Math.ceil(r.length/this.LAST),l=n<s?t:(o.length+t)%this.LAST,u=this.LAST+(i<c?t:(r.length+t)%this.LAST);if(37!=e)if(38!=e)if(39!=e){if(40==e){var p=null;if(a<this.HSIZE&&(l>=this.HSIZE?p=Math.min(l,a+this.HSIZE):a+=this.HSIZE),null==p&&a<this.LAST){if(0==c)return;p=Math.min(a+this.HSIZE,u)}return null==p&&a<this.LAST+this.HSIZE&&u>=this.LAST+this.HSIZE&&(p=Math.min(u,a+this.HSIZE)),void(null!=p&&this._clickToolboxIndex(p))}}else{if(n<s&&a==t)core.status.event.data.toolsPage++,a=0;else if(i<c&&a==2*this.LAST-1)core.status.event.data.constantsPage++,a=this.LAST;else if(a==l){if(0==c)return;core.status.event.data.constantsPage=1,a=this.LAST}else{if(a==u)return;a++}this._clickToolboxIndex(a)}else{if(a>=this.LAST&&a<this.LAST+this.HSIZE){if(0==s)return;a=l>=this.HSIZE?Math.min(l,a-this.HSIZE):Math.min(l,a-this.LAST)}else{if(a<this.HSIZE)return;a-=this.HSIZE}this._clickToolboxIndex(a)}else{if(0==a){if(!(n>1))return;core.status.event.data.toolsPage--,a=t}else if(a==this.LAST)if(1==i){if(0==s)return;core.status.event.data.toolsPage=s,a=(o.length+t)%this.LAST}else core.status.event.data.constantsPage--,a=2*this.LAST-1;else a-=1;this._clickToolboxIndex(a)}}},actions.prototype._keyUpToolbox=function(e){if(81==e)return core.ui.closePanel(),void(core.isReplaying()?core.equipboxReplay():core.openEquipbox());84!=e&&27!=e&&88!=e?null!=core.status.event.data&&(13!=e&&32!=e&&67!=e||this._clickToolboxIndex(core.status.event.selection)):core.ui.closePanel()},actions.prototype._clickEquipbox=function(e,t){if(e>=this.LAST-2&&0==t)return core.ui.closePanel(),void(core.isReplaying()?core.toolboxReplay():core.openToolbox());if(e>=this.LAST-2&&t==this.LAST)core.ui.closePanel();else if(e!=this.HSIZE-2&&e!=this.HSIZE-3||t!=this.LAST)if(e!=this.HSIZE+2&&e!=this.HSIZE+3||t!=this.LAST){var o=this.HSIZE-3,r=this.SIZE/o;if(t==this.LAST-8){for(var a=0;a<o;++a)if(e>=a*r&&e<=(a+1)*r)return this._clickEquipboxIndex(a)}else if(t==this.LAST-6){for(a=0;a<o;++a)if(e>=a*r&&e<=(a+1)*r)return this._clickEquipboxIndex(o+a)}else t==this.LAST-3?this._clickEquipboxIndex(this.LAST+parseInt(e/2)):t==this.LAST-1&&this._clickEquipboxIndex(this.LAST+this.HSIZE+parseInt(e/2))}else{var n=Math.ceil(Object.keys(core.status.hero.items.equips).length/this.LAST);core.status.event.data.page<n&&(core.status.event.data.page++,core.ui.drawEquipbox(core.status.event.selection))}else core.status.event.data.page>1&&(core.status.event.data.page--,core.ui.drawEquipbox(core.status.event.selection))},actions.prototype._clickEquipboxIndex=function(e){if(e<this.LAST){if(e>=core.status.globalAttribute.equipName.length)return;if(e==core.status.event.selection&&core.status.hero.equipment[e]){if(core.isReplaying())return;core.unloadEquip(e),core.status.route.push("unEquip:"+e)}}else{var t=Object.keys(core.status.hero.items.equips||{}).sort();if(e==core.status.event.selection){if(core.isReplaying())return;var o=t[e-this.LAST+(core.status.event.data.page-1)*this.LAST];core.loadEquip(o),core.status.route.push("equip:"+o)}}core.ui.drawEquipbox(e)},actions.prototype._keyDownEquipbox=function(e){if(null!=core.status.event.data){var t=this.LAST-1,o=this.HSIZE-3,r=core.status.globalAttribute.equipName.length,a=Object.keys(core.status.hero.items.equips).sort(),n=core.status.event.selection,i=core.status.event.data.page,s=Math.ceil(a.length/this.LAST),c=this.LAST+(i<s?t:(a.length+t)%this.LAST);if(37!=e){if(38==e){if(n<o)return;return n<2*o?n-=o:n<this.LAST+this.HSIZE?(n=parseInt((n-this.LAST)/2),n=r>o?Math.min(r-1,n+o):Math.min(r-1,n)):n-=this.HSIZE,void this._clickEquipboxIndex(n)}if(39!=e)if(40!=e);else{if(n<o)if(r>o)n=Math.min(n+o,r-1);else{if(0==s)return;n=Math.min(2*n+1+this.LAST,c)}else if(n<2*o){if(0==s)return;n=Math.min(2*(n-o)+1+this.LAST,c)}else{if(!(n<this.LAST+this.HSIZE))return;n=Math.min(n+this.HSIZE,c)}this._clickEquipboxIndex(n)}else{if(i<s&&n==this.LAST+t)core.status.event.data.page++,n=this.LAST;else if(n==r-1){if(0==s)return;n=this.LAST}else{if(n==c)return;n++}this._clickEquipboxIndex(n)}}else{if(0==n)return;if(n==this.LAST)if(i>1)core.status.event.data.page--,n=this.LAST+t;else{if(1!=i)return;n=r-1}else n-=1;this._clickEquipboxIndex(n)}}},actions.prototype._keyUpEquipbox=function(e,t){if(!(t&&e>=48&&e<=57))return 84==e?(core.ui.closePanel(),void(core.isReplaying()?core.toolboxReplay():core.openToolbox())):void(81!=e&&27!=e&&88!=e?core.status.event.data.selectId&&(13!=e&&32!=e&&67!=e||this._clickEquipboxIndex(core.status.event.selection)):core.ui.closePanel());core.items.quickSaveEquip(e-48)},actions.prototype._clickSL=function(e,t){var o=core.status.event.data.page,r=core.status.event.data.offset,a=10*o+r;if(e!=this.HSIZE-2&&e!=this.HSIZE-3||t!=this.LAST)if(e!=this.HSIZE+2&&e!=this.HSIZE+3||t!=this.LAST){if(e>=this.LAST-2&&t==this.LAST){if(core.events.recoverEvents(core.status.event.interval))return;return core.ui.closePanel(),delete core.status.tempRoute,void(core.isPlaying()||core.showStartAnimate(!0))}if(e>=0&&e<=2&&t==this.LAST)"save"==core.status.event.id?(core.status.event.selection=!core.status.event.selection,core.ui.drawSLPanel(a)):(core.status.event.data.mode="all"==core.status.event.data.mode?"fav":"all","fav"==core.status.event.data.mode?core.ui.drawSLPanel(1,!0):(o=parseInt((core.saves.saveIndex-1)/5),r=core.saves.saveIndex-5*o,core.ui.drawSLPanel(10*o+r,!0)));else{var n=parseInt(this.SIZE/3),i=parseInt(2*this.SIZE/3),s=this.HSIZE;if(t>=0&&t<=1){if(e>=n&&e<i)return this._clickSL_favorite(o,1);if(e>=i)return this._clickSL_favorite(o,2)}if(t>=s&&t<=s+1){if(e<n)return this._clickSL_favorite(o,3);if(e>=n&&e<i)return this._clickSL_favorite(o,4);if(e>=i)return this._clickSL_favorite(o,5)}var c=null;t>=2&&t<this.HSIZE-1&&(e<n&&(c="autoSave"),e>=n&&e<i&&(c=5*o+1),e>=i&&(c=5*o+2)),t>=s+2&&t<this.SIZE-1&&(e<n&&(c=5*o+3),e>=n&&e<i&&(c=5*o+4),e>=i&&(c=5*o+5)),null!=c&&(core.status.event.selection?"autoSave"==c?core.drawTip("无法删除自动存档！"):core.removeSave(c,(function(){core.ui.drawSLPanel(a,!0)})):("fav"==core.status.event.data.mode&&"autoSave"!=c&&(c=core.saves.favorite[c-1]),core.doSL(c,core.status.event.id)))}}else core.ui.drawSLPanel(10*(o+1)+r);else core.ui.drawSLPanel(10*(o-1)+r)},actions.prototype._clickSL_favorite=function(e,t){if(0!=t){var o=5*e+t;if("fav"==core.status.event.data.mode)o=core.saves.favorite[o-1],core.myprompt("请输入想要显示的存档名(长度不超过5字符)",null,(function(r){r&&r.length<=5?(core.saves.favoriteName[o]=r,core.control._updateFavoriteSaves(),core.drawSLPanel(10*e+t)):r&&alert("无效的输入！")}));else{var r=core.saves.favorite.indexOf(o);r>=0?(core.saves.favorite.splice(r,1),delete core.saves.favoriteName[o]):core.hasSave(o)&&(core.saves.favorite.push(o),core.saves.favorite=core.saves.favorite.sort((function(e,t){return e-t})),core.drawTip("收藏成功！")),core.control._updateFavoriteSaves(),core.ui.drawSLPanel(10*e+t)}}},actions.prototype._keyDownSL=function(e){var t=core.status.event.data.page,o=core.status.event.data.offset,r=10*t+o;37!=e?38!=e?39!=e?40!=e?33!=e?34!=e||core.ui.drawSLPanel(10*(t+1)+o):core.ui.drawSLPanel(10*(t-1)+o):o>=3?core.ui.drawSLPanel(10*(t+1)+o-3):core.ui.drawSLPanel(r+3):5==o?core.ui.drawSLPanel(10*(t+1)+1):core.ui.drawSLPanel(r+1):o<3?core.ui.drawSLPanel(10*(t-1)+o+3):core.ui.drawSLPanel(r-3):0==o?core.ui.drawSLPanel(10*(t-1)+5):core.ui.drawSLPanel(r-1)},actions.prototype._keyUpSL=function(e){var t=core.status.event.data.page,o=core.status.event.data.offset,r=10*t+o;if(27==e||88==e||"save"==core.status.event.id&&83==e||"load"==core.status.event.id&&68==e)this._clickSL(this.LAST,this.LAST);else{if(e>=48&&e<=57)return 48==e&&(e=58),void core.ui.drawSLPanel(1e3*(e-49)+1);if(13!=e&&32!=e&&67!=e)if(69!=e||"save"==core.status.event.id){if(46==e)if(0==o)core.drawTip("无法删除自动存档！");else{a=5*t+o;"fav"==core.status.event.data.mode&&(a=core.saves.favorite[a-1]),core.removeSave(a,(function(){core.ui.drawSLPanel(r,!0)}))}70==e&&"all"==core.status.event.data.mode&&this._clickSL_favorite(t,o)}else this._clickSL(0,this.LAST);else if(0==o)core.doSL("autoSave",core.status.event.id);else{var a=5*t+o;"fav"==core.status.event.data.mode&&(a=core.saves.favorite[a-1]),core.doSL(a,core.status.event.id)}}},actions.prototype._clickSwitchs=function(e,t){var o=core.status.event.ui.choices,r=t-(this.HSIZE-parseInt((o.length-1)/2)+(core.status.event.ui.offset||0));if(e<this.CHOICES_LEFT||e>this.CHOICES_RIGHT){if(2!=r&&3!=r)return;if(e!=this.HSIZE-2&&e!=this.HSIZE+2)return}if(r>=0&&r<o.length)switch(core.status.event.selection=r,r){case 0:return this._clickSwitchs_bgm();case 1:return this._clickSwitchs_sound();case 2:return e==this.HSIZE-2?this._clickSwitchs_userVolume(-1):e==this.HSIZE+2?this._clickSwitchs_userVolume(1):void 0;case 3:return e==this.HSIZE-2?this._clickSwitchs_moveSpeed(-10):e==this.HSIZE+2?this._clickSwitchs_moveSpeed(10):void 0;case 4:return this._clickSwitchs_displayEnemyDamage();case 5:return this._clickSwitchs_displayCritical();case 6:return this._clickSwitchs_displayExtraDamage();case 7:return this._clickSwitchs_localForage();case 8:return this._clickSwitchs_clickMove();case 9:core.status.event.selection=0,core.ui.drawSettings()}},actions.prototype._clickSwitchs_bgm=function(){core.triggerBgm(),core.ui.drawSwitchs()},actions.prototype._clickSwitchs_sound=function(){core.musicStatus.soundStatus=!core.musicStatus.soundStatus,core.setLocalStorage("soundStatus",core.musicStatus.soundStatus),core.ui.drawSwitchs()},actions.prototype._clickSwitchs_userVolume=function(e){var t=Math.round(Math.sqrt(100*core.musicStatus.userVolume));core.musicStatus.userVolume=core.clamp(Math.pow(t+e,2)/100,0,1),null!=core.musicStatus.gainNode&&(core.musicStatus.gainNode.gain.value=core.musicStatus.userVolume),core.musicStatus.playingBgm&&(core.material.bgms[core.musicStatus.playingBgm].volume=core.musicStatus.userVolume*core.musicStatus.designVolume),core.setLocalStorage("userVolume",core.musicStatus.userVolume),core.ui.drawSwitchs()},actions.prototype._clickSwitchs_moveSpeed=function(e){core.values.moveSpeed=core.clamp(core.values.moveSpeed+e,50,200),core.setLocalStorage("moveSpeed",core.values.moveSpeed),core.ui.drawSwitchs()},actions.prototype._clickSwitchs_displayEnemyDamage=function(){core.flags.displayEnemyDamage=!core.flags.displayEnemyDamage,core.updateDamage(),core.setLocalStorage("enemyDamage",core.flags.displayEnemyDamage),core.ui.drawSwitchs()},actions.prototype._clickSwitchs_displayCritical=function(){core.flags.displayCritical=!core.flags.displayCritical,core.updateDamage(),core.setLocalStorage("critical",core.flags.displayCritical),core.ui.drawSwitchs()},actions.prototype._clickSwitchs_displayExtraDamage=function(){core.flags.displayExtraDamage=!core.flags.displayExtraDamage,core.updateDamage(),core.setLocalStorage("extraDamage",core.flags.displayExtraDamage),core.ui.drawSwitchs()},actions.prototype._clickSwitchs_localForage=function(){core.platform.useLocalForage=!core.platform.useLocalForage,core.setLocalStorage("useLocalForage",core.platform.useLocalForage),core.control.getSaveIndexes((function(e){core.saves.ids=e})),core.ui.drawSwitchs()},actions.prototype._clickSwitchs_clickMove=function(){core.hasFlag("__noClickMove__")?core.removeFlag("__noClickMove__"):core.setFlag("__noClickMove__",!0),core.ui.drawSwitchs()},actions.prototype._keyUpSwitchs=function(e){if(27==e||88==e)return core.status.event.selection=0,void core.ui.drawSettings();this._selectChoices(core.status.event.ui.choices.length,e,this._clickSwitchs)},actions.prototype._clickSettings=function(e,t){if(!(e<this.CHOICES_LEFT||e>this.CHOICES_RIGHT)){var o=core.status.event.ui.choices,r=this.HSIZE-parseInt((o.length-1)/2)+(core.status.event.ui.offset||0);if(t>=r&&t<r+o.length){var a=t-r;switch(core.status.event.selection=a,a){case 0:core.status.event.selection=0,core.ui.drawSwitchs();break;case 1:core.ui.drawKeyBoard();break;case 2:core.clearUI(),core.ui.drawMaps();break;case 3:core.clearUI(),core.ui.drawPaint();break;case 4:core.status.event.selection=0,core.ui.drawSyncSave();break;case 5:core.status.event.selection=0,core.ui.drawGameInfo();break;case 6:return core.confirmRestart();case 7:core.ui.closePanel()}}}},actions.prototype._keyUpSettings=function(e){27!=e&&88!=e?this._selectChoices(core.status.event.ui.choices.length,e,this._clickSettings):core.ui.closePanel()},actions.prototype._clickSyncSave=function(e,t){if(!(e<this.CHOICES_LEFT||e>this.CHOICES_RIGHT)){var o=core.status.event.ui.choices,r=this.HSIZE-parseInt((o.length-1)/2)+(core.status.event.ui.offset||0);if(t>=r&&t<r+o.length){var a=t-r;switch(core.status.event.selection=a,a){case 0:core.status.event.selection=0,core.ui.drawSyncSelect();break;case 1:core.syncLoad();break;case 2:core.status.event.selection=0,core.ui.drawLocalSaveSelect();break;case 3:return this._clickSyncSave_readFile();case 4:return this._clickSyncSave_replay();case 5:core.status.event.selection=0,core.ui.drawStorageRemove();break;case 6:core.status.event.selection=4,core.ui.drawSettings()}}}},actions.prototype._clickSyncSave_readFile=function(){core.readFile((function(e){return e.name!=core.firstData.name?alert("存档和游戏不一致！"):e.version!=core.firstData.version?alert("游戏版本不一致！"):e.data?void core.control._syncLoad_write(e.data):alert("无效的存档！")}),null,".h5save")},actions.prototype._clickSyncSave_replay=function(){core.ui.drawReplay()},actions.prototype._keyUpSyncSave=function(e){if(27==e||88==e)return core.status.event.selection=2,void core.ui.drawSettings();this._selectChoices(core.status.event.ui.choices.length,e,this._clickSyncSave)},actions.prototype._clickSyncSelect=function(e,t){if(!(e<this.CHOICES_LEFT||e>this.CHOICES_RIGHT)){var o=core.status.event.ui.choices,r=this.HSIZE-parseInt((o.length-1)/2)+(core.status.event.ui.offset||0);if(t>=r&&t<r+o.length){var a=t-r;switch(core.status.event.selection=a,a){case 0:core.syncSave("all");break;case 1:core.syncSave();break;case 2:core.status.event.selection=0,core.ui.drawSyncSave()}}}},actions.prototype._keyUpSyncSelect=function(e){if(27==e||88==e)return core.status.event.selection=0,void core.ui.drawSettings();this._selectChoices(core.status.event.ui.choices.length,e,this._clickSyncSelect)},actions.prototype._clickLocalSaveSelect=function(e,t){if(!(e<this.CHOICES_LEFT||e>this.CHOICES_RIGHT)){var o=core.status.event.ui.choices,r=this.HSIZE-parseInt((o.length-1)/2)+(core.status.event.ui.offset||0);if(t>=r&&t<r+o.length){var a=t-r;if(core.status.event.selection=a,a<2){var n=function(e){if(e){var t={name:core.firstData.name,version:core.firstData.version,data:e};core.download(core.firstData.name+"_"+core.formatDate2(new Date)+".h5save",JSON.stringify(t))}};0==a?core.getAllSaves(n):core.getSave(core.saves.saveIndex,n)}core.status.event.selection=2,core.ui.drawSyncSave()}}},actions.prototype._keyUpLocalSaveSelect=function(e){if(27==e||88==e)return core.status.event.selection=0,void core.ui.drawSettings();this._selectChoices(core.status.event.ui.choices.length,e,this._clickLocalSaveSelect)},actions.prototype._clickStorageRemove=function(e,t){if(!(e<this.CHOICES_LEFT||e>this.CHOICES_RIGHT)){var o=core.status.event.ui.choices,r=this.HSIZE-parseInt((o.length-1)/2)+(core.status.event.ui.offset||0);if(t>=r&&t<r+o.length){var a=t-r;switch(core.status.event.selection=a,a){case 0:return this._clickStorageRemove_all();case 1:return this._clickStorageRemove_current();case 2:core.status.event.selection=6,core.ui.drawSyncSave()}}}},actions.prototype._clickStorageRemove_all=function(){core.myconfirm("你确定要清除【全部塔】的所有本地存档？\n此行为不可逆！！！",(function(){var e=function(){core.saves.ids={},core.saves.autosave.data=null,core.saves.autosave.updated=!1,core.ui.closePanel(),core.saves.saveIndex=1,core.saves.favorite=[],core.saves.favoriteName={},core.control._updateFavoriteSaves(),core.removeLocalStorage("saveIndex"),core.drawText("\t[操作成功]你的所有存档已被清空。")};core.platform.useLocalForage?(core.ui.drawWaiting("正在清空，请稍后..."),localforage.clear(e)):(localStorage.clear(),e())}))},actions.prototype._clickStorageRemove_current=function(){core.myconfirm("你确定要清除本塔的所有本地存档？\n此行为不可逆！！！",(function(){var e=function(){core.saves.ids={},core.saves.autosave.data=null,core.saves.autosave.updated=!1,core.ui.closePanel(),core.saves.saveIndex=1,core.saves.favorite=[],core.saves.favoriteName={},core.control._updateFavoriteSaves(),core.removeLocalStorage("saveIndex"),core.drawText("\t[操作成功]当前塔的存档已被清空。")};core.platform.useLocalForage?(core.ui.drawWaiting("正在清空，请稍后..."),Object.keys(core.saves.ids).forEach((function(e){core.removeLocalForage("save"+e)})),core.removeLocalForage("autoSave",e)):(Object.keys(core.saves.ids).forEach((function(e){core.removeLocalStorage("save"+e)})),core.removeLocalStorage("autoSave"),e())}))},actions.prototype._keyUpStorageRemove=function(e){if(27==e||88==e)return core.status.event.selection=5,void core.ui.drawSyncSave();this._selectChoices(core.status.event.ui.choices.length,e,this._clickStorageRemove)},actions.prototype._clickReplay=function(e,t){if(!(e<this.CHOICES_LEFT||e>this.CHOICES_RIGHT)){var o=core.status.event.ui.choices,r=this.HSIZE-parseInt((o.length-1)/2)+(core.status.event.ui.offset||0);if(t>=r&&t<r+o.length){var a=t-r;switch(core.status.event.selection=a,a){case 0:return this._clickReplay_fromBeginning();case 1:return this._clickReplay_fromLoad();case 2:return this._clickReplay_replayRemain();case 3:return core.chooseReplayFile();case 4:return this._clickReplay_download();case 5:return core.ui.closePanel()}}}},actions.prototype._clickReplay_fromBeginning=function(){core.ui.closePanel(),core.startGame(core.status.hard,core.getFlag("__seed__"),core.clone(core.status.route))},actions.prototype._clickReplay_fromLoad=function(){core.status.event.id="replayLoad",core.status.event.selection=null,core.clearUI();var e=core.saves.saveIndex,t=parseInt((e-1)/5),o=e-5*t;core.ui.drawSLPanel(10*t+o)},actions.prototype._clickReplay_replayRemain=function(){core.closePanel(),core.drawText(["\t[接续播放录像]该功能允许你播放\r[yellow]两个存档之间的录像\r，常常用于\r[yellow]区域优化\r。\n例如，有若干个区，已经全部通关；之后重打一区并进行了优化，则可以对剩余区域直接播放录像而无需全部重打。","\t[步骤1]请选择一个存档。\n\r[yellow]该存档的坐标必须和当前勇士坐标完全相同。\r\n将尝试从此处开始回放。"],(function(){core.status.event.id="replayRemain",core.lockControl();var e=core.saves.saveIndex,t=parseInt((e-1)/5),o=e-5*t;core.ui.drawSLPanel(10*t+o)}))},actions.prototype._clickReplay_download=function(){core.download(core.firstData.name+"_"+core.formatDate2()+".h5route",JSON.stringify({name:core.firstData.name,hard:core.status.hard,seed:core.getFlag("__seed__"),route:core.encodeRoute(core.status.route)}))},actions.prototype._keyUpReplay=function(e){27!=e&&88!=e?this._selectChoices(core.status.event.ui.choices.length,e,this._clickReplay):core.ui.closePanel()},actions.prototype._clickGameInfo=function(e,t){if(!(e<this.CHOICES_LEFT||e>this.CHOICES_RIGHT)){var o=core.status.event.ui.choices,r=this.HSIZE-parseInt((o.length-1)/2)+(core.status.event.ui.offset||0);if(t>=r&&t<r+o.length){var a=t-r;switch(core.status.event.selection=a,a){case 0:return core.ui.drawStatistics();case 1:return this._clickGameInfo_openProject();case 2:return this._clickGameInfo_openComments();case 3:return core.ui.drawHelp();case 4:return core.ui.drawAbout();case 5:return this._clickGameInfo_download();case 6:core.status.event.selection=5,core.ui.drawSettings()}}}},actions.prototype._clickGameInfo_openProject=function(){core.platform.isPC?window.open("editor.html","_blank"):core.myconfirm("即将离开本塔，跳转至本塔工程页面，确认？",(function(){window.location.href="editor-mobile.html"}))},actions.prototype._clickGameInfo_openComments=function(){core.platform.isPC?window.open("/score.php?name="+core.firstData.name+"&num=10","_blank"):core.myconfirm("即将离开本塔，跳转至本塔评论页面，确认？",(function(){window.location.href="/score.php?name="+core.firstData.name+"&num=10"}))},actions.prototype._clickGameInfo_download=function(){core.platform.isPC?window.open(core.firstData.name+".zip"):window.location.href=core.firstData.name+".zip"},actions.prototype._keyUpGameInfo=function(e){27!=e&&88!=e?this._selectChoices(core.status.event.ui.choices.length,e,this._clickGameInfo):core.ui.closePanel()},actions.prototype._clickKeyBoard=function(x,y){var m=this.HSIZE;if(y==m-3&&x>=m-5&&x<=m+5&&(core.ui.closePanel(),core.keyUp(112+x+5-m)),y==m-3&&x==m+6){var val=prompt();if(null!=val)try{eval(val)}catch(e){}}y==m-2&&x>=m-5&&x<=m+4&&(core.ui.closePanel(),core.keyUp(x==m+4?48:49+x+5-m));var lines=[["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["Z","X","C","V","B","N","M"]];y==m-1&&x>=m-5&&x<=m+4&&(core.ui.closePanel(),core.keyUp(lines[0][x+5-m].charCodeAt(0))),y==m&&x>=m-5&&x<=m+3&&(core.ui.closePanel(),core.keyUp(lines[1][x+5-m].charCodeAt(0))),y==m+1&&x>=m-5&&x<=m+1&&(core.ui.closePanel(),core.keyUp(lines[2][x+5-m].charCodeAt(0))),y==m+2&&x>=m-5&&x<=m+5&&(core.ui.closePanel(),x==m-5&&core.keyUp(189),x==m-4&&core.keyUp(187),x==m-3&&core.keyUp(219),x==m-2&&core.keyUp(221),x==m-1&&core.keyUp(220),x==m&&core.keyUp(186),x==m+1&&core.keyUp(222),x==m+2&&core.keyUp(188),x==m+3&&core.keyUp(190),x==m+4&&core.keyUp(191),x==m+5&&core.keyUp(192)),y==m+3&&x>=m-5&&x<=m+4&&(core.ui.closePanel(),x==m-5&&core.keyUp(27),x==m-4&&core.keyUp(9),x==m-3&&core.keyUp(20),x==m-2&&core.keyUp(16),x==m-1&&core.keyUp(17),x==m&&core.keyUp(18),x==m+1&&core.keyUp(32),x==m+2&&core.keyUp(8),x==m+3&&core.keyUp(13),x==m+4&&core.keyUp(46)),y==m+4&&x>=m+3&&x<=m+5&&core.ui.closePanel()},actions.prototype._clickCursor=function(e,t){if(e==core.status.automaticRoute.cursorX&&t==core.status.automaticRoute.cursorY)return core.ui.closePanel(),void core.onclick(e,t,[]);core.status.automaticRoute.cursorX=e,core.status.automaticRoute.cursorY=t,core.ui.drawCursor()},actions.prototype._keyDownCursor=function(e){return 37==e?(core.status.automaticRoute.cursorX--,void core.ui.drawCursor()):38==e?(core.status.automaticRoute.cursorY--,void core.ui.drawCursor()):39==e?(core.status.automaticRoute.cursorX++,void core.ui.drawCursor()):40==e?(core.status.automaticRoute.cursorY++,void core.ui.drawCursor()):void 0},actions.prototype._keyUpCursor=function(e){if(27!=e&&88!=e)return 13==e||32==e||67==e||69==e?(core.ui.closePanel(),void core.onclick(core.status.automaticRoute.cursorX,core.status.automaticRoute.cursorY,[])):void 0;core.ui.closePanel()},actions.prototype._ondownPaint=function(e,t){e+=core.bigmap.offsetX,t+=core.bigmap.offsetY,core.status.event.data.erase||(core.dymCanvas.paint.beginPath(),core.dymCanvas.paint.moveTo(e,t)),core.status.event.data.x=e,core.status.event.data.y=t},actions.prototype._onmovePaint=function(e,t){if(null!=core.status.event.data.x)if(e+=core.bigmap.offsetX,t+=core.bigmap.offsetY,core.status.event.data.erase)core.clearMap("paint",e-10,t-10,20,20);else{var o=(core.status.event.data.x+e)/2,r=(core.status.event.data.y+t)/2;core.dymCanvas.paint.quadraticCurveTo(o,r,e,t),core.dymCanvas.paint.stroke(),core.status.event.data.x=e,core.status.event.data.y=t}},actions.prototype._onupPaint=function(){core.status.event.data.x=null,core.status.event.data.y=null,core.paint[core.status.floorId]=main.lzw.encode(core.utils._encodeCanvas(core.dymCanvas.paint).join(","))},actions.prototype.setPaintMode=function(e){if("paint"==e)core.status.event.data.erase=!1;else{if("erase"!=e)return;core.status.event.data.erase=!0}core.drawTip("进入"+(core.status.event.data.erase?"擦除":"绘图")+"模式")},actions.prototype.clearPaint=function(){core.clearMap("paint"),delete core.paint[core.status.floorId],core.drawTip("已清空绘图内容")},actions.prototype.savePaint=function(){var e={};for(var t in core.paint)core.paint[t]&&(e[t]=main.lzw.decode(core.paint[t]));core.download(core.firstData.name+".h5paint",JSON.stringify({name:core.firstData.name,paint:e}))},actions.prototype.loadPaint=function(){core.readFile((function(e){if(e.name==core.firstData.name)if(e.paint){for(var t in core.paint={},e.paint)e.paint[t]&&(core.paint[t]=main.lzw.encode(e.paint[t]));core.clearMap("paint");var o=core.paint[core.status.floorId];o&&(o=main.lzw.decode(o).split(",")),core.utils._decodeCanvas(o,32*core.bigmap.width,32*core.bigmap.height),core.drawImage("paint",core.bigmap.tempCanvas.canvas,0,0),core.drawTip("读取绘图文件成功")}else alert("无效的绘图文件！");else alert("绘图文件和游戏不一致！")}))},actions.prototype.exitPaint=function(){core.deleteCanvas("paint"),core.ui.closePanel(),core.statusBar.image.keyboard.style.opacity=1,core.statusBar.image.shop.style.opacity=1,core.drawTip("退出绘图模式")},actions.prototype._keyUpPaint=function(e){27!=e&&88!=e&&77!=e&&13!=e&&32!=e&&67!=e||this.exitPaint()}},function(e,t){e.exports={redSlime:{name:"红头怪",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:[16,18],value:10},blackSlime:{name:"青头怪",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},slimelord:{name:"怪王",hp:100,atk:120,def:0,money:10,experience:0,point:0,special:[1,9]},bat:{name:"小蝙蝠",hp:100,atk:120,def:0,money:2,experience:0,point:0,special:1},bigBat:{name:"大蝙蝠",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},redBat:{name:"红蝙蝠",hp:100,atk:120,def:0,money:5,experience:0,point:0,special:4},vampire:{name:"冥灵魔王",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},skeleton:{name:"骷髅人",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},skeletonSoilder:{name:"骷髅士兵",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},skeletonCaptain:{name:"骷髅队长",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},ghostSkeleton:{name:"冥队长",hp:100,atk:120,def:0,money:8,experience:0,point:0,special:7},zombie:{name:"兽人",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},zombieKnight:{name:"兽人武士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},rock:{name:"石头人",hp:100,atk:120,def:0,money:4,experience:0,point:0,special:3},slimeMan:{name:"影子战士",hp:100,atk:0,def:0,money:11,experience:0,point:0,special:[10,21],atkValue:2,defValue:3},bluePriest:{name:"初级法师",hp:100,atk:120,def:0,money:3,experience:0,point:1,special:2},redPriest:{name:"高级法师",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},brownWizard:{name:"初级巫师",hp:100,atk:120,def:0,money:16,experience:0,point:0,special:15,value:100,range:2},redWizard:{name:"高级巫师",hp:1e3,atk:1200,def:0,money:160,experience:0,point:0,special:15,value:200,zoneSquare:!0},yellowGuard:{name:"初级卫兵",hp:100,atk:120,def:0,money:10,experience:0,point:0,special:0},blueGuard:{name:"中级卫兵",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},redGuard:{name:"高级卫兵",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},swordsman:{name:"双手剑士",hp:100,atk:120,def:0,money:6,experience:0,point:0,special:[5,23]},soldier:{name:"冥战士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},yellowKnight:{name:"金骑士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},redKnight:{name:"红骑士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},darkKnight:{name:"黑骑士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},yellowKing:{name:"黄衣魔王",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},greenKing:{name:"青衣武士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},blueKnight:{name:"蓝骑士",hp:100,atk:120,def:0,money:9,experience:0,point:0,special:8},goldSlime:{name:"黄头怪",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},poisonSkeleton:{name:"紫骷髅",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},poisonBat:{name:"紫蝙蝠",hp:100,atk:120,def:0,money:14,experience:0,point:0,special:13},steelRock:{name:"铁面人",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},skeletonPriest:{name:"骷髅法师",hp:100,atk:100,def:0,money:0,experience:0,point:0,special:18,value:20},skeletonKing:{name:"骷髅王",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},skeletonWizard:{name:"骷髅巫师",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},redSkeletonCaption:{name:"骷髅武士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},badHero:{name:"迷失勇者",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},demon:{name:"魔神武士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},demonPriest:{name:"魔神法师",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},goldHornSlime:{name:"金角怪",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},redKing:{name:"红衣魔王",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},whiteKing:{name:"白衣武士",hp:100,atk:120,def:0,money:17,experience:0,point:0,special:16},blackMagician:{name:"黑暗大法师",hp:100,atk:120,def:0,money:12,experience:0,point:0,special:11,value:.3333333333333333,add:!0,notBomb:!0},silverSlime:{name:"银头怪",hp:100,atk:120,def:0,money:15,experience:0,point:0,special:14},swordEmperor:{name:"剑圣",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},whiteHornSlime:{name:"尖角怪",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},badPrincess:{name:"痛苦魔女",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},badFairy:{name:"黑暗仙子",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},grayPriest:{name:"中级法师",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},redSwordsman:{name:"剑王",hp:100,atk:120,def:0,money:7,experience:0,point:0,special:6,n:8},whiteGhost:{name:"水银战士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},poisonZombie:{name:"绿兽人",hp:100,atk:120,def:0,money:13,experience:0,point:0,special:12},magicDragon:{name:"魔龙",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},octopus:{name:"血影",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},darkFairy:{name:"仙子",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},greenKnight:{name:"强盾骑士",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},angel:{name:"天使",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},elemental:{name:"元素生物",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},steelGuard:{name:"铁守卫",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:18,value:20},evilBat:{name:"邪恶蝙蝠",hp:1e3,atk:1,def:0,money:0,experience:0,point:0,special:[2,3]},greenSlime:{name:"绿头怪",hp:100,atk:120,def:0,money:1,experience:1,point:0,special:[1,5,7,8]},tree1:{name:"黑衣魔王",hp:1e3,atk:500,def:0,money:1e3,experience:1e3,point:0,special:0,notBomb:!0,drawTo:"console.log('hello');"}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var exports_loader_functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a_project_functions__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(11),exports_loader_functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a_project_functions__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(exports_loader_functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a_project_functions__WEBPACK_IMPORTED_MODULE_0__),exports_loader_events_c12a15a8_c380_4b28_8144_256cba95f760_editor_project_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(39),exports_loader_events_c12a15a8_c380_4b28_8144_256cba95f760_editor_project_events__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(exports_loader_events_c12a15a8_c380_4b28_8144_256cba95f760_editor_project_events__WEBPACK_IMPORTED_MODULE_1__),_pixi_scenes_route__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(12),_pixi_ui__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1);function events(){this._init()}__webpack_exports__.a=events,events.prototype._init=function(){this.eventdata=exports_loader_functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a_project_functions__WEBPACK_IMPORTED_MODULE_0___default.a.events,this.commonEvent=exports_loader_events_c12a15a8_c380_4b28_8144_256cba95f760_editor_project_events__WEBPACK_IMPORTED_MODULE_1___default.a.commonEvent,this.systemEvents={},this.actions={}},events.prototype.resetGame=function(e,t,o,r,a){this.eventdata.resetGame(e,t,o,r,a)},events.prototype.startGame=function(e,t,o,r){e=e||"","play"==main.mode&&(core.flags.startUsingCanvas||null!=o?this._startGame_start(e,t,o,r):core.hideStartAnimate((function(){core.events._startGame_start(e,t,o,r)})))},events.prototype._startGame_start=function(e,t,o,r){console.log("开始游戏");var a=pixi.utils.cloneWith(core.initStatus.maps,(function(e){return!!pixi.Block.isBlock(e)&&e.clone()}));core.resetGame(core.firstData.hero,e,null,a);var n=core.clone(core.getHeroLoc());core.setHeroLoc("x",-1),core.setHeroLoc("y",-1),null!=t?(core.setFlag("__seed__",t),core.setFlag("__rand__",t)):core.utils.__init_seed(),this.setInitData(),core.clearStatusBar();var i=[];core.flags.startUsingCanvas&&(core.hideStatusBar(),core.dom.musicBtn.style.display="block",core.push(i,core.firstData.startCanvas)),core.push(i,core.firstData.startText),this.insertAction(i,null,null,(function(){core.events._startGame_afterStart(n,r)})),null!=o&&core.startReplay(o)},events.prototype._startGame_afterStart=function(e,t){core.ui.closePanel(),this._startGame_statusBar(),core.dom.musicBtn.style.display="none",core.changeFloor(core.firstData.floorId,null,e,null,(function(){pixi.event.emit("startGame"),core.insertAction([]),t&&t()})),this._startGame_upload()},events.prototype._startGame_statusBar=function(){core.flags.startUsingCanvas?core.hideStatusBar():core.showStatusBar()},events.prototype._startGame_upload=function(){var e=new FormData;e.append("type","people"),e.append("name",core.firstData.name),e.append("version",core.firstData.version),e.append("platform",core.platform.string),e.append("hard",core.encodeBase64(core.status.hard)),e.append("hardCode",core.getFlag("hard",0)),e.append("base64",1),core.utils.http("POST","/games/upload.php",e)},events.prototype.setInitData=function(){return this.eventdata.setInitData()},events.prototype.win=function(e,t,o){return o||(core.status.gameOver=!0),this.eventdata.win(e,t,o)},events.prototype.lose=function(e){return core.status.gameOver=!0,this.eventdata.lose(e)},events.prototype.gameOver=function(e,t,o){core.status.extraEvent||(core.clearMap("all"),core.deleteAllCanvas(),core.dom.gif2.innerHTML="",core.setWeather()),core.ui.closePanel(),main.isCompetition&&null!=e&&(""==e&&(e="恭喜通关"),e+="[比赛]");var r=null;t?r="录像回放完毕！":core.hasFlag("debug")?r="\t[系统提示]调试模式下无法上传成绩":core.hasFlag("__consoleOpened__")&&(r="\t[系统提示]本存档开启过控制台，无法上传成绩"),null!=r?core.drawText(r,core.restart):this._gameOver_confirmUpload(e,o)},events.prototype._gameOver_confirmUpload=function(e,t){core.ui.closePanel(),null!=e?core.ui.drawConfirmBox("你想记录你的ID和成绩吗？",(function(){main.isCompetition?core.events._gameOver_doUpload("",e,t):core.myprompt("请输入你的ID：",core.getCookie("id")||"",(function(o){core.events._gameOver_doUpload(o,e,t)}))}),(function(){main.isCompetition?core.events._gameOver_confirmDownload(e):core.events._gameOver_doUpload(null,e,t)})):this._gameOver_confirmDownload(e)},events.prototype._gameOver_doUpload=function(e,t,o){var r=core.status.hero.hp;null==e&&(r=1),core.ui.closePanel();var a=new FormData;a.append("type","score"),a.append("name",core.firstData.name),a.append("version",core.firstData.version),a.append("platform",core.platform.string),a.append("hard",core.encodeBase64(core.status.hard)),a.append("username",core.encodeBase64(e||"")),a.append("ending",core.encodeBase64(t)),a.append("lv",core.status.hero.lv),a.append("hp",Math.min(r,Math.pow(2,63))),a.append("atk",core.status.hero.atk),a.append("def",core.status.hero.def),a.append("mdef",core.status.hero.mdef),a.append("money",core.status.hero.money),a.append("experience",core.status.hero.experience),a.append("steps",core.status.hero.steps),a.append("norank",o?1:0),a.append("seed",core.getFlag("__seed__")),a.append("totalTime",Math.floor(core.status.hero.statistics.totalTime/1e3)),a.append("route",core.encodeRoute(core.status.route)),a.append("base64",1),main.isCompetition?core.http("POST","/games/competition/upload.php",a):core.http("POST","/games/upload.php",a),core.events._gameOver_confirmDownload(t)},events.prototype._gameOver_confirmDownload=function(e){core.ui.closePanel(),core.ui.drawConfirmBox("你想下载录像吗？",(function(){var t={name:core.firstData.name,version:core.firstData.version,hard:core.status.hard,seed:core.getFlag("__seed__"),route:core.encodeRoute(core.status.route)};core.download(core.firstData.name+"_"+core.formatDate2(new Date)+".h5route",JSON.stringify(t)),core.events._gameOver_askRate(e)}),(function(){core.events._gameOver_askRate(e)}))},events.prototype._gameOver_askRate=function(e){return core.ui.closePanel(),core.status.extraEvent?(core.status.event=core.status.extraEvent,delete core.status.extraEvent,core.lockControl(),void core.doAction()):null==e?(core.status.event.selection=0,void core.ui.drawConfirmBox("你想读取自动存档么？",(function(){core.ui.closePanel(),core.doSL("autoSave","load")}),(function(){core.ui.closePanel(),core.restart()}))):void core.ui.drawConfirmBox("恭喜通关本塔，你想进行评分吗？",(function(){core.platform.isPC?(window.open("/score.php?name="+core.firstData.name+"&num=10","_blank"),core.restart()):window.location.href="/score.php?name="+core.firstData.name+"&num=10"}),(function(){core.restart()}))},events.prototype.restart=function(){core.showStartAnimate(),core.playBgm(main.startBgm)},events.prototype.confirmRestart=function(){core.status.event.selection=1,core.ui.drawConfirmBox("你确定要返回标题页面吗？",(function(){core.ui.closePanel(),core.restart()}),(function(){core.ui.closePanel()}))},events.prototype.registerSystemEvent=function(e,t){this.systemEvents[e]=t},events.prototype.unregisterSystemEvent=function(e){delete this.systemEvents[e]},events.prototype.doSystemEvent=function(e,t,o){if(this.systemEvents[e])try{return core.doFunc(this.systemEvents[e],this,t,o)}catch(t){main.log(t),main.log("ERROR in systemEvents["+e+"]")}if(this["_sys_"+e])return this["_sys_"+e](t,o);main.log("未知的系统事件: "+e+"！"),o&&o()},events.prototype._trigger=function(x,y){if(!core.status.gameOver)if("action"!=core.status.event.id){if(!core.status.event.id){var block=core.getBlock(x,y);if(null!=block){block=block.block;try{eval(block.event.script)}catch(e){main.log(e)}if(block.event.trigger){var noPass=block.event.noPass,trigger=block.event.trigger;if(noPass&&_pixi_scenes_route__WEBPACK_IMPORTED_MODULE_2__.a.clear(),"changeFloor"==trigger&&!noPass&&this._trigger_ignoreChangeFloor(block))return;core.status.automaticRoute.moveDirectly=!1,this.doSystemEvent(trigger,block)}}}}else core.insertAction({type:"trigger",loc:[x,y]},x,y,null,!0)},events.prototype._trigger_ignoreChangeFloor=function(e){var t=core.flags.ignoreChangeFloor;if(e.event.data&&null!=e.event.data.ignoreChangeFloor&&(t=e.event.data.ignoreChangeFloor),t)if(core.isReplaying()){if("no"==core.status.replay.toReplay[0])return core.status.replay.toReplay.shift(),core.status.route.push("no"),!0}else if(core.status.automaticRoute.autoHeroMove||core.status.automaticRoute.autoStep<core.status.automaticRoute.autoStepRoutes.length)return core.status.route.push("no"),!0;return!1},events.prototype._sys_battle=function(e,t){this.battle(e.event.id,e.x,e.y,!1,t)},events.prototype.battle=function(e,t,o,r,a){return core.saveAndStopAutomaticRoute(),(e=e||core.getBlockId(t,o))?core.enemys.canBattle(e,t,o)||r||core.status.event.id?(core.status.event.id||core.autosave(!0),this.beforeBattle(e,t,o)?void this.afterBattle(e,t,o,a):core.clearContinueAutomaticRoute(a)):(core.drawTip("你打不过此怪物！",null,!0),core.clearContinueAutomaticRoute(a)):core.clearContinueAutomaticRoute(a)},events.prototype.beforeBattle=function(e,t,o){return this.eventdata.beforeBattle(e,t,o)},events.prototype.afterBattle=function(e,t,o,r){return this.eventdata.afterBattle(e,t,o,r)},events.prototype._sys_openDoor=function(e,t){this.openDoor(e.x,e.y,!0,(function(){core.replay(),t&&t()}))},events.prototype.openDoor=function(e,t,o,r){var a=core.getBlockId(e,t);if(core.saveAndStopAutomaticRoute(),this._openDoor_check(a,e,t,o))core.playSound("door.mp3"),this._openDoor_animate(a,e,t,r);else{var n=core.status.lockControl;core.waitHeroToStop((function(){n||core.unLockControl(),r&&r()}))}},events.prototype._openDoor_check=function(e,t,o,r){if(!core.terrainExists(t,o,e)||!e.endsWith("Door")&&!e.endsWith("Wall")||null==core.material.icons.animates[e])return core.clearContinueAutomaticRoute(),!1;if("steelDoor"==e&&core.flags.steelDoorWithoutKey&&(r=!1),r&&e.endsWith("Door")){var a=e.replace("Door","Key");if(!core.hasItem(a))return"specialKey"!=a?core.drawTip("你没有"+((core.material.items[a]||{}).name||"钥匙"),null,!0):core.drawTip("无法开启此门",null,!0),core.clearContinueAutomaticRoute(),!1;core.status.event.id||core.autosave(!0),core.removeItem(a)}return!0},events.prototype._openDoor_animate=function(e,t,o,r){core.material.icons.animates[e];var a=e.endsWith("Door")?50:70,n=core.status.lockControl;core.lockControl(),core.status.replay.animate=!0,core.removeBlock(t,o);var i=pixi.game.getScene("event");_pixi_ui__WEBPACK_IMPORTED_MODULE_3__.a.drawAnimate(e,i,32*t+16,32*o+16,{async:!0,time:24==core.status.replay.speed?1:a/Math.max(core.status.replay.speed,1),onComplete:function(){n||core.unLockControl(),core.status.replay.animate=!1,core.events.afterOpenDoor(e,t,o,r)}})},events.prototype.afterOpenDoor=function(e,t,o,r){return this.eventdata.afterOpenDoor(e,t,o,r)},events.prototype._sys_getItem=function(e,t){this.getItem(e.event.id,1,e.x,e.y,t)},events.prototype.getItem=function(e,t,o,r,a){null==t&&(t=1),t=t||1;var n=core.material.items[e].cls;core.items.getItemEffect(e,t),core.removeBlock(o,r);var i="获得 "+core.material.items[e].name;t>1&&(i+="x"+t),"items"===n&&1==t&&(i+=core.items.getItemEffectTip(e)),core.drawTip(i,e),core.hasFlag("__itemHint__")||core.setFlag("__itemHint__",[]);var s=core.getFlag("__itemHint__");if(core.flags.itemFirstText&&s.indexOf(e)<0&&"items"!=n){var c=core.material.items[e].text||"该道具暂无描述";try{c=core.replaceText(c)}catch(e){}core.status.event.id&&"action"!=core.status.event.id||core.insertAction("\t["+core.material.items[e].name+","+e+"]"+c+"\n"+("keys"==n||"greenKey"==e||"steelKey"==e?"（钥匙类道具，遇到对应的门时自动打开）":"tools"==n?"（消耗类道具，请按T在道具栏使用）":"constants"==n?"（永久类道具，请按T在道具栏使用）":"equips"==n?"（装备类道具，请按Q在装备栏进行装备）":"")),s.push(e)}core.updateStatusBar(),this.afterGetItem(e,o,r,a)},events.prototype.afterGetItem=function(e,t,o,r){this.eventdata.afterGetItem(e,t,o,r)},events.prototype.getNextItem=function(e){if(core.isMoving()||!core.flags.enableGentleClick)return!1;if(this._canGetNextItem())return this._getNextItem(null,e);var t=["up","down","left","right"].filter((function(e){return core.events._canGetNextItem(e)}));return 1==t.length&&this._getNextItem(t[0])},events.prototype._canGetNextItem=function(e){if(e=e||core.getHeroLoc("direction"),core.canMoveHero(null,null,e)){var t=core.getHeroLoc("x")+core.utils.scan[e].x,o=core.getHeroLoc("y")+core.utils.scan[e].y,r=core.getBlock(t,o);return null!=r&&"getItem"==r.block.event.trigger}},events.prototype._getNextItem=function(e,t){e=e||core.getHeroLoc("direction");var o=core.getHeroLoc("x")+core.utils.scan[e].x,r=core.getHeroLoc("y")+core.utils.scan[e].y;return t||core.status.route.push("getNext"),this.getItem(core.getBlockId(o,r),1,o,r),!0},events.prototype._sys_changeFloor=function(e,t){var o={};(e=e.event.data).loc&&(o={x:e.loc[0],y:e.loc[1]}),e.direction&&(o.direction=e.direction),"action"!=core.status.event.id&&(core.status.event.id=null),core.changeFloor(e.floorId,e.stair,o,e.time,(function(){core.replay(),t&&t()}))},events.prototype.changeFloor=function(e,t,o,r,a,n){var i=this._changeFloor_getInfo(e,t,o,r);null!=i?(i.fromLoad=n,e=i.floorId,i.locked=core.status.lockControl,core.lockControl(),core.stopAutomaticRoute(),core.clearContinueAutomaticRoute(),core.status.replay.animate=!0,clearInterval(core.interval.onDownInterval),core.interval.onDownInterval="tmp",this._changeFloor_beforeChange(i,a)):a&&a()},events.prototype._changeFloor_getInfo=function(e,t,o,r){if(":before"==(e=e||core.status.floorId))e=(a=core.floorIds.indexOf(core.status.floorId))>0?core.floorIds[a-1]:core.status.floorId;else if(":next"==e){var a;e=(a=core.floorIds.indexOf(core.status.floorId))<core.floorIds.length-1?core.floorIds[a+1]:core.status.floorId}return core.status.maps[e]?(("play"!=main.mode||core.isReplaying())&&(r=0),null==r&&(r=core.values.floorChangeTime),null==r&&(r=800),r<100&&(r=0),{floorId:e,time:r/=20,heroLoc:core.clone(this._changeFloor_getHeroLoc(e,t,o))}):(main.log("不存在的楼层："+e),null)},events.prototype._changeFloor_getHeroLoc=function(e,t,o){if(o||(o=core.clone(core.status.hero.loc)),t)if(":now"==t)o=core.clone(core.status.hero.loc);else if(":symmetry"==t)o.x=core.bigmap.width-1-core.getHeroLoc("x"),o.y=core.bigmap.height-1-core.getHeroLoc("y");else if(":symmetry_x"==t)o.x=core.bigmap.width-1-core.getHeroLoc("x");else if(":symmetry_y"==t)o.y=core.bigmap.height-1-core.getHeroLoc("y");else if(core.status.maps[e][t])o.x=core.status.maps[e][t][0],o.y=core.status.maps[e][t][1];else{var r=core.status.maps[e].blocks;for(var a in r)if(!r[a].disable&&r[a].event.id===t){o.x=r[a].x,o.y=r[a].y;break}}return["x","y","direction"].forEach((function(e){null==o[e]&&(o[e]=core.getHeroLoc(e))})),o},events.prototype._changeFloor_beforeChange=function(e,t){pixi.event.emit("changeFloor",e,t)},events.prototype._changeFloor_changing=function(e,t){this.changingFloor(e.floorId,e.heroLoc,e.fromLoad),0==e.time?this._changeFloor_afterChange(e,t):core.hideWithAnimate(core.dom.floorMsgGroup,e.time/4,(function(){core.events._changeFloor_afterChange(e,t)}))},events.prototype._changeFloor_afterChange=function(e,t){e.locked||core.unLockControl(),core.status.replay.animate=!1,core.events.afterChangeFloor(e.floorId,e.fromLoad),t&&t()},events.prototype.changingFloor=function(e,t,o){this.eventdata.changingFloor(e,t,o)},events.prototype.afterChangeFloor=function(e,t){if("play"==main.mode)return this.eventdata.afterChangeFloor(e,t)},events.prototype.hasVisitedFloor=function(e){return core.getFlag("__visited__")[e]||!1},events.prototype.visitFloor=function(e){core.getFlag("__visited__")[e]=!0},events.prototype._sys_passNet=function(e,t){this.passNet(e),t&&t()},events.prototype.passNet=function(e){core.hasItem("shoes")||("poisonNet"==e.event.id?core.insertAction({type:"insert",name:"毒衰咒处理",args:[0]}):"weakNet"==e.event.id?core.insertAction({type:"insert",name:"毒衰咒处理",args:[1]}):"curseNet"==e.event.id&&core.insertAction({type:"insert",name:"毒衰咒处理",args:[2]})),this.afterPassNet(e.x,e.y,e.event.id),core.updateStatusBar()},events.prototype.afterPassNet=function(e,t,o){this.eventdata.afterPassNet&&this.eventdata.afterPassNet(e,t,o)},events.prototype._sys_pushBox=function(e,t){this.pushBox(e),t&&t()},events.prototype.pushBox=function(e){if("box"==e.event.id||"boxed"==e.event.id){var t=core.getHeroLoc("direction"),o=e.x+core.utils.scan[t].x,r=e.y+core.utils.scan[t].y;if(core.canMoveHero()&&core.canMoveHero(e.x,e.y,t)){var a=core.getBlockId(o,r);null!=a&&"flower"!=a||(core.setBlock(null==a?169:170,o,r),"box"==e.event.id?core.removeBlock(e.x,e.y):core.setBlock(168,e.x,e.y),core.updateStatusBar(),this._pushBox_moveHero(t))}}},events.prototype._pushBox_moveHero=function(e){core.status.replay.animate=!0,core.lockControl(),setTimeout((function(){core.moveHero(e,(function(){core.status.replay.animate=!1,core.status.route.pop(),core.events.afterPushBox(),null==core.status.event.id&&(core.unLockControl(),core.replay())}))}))},events.prototype.afterPushBox=function(){return this.eventdata.afterPushBox()},events.prototype._sys_changeLight=function(e,t){core.events.changeLight(e.event.id,e.x,e.y),t&&t()},events.prototype.changeLight=function(e,t,o){if(null==e||"light"==e)return core.setBlock(core.getNumberById("darkLight"),t,o),this.eventdata.afterChangeLight(t,o)},events.prototype._sys_ski=function(e,t){core.insertAction(["V2.6后，请将滑冰放在背景层！"],e.x,e.y,t)},events.prototype._sys_action=function(e,t){var o=core.clone(e.event.data),r=e.x,a=e.y;if(r==core.nextX()&&a==core.nextY()){var n=core.reverseDirection(),i=e.event.id,s=(e.event.faceIds||{})[n];if(s&&i!=s){var c=core.getNumberById(s);c>0&&core.setBlock(c,r,a)}}this.insertAction(o,r,a,t)},events.prototype._sys_custom=function(e,t){core.insertAction(["请使用\r[yellow]core.registerSystemEvent('custom', func)\r来处理自己添加的系统触发器！"],e.x,e.y,t)},events.prototype.registerEvent=function(e,t){this.actions[e]=t},events.prototype.unregisterEvent=function(e){delete this.actions[e]},events.prototype.doEvent=function(e,t,o,r){var a=e.type;if(this.actions[a])try{return core.doFunc(this.actions[a],this,e,t,o,r)}catch(e){main.log(e),main.log("ERROR in actions["+a+"]")}if(this["_action_"+a])return this["_action_"+a](e,t,o,r);core.insertAction("未知的自定义事件: "+a+"！"),core.doAction()},events.prototype.setEvents=function(e,t,o,r){var a=core.status.event.data||{};e&&(a.list=[{todo:core.clone(e),total:core.clone(e),condition:"false"}],0==e.length&&core.status.autoEvents.forEach((function(e){core.autoEventExecuting(e.symbol,!1)}))),null!=t&&(a.x=t),null!=o&&(a.y=o),r&&(a.callback=r),a.appendingEvents||(a.appendingEvents=[]),a.locStack||(a.locStack=[]),core.status.event.id="action",core.status.event.data=a},events.prototype.startEvents=function(e,t,o,r){e&&(e instanceof Array||(e=[e]),this.setEvents(e,t,o,r),core.waitHeroToStop((function(){core.lockControl(),core.doAction()})))},events.prototype.doAction=function(e){if(e||(core.clearUI(),clearInterval(core.status.event.interval),core.status.event.interval=null),!this._doAction_finishEvents()){var t=core.status.event.data.floorId||core.status.floorId,o=core.status.event.data.x,r=core.status.event.data.y,a=[t||":f",null!=o?o:"x",null!=r?r:"y"].join("@"),n=core.status.event.data.list[0];if(!this._popEvents(n,a)){var i=n.todo.shift();core.status.event.data.current=i,"string"==typeof i&&(i={type:"text",text:i}),i.floorId=i.floorId||t,core.status.event.data.type=i.type,this.doEvent(i,o,r,a)}}},events.prototype._doAction_finishEvents=function(){if(0==core.status.event.data.list.length){if(core.status.event.data.appendingEvents.length>0)return this.setEvents(core.status.event.data.appendingEvents.shift()),!1;var e=core.status.event.data.callback;return core.ui.closePanel(),e&&e(),core.replay(),!0}return!1},events.prototype._popEvents=function(e,t){return 0==e.todo.length&&(core.calValue(e.condition,t)?e.todo=core.clone(e.total):core.status.event.data.list.shift(),core.doAction(),!0)},events.prototype.insertAction=function(e,t,o,r,a){if(!core.hasFlag("__statistics__")&&!core.status.gameOver){var n=this.getCommonEvent(e);n instanceof Array&&(e=[{type:"dowhile",condition:"false",data:n}]),e&&(e=this.precompile(e),"action"!=core.status.event.id?this.startEvents(e,t,o,r):(a?core.push(core.status.event.data.list[0].todo,e):core.unshift(core.status.event.data.list[0].todo,e),this.setEvents(null,t,o,r)))}},events.prototype.getCommonEvent=function(e){return e&&"string"==typeof e&&this.commonEvent[e]||null},events.prototype.recoverEvents=function(e){return!!e&&(core.ui.closePanel(),core.lockControl(),core.status.event.id="action",core.status.event.data=e,setTimeout((function(){core.doAction()}),30),!0)},events.prototype.checkAutoEvents=function(){if(core.isPlaying()&&(!core.status.lockControl||"action"==core.status.event.id)){var e=[],t=[];core.status.autoEvents.forEach((function(o){var r=o.symbol,a=o.x,n=o.y,i=o.floorId;if((!o.currentFloor||i==core.status.floorId)&&(o.multiExecute||!core.autoEventExecuted(r))&&!core.autoEventExecuting(r)){var s=i+"@"+a+"@"+n;try{if(!core.calValue(o.condition,s))return}catch(e){return}core.autoEventExecuting(r,!0),core.autoEventExecuted(r,!0);var c=[{type:"function",function:"function() { core.pushEventLoc("+a+", "+n+", '"+i+"' ); }"},{type:"dowhile",condition:"false",data:o.data},{type:"function",function:"function() { core.popEventLoc(); core.autoEventExecuting('"+r+"', false); }"}];o.delayExecute?t.push(c):core.push(e,c)}})),0==e.length&&0==t.length||("action"==core.status.event.id||e.length>0?(core.insertAction(e),core.push(core.status.event.data.appendingEvents,t)):(core.insertAction(t[0]),t.length>0&&core.insertAction(t.slice(1))))}},events.prototype.autoEventExecuting=function(e,t){var o="_executing_autoEvent_"+e;if(null==t)return core.hasFlag(o);core.setFlag(o,t||null)},events.prototype.autoEventExecuted=function(e,t){var o="_executed_autoEvent_"+e;if(null==t)return core.hasFlag(o);core.setFlag(o,t||null)},events.prototype.pushEventLoc=function(e,t,o){"action"==core.status.event.id&&(core.status.event.data.locStack.push({x:core.status.event.data.x,y:core.status.event.data.y,floorId:core.status.event.data.floorId}),core.status.event.data.x=e,core.status.event.data.y=t,core.status.event.data.floorId=o)},events.prototype.popEventLoc=function(){if("action"==core.status.event.id){var e=core.status.event.data.locStack.shift();e&&(core.status.event.data.x=e.x,core.status.event.data.y=e.y,core.status.event.data.floorId=e.floorId)}},events.prototype.precompile=function(e){var t=this.__precompile_getArray();if("string"==typeof e)return this.__precompile_text(e);if(e instanceof Array){for(var o=0;o<e.length;++o)e[o]=this.precompile(e[o]);return e}return e&&e.type&&(this["_precompile_"+e.type]&&(e=this["_precompile_"+e.type](e)),t.texts.indexOf(e.type)>=0&&(e.text=this.__precompile_text(e.text)),t.locs.indexOf(e.type)>=0&&(e.loc=this.__precompile_array(e.loc)),t.values.indexOf(e.type)>=0&&(e.value=core.replaceValue(e.value)),t.uievents.indexOf(e.type)>=0&&(e.x=core.replaceValue(e.x),e.y=core.replaceValue(e.y),e.width=core.replaceValue(e.width),e.height=core.replaceValue(e.height)),e.type in t.others&&t.others[e.type].forEach((function(t){e[t]=core.replaceValue(e[t])}))),e},events.prototype.__precompile_getArray=function(){return{texts:["text","autoText","scrollText","tip","textImage","input","input2","choices","confirm","fillText","fillBoldText","drawTextContent"],locs:["show","hide","setBlock","showFloorImg","hideFloorImg","showBgFgMap","hideBgFgMap","setBgFgBlock","animate","setViewport","move","jumoHero","changeFloor","changePos","showTextImage","showGif","openDoor","closeDoor","battle","trigger","insert"],values:["setValue","setValue2","addValue","setEnemy","setFloor","setGlobalValue"],uievents:["clearMap","fillText","fillBoldText","fillRect","strokeRect","strokeCircle","drawIcon","drawSelector","drawBackground"],others:{strokeCircle:["r"],drawLine:["x1","y1","x2","y2"],drawArrow:["x1","y1","x2","y2"],drawImage:["x","y","w","h","x1","y1","w1","h1"],drawTextContent:["left","top"]}}},events.prototype.__precompile_text=function(e){return"string"!=typeof e?e:e.replace(/\${(.*?)}/g,(function(e,t){return"${"+core.replaceValue(t)+"}"}))},events.prototype.__precompile_array=function(e){if("string"==typeof e)return e=core.replaceValue(e);if(e instanceof Array)for(var t=0;t<e.length;++t)e[t]=this.__precompile_array(e[t]);return e},events.prototype.__action_checkReplaying=function(){return!!core.isReplaying()&&(core.doAction(),!0)},events.prototype.__action_getLoc=function(e,t,o,r){return e&&(t=core.calValue(e[0],r),o=core.calValue(e[1],r)),[t,o]},events.prototype.__action_getHeroLoc=function(e,t){return this.__action_getLoc(e,core.getHeroLoc("x"),core.getHeroLoc("y"),t)},events.prototype.__action_getLoc2D=function(e,t,o,r){return e&&e[0]instanceof Array||(e=[this.__action_getLoc(e,t,o,r)]),e},events.prototype.__action_doAsyncFunc=function(e,t){var o=Array.prototype.slice.call(arguments,2);e?(t.apply(this,o),core.doAction()):t.apply(this,o.concat(core.doAction))},events.prototype._action_text=function(e,t,o,r){this.__action_checkReplaying()||core.ui.drawTextBox(e.text,e.showAll)},events.prototype._action_autoText=function(e,t,o,r){this.__action_checkReplaying()||(core.ui.drawTextBox(e.text),setTimeout(core.doAction,e.time||3e3))},events.prototype._action_scrollText=function(e,t,o,r){this.__action_checkReplaying()||this.__action_doAsyncFunc(e.async,core.drawScrollText,e.text,e.time||5e3,e.lineHeight||1.4)},events.prototype._action_comment=function(e,t,o,r){core.doAction()},events.prototype._action_setText=function(e,t,o,r){["position","offset","align","bold","titlefont","textfont","time","interval"].forEach((function(t){null!=e[t]&&(core.status.textAttribute[t]=e[t])})),["background","title","text"].forEach((function(t){if(e[t]instanceof Array&&e[t].length>=3&&(3==e[t].length&&e[t].push(1),core.status.textAttribute[t]=e[t]),"background"==t){var o=core.getMappedName(e[t]),r=core.material.images.images[o];r&&192==r.width&&128==r.height&&(core.status.textAttribute[t]=o)}})),core.setFlag("textAttribute",core.status.textAttribute),core.doAction()},events.prototype._action_tip=function(e,t,o,r){core.drawTip(core.replaceText(e.text),e.icon),core.doAction()},events.prototype._action_show=function(e,t,o,r){e.loc=this.__action_getLoc2D(e.loc,t,o,r),e.time>0&&e.floorId==core.status.floorId?this.__action_doAsyncFunc(e.async,core.animateBlock,e.loc,"show",e.time):(e.loc.forEach((function(t){core.showBlock(t[0],t[1],e.floorId)})),core.doAction())},events.prototype._action_hide=function(e,t,o,r){e.loc=this.__action_getLoc2D(e.loc,t,o,r),e.time>0&&e.floorId==core.status.floorId?(e.loc.forEach((function(t){core.hideBlock(t[0],t[1],e.floorId)})),this.__action_doAsyncFunc(e.async,core.animateBlock,e.loc,"hide",e.time)):(e.loc.forEach((function(t){core.removeBlock(t[0],t[1],e.floorId)})),core.doAction())},events.prototype._action_setBlock=function(e,t,o,r){e.loc=this.__action_getLoc2D(e.loc,t,o,r),e.loc.forEach((function(t){core.setBlock(e.number,t[0],t[1],e.floorId)})),core.doAction()},events.prototype._action_showFloorImg=function(e,t,o,r){core.maps.showFloorImage(this.__action_getLoc2D(e.loc,t,o,r),e.floorId,core.doAction)},events.prototype._action_hideFloorImg=function(e,t,o,r){core.maps.hideFloorImage(this.__action_getLoc2D(e.loc,t,o,r),e.floorId,core.doAction)},events.prototype._action_showBgFgMap=function(e,t,o,r){core.maps.showBgFgMap(e.name,this.__action_getLoc2D(e.loc,t,o,r),e.floorId,core.doAction)},events.prototype._action_hideBgFgMap=function(e,t,o,r){core.maps.hideBgFgMap(e.name,this.__action_getLoc2D(e.loc,t,o,r),e.floorId,core.doAction)},events.prototype._action_setBgFgBlock=function(e,t,o,r){e.loc=this.__action_getLoc2D(e.loc,t,o,r),e.loc.forEach((function(t){core.setBgFgBlock(e.name,e.number,t[0],t[1],e.floorId)})),core.doAction()},events.prototype._action_follow=function(e,t,o,r){this.follow(e.name),core.doAction()},events.prototype._action_unfollow=function(e,t,o,r){this.unfollow(e.name),core.doAction()},events.prototype._action_animate=function(e,t,o,r){"hero"==e.loc?this.__action_doAsyncFunc(e.async,core.drawHeroAnimate,e.name):(e.loc=this.__action_getLoc(e.loc,t,o,r),this.__action_doAsyncFunc(e.async,core.drawAnimate,e.name,e.loc[0],e.loc[1]))},events.prototype._action_setViewport=function(e,t,o,r){if(null==e.loc)core.drawHero();else{var a=this.__action_getLoc(e.loc,t,o,r);core.setViewport(32*a[0],32*a[1])}core.doAction()},events.prototype._action_moveViewport=function(e,t,o,r){this.__action_doAsyncFunc(e.async,core.moveViewport,e.steps,e.time)},events.prototype._action_move=function(e,t,o,r){var a=this.__action_getLoc(e.loc,t,o,r);this.__action_doAsyncFunc(e.async,core.moveBlock,a[0],a[1],e.steps,e.time,e.keep)},events.prototype._action_moveHero=function(e,t,o,r){this.__action_doAsyncFunc(e.async,core.eventMoveHero,e.steps,e.time)},events.prototype._action_jump=function(e,t,o,r){var a=this.__action_getLoc(e.from,t,o,r),n=this.__action_getLoc(e.to,t,o,r);this.__action_doAsyncFunc(e.async,core.jumpBlock,a[0],a[1],n[0],n[1],e.time,e.keep)},events.prototype._precompile_jump=function(e){return e.from=this.__precompile_array(e.from),e.to=this.__precompile_array(e.to),e},events.prototype._action_jumpHero=function(e,t,o,r){var a=this.__action_getHeroLoc(e.loc,r);this.__action_doAsyncFunc(e.async,core.jumpHero,a[0],a[1],e.time)},events.prototype._action_changeFloor=function(e,t,o,r){var a=this.__action_getHeroLoc(e.loc,r),n={x:a[0],y:a[1],direction:e.direction};core.changeFloor(e.floorId,null,n,e.time,core.doAction)},events.prototype._action_changePos=function(e,t,o,r){core.clearMap("hero");var a=this.__action_getHeroLoc(e.loc,r);core.setHeroLoc("x",a[0]),core.setHeroLoc("y",a[1]),e.direction&&core.setHeroLoc("direction",e.direction),core.drawHero(),core.doAction()},events.prototype._action_showImage=function(e,t,o,r){core.isReplaying()&&(e.time=0),this.__action_doAsyncFunc(e.async||0==e.time,core.showImage,e.code,e.image,e.sloc,e.loc,e.opacity,e.time)},events.prototype._precompile_showImage=function(e){return e.sloc=this.__precompile_array(e.sloc),e.loc=this.__precompile_array(e.loc),e},events.prototype._action_showTextImage=function(e,t,o,r){var a=this.__action_getLoc(e.loc,0,0,r);core.isReplaying()&&(e.time=0),this.__action_doAsyncFunc(e.async||0==e.time,core.showImage,e.code,core.ui.textImage(e.text),null,a,e.opacity,e.time)},events.prototype._action_hideImage=function(e,t,o,r){core.isReplaying()&&(e.time=0),this.__action_doAsyncFunc(e.async||0==e.time,core.hideImage,e.code,e.time)},events.prototype._action_showGif=function(e,t,o,r){var a=this.__action_getLoc(e.loc,0,0,r);this.showGif(e.name,a[0],a[1]),core.doAction()},events.prototype._action_moveImage=function(e,t,o,r){this.__action_checkReplaying()||this.__action_doAsyncFunc(e.async,core.moveImage,e.code,e.to,e.opacity,e.time)},events.prototype._precompile_moveImage=function(e){return e.to=this.__precompile_array(e.to),e},events.prototype._action_setFg=function(e,t,o,r){return this._action_setCurtain(e,t,o,r)},events.prototype._action_setCurtain=function(e,t,o,r){e.async?(core.setCurtain(e.color,e.time),core.setFlag("__color__",e.color||null),core.doAction()):core.setCurtain(e.color,e.time,(function(){core.setFlag("__color__",e.color||null),core.doAction()}))},events.prototype._action_screenFlash=function(e,t,o,r){this.__action_doAsyncFunc(e.async,core.screenFlash,e.color,e.time,e.times)},events.prototype._action_setWeather=function(e,t,o,r){core.setWeather(e.name,e.level),"rain"==e.name||"snow"==e.name||"fog"==e.name?core.setFlag("__weather__",[e.name,e.level]):core.removeFlag("__weather__"),core.doAction()},events.prototype._action_openDoor=function(e,t,o,r){var a=this.__action_getLoc(e.loc,t,o,r),n=e.floorId;n==core.status.floorId?this.__action_doAsyncFunc(e.async,core.openDoor,a[0],a[1],e.needKey):(core.removeBlock(a[0],a[1],n),core.doAction())},events.prototype._action_closeDoor=function(e,t,o,r){var a=this.__action_getLoc(e.loc,t,o,r);this.__action_doAsyncFunc(e.async,core.closeDoor,a[0],a[1],e.id)},events.prototype._action_useItem=function(e,t,o,r){"book"!=e.id&&core.canUseItem(e.id)?core.useItem(e.id,!0,core.doAction):(core.drawTip("当前无法使用"+((core.material.items[e.id]||{}).name||"未知道具")),core.doAction())},events.prototype._action_loadEquip=function(e,t,o,r){core.loadEquip(e.id),core.doAction()},events.prototype._action_unloadEquip=function(e,t,o,r){core.unloadEquip(e.pos),core.doAction()},events.prototype._action_openShop=function(e,t,o,r){core.status.shops[e.id].visited=!0,this.setEvents([]),core.isReplaying()||this.openShop(e.id),"action"==core.status.event.id&&core.doAction()},events.prototype._action_disableShop=function(e,t,o,r){this.disableQuickShop(e.id),core.doAction()},events.prototype._action_battle=function(e,t,o,r){if(e.id)this.battle(e.id,null,null,!0,core.doAction);else{if(e.floorId!=core.status.floorId)return void core.doAction();var a=this.__action_getLoc(e.loc,t,o,r);this.battle(null,a[0],a[1],!0,core.doAction)}},events.prototype._action_trigger=function(e,t,o,r){var a=this.__action_getLoc(e.loc,t,o,r),n=core.getBlock(a[0],a[1]);if(null!=n&&n.block.event.trigger){if(n=n.block,this.setEvents(e.keep?null:[],n.x,n.y),"action"!=n.event.trigger)return void core.doSystemEvent(n.event.trigger,n,core.doAction);this.insertAction(n.event.data)}core.doAction()},events.prototype._action_insert=function(e,t,o,r){if(e.args instanceof Array)for(var a=0;a<e.args.length;++a)try{null!=e.args[a]&&core.setFlag("arg"+(a+1),e.args[a])}catch(e){main.log(e)}if(e.name)core.setFlag("arg0",e.name),core.insertAction(e.name);else{var n=this.__action_getLoc(e.loc,t,o,r);core.setFlag("arg0",n);var i=e.floorId,s=e.which||"events",c=(core.floors[i][s]||[])[n[0]+","+n[1]];c&&this.insertAction(c.data||c)}core.doAction()},events.prototype._action_playBgm=function(e,t,o,r){core.playBgm(e.name),core.setFlag("__bgm__",e.keep?e.name:null),core.doAction()},events.prototype._action_pauseBgm=function(e,t,o,r){core.pauseBgm(),core.doAction()},events.prototype._action_resumeBgm=function(e,t,o,r){core.resumeBgm(),core.doAction()},events.prototype._action_loadBgm=function(e,t,o,r){core.loadBgm(e.name),core.doAction()},events.prototype._action_freeBgm=function(e,t,o,r){core.freeBgm(e.name),core.doAction()},events.prototype._action_playSound=function(e,t,o,r){e.stop&&core.stopSound(),core.playSound(e.name),core.doAction()},events.prototype._action_stopSound=function(e,t,o,r){core.stopSound(),core.doAction()},events.prototype._action_setVolume=function(e,t,o,r){e.value=core.clamp(parseInt(e.value)/100,0,1),core.setFlag("__volume__",e.value),this.__action_doAsyncFunc(e.async,core.setVolume,e.value,e.time||0)},events.prototype._action_setValue=function(e,t,o,r){this.setValue(e.name,e.value,r),e.norefresh||(core.status.hero.hp<=0?(core.status.hero.hp=0,core.updateStatusBar(),core.events.lose()):core.updateStatusBar()),core.doAction()},events.prototype._action_setValue2=function(e,t,o,r){this._action_addValue(e,t,o,r)},events.prototype._action_addValue=function(e,t,o,r){this.addValue(e.name,e.value,r),e.norefresh||(core.status.hero.hp<=0?(core.status.hero.hp=0,core.updateStatusBar(),core.events.lose()):core.updateStatusBar()),core.doAction()},events.prototype._action_setEnemy=function(e,t,o,r){this.setEnemy(e.id,e.name,e.value,r),core.doAction()},events.prototype._action_setFloor=function(e,t,o,r){this.setFloorInfo(e.name,e.value,e.floorId,r),core.doAction()},events.prototype._action_setGlobalAttribute=function(e,t,o,r){this.setGlobalAttribute(e.name,e.value),core.doAction()},events.prototype._action_setGlobalValue=function(e,t,o,r){core.values[e.name]=e.value,core.doAction()},events.prototype._action_setGlobalFlag=function(e,t,o,r){this.setGlobalFlag(e.name,e.value),core.doAction()},events.prototype._action_setHeroIcon=function(e,t,o,r){this.setHeroIcon(e.name),core.doAction()},events.prototype._action_input=function(e,t,o,r){this.__action_getInput(e.text,!1,(function(e){e=Math.abs(parseInt(e)||0),core.status.route.push("input:"+e),core.setFlag("input",e),core.doAction()}))},events.prototype._action_input2=function(e,t,o,r){this.__action_getInput(e.text,!0,(function(e){e=e||"",core.status.route.push("input2:"+core.encodeBase64(e)),core.setFlag("input",e),core.doAction()}))},events.prototype.__action_getInput=function(e,t,o){var r=t?"input2:":"input:";if(core.isReplaying()){var a=core.status.replay.toReplay.shift();try{if(0!=a.indexOf(r))throw new Error("录像文件出错！当前需要一个 "+r+" 项，实际为 "+a);o(t?core.decodeBase64(a.substring(7)):parseInt(a.substring(6)))}catch(e){return void core.control._replay_error(a)}}else core.myprompt(core.replaceText(e),null,o)},events.prototype._action_if=function(e,t,o,r){core.calValue(e.condition,r)?core.events.insertAction(e.true):core.events.insertAction(e.false),core.doAction()},events.prototype._precompile_if=function(e){return e.condition=core.replaceValue(e.condition),e.true=this.precompile(e.true),e.false=this.precompile(e.false),e},events.prototype._action_switch=function(e,t,o,r){for(var a=core.calValue(e.condition,r),n=[],i=0;i<e.caseList.length;i++){var s=e.caseList[i].case;if(("default"==s||core.calValue(s,r)==a)&&(core.push(n,e.caseList[i].action),!e.caseList[i].nobreak))break}core.insertAction(n),core.doAction()},events.prototype._precompile_switch=function(e){e.condition=core.replaceValue(e.condition);for(var t=0;t<e.caseList.length;t++)e.caseList[t].case=core.replaceValue(e.caseList[t].case),e.caseList[t].action=this.precompile(e.caseList[t].action);return e},events.prototype._action_choices=function(e,t,o,r){if(e.choices=e.choices.filter((function(e){if(null==e.condition||""==e.condition)return!0;try{return core.calValue(e.condition,r)}catch(e){return!0}})),0==e.choices.length)return this.doAction();if(core.isReplaying()){var a,n=core.status.replay.toReplay.shift();if("turn"==n&&(n=core.status.replay.toReplay.shift()),!(0==n.indexOf("choices:")&&(a=parseInt(n.substring(8)))>=0&&a<e.choices.length))return void core.control._replay_error(n);core.status.event.selection=a,setTimeout((function(){core.status.route.push("choices:"+a),core.insertAction(e.choices[a].action),core.doAction()}),24==core.status.replay.speed?1:750/Math.max(1,core.status.replay.speed))}core.ui.drawChoices(e.text,e.choices)},events.prototype._precompile_choices=function(e){if(!(e.choices instanceof Array))return e;for(var t=0;t<e.choices.length;++t)e.choices[t].condition=core.replaceValue(e.choices[t].condition),e.choices[t].text=this.__precompile_text(e.choices[t].text),e.choices[t].action=this.precompile(e.choices[t].action);return e},events.prototype._action_confirm=function(e,t,o,r){if(core.status.event.ui={text:e.text,yes:e.yes,no:e.no},core.isReplaying()){var a,n=core.status.replay.toReplay.shift();if("turn"==n&&(n=core.status.replay.toReplay.shift()),!(0==n.indexOf("choices:")&&(a=parseInt(n.substring(8)))>=0&&a<2))return void core.control._replay_error(n);core.status.event.selection=a,setTimeout((function(){core.status.route.push("choices:"+a),0==a?core.insertAction(e.yes):core.insertAction(e.no),core.doAction()}),24==core.status.replay.speed?1:750/Math.max(1,core.status.replay.speed))}else core.status.event.selection=e.default?0:1;core.ui.drawConfirmBox(e.text)},events.prototype._precompile_confirm=function(e){return e.yes=this.precompile(e.yes),e.no=this.precompile(e.no),e},events.prototype._action_while=function(e,t,o,r){core.calValue(e.condition,r)&&core.unshift(core.status.event.data.list,{todo:core.clone(e.data),total:core.clone(e.data),condition:e.condition}),core.doAction()},events.prototype._precompile_while=function(e){return e.condition=core.replaceValue(e.condition),e.data=this.precompile(e.data),e},events.prototype._action_dowhile=function(e,t,o,r){core.unshift(core.status.event.data.list,{todo:core.clone(e.data),total:core.clone(e.data),condition:e.condition}),core.doAction()},events.prototype._precompile_dowhile=function(e){return e.condition=core.replaceValue(e.condition),e.data=this.precompile(e.data),e},events.prototype._action_break=function(e,t,o,r){core.status.event.data.list.shift(),core.doAction()},events.prototype._action_continue=function(e,t,o,r){core.calValue(core.status.event.data.list[0].condition,r)?core.status.event.data.list[0].todo=core.clone(core.status.event.data.list[0].total):core.status.event.data.list.shift(),core.doAction()},events.prototype._action_win=function(e,t,o,r){this.win(core.replaceText(e.reason),e.norank,e.noexit)},events.prototype._action_lose=function(e,t,o,r){this.lose(core.replaceText(e.reason))},events.prototype._action_restart=function(e,t,o,r){core.restart()},events.prototype._action_function=function(data,x,y,prefix){var func=data.function;try{"string"==typeof func&&0==func.indexOf("function")&&eval("("+func+")()")}catch(e){main.log(e)}data.async||core.doAction()},events.prototype._action_update=function(e,t,o,r){core.updateStatusBar(),core.doAction()},events.prototype._action_showStatusBar=function(e,t,o,r){core.showStatusBar(),core.doAction()},events.prototype._action_hideStatusBar=function(e,t,o,r){core.hideStatusBar(e.toolbox),core.doAction()},events.prototype._action_showHero=function(e,t,o,r){core.removeFlag("hideHero"),core.drawHero(),core.doAction()},events.prototype._action_hideHero=function(e,t,o,r){core.setFlag("hideHero",!0),core.drawHero(),core.doAction()},events.prototype._action_vibrate=function(e,t,o,r){this.__action_doAsyncFunc(e.async,core.vibrate,e.time)},events.prototype._action_sleep=function(e,t,o,r){core.timeout.sleepTimeout=setTimeout((function(){core.timeout.sleepTimeout=null,core.doAction()}),core.isReplaying()?Math.min(e.time,20):e.time)},events.prototype._action_wait=function(e,t,o,r){if(core.isReplaying()){var a=core.status.replay.toReplay.shift();if(0==a.indexOf("input:")){var n=parseInt(a.substring(6));core.status.route.push("input:"+n),this.__action_wait_getValue(n),this.__action_wait_afterGet(e)}else main.log("录像文件出错！当前需要一个 input: 项，实际为 "+a),core.stopReplay(),core.insertAction(["录像文件出错，请在控制台查看报错信息。",{type:"exit"}]);core.doAction()}else;},events.prototype.__action_wait_getValue=function(e){if(e>=1e6){core.setFlag("type",1);var t=parseInt((e-1e6)/1e3),o=e%1e3;core.setFlag("px",t),core.setFlag("py",o),core.setFlag("x",parseInt(t/32)),core.setFlag("y",parseInt(o/32))}else if(e>=1e4){core.setFlag("type",1);var r=parseInt((e-1e4)/100),a=e%100;core.setFlag("px",32*r+16),core.setFlag("py",32*a+16),core.setFlag("x",r),core.setFlag("y",a)}else e>0&&(core.setFlag("type",0),core.setFlag("keycode",e))},events.prototype.__action_wait_afterGet=function(e){if(e.data){var t=[];e.data.forEach((function(e){if("keyboard"==e.case&&0==core.getFlag("type")&&e.keycode==core.getFlag("keycode",0)&&core.push(t,e.action),"mouse"==e.case&&e.px instanceof Array&&e.py instanceof Array&&1==core.getFlag("type")){var o=core.calValue(e.px[0]),r=core.calValue(e.px[1]),a=core.calValue(e.py[0]),n=core.calValue(e.py[1]),i=core.getFlag("px",0),s=core.getFlag("py",0);i>=o&&i<=r&&s>=a&&s<=n&&core.push(t,e.action)}})),t.length>0&&core.insertAction(t)}},events.prototype._precompile_wait=function(e){return e.data&&e.data.forEach((function(e){e.px&&(e.px=this.__precompile_array(e.px)),e.py&&(e.py=this.__precompile_array(e.py)),e.action=this.precompile(e.action)}),this),e},events.prototype._action_waitAsync=function(e,t,o,r){var a=window.setInterval((function(){core.hasAsync()||(clearInterval(a),core.doAction())}),50)},events.prototype._action_revisit=function(e,t,o,r){var a=core.getBlock(t,o);null!=a&&"action"==a.block.event.trigger&&this.setEvents(a.block.event.data),core.doAction()},events.prototype._action_callBook=function(e,t,o,r){if(core.isReplaying()||!core.hasItem("book"))core.doAction();else{var a=core.clone(core.status.event.data);core.ui.closePanel(),core.openBook(),core.status.event.interval=a}},events.prototype._action_callSave=function(e,t,o,r){if(core.isReplaying()||core.hasFlag("__events__"))core.removeFlag("__events__"),core.doAction();else{var a=core.clone(core.status.event.data);core.ui.closePanel(),core.save(),core.status.event.interval=a}},events.prototype._action_autoSave=function(e,t,o,r){core.autosave(),e.nohint||core.drawTip("已自动存档"),core.doAction()},events.prototype._action_callLoad=function(e,t,o,r){if(!this.__action_checkReplaying()){var a=core.clone(core.status.event.data);core.ui.closePanel(),core.load(),core.status.event.interval=a}},events.prototype._action_exit=function(e,t,o,r){this.setEvents([]),core.doAction()},events.prototype._action_previewUI=function(e,t,o,r){this.insertAction(e.action),core.doAction()},events.prototype._precompile_previewUI=function(e){return e.action=this.precompile(e.action),e},events.prototype.__action_doUIEvent=function(e){this.__action_doUIEvent_doOne(e);for(var t=core.status.event.data.list[0];t.todo.length>0&&(e=t.todo[0],this.__action_doUIEvent_doOne(t.todo[0]));)t.todo.shift();core.doAction()},events.prototype.__action_doUIEvent_doOne=function(e){return!!core.ui["_uievent_"+e.type]&&(core.ui["_uievent_"+e.type](e),!0)},events.prototype._action_clearMap=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._action_fillText=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._action_fillBoldText=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._action_fillRect=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._action_fillPolygon=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._precompile_fillPolygon=function(e){return e.nodes=this.__precompile_array(e.nodes),e},events.prototype._action_strokeRect=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._action_strokePolygon=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._precompile_strokePolygon=function(e){return e.nodes=this.__precompile_array(e.nodes),e},events.prototype._action_fillCircle=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._action_strokeCircle=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._action_drawLine=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._action_drawArrow=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._action_setAttribute=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._action_drawImage=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._action_drawIcon=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._action_drawSelector=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._action_drawBackground=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._action_drawTextContent=function(e,t,o,r){this.__action_doUIEvent(e)},events.prototype._checkStatus=function(e,t,o){return t&&core.status.event.id==e?(core.ui.closePanel(),!1):(!t||!core.status.lockControl)&&(o&&!core.hasItem(e)?(core.drawTip("你没有"+core.material.items[e].name),!1):core.isMoving()?(core.drawTip("请先停止勇士行动"),!1):(core.lockControl(),core.status.event.id=e,!0))},events.prototype.openBook=function(e){if(!(core.isReplaying()||"book"==core.status.event.id&&core.events.recoverEvents(core.status.event.interval))){if("book"==core.status.event.id&&core.status.event.ui)return core.status.boxAnimateObjs=[],void core.ui.drawMaps(core.status.event.ui);"viewMaps"==core.status.event.id&&(e=!1,core.status.event.ui=core.status.event.data),this._checkStatus("book",e,!0)&&core.useItem("book",!0)}},events.prototype.useFly=function(e){if(!core.isReplaying()&&this._checkStatus("fly",e,!0))return core.flags.flyNearStair&&!core.nearStair()?(core.drawTip("只有在楼梯边才能使用传送器"),core.unLockControl(),core.status.event.data=null,void(core.status.event.id=null)):core.canUseItem("fly")?void core.useItem("fly",!0):(core.drawTip("楼层传送器好像失效了"),core.unLockControl(),core.status.event.data=null,void(core.status.event.id=null))},events.prototype.flyTo=function(e,t){return this.eventdata.flyTo(e,t)},events.prototype.openEquipbox=function(e){core.isReplaying()||this._checkStatus("equipbox",e)&&core.ui.drawEquipbox()},events.prototype.openToolbox=function(e){core.isReplaying()||this._checkStatus("toolbox",e)&&core.ui.drawToolbox()},events.prototype.openQuickShop=function(e){if(!core.isReplaying())if(0!=Object.keys(core.status.shops).length){if(1==Object.keys(core.status.shops).length){var t=Object.keys(core.status.shops)[0];if(null!=core.status.event.id||!this._checkStatus("shop",!1))return;var o=core.events.canUseQuickShop(t);return!core.flags.enableDisabledShop&&o?void core.drawText(o):void core.events.openShop(t,!0)}this._checkStatus("selectShop",e)&&core.ui.drawQuickShop()}else core.drawTip("本塔没有快捷商店！")},events.prototype.openKeyBoard=function(e){core.isReplaying()||this._checkStatus("keyBoard",e)&&core.ui.drawKeyBoard()},events.prototype.save=function(e){if(!core.isReplaying()&&("save"!=core.status.event.id||!core.events.recoverEvents(core.status.event.interval))&&this._checkStatus("save",e)){var t=core.saves.saveIndex,o=parseInt((t-1)/5),r=t-5*o;core.ui.drawSLPanel(10*o+r)}},events.prototype.load=function(e){if(!core.isReplaying()){var t=core.saves.saveIndex,o=parseInt((t-1)/5),r=t-5*o;if(!core.isPlaying())return core.dom.startPanel.style.display="none",core.clearStatus(),core.clearMap("all"),core.status.event={id:"load",data:null},core.status.lockControl=!0,void core.ui.drawSLPanel(10*o+r);"load"==core.status.event.id&&core.events.recoverEvents(core.status.event.interval)||this._checkStatus("load",e)&&core.ui.drawSLPanel(10*o+r)}},events.prototype.openSettings=function(e){core.isReplaying()||this._checkStatus("settings",e)&&core.ui.drawSettings()},events.prototype.hasAsync=function(){return Object.keys(core.animateFrame.asyncId).length>0||(core.status.animateObjs||[]).length>0},events.prototype.follow=function(e){core.status.hero.followers=core.status.hero.followers||[],e=core.getMappedName(e),core.material.images.images[e]&&(core.status.hero.followers.push({name:e}),core.gatherFollowers(),core.clearMap("hero"),core.drawHero())},events.prototype.unfollow=function(e){if(core.status.hero.followers=core.status.hero.followers||[],e){e=core.getMappedName(e);for(var t=0;t<core.status.hero.followers.length;t++)if(core.status.hero.followers[t].name==e){core.status.hero.followers.splice(t,1);break}}else core.status.hero.followers=[];core.gatherFollowers(),core.clearMap("hero"),core.drawHero()},events.prototype.setValue=function(e,t,o,r){t=core.calValue(t,o);r&&(t+=core.calValue(e,o)),this._setValue_setStatus(e,t),this._setValue_setItem(e,t),this._setValue_setFlag(e,t),this._setValue_setSwitch(e,t,o),this._setValue_setGlobal(e,t)},events.prototype._setValue_setStatus=function(e,t){0===e.indexOf("status:")&&core.setStatus(e.substring(7),t)},events.prototype._setValue_setItem=function(e,t){if(0===e.indexOf("item:")){var o=e.substring(5),r=core.itemCount(o);t>r?core.getItem(o,t-r):core.setItem(o,t)}},events.prototype._setValue_setFlag=function(e,t){0===e.indexOf("flag:")&&core.setFlag(e.substring(5),t)},events.prototype._setValue_setSwitch=function(e,t,o){0===e.indexOf("switch:")&&core.setFlag((o||":f@x@y")+"@"+e.substring(7),t)},events.prototype._setValue_setGlobal=function(e,t){0===e.indexOf("global:")&&core.setGlobal(e.substring(7),t)},events.prototype.addValue=function(e,t,o){this.setValue(e,t,o,!0)},events.prototype.doEffect=function(e,t,o){e.split(";").forEach((function(e){var r=e.split("+=");if(2==r.length){var a=r[0],n=core.calValue(r[1],null,t,o);core.addValue(a,n)}}))},events.prototype.setEnemy=function(e,t,o,r){core.hasFlag("enemyInfo")||core.setFlag("enemyInfo",{});var a=core.getFlag("enemyInfo");a[e]||(a[e]={}),o=core.calValue(o,r),a[e][t]=o,(core.material.enemys[e]||{})[t]=core.clone(o),core.updateStatusBar()},events.prototype.setFloorInfo=function(e,t,o,r){o=o||core.status.floorId,core.status.maps[o][e]=core.calValue(t,r),core.updateStatusBar()},events.prototype.setGlobalAttribute=function(name,value){"string"==typeof value&&(('"'==value.charAt(0)&&'"'==value.charAt(value.length-1)||"'"==value.charAt(0)&&"'"==value.charAt(value.length-1))&&(value=value.substring(1,value.length-1)),"["==value.charAt(0)&&"]"==value.charAt(value.length-1)&&(value=eval(value))),core.status.globalAttribute[name]=value,core.updateGlobalAttribute(name),core.setFlag("globalAttribute",core.status.globalAttribute)},events.prototype.setGlobalFlag=function(e,t){var o=core.getFlag("globalFlags",{});o[e]=t,core.flags[e]=t,core.setFlag("globalFlags",o),core.resize(),"blurFg"==e&&core.drawMap()},events.prototype.closeDoor=function(e,t,o,r){if(((o=o||"").endsWith("Door")||o.endsWith("Wall"))&&null!=core.material.icons.animates[o]&&null==core.getBlock(e,t)){core.playSound("door.mp3");core.material.icons.animates[o];var a=o.endsWith("Door")?30:70,n=pixi.game.getScene("event");_pixi_ui__WEBPACK_IMPORTED_MODULE_3__.a.drawAnimate(o,n,32*e+16,32*t+16,{async:!0,reverse:!0,time:24==core.status.replay.speed?1:a/Math.max(core.status.replay.speed,1),onComplete:function(){core.setBlock(core.getNumberById(o),e,t),r&&r()}})}else r&&r()},events.prototype.showImage=function(e,t,o,r,a,n,i){if("string"==typeof t&&(t=core.getMappedName(t),t=core.material.images.images[t]),t){o=o||[];var s=core.calValue(o[0])||0,c=core.calValue(o[1])||0,l=core.calValue(o[2]),u=core.calValue(o[3]);null==l&&(l=t.width),null==u&&(u=t.height),r=r||[];var p=core.calValue(r[0])||0,d=core.calValue(r[1])||0,f=core.calValue(r[2]),m=core.calValue(r[3]);null==f&&(f=l),null==m&&(m=u);var h=e+100;n=n||0;var y="image"+h;if(core.createCanvas(y,p,d,f,m,h).drawImage(t,s,c,l,u,0,0,f,m),0==n)return core.setOpacity(y,a),void(i&&i());core.setOpacity(y,0),this.moveImage(e,null,a,n,i)}else i&&i()},events.prototype.hideImage=function(e,t,o){var r="image"+(e+100);if(0==(t=t||0)||!core.dymCanvas[r])return core.deleteCanvas(r),void(o&&o());this.moveImage(e,null,0,t,(function(){core.deleteCanvas(r),o&&o()}))},events.prototype.moveImage=function(e,t,o,r,a){r=r||1e3,t=t||[];var n="image"+(e+100);if(core.dymCanvas[n]){var i=function(e,t){return null!=(e=core.calValue(e))?e:t},s=core.dymCanvas[n].canvas,c=parseFloat(s.getAttribute("_left")),l=parseFloat(s.getAttribute("_top")),u=i(t[0],c),p=i(t[1],l),d=parseFloat(s.style.opacity),f=i(o,d);this._moveImage_moving(n,{fromX:c,fromY:l,toX:u,toY:p,opacity:d,toOpacity:f,time:r/Math.max(core.status.replay.speed,1)},a)}else a&&a()},events.prototype._moveImage_moving=function(e,t,o){var r=0,a=parseInt(t.time/10);a<=0&&(a=1);var n=t.fromX,i=t.fromY,s=t.toX,c=t.toY,l=t.opacity,u=t.toOpacity,p=n,d=i,f=l,m=setInterval((function(){r++,f=l+(u-l)*r/a,p=parseInt(n+(s-n)*r/a),d=parseInt(i+(c-i)*r/a),core.setOpacity(e,f),core.relocateCanvas(e,p,d),r==a&&(core.setOpacity(e,u),delete core.animateFrame.asyncId[m],clearInterval(m),o&&o())}),10);core.animateFrame.asyncId[m]=!0},events.prototype.showGif=function(e,t,o){e=core.getMappedName(e);var r=core.material.images.images[e];if(r){var a=new Image;a.src=r.src,a.style.position="absolute",a.style.left=t*core.domStyle.scale+"px",a.style.top=o*core.domStyle.scale+"px",a.style.width=r.width*core.domStyle.scale+"px",a.style.height=r.height*core.domStyle.scale+"px",core.dom.gif2.appendChild(a)}else core.dom.gif2.innerHTML=""},events.prototype.setVolume=function(e,t,o){var r=function(e){core.musicStatus.designVolume=e,core.musicStatus.playingBgm&&(core.material.bgms[core.musicStatus.playingBgm].volume=core.musicStatus.userVolume*core.musicStatus.designVolume)};if(!t||t<100)return r(e),void(o&&o());var a=core.musicStatus.designVolume;t/=Math.max(core.status.replay.speed,1);var n=0,i=parseInt(t/10);i<=0&&(i=1);var s=setInterval((function(){n++,r(a+(e-a)*n/i),n>=i&&(delete core.animateFrame.asyncId[s],clearInterval(s),o&&o())}),10);core.animateFrame.asyncId[s]=!0},events.prototype.vibrate=function(e,t){if(core.isReplaying())t&&t();else{(!e||e<1e3)&&(e=1e3),e/=Math.max(core.status.replay.speed,1);var o={duration:3*(e=500*Math.ceil(e/500))/50,speed:5,power:5,direction:1,shake:0},r=setInterval((function(){core.events._vibrate_update(o),core.control.addGameCanvasTranslate(o.shake,0),0===o.duration&&(delete core.animateFrame.asyncId[r],clearInterval(r),t&&t())}),50/3);core.animateFrame.asyncId[r]=!0}},events.prototype._vibrate_update=function(e){if(e.duration>=1||0!=e.shake){var t=e.power*e.speed*e.direction/10;e.duration<=1&&e.shake*(e.shake+t)<0?e.shake=0:e.shake+=t,e.shake>2*e.power&&(e.direction=-1),e.shake<2*-e.power&&(e.direction=1),e.duration>=1&&(e.duration-=1)}},events.prototype.eventMoveHero=function(e,t,o){t=t||core.values.moveSpeed||100;var r=0,a=(e||[]).filter((function(e){return["up","down","left","right","forward","backward"].indexOf(e)>=0})),n=window.setInterval((function(){0==a.length?(delete core.animateFrame.asyncId[n],clearInterval(n),core.drawHero(),o&&o()):core.events._eventMoveHero_moving(++r,a)&&(r=0)}),24==core.status.replay.speed?1:t/8/core.status.replay.speed);core.animateFrame.asyncId[n]=!0},events.prototype._eventMoveHero_moving=function(e,t){var o=t[0],r=core.getHeroLoc("x"),a=core.getHeroLoc("y"),n="backward"==o?-1:1;return"forward"!=o&&"backward"!=o||(o=core.getHeroLoc("direction")),core.setHeroLoc("direction",o),e<=4?core.drawHero("leftFoot",4*n*e):e<=8&&core.drawHero("rightFoot",4*n*e),8==e&&(core.setHeroLoc("x",r+n*core.utils.scan[o].x,!0),core.setHeroLoc("y",a+n*core.utils.scan[o].y,!0),core.updateFollowers(),t.shift(),!0)},events.prototype.jumpHero=function(e,t,o,r){var a=core.getHeroLoc("x"),n=core.getHeroLoc("y");null==e&&(e=a),null==t&&(t=n);a=core.status.hero.loc.x,n=core.status.hero.loc.y;core.isset(e)||(e=a),core.isset(t)||(t=n),core.playSound("jump.mp3");var i=core.maps.__generateJumpInfo(a,n,e,t,o||500);i.icon=core.material.icons.hero[core.getHeroLoc("direction")],i.width=core.material.icons.hero.width||32,i.height=core.material.icons.hero.height,this._jumpHero_doJump(i,r)},events.prototype._jumpHero_doJump=function(e,t){var o=window.setInterval((function(){e.jump_count>0?core.events._jumpHero_jumping(e):core.events._jumpHero_finished(o,e.ex,e.ey,t)}),e.per_time);core.animateFrame.asyncId[o]=!0},events.prototype._jumpHero_jumping=function(e){core.clearMap("hero"),core.maps.__updateJumpInfo(e);var t=e.px,o=e.py,r=e.width||32,a=e.height;core.bigmap.offsetX=core.clamp(t-32*core.__HALF_SIZE__,0,32*core.bigmap.width-core.__PIXELS__),core.bigmap.offsetY=core.clamp(o-32*core.__HALF_SIZE__,0,32*core.bigmap.height-core.__PIXELS__),core.control.updateViewport(),core.drawImage("hero",core.material.images.hero,e.icon.stop,e.icon.loc*a,r,a,t+(32-r)/2-core.bigmap.offsetX,o+32-a-core.bigmap.offsetY,r,a),core.status.heroCenter.px=t+16,core.status.heroCenter.py=o+32-a/2},events.prototype._jumpHero_finished=function(e,t,o,r){delete core.animateFrame.asyncId[e],clearInterval(e),core.setHeroLoc("x",t),core.setHeroLoc("y",o),core.drawHero(),r&&r()},events.prototype.openShop=function(e,t){var o=core.status.shops[e];if(o.times=o.times||0,o.commonTimes&&(o.times=core.getFlag("commonTimes",0)),t&&!o.visited){if(!core.flags.enableDisabledShop||o.commonEvent||o.item)return 0==o.times?core.drawTip("该项尚未开启"):core.drawTip("该项已失效"),void core.ui.closePanel();core.drawTip("该商店尚未开启，只能浏览不可使用")}else o.visited=!0;return o.item?(core.status.route.push("shop:"+e+":0"),void(core.openItemShop?core.openItemShop(e):core.insertAction("道具商店插件不存在！请检查是否存在该插件！"))):o.commonEvent?(core.status.route.push("shop:"+e+":0"),void core.insertAction({type:"insert",name:o.commonEvent,args:o.args})):void core.ui.drawShop(e)},events.prototype._useShop=function(e,t){var o=core.events.canUseQuickShop(e.id);if(o||e.visited||(o=e.times?"该商店已失效":"该商店尚未开启"),o)return core.drawTip(o),!1;var r=e.use,a=e.choices[t],n=e.times,i=core.calValue(a.need||e.need,null,null,n);return i>core.getStatus(r)?(core.drawTip("你的"+("money"==r?"金币":"经验")+"不足"),!1):(core.status.event.selection=t,core.status.event.data.actions.push(t),core.setStatus(r,core.getStatus(r)-i),core.doEffect(a.effect,i,n),core.updateStatusBar(),e.times++,e.commonTimes&&core.setFlag("commonTimes",e.times),this.openShop(e.id),!0)},events.prototype._exitShop=function(){core.status.event.data.actions.length>0&&core.status.route.push("shop:"+core.status.event.data.id+":"+core.status.event.data.actions.join("")),core.status.event.data.actions=[],core.status.boxAnimateObjs=[],core.status.event.data.fromList?core.ui.drawQuickShop():core.ui.closePanel()},events.prototype.disableQuickShop=function(e){core.status.shops[e].visited=!1},events.prototype.canUseQuickShop=function(e){return this.eventdata.canUseQuickShop(e)},events.prototype.setHeroIcon=function(e,t){e=core.getMappedName(e),pixi.ui.getHeroTexture(e)&&(core.setFlag("heroIcon",e),core.control.updateHeroIcon(e),t||core.drawHero())},events.prototype.checkLvUp=function(){for(var e=[];;){var t=this._checkLvUp_check();if(null==t)break;e=e.concat(t)}e.length>0&&core.insertAction(e)},events.prototype._checkLvUp_check=function(){if(!core.flags.enableLevelUp||!core.firstData.levelUp||core.status.hero.lv>=core.firstData.levelUp.length)return null;var e=core.firstData.levelUp[core.status.hero.lv]||{},t=core.calValue(e.need);return null==t?null:core.status.hero.experience>=t?(core.status.hero.lv++,e.clear&&(core.status.hero.experience-=t),e.action||[]):null},events.prototype.tryUseItem=function(e){return core.ui.closePanel(),"book"==e?core.openBook(!1):"fly"==e?core.useFly(!1):"centerFly"==e?core.ui.drawCenterFly():void(core.canUseItem(e)?core.useItem(e):core.drawTip("当前无法使用"+core.material.items[e].name))},events.prototype.afterUseBomb=function(){return this.eventdata.afterUseBomb()},events.prototype._uploadCurrent=function(e){var t=new FormData;t.append("type","score"),t.append("name",core.firstData.name),t.append("version",core.firstData.version),t.append("platform",core.platform.string),t.append("hard",core.encodeBase64(core.status.hard)),t.append("username",core.encodeBase64(e||"current")),t.append("lv",core.status.hero.lv),t.append("hp",Math.min(core.status.hero.hp,Math.pow(2,63))),t.append("atk",core.status.hero.atk),t.append("def",core.status.hero.def),t.append("mdef",core.status.hero.mdef),t.append("money",core.status.hero.money),t.append("experience",core.status.hero.experience),t.append("steps",core.status.hero.steps),t.append("seed",core.getFlag("__seed__")),t.append("totalTime",Math.floor(core.status.hero.statistics.totalTime/1e3)),t.append("route",core.encodeRoute(core.status.route)),t.append("deler","current"),t.append("base64",1),core.http("POST","/games/upload.php",t)}},function(e,t){e.exports={commonEvent:{"加点事件":[{type:"comment",text:"通过传参，flag:arg1 表示当前应该的加点数值"},{type:"choices",choices:[{text:"攻击+${1*flag:arg1}",action:[{type:"setValue",name:"status:atk",value:"status:atk+1*flag:arg1"}]},{text:"防御+${2*flag:arg1}",action:[{type:"setValue",name:"status:def",value:"status:def+2*flag:arg1"}]},{text:"生命+${200*flag:arg1}",action:[{type:"setValue",name:"status:hp",value:"status:hp+200*flag:arg1"}]}]}],"毒衰咒处理":[{type:"comment",text:"获得毒衰咒效果，flag:arg1 为要获得的类型"},{type:"switch",condition:"flag:arg1",caseList:[{case:"0",action:[{type:"comment",text:"获得毒效果"},{type:"if",condition:"!flag:poison",true:[{type:"setValue",name:"flag:poison",value:"true"}],false:[]}]},{case:"1",action:[{type:"comment",text:"获得衰效果"},{type:"if",condition:"!flag:weak",true:[{type:"setValue",name:"flag:weak",value:"true"},{type:"if",condition:"core.values.weakValue>=1",true:[{type:"comment",text:">=1：直接扣数值"},{type:"addValue",name:"status:atk",value:"-core.values.weakValue"},{type:"addValue",name:"status:def",value:"-core.values.weakValue"}],false:[{type:"comment",text:"<1：扣比例"},{type:"function",function:"function(){\ncore.addBuff('atk', -core.values.weakValue);\n}"},{type:"function",function:"function(){\ncore.addBuff('def', -core.values.weakValue);\n}"}]}],false:[]}]},{case:"2",action:[{type:"comment",text:"获得咒效果"},{type:"if",condition:"!flag:curse",true:[{type:"setValue",name:"flag:curse",value:"true"}],false:[]}]}]}],"滑冰事件":[{type:"comment",text:"公共事件：滑冰事件"},{type:"if",condition:"core.canMoveHero()",true:[{type:"comment",text:"检测下一个点是否可通行"},{type:"setValue",name:"flag:nx",value:"core.nextX()"},{type:"setValue",name:"flag:ny",value:"core.nextY()"},{type:"if",condition:"core.noPass(flag:nx, flag:ny)",true:[{type:"comment",text:"不可通行，触发下一个点的事件"},{type:"trigger",loc:["flag:nx","flag:ny"]}],false:[{type:"comment",text:"可通行，先移动到下个点，然后检查阻激夹域，并尝试触发该点事件"},{type:"moveHero",time:80,steps:["forward"]},{type:"function",function:"function(){\ncore.checkBlock();\n}"},{type:"comment",text:"【触发事件】如果该点存在事件则会立刻结束当前事件"},{type:"trigger",loc:["flag:nx","flag:ny"]},{type:"comment",text:"如果该点不存在事件，则继续检测该点是否是滑冰点"},{type:"if",condition:"core.getBgNumber() == 167",true:[{type:"function",function:'function(){\ncore.insertAction("滑冰事件",null,null,null,true)\n}'}],false:[]}]}],false:[]}],"回收钥匙商店":[{type:"comment",text:"此事件在全局商店中被引用了(全局商店keyShop1)"},{type:"comment",text:"解除引用前勿删除此事件"},{type:"comment",text:"玩家在快捷列表（V键）中可以使用本公共事件"},{type:"while",condition:"1",data:[{type:"choices",text:"\t[商人,woman]你有多余的钥匙想要出售吗？",choices:[{text:"黄钥匙（10金币）",color:[255,255,0,1],action:[{type:"if",condition:"item:yellowKey >= 1",true:[{type:"addValue",name:"item:yellowKey",value:"-1"},{type:"addValue",name:"status:money",value:"10"}],false:["\t[商人,woman]你没有黄钥匙！"]}]},{text:"蓝钥匙（50金币）",color:[0,0,255,1],action:[{type:"if",condition:"item:blueKey >= 1",true:[{type:"addValue",name:"item:blueKey",value:"-1"},{type:"addValue",name:"status:money",value:"50"}],false:["\t[商人,woman]你没有蓝钥匙！"]}]},{text:"离开",action:[{type:"exit"}]}]}]}]}}},function(e,t){e.exports={hero:{down:{loc:0,stop:0,leftFoot:1,rightFoot:3},left:{loc:1,stop:0,leftFoot:1,rightFoot:3},right:{loc:2,stop:0,leftFoot:1,rightFoot:3},up:{loc:3,stop:0,leftFoot:1,rightFoot:3},width:32,height:48},terrains:{ground:0,grass:1,grass2:2,yellowWall:3,whiteWall:4,blueWall:5,snowGround:6,ground2:7,ground3:8,ground4:9,sand:10,ground5:11,yellowWall2:12,whiteWall2:13,blueWall2:14,blockWall:15,grayWall:16,white:17,ground6:18,soil:19,ground7:20,ground8:21,ice:22,downFloor:23,upFloor:24,yellowDoor:25,blueDoor:26,redDoor:27,greenDoor:28,specialDoor:29,steelDoor:30,"blueShop-left":31,"blueShop-right":32,"pinkShop-left":33,"pinkShop-right":34,arrowUp:35,arrowDown:36,arrowLeft:37,arrowRight:38,light:39,darkLight:40,ski:41,flower:42,box:43,boxed:44},animates:{star:0,lava:1,blueWater:2,water:3,yellowDoor:4,blueDoor:5,redDoor:6,greenDoor:7,specialDoor:8,steelDoor:9,yellowWall:10,whiteWall:11,blueWall:12,crystalUp:13,crystalBottom:14,starPortal:15,fire:16,portal:17,switch:18,lavaNet:19,poisonNet:20,weakNet:21,curseNet:22,downPortal:23,leftPortal:24,rightPortal:25,upPortal:26},npcs:{man:0,woman:1,thief:2,fairy:3,magician:4,womanMagician:5,oldMan:6,child:7,wood:8,pinkShop:9,blueShop:10,princess:11,wlt:12,wt:13,wrt:14,wl:15,wc:16,wr:17,wlb:18,wrb:19,dlt:20,dt:21,drt:22,dl:23,dc:24,dr:25,dlb:26,drb:27},npc48:{npc0:0,npc1:1,npc2:2,npc3:3},enemys:{redSlime:1,blackSlime:2,slimelord:3,bat:4,bigBat:5,redBat:6,vampire:7,skeleton:8,skeletonSoilder:9,skeletonCaptain:10,ghostSkeleton:11,zombie:12,zombieKnight:13,rock:14,slimeMan:15,bluePriest:16,redPriest:17,brownWizard:18,redWizard:19,yellowGuard:20,blueGuard:21,redGuard:22,swordsman:23,soldier:24,yellowKnight:25,redKnight:26,darkKnight:27,yellowKing:29,greenKing:30,blueKnight:31,goldSlime:32,poisonSkeleton:33,poisonBat:34,steelRock:35,skeletonPriest:36,skeletonKing:37,skeletonWizard:38,redSkeletonCaption:39,badHero:40,demon:41,demonPriest:42,goldHornSlime:43,redKing:44,whiteKing:45,blackMagician:46,silverSlime:47,swordEmperor:48,whiteHornSlime:49,badPrincess:50,badFairy:51,grayPriest:52,redSwordsman:53,whiteGhost:54,poisonZombie:55,magicDragon:56,octopus:57,darkFairy:58,greenKnight:59,greenSlime:0,tree1:28},enemy48:{angel:0,elemental:1,steelGuard:2,evilBat:3},items:{yellowKey:0,blueKey:1,redKey:2,greenKey:3,steelKey:4,bigKey:6,redJewel:16,blueJewel:17,greenJewel:18,yellowJewel:19,redPotion:20,bluePotion:21,greenPotion:22,yellowPotion:23,lifeWand:33,sword0:60,sword1:50,sword2:51,sword3:52,sword4:53,sword5:54,shield0:61,shield1:55,shield2:56,shield3:57,shield4:58,shield5:59,book:9,fly:12,pickaxe:45,icePickaxe:44,bomb:43,centerFly:13,upFly:15,downFly:14,coin:11,snow:41,cross:40,superPotion:29,earthquake:8,poisonWine:24,weakWine:25,curseWine:27,superWine:28,knife:42,moneyPocket:46,shoes:47,hammer:48,jumpShoes:49,skill1:30,wand:10},autotile:{autotile:0,autotile1:0,autotile2:0,autotile3:0,autotile4:0}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var exports_loader_items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a_editor_project_items__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10),exports_loader_items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a_editor_project_items__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(exports_loader_items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a_editor_project_items__WEBPACK_IMPORTED_MODULE_0__);function items(){this._init()}__webpack_exports__.a=items,items.prototype._init=function(){this.items=exports_loader_items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a_editor_project_items__WEBPACK_IMPORTED_MODULE_0___default.a.items,this.itemEffect=exports_loader_items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a_editor_project_items__WEBPACK_IMPORTED_MODULE_0___default.a.itemEffect,this.itemEffectTip=exports_loader_items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a_editor_project_items__WEBPACK_IMPORTED_MODULE_0___default.a.itemEffectTip,this.useItemEffect=exports_loader_items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a_editor_project_items__WEBPACK_IMPORTED_MODULE_0___default.a.useItemEffect,this.canUseItemEffect=exports_loader_items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a_editor_project_items__WEBPACK_IMPORTED_MODULE_0___default.a.canUseItemEffect,exports_loader_items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a_editor_project_items__WEBPACK_IMPORTED_MODULE_0___default.a.equipCondition||(exports_loader_items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a_editor_project_items__WEBPACK_IMPORTED_MODULE_0___default.a.equipCondition={}),exports_loader_items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a_editor_project_items__WEBPACK_IMPORTED_MODULE_0___default.a.useItemEvent||(exports_loader_items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a_editor_project_items__WEBPACK_IMPORTED_MODULE_0___default.a.useItemEvent={}),this.equipCondition=exports_loader_items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a_editor_project_items__WEBPACK_IMPORTED_MODULE_0___default.a.equipCondition,this.useItemEvent=exports_loader_items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a_editor_project_items__WEBPACK_IMPORTED_MODULE_0___default.a.useItemEvent},items.prototype.getItems=function(){return core.clone(this.items)},items.prototype._resetItems=function(){"play"==main.mode&&(core.flags.bigKeyIsBox&&(core.material.items.bigKey.cls="items",core.material.items.bigKey.name="钥匙盒"),core.flags.pickaxeFourDirections&&(core.material.items.pickaxe.text="可以破坏勇士四周的墙"),core.flags.bombFourDirections&&(core.material.items.bomb.text="可以炸掉勇士四周的怪物"),core.flags.snowFourDirections&&(core.material.items.snow.text="可以将四周的熔岩变成平地"),core.flags.equipment&&(core.material.items.sword1.cls="equips",core.material.items.sword2.cls="equips",core.material.items.sword3.cls="equips",core.material.items.sword4.cls="equips",core.material.items.sword5.cls="equips",core.material.items.shield1.cls="equips",core.material.items.shield2.cls="equips",core.material.items.shield3.cls="equips",core.material.items.shield4.cls="equips",core.material.items.shield5.cls="equips"))},items.prototype.getItemEffect=function(itemId,itemNum){var itemCls=core.material.items[itemId].cls;if("items"===itemCls){var ratio=parseInt(core.status.thisMap.item_ratio)||1,curr_hp=core.status.hero.hp;if(itemId in this.itemEffect)try{for(var i=0;i<itemNum;++i)eval(this.itemEffect[itemId])}catch(e){main.log(e)}if(core.status.hero.statistics.hp+=core.status.hero.hp-curr_hp,this.useItemEvent[itemId])try{core.insertAction(this.useItemEvent[itemId])}catch(e){main.log(e)}}else core.addItem(itemId,itemNum)},items.prototype.getItemEffectTip=function(itemId){var itemCls=core.material.items[itemId].cls;if("items"===itemCls){var ratio=parseInt(core.status.thisMap.item_ratio)||1;if(itemId in this.itemEffectTip)try{return eval(this.itemEffectTip[itemId])||""}catch(e){return main.log(e),""}}return""},items.prototype.useItem=function(e,t,o){this.canUseItem(e)?(this._useItemEffect(e),this._afterUseItem(e),t||core.status.route.push("item:"+e),o&&o()):o&&o()},items.prototype._useItemEffect=function(itemId){if(itemId in this.useItemEffect)try{var ratio=parseInt(core.status.thisMap.item_ratio)||1;eval(this.useItemEffect[itemId])}catch(e){main.log(e)}if(this.useItemEvent[itemId])try{core.insertAction(this.useItemEvent[itemId])}catch(e){main.log(e)}},items.prototype._afterUseItem=function(e){var t=core.material.items[e].cls;"tools"==t&&core.status.hero.items[t][e]--,core.status.hero.items[t][e]<=0&&delete core.status.hero.items[t][e],core.status.event.id||(core.status.event.ui=null),core.updateStatusBar()},items.prototype.canUseItem=function(itemId){if(!core.hasItem(itemId))return!1;var able=!1;if(itemId in this.canUseItemEffect)try{able=eval(this.canUseItemEffect[itemId])}catch(e){main.log(e)}return able||(core.status.event.data=null,core.status.event.ui=null),able},items.prototype.itemCount=function(e){if(!core.material.items[e]||!core.isPlaying())return 0;var t=core.material.items[e].cls;return"items"==t?0:core.status.hero.items[t][e]||0},items.prototype.hasItem=function(e){return this.itemCount(e)>0},items.prototype.hasEquip=function(e){if(!(core.material.items[e]||{}).equip||!core.isPlaying())return null;for(var t in core.status.hero.equipment)if(core.status.hero.equipment[t]==e)return!0;return!1},items.prototype.getEquip=function(e){return core.status.hero.equipment[e]||null},items.prototype.setItem=function(e,t){t=t||0;var o=core.material.items[e].cls;"items"!=o&&(core.status.hero.items[o][e]=t,core.status.hero.items[o][e]<=0&&("keys"!=o?delete core.status.hero.items[o][e]:core.status.hero.items[o][e]=0),core.updateStatusBar())},items.prototype.addItem=function(e,t){null==t&&(t=1);var o=core.material.items[e].cls;"items"!=o&&(null==core.status.hero.items[o][e]&&(core.status.hero.items[o][e]=0),core.status.hero.items[o][e]+=t,core.status.hero.items[o][e]<=0&&("keys"!=o?delete core.status.hero.items[o][e]:core.status.hero.items[o][e]=0),"constants"==o&&core.status.hero.items[o][e]>1&&(core.status.hero.items[o][e]=1),core.updateStatusBar())},items.prototype.removeItem=function(e,t){if(null==t&&(t=1),!core.hasItem(e))return!1;var o=core.material.items[e].cls;return core.status.hero.items[o][e]-=t,core.status.hero.items[o][e]<=0&&("keys"!=o?delete core.status.hero.items[o][e]:core.status.hero.items[o][e]=0),core.updateStatusBar(),!0},items.prototype.getEquipTypeByName=function(e){for(var t=core.status.globalAttribute.equipName,o=0;o<t.length;++o)if(t[o]===e&&!core.status.hero.equipment[o])return o;return-1},items.prototype.getEquipTypeById=function(e){var t=core.material.items[e].equip.type;return"string"==typeof t&&(t=this.getEquipTypeByName(t)),t},items.prototype.canEquip=function(equipId,hint){var equip=core.material.items[equipId]||{};if(!equip.equip)return hint&&core.drawTip("不合法的装备！"),!1;if(!core.hasItem(equipId)&&!core.hasEquip(equipId))return hint&&core.drawTip("你当前没有"+equip.name+"，无法换装"),!1;var condition=this.equipCondition[equipId];if(condition)try{if(!eval(condition))return hint&&core.drawTip("当前不可换上"+equip.name),!1}catch(e){return console.log(e),!1}return!0},items.prototype.loadEquip=function(e,t){if(this.canEquip(e,!0)){var o=core.material.items[e]||{},r=this.getEquipTypeById(e);if(r<0)return core.drawTip("当前没有"+o.equip.type+"的空位！"),void(t&&t());this._realLoadEquip(r,e,core.status.hero.equipment[r],t)}else t&&t()},items.prototype.unloadEquip=function(e,t){var o=core.status.hero.equipment[e];o?this._realLoadEquip(e,null,o,t):t&&t()},items.prototype.compareEquipment=function(e,t){var o={},r=core.material.items[e],a=core.material.items[t];for(var n in core.status.hero)if("number"==typeof core.status.hero[n]){var i=0;r&&(i+=(r.equip||{})[n]||0),a&&(i-=(a.equip||{})[n]||0),0!=i&&(o[n]=i)}return o},items.prototype._loadEquipEffect=function(e,t,o){var r=core.compareEquipment(e,t);if(o)for(var a in r)core.addBuff(a,r[a]/100);else for(var a in r)core.status.hero[a]+=r[a]},items.prototype._realLoadEquip=function(e,t,o,r){var a=core.material.items[t]||{},n=core.material.items[o]||{};a.equip=a.equip||{},n.equip=n.equip||{};var i=a.equip.percentage,s=n.equip.percentage;if(t&&o&&(i||!1)!=(s||!1))return this.unloadEquip(e),this.loadEquip(t),void(r&&r());this._realLoadEquip_playSound(),this._loadEquipEffect(t,o,null==i?s:i),t&&core.removeItem(t),o&&core.addItem(o),core.status.hero.equipment[e]=t||null,t?core.drawTip("已装备上"+a.name,t):o&&core.drawTip("已卸下"+n.name,o),r&&r()},items.prototype._realLoadEquip_playSound=function(){core.hasFlag("__quickLoadEquip__")||(core.stopSound(),core.playSound("equip.mp3"))},items.prototype.quickSaveEquip=function(e){var t=core.getFlag("saveEquips",[]);t[e]=core.clone(core.status.hero.equipment),core.setFlag("saveEquips",t),core.drawTip("已保存"+e+"号套装")},items.prototype.quickLoadEquip=function(e){var t=core.getFlag("saveEquips",[])[e];if(t){for(var o=core.status.globalAttribute.equipName.length,r=0;r<o;r++){var a=t[r];if(a&&!this.canEquip(a,!0))return}core.setFlag("__quickLoadEquip__",!0);var n=[];for(r=0;r<o;r++){var i=core.status.hero.equipment[r];i!=(s=t[r])&&(n.push(s||null),i&&(this.unloadEquip(r),core.status.route.push("unEquip:"+r)))}for(var r in n){var s;(s=n[r])&&(this.loadEquip(s),core.status.route.push("equip:"+s))}core.removeFlag("__quickLoadEquip__"),this._realLoadEquip_playSound(),core.drawTip("成功换上"+e+"号套装")}else core.drawTip(e+"号套装不存在")},items.prototype.getEquippedStatus=function(e){var t=0;return core.status.hero.equipment.forEach((function(o){o&&(core.material.items[o]||{}).equip&&(core.material.items[o].equip.percentage||(t+=core.material.items[o].equip[e]||0))})),t}},function(e,t){e.exports={1:{cls:"terrains",id:"yellowWall",canBreak:!0},2:{cls:"terrains",id:"whiteWall",canBreak:!0},3:{cls:"terrains",id:"blueWall",canBreak:!0},4:{cls:"animates",id:"star",noPass:!0},5:{cls:"animates",id:"lava",noPass:!0},6:{cls:"terrains",id:"ice"},7:{cls:"terrains",id:"blueShop-left"},8:{cls:"terrains",id:"blueShop-right"},9:{cls:"terrains",id:"pinkShop-left"},10:{cls:"terrains",id:"pinkShop-right"},11:{cls:"animates",id:"lavaNet",noPass:!1,trigger:"passNet"},12:{cls:"animates",id:"poisonNet",noPass:!1,trigger:"passNet"},13:{cls:"animates",id:"weakNet",noPass:!1,trigger:"passNet"},14:{cls:"animates",id:"curseNet",noPass:!1,trigger:"passNet"},15:{cls:"animates",id:"blueWater",noPass:!0},16:{cls:"animates",id:"water",noPass:!0},20:{cls:"autotile",id:"autotile",noPass:!0},21:{cls:"items",id:"yellowKey"},22:{cls:"items",id:"blueKey"},23:{cls:"items",id:"redKey"},24:{cls:"items",id:"greenKey"},25:{cls:"items",id:"steelKey"},26:{cls:"items",id:"bigKey"},27:{cls:"items",id:"redJewel"},28:{cls:"items",id:"blueJewel"},29:{cls:"items",id:"greenJewel"},30:{cls:"items",id:"yellowJewel"},31:{cls:"items",id:"redPotion"},32:{cls:"items",id:"bluePotion"},33:{cls:"items",id:"greenPotion"},34:{cls:"items",id:"yellowPotion"},35:{cls:"items",id:"sword1"},36:{cls:"items",id:"shield1"},37:{cls:"items",id:"sword2"},38:{cls:"items",id:"shield2"},39:{cls:"items",id:"sword3"},40:{cls:"items",id:"shield3"},41:{cls:"items",id:"sword4"},42:{cls:"items",id:"shield4"},43:{cls:"items",id:"sword5"},44:{cls:"items",id:"shield5"},45:{cls:"items",id:"book"},46:{cls:"items",id:"fly"},47:{cls:"items",id:"pickaxe"},48:{cls:"items",id:"icePickaxe"},49:{cls:"items",id:"bomb"},50:{cls:"items",id:"centerFly"},51:{cls:"items",id:"upFly"},52:{cls:"items",id:"downFly"},53:{cls:"items",id:"coin"},54:{cls:"items",id:"snow"},55:{cls:"items",id:"cross"},56:{cls:"items",id:"superPotion"},57:{cls:"items",id:"earthquake"},58:{cls:"items",id:"poisonWine"},59:{cls:"items",id:"weakWine"},60:{cls:"items",id:"curseWine"},61:{cls:"items",id:"superWine"},62:{cls:"items",id:"knife"},63:{cls:"items",id:"moneyPocket"},64:{cls:"items",id:"shoes"},65:{cls:"items",id:"hammer"},68:{cls:"items",id:"lifeWand"},69:{cls:"items",id:"jumpShoes"},70:{cls:"items",id:"sword0"},71:{cls:"items",id:"shield0"},72:{cls:"items",id:"skill1"},73:{cls:"items",id:"wand"},81:{cls:"terrains",id:"yellowDoor",trigger:"openDoor"},82:{cls:"terrains",id:"blueDoor",trigger:"openDoor"},83:{cls:"terrains",id:"redDoor",trigger:"openDoor"},84:{cls:"terrains",id:"greenDoor",trigger:"openDoor"},85:{cls:"terrains",id:"specialDoor",trigger:"openDoor"},86:{cls:"terrains",id:"steelDoor",trigger:"openDoor"},87:{cls:"terrains",id:"upFloor",noPass:!1},88:{cls:"terrains",id:"downFloor",noPass:!1},89:{cls:"animates",id:"portal",noPass:!1},90:{cls:"animates",id:"starPortal",noPass:!1},91:{cls:"animates",id:"upPortal",noPass:!1},92:{cls:"animates",id:"leftPortal",noPass:!1},93:{cls:"animates",id:"downPortal",noPass:!1},94:{cls:"animates",id:"rightPortal",noPass:!1},101:{cls:"animates",id:"crystalUp"},102:{cls:"animates",id:"crystalBottom"},103:{cls:"animates",id:"fire"},104:{cls:"animates",id:"switch"},121:{cls:"npcs",id:"man"},122:{cls:"npcs",id:"woman"},123:{cls:"npcs",id:"thief"},124:{cls:"npcs",id:"fairy"},125:{cls:"npcs",id:"magician"},126:{cls:"npcs",id:"womanMagician"},127:{cls:"npcs",id:"oldMan"},128:{cls:"npcs",id:"child"},129:{cls:"npcs",id:"wood"},130:{cls:"npcs",id:"pinkShop"},131:{cls:"npcs",id:"blueShop"},132:{cls:"npcs",id:"princess"},133:{cls:"npc48",id:"npc0",faceIds:{down:"npc0",left:"npc1",right:"npc2",up:"npc3"}},134:{cls:"npc48",id:"npc1",faceIds:{down:"npc0",left:"npc1",right:"npc2",up:"npc3"}},135:{cls:"npc48",id:"npc2",faceIds:{down:"npc0",left:"npc1",right:"npc2",up:"npc3"}},136:{cls:"npc48",id:"npc3",faceIds:{down:"npc0",left:"npc1",right:"npc2",up:"npc3"}},140:{cls:"autotile",id:"autotile4",noPass:!0},151:{cls:"autotile",id:"autotile1",noPass:!0},152:{cls:"autotile",id:"autotile2",noPass:!0},153:{cls:"autotile",id:"autotile3",noPass:!0},161:{cls:"terrains",id:"arrowUp",noPass:!1,cannotOut:["left","right","down"],cannotIn:["down"]},162:{cls:"terrains",id:"arrowDown",noPass:!1,cannotOut:["left","right","up"],cannotIn:["up"]},163:{cls:"terrains",id:"arrowLeft",noPass:!1,cannotOut:["up","down","right"],cannotIn:["right"]},164:{cls:"terrains",id:"arrowRight",noPass:!1,cannotOut:["up","down","left"],cannotIn:["left"]},165:{cls:"terrains",id:"light",trigger:"changeLight",noPass:!1},166:{cls:"terrains",id:"darkLight",noPass:!0},167:{cls:"terrains",id:"ski",trigger:"ski",noPass:!1},168:{cls:"terrains",id:"flower",noPass:!1},169:{cls:"terrains",id:"box",trigger:"pushBox",noPass:!0},170:{cls:"terrains",id:"boxed",trigger:"pushBox",noPass:!0},181:{cls:"npcs",id:"wlt"},182:{cls:"npcs",id:"wt"},183:{cls:"npcs",id:"wrt"},184:{cls:"npcs",id:"wl"},185:{cls:"npcs",id:"wc"},186:{cls:"npcs",id:"wr"},187:{cls:"npcs",id:"wlb"},188:{cls:"npcs",id:"wrb"},189:{cls:"npcs",id:"dlt"},190:{cls:"npcs",id:"dt"},191:{cls:"npcs",id:"drt"},192:{cls:"npcs",id:"dl"},193:{cls:"npcs",id:"dc"},194:{cls:"npcs",id:"dr"},195:{cls:"npcs",id:"dlb"},196:{cls:"npcs",id:"drb"},201:{cls:"enemys",id:"greenSlime"},202:{cls:"enemys",id:"redSlime"},203:{cls:"enemys",id:"blackSlime"},204:{cls:"enemys",id:"slimelord"},205:{cls:"enemys",id:"bat"},206:{cls:"enemys",id:"bigBat"},207:{cls:"enemys",id:"redBat"},208:{cls:"enemys",id:"vampire"},209:{cls:"enemys",id:"skeleton"},210:{cls:"enemys",id:"skeletonSoilder"},211:{cls:"enemys",id:"skeletonCaptain"},212:{cls:"enemys",id:"ghostSkeleton"},213:{cls:"enemys",id:"zombie"},214:{cls:"enemys",id:"zombieKnight"},215:{cls:"enemys",id:"rock"},216:{cls:"enemys",id:"slimeMan"},217:{cls:"enemys",id:"bluePriest"},218:{cls:"enemys",id:"redPriest"},219:{cls:"enemys",id:"brownWizard"},220:{cls:"enemys",id:"redWizard"},221:{cls:"enemys",id:"yellowGuard"},222:{cls:"enemys",id:"blueGuard"},223:{cls:"enemys",id:"redGuard"},224:{cls:"enemys",id:"swordsman"},225:{cls:"enemys",id:"soldier"},226:{cls:"enemys",id:"yellowKnight"},227:{cls:"enemys",id:"redKnight"},228:{cls:"enemys",id:"darkKnight"},229:{cls:"enemys",id:"tree1"},230:{cls:"enemys",id:"yellowKing"},231:{cls:"enemys",id:"greenKing"},232:{cls:"enemys",id:"blueKnight"},233:{cls:"enemys",id:"goldSlime"},234:{cls:"enemys",id:"poisonSkeleton"},235:{cls:"enemys",id:"poisonBat"},236:{cls:"enemys",id:"steelRock"},237:{cls:"enemys",id:"skeletonPriest"},238:{cls:"enemys",id:"skeletonKing"},239:{cls:"enemys",id:"skeletonWizard"},240:{cls:"enemys",id:"redSkeletonCaption"},241:{cls:"enemys",id:"badHero"},242:{cls:"enemys",id:"demon"},243:{cls:"enemys",id:"demonPriest"},244:{cls:"enemys",id:"goldHornSlime"},245:{cls:"enemys",id:"redKing"},246:{cls:"enemys",id:"whiteKing"},247:{cls:"enemys",id:"blackMagician"},248:{cls:"enemys",id:"silverSlime"},249:{cls:"enemys",id:"swordEmperor"},250:{cls:"enemys",id:"whiteHornSlime"},251:{cls:"enemys",id:"badPrincess"},252:{cls:"enemys",id:"badFairy"},253:{cls:"enemys",id:"grayPriest"},254:{cls:"enemys",id:"redSwordsman"},255:{cls:"enemys",id:"whiteGhost"},256:{cls:"enemys",id:"poisonZombie"},257:{cls:"enemys",id:"magicDragon"},258:{cls:"enemys",id:"octopus"},259:{cls:"enemys",id:"darkFairy"},260:{cls:"enemys",id:"greenKnight"},261:{cls:"enemy48",id:"angel"},262:{cls:"enemy48",id:"elemental"},263:{cls:"enemy48",id:"steelGuard"},264:{cls:"enemy48",id:"evilBat"}}},function(e,t,o){var r,a,n,i;function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}i=function(){return function e(t,o,r){function a(i,s){if(!o[i]){if(!t[i]){if(n)return n(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=o[i]={exports:{}};t[i][0].call(l.exports,(function(e){var o=t[i][1][e];return a(o||e)}),l,l.exports,e,t,o,r)}return o[i].exports}for(var n=!1,i=0;i<r.length;i++)a(r[i]);return a}({1:[function(e,t,o){var r,a,n,i,s,c={}.hasOwnProperty;r=e("./PriorityQueue/AbstractPriorityQueue"),a=e("./PriorityQueue/ArrayStrategy"),i=e("./PriorityQueue/BinaryHeapStrategy"),n=e("./PriorityQueue/BHeapStrategy"),(s=function(e){function t(e){e||(e={}),e.strategy||(e.strategy=i),e.comparator||(e.comparator=function(e,t){return(e||0)-(t||0)}),t.__super__.constructor.call(this,e)}return function(e,t){function o(){this.constructor=e}for(var r in t)c.call(t,r)&&(e[r]=t[r]);o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype}(t,e),t}(r)).ArrayStrategy=a,s.BinaryHeapStrategy=i,s.BHeapStrategy=n,t.exports=s},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(e,t,o){t.exports=function(){function e(e){var t;if(null==(null!=e?e.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=e?e.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new e.strategy(e),this.length=(null!=e&&null!=(t=e.initialValues)?t.length:void 0)||0}return e.prototype.queue=function(e){this.length++,this.priv.queue(e)},e.prototype.dequeue=function(e){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},e.prototype.peek=function(e){if(!this.length)throw"Empty queue";return this.priv.peek()},e.prototype.clear=function(){return this.length=0,this.priv.clear()},e}()},{}],3:[function(e,t,o){var r;r=function(e,t,o){var r,a,n;for(a=0,r=e.length;r>a;)o(e[n=a+r>>>1],t)>=0?a=n+1:r=n;return a},t.exports=function(){function e(e){var t;this.options=e,this.comparator=this.options.comparator,this.data=(null!=(t=this.options.initialValues)?t.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return e.prototype.queue=function(e){var t;t=r(this.data,e,this.comparator),this.data.splice(t,0,e)},e.prototype.dequeue=function(){return this.data.pop()},e.prototype.peek=function(){return this.data[this.data.length-1]},e.prototype.clear=function(){this.data.length=0},e}()},{}],4:[function(e,t,o){t.exports=function(){function e(e){var t,o,r,a,n,i,s,c;for(this.comparator=(null!=e?e.comparator:void 0)||function(e,t){return e-t},this.pageSize=(null!=e?e.pageSize:void 0)||512,this.length=0,s=0;1<<s<this.pageSize;)s+=1;if(1<<s!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=s,this._emptyMemoryPageTemplate=t=[],o=0,n=this.pageSize;n>=0?n>o:o>n;n>=0?++o:--o)t.push(null);if(this._memory=[],this._mask=this.pageSize-1,e.initialValues)for(r=0,a=(i=e.initialValues).length;a>r;r++)c=i[r],this.queue(c)}return e.prototype.queue=function(e){this.length+=1,this._write(this.length,e),this._bubbleUp(this.length,e)},e.prototype.dequeue=function(){var e,t;return e=this._read(1),t=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,t),this._bubbleDown(1,t)),e},e.prototype.peek=function(){return this._read(1)},e.prototype.clear=function(){this.length=0,this._memory.length=0},e.prototype._write=function(e,t){var o;for(o=e>>this._shift;o>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[o][e&this._mask]=t},e.prototype._read=function(e){return this._memory[e>>this._shift][e&this._mask]},e.prototype._bubbleUp=function(e,t){var o,r,a,n;for(o=this.comparator;e>1&&(r=e&this._mask,e<this.pageSize||r>3?a=e&~this._mask|r>>1:2>r?(a=e-this.pageSize>>this._shift,a+=a&~(this._mask>>1),a|=this.pageSize>>1):a=e-2,!(o(n=this._read(a),t)<0));)this._write(a,t),this._write(e,n),e=a},e.prototype._bubbleDown=function(e,t){var o,r,a,n,i;for(i=this.comparator;e<this.length;)if(e>this._mask&&!(e&this._mask-1)?o=r=e+2:e&this.pageSize>>1?(o=(e&~this._mask)>>1,r=1+(o=1+(o|=e&this._mask>>1)<<this._shift)):r=(o=e+(e&this._mask))+1,o!==r&&r<=this.length)if(a=this._read(o),n=this._read(r),i(a,t)<0&&i(a,n)<=0)this._write(o,t),this._write(e,a),e=o;else{if(!(i(n,t)<0))break;this._write(r,t),this._write(e,n),e=r}else{if(!(o<=this.length))break;if(!(i(a=this._read(o),t)<0))break;this._write(o,t),this._write(e,a),e=o}},e}()},{}],5:[function(e,t,o){t.exports=function(){function e(e){var t;this.comparator=(null!=e?e.comparator:void 0)||function(e,t){return e-t},this.length=0,this.data=(null!=(t=e.initialValues)?t.slice(0):void 0)||[],this._heapify()}return e.prototype._heapify=function(){var e,t,o;if(this.data.length>0)for(e=t=1,o=this.data.length;o>=1?o>t:t>o;e=o>=1?++t:--t)this._bubbleUp(e)},e.prototype.queue=function(e){this.data.push(e),this._bubbleUp(this.data.length-1)},e.prototype.dequeue=function(){var e,t;return t=this.data[0],e=this.data.pop(),this.data.length>0&&(this.data[0]=e,this._bubbleDown(0)),t},e.prototype.peek=function(){return this.data[0]},e.prototype.clear=function(){this.length=0,this.data.length=0},e.prototype._bubbleUp=function(e){for(var t,o;e>0&&(t=e-1>>>1,this.comparator(this.data[e],this.data[t])<0);)o=this.data[t],this.data[t]=this.data[e],this.data[e]=o,e=t},e.prototype._bubbleDown=function(e){var t,o,r,a,n;for(t=this.data.length-1;a=1+(o=1+(e<<1)),r=e,t>=o&&this.comparator(this.data[o],this.data[r])<0&&(r=o),t>=a&&this.comparator(this.data[a],this.data[r])<0&&(r=a),r!==e;)n=this.data[r],this.data[r]=this.data[e],this.data[e]=n,e=r},e}()},{}]},{},[1])(1)},"object"==s(t)&&void 0!==e?e.exports=i():(a=[],void 0===(n="function"==typeof(r=i)?r.apply(t,a):r)||(e.exports=n))},function(module,__webpack_exports__,__webpack_require__){"use strict";var exports_loader_functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a_project_functions__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(11),exports_loader_functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a_project_functions__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(exports_loader_functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a_project_functions__WEBPACK_IMPORTED_MODULE_0__),_pixi_resize__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6),_pixi_scenes_tip__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(45),pixi_js_legacy__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(0);function ui(){this._init(),this.SIZE=core.__SIZE__,this.HSIZE=core.__HALF_SIZE__,this.LAST=this.SIZE-1,this.PIXEL=core.__PIXELS__,this.HPIXEL=this.PIXEL/2}__webpack_exports__.a=ui,ui.prototype._init=function(){this.uidata=exports_loader_functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a_project_functions__WEBPACK_IMPORTED_MODULE_0___default.a.ui},ui.prototype.getContextByName=function(e){var t=e;return"string"==typeof e&&(core.canvas[e]?t=core.canvas[e]:core.dymCanvas[e]&&(t=core.dymCanvas[e])),t&&t.canvas?t:null},ui.prototype._createUIEvent=function(){"editor"!=main.mode&&(core.dymCanvas.uievent||core.createCanvas("uievent",0,0,this.PIXEL,this.PIXEL,135))},ui.prototype.clearMap=function(e,t,o,r,a){if("all"==e){for(var n in core.canvas)core.canvas[n].clearRect(0,0,32*core.bigmap.width,32*core.bigmap.height);core.removeGlobalAnimate()}else{var i=this.getContextByName(e);i&&i.clearRect(t||0,o||0,r||i.canvas.width,a||i.canvas.height)}},ui.prototype._uievent_clearMap=function(e){"editor"==main.mode||null!=e.x&&null!=e.y&&null!=e.width&&null!=e.height?(this._createUIEvent(),this.clearMap("uievent",core.calValue(e.x),core.calValue(e.y),core.calValue(e.width),core.calValue(e.height))):this.deleteCanvas("uievent")},ui.prototype.fillText=function(e,t,o,r,a,n,i){a&&core.setFillStyle(e,a),n&&core.setFont(e,n);var s=this.getContextByName(e);s&&(null!=i?this._fillTextWithMaxWidth(s,t,o,r,i):s.fillText(t,o,r))},ui.prototype._uievent_fillText=function(e){this._createUIEvent(),this.fillText("uievent",core.replaceText(e.text),core.calValue(e.x),core.calValue(e.y),e.style,e.font,e.maxWidth)},ui.prototype._fillTextWithMaxWidth=function(e,t,o,r,a){var n=e.font,i=/(\d+)px/.exec(n);if(null==i)return e.fillText(t,o,r);for(var s=parseInt(i[1]);s>=8&&(e.font=n.replace(/(\d+)px/,s+"px"),!(e.measureText(t).width<=a));s--);e.fillText(t,o,r),e.font=n},ui.prototype.fillBoldText=function(e,t,o,r,a,n){var i=this.getContextByName(e);i&&(n&&(i.font=n),a||(a=i.fillStyle),a instanceof Array&&(a=core.arrayToRGBA(a)),i.fillStyle="#000000",i.fillText(t,o-1,r-1),i.fillText(t,o-1,r+1),i.fillText(t,o+1,r-1),i.fillText(t,o+1,r+1),i.fillStyle=a,i.fillText(t,o,r))},ui.prototype._uievent_fillBoldText=function(e){this._createUIEvent(),this.fillBoldText("uievent",core.replaceText(e.text),core.calValue(e.x),core.calValue(e.y),e.style,e.font)},ui.prototype.fillRect=function(e,t,o,r,a,n){n&&core.setFillStyle(e,n);var i=this.getContextByName(e);i&&i.fillRect(t,o,r,a)},ui.prototype._uievent_fillRect=function(e){this._createUIEvent(),this.fillRect("uievent",core.calValue(e.x),core.calValue(e.y),core.calValue(e.width),core.calValue(e.height),e.style)},ui.prototype.fillPolygon=function(e,t,o){o&&core.setFillStyle(e,o);var r=this.getContextByName(e);if(r&&t&&!(t.length<3)){r.beginPath();for(var a=0;a<t.length;++a){var n=core.calValue(t[a][0]),i=core.calValue(t[a][1]);0==a?r.moveTo(n,i):r.lineTo(n,i)}r.closePath(),r.fill()}},ui.prototype._uievent_fillPolygon=function(e){this._createUIEvent(),this.fillPolygon("uievent",e.nodes,e.style)},ui.prototype.strokeRect=function(e,t,o,r,a,n,i){n&&core.setStrokeStyle(e,n),i&&core.setLineWidth(e,i);var s=this.getContextByName(e);s&&s.strokeRect(t,o,r,a)},ui.prototype._uievent_strokeRect=function(e){this._createUIEvent(),this.strokeRect("uievent",core.calValue(e.x),core.calValue(e.y),core.calValue(e.width),core.calValue(e.height),e.style,e.lineWidth)},ui.prototype.strokePolygon=function(e,t,o,r){o&&core.setStrokeStyle(e,o),r&&core.setLineWidth(e,r);var a=this.getContextByName(e);if(a&&t&&!(t.length<3)){a.beginPath();for(var n=0;n<t.length;++n){var i=core.calValue(t[n][0]),s=core.calValue(t[n][1]);0==n?a.moveTo(i,s):a.lineTo(i,s)}a.closePath(),a.stroke()}},ui.prototype._uievent_strokePolygon=function(e){this._createUIEvent(),this.strokePolygon("uievent",e.nodes,e.style,e.lineWidth)},ui.prototype.fillCircle=function(e,t,o,r,a){a&&core.setFillStyle(e,a);var n=this.getContextByName(e);n&&(n.beginPath(),n.arc(t,o,r,0,2*Math.PI),n.fill())},ui.prototype._uievent_fillCircle=function(e){this._createUIEvent(),this.fillCircle("uievent",core.calValue(e.x),core.calValue(e.y),core.calValue(e.r),e.style)},ui.prototype.strokeCircle=function(e,t,o,r,a,n){a&&core.setStrokeStyle(e,a),n&&core.setLineWidth(e,n);var i=this.getContextByName(e);i&&(i.beginPath(),i.arc(t,o,r,0,2*Math.PI),i.stroke())},ui.prototype._uievent_strokeCircle=function(e){this._createUIEvent(),this.strokeCircle("uievent",core.calValue(e.x),core.calValue(e.y),core.calValue(e.r),e.style,e.lineWidth)},ui.prototype.drawLine=function(e,t,o,r,a,n,i){n&&core.setStrokeStyle(e,n),null!=i&&core.setLineWidth(e,i);var s=this.getContextByName(e);s&&(s.beginPath(),s.moveTo(t,o),s.lineTo(r,a),s.stroke())},ui.prototype._uievent_drawLine=function(e){this._createUIEvent(),this.drawLine("uievent",core.calValue(e.x1),core.calValue(e.y1),core.calValue(e.x2),core.calValue(e.y2),e.style,e.lineWidth)},ui.prototype.drawArrow=function(e,t,o,r,a,n,i){if(t!=r||o!=a){n&&core.setStrokeStyle(e,n),null!=i&&core.setLineWidth(e,i);var s=this.getContextByName(e);if(s){var c=r-t,l=a-o,u=Math.atan2(l,c);s.beginPath(),s.moveTo(t,o),s.lineTo(r,a),s.lineTo(r-10*Math.cos(u-Math.PI/6),a-10*Math.sin(u-Math.PI/6)),s.moveTo(r,a),s.lineTo(r-10*Math.cos(u+Math.PI/6),a-10*Math.sin(u+Math.PI/6)),s.stroke()}}},ui.prototype._uievent_drawArrow=function(e){this._createUIEvent(),this.drawArrow("uievent",core.calValue(e.x1),core.calValue(e.y1),core.calValue(e.x2),core.calValue(e.y2),e.style,e.lineWidth)},ui.prototype.setFont=function(e,t){var o=this.getContextByName(e);o&&(o.font=t)},ui.prototype.setLineWidth=function(e,t){var o=this.getContextByName(e);o&&(o.lineWidth=t)},ui.prototype.saveCanvas=function(e){var t=this.getContextByName(e);t&&t.save()},ui.prototype.loadCanvas=function(e){var t=this.getContextByName(e);t&&t.restore()},ui.prototype.setAlpha=function(e,t){var o=this.getContextByName(e);o&&(o.globalAlpha=t)},ui.prototype.setOpacity=function(e,t){var o=this.getContextByName(e);o&&(o.canvas.style.opacity=t)},ui.prototype.setFillStyle=function(e,t){var o=this.getContextByName(e);t instanceof Array&&(t=core.arrayToRGBA(t)),o&&(o.fillStyle=t)},ui.prototype.setStrokeStyle=function(e,t){var o=this.getContextByName(e);t instanceof Array&&(t=core.arrayToRGBA(t)),o&&(o.strokeStyle=t)},ui.prototype.setTextAlign=function(e,t){var o=this.getContextByName(e);o&&(o.textAlign=t)},ui.prototype.setTextBaseline=function(e,t){var o=this.getContextByName(e);o&&(o.textBaseline=t)},ui.prototype._uievent_setAttribute=function(e){if(this._createUIEvent(),e.font&&this.setFont("uievent",e.font),e.lineWidth&&this.setLineWidth("uievent",e.lineWidth),null!=e.alpha&&this.setAlpha("uievent",e.alpha),e.fillStyle&&this.setFillStyle("uievent",e.fillStyle),e.strokeStyle&&this.setStrokeStyle("uievent",e.strokeStyle),e.align&&this.setTextAlign("uievent",e.align),e.baseline&&this.setTextBaseline("uievent",e.baseline),null!=e.z&&"editor"!=main.mode){var t=parseInt(e.z)||135;core.dymCanvas.uievent.canvas.style.zIndex=t,core.dymCanvas._uievent_selector&&(core.dymCanvas._uievent_selector.canvas.style.zIndex=t+1)}},ui.prototype.calWidth=function(e,t,o){var r=this.getContextByName(e);return r?(o&&(r.font=o),r.measureText(t).width):0},ui.prototype.splitLines=function(e,t,o,r){if(!this.getContextByName(e))return[t];r&&core.setFont(e,r);for(var a=[],n=0,i=0;i<t.length;i++)if("\n"==t.charAt(i))a.push(t.substring(n,i)),n=i+1;else if("\\"==t.charAt(i)&&"n"==t.charAt(i+1))a.push(t.substring(n,i)),n=i+2;else{var s=t.substring(n,i+1),c=core.calWidth(e,s);o&&c>o&&(a.push(t.substring(n,i)),n=i)}return a.push(t.substring(n)),a},ui.prototype.drawImage=function(e,t,o,r,a,n,i,s,c,l){var u=this.getContextByName(e);if(u&&("string"!=typeof t||(t=pixi.ui.getTexture(t)))){t instanceof Object&&!i||console.warn(arguments);var p=pixi.canvasRenderer,d=pixi.nodes.getNode("sprite",{texture:t}),f=d.width,m=d.height;p.context.clearRect(0,0,f,m),d.renderCanvas(p),u.drawImage(p.view,0,0,f,m,o,r,a||f,n||m),d.remove()}},ui.prototype._uievent_drawImage=function(e){this._createUIEvent(),this.drawImage("uievent",e.image,core.calValue(e.x),core.calValue(e.y),core.calValue(e.w),core.calValue(e.h),core.calValue(e.x1),core.calValue(e.y1),core.calValue(e.w1),core.calValue(e.h1))},ui.prototype.drawIcon=function(e,t,o,r,a,n){var i=this.getContextByName(e);if(i){var s=core.getBlockInfo(t);if(!s){if(!(core.statusBar.icons[t]instanceof Image))return;s={image:core.statusBar.icons[t],posX:0,posY:0,height:32}}i.drawImage(s.image,32*s.posX,s.height*s.posY,32,s.height,o,r,a||32,n||s.height)}},ui.prototype._uievent_drawIcon=function(e){var t;this._createUIEvent();try{"string"!=typeof(t=core.calValue(e.id))&&(t=e.id)}catch(o){t=e.id}this.drawIcon("uievent",t,core.calValue(e.x),core.calValue(e.y),core.calValue(e.width),core.calValue(e.height))},ui.prototype.closePanel=function(){this.clearUI(),core.updateStatusBar(!0),core.unLockControl(),core.status.event.data=null,core.status.event.id=null,core.status.event.selection=null,core.status.event.ui=null,core.status.event.interval=null},ui.prototype.clearUI=function(){core.status.boxAnimateObjs=[],core.dymCanvas._selector&&core.deleteCanvas("_selector"),core.clearMap("ui"),pixi.scenes.getScene("ui").flash()},ui.prototype.drawTip=function(e,t,o){return _pixi_scenes_tip__WEBPACK_IMPORTED_MODULE_2__.a.draw(e,t)},ui.prototype.clearTip=function(){},ui.prototype.drawText=function(e,t){if(null!=e)return this._drawText_setContent(e,t);if(0==core.status.event.data.list.length){t=core.status.event.data.callback;return core.ui.closePanel(!1),void(t&&t())}var o=core.status.event.data.list.shift();"string"==typeof o?core.ui.drawTextBox(o):core.ui.drawTextBox(o.content,o.id)},ui.prototype._drawText_setContent=function(e,t){core.status.event&&"action"==core.status.event.id||!core.hasFlag("__replayText__")&&core.isReplaying()?core.insertAction(e,null,null,t):(e instanceof Array||(e=[e]),core.status.event={id:"text",data:{list:e,callback:t}},core.lockControl(),core.waitHeroToStop(core.drawText))},ui.prototype._getTitleAndIcon=function(e){var t=null,o=null,r=null,a=32,n=1;return{content:e=e.replace(/(\t|\\t)\[(([^\],]+),)?([^\],]+)\]/g,(function(e,i,s,c,l){if(l)if("hero"==l){t=core.status.hero.name,o=core.material.images.hero,r=0;var u=core.material.icons.hero.width||32;a=32*core.material.icons.hero.height/u}else if(l.endsWith(".png"))l=core.getMappedName(l),o=core.material.images.images[l];else{var p=core.getBlockInfo(l);null!=p?(p.name&&(t=p.name),o=p.image,r=p.posY,a=p.height,n=p.animate):t=l}return null!=c&&"null"==(t=c)&&(t=null),""})),title:t,image:o,icon:r,height:a,animate:n}},ui.prototype._getPosition=function(e){var t=null,o=null,r=null,a=!1;return"action"==core.status.event.id&&(o=core.status.event.data.x,r=core.status.event.data.y),{content:e=e.replace("\b","\\b").replace(/\\b\[(up|center|down|hero|null)(,(hero|null|\d+,\d+|\d+))?]/g,(function(e,n,i,s){if(t=n,"hero"==s||"hero"==n&&!s)o=core.status.hero.loc.x,r=core.status.hero.loc.y;else if("null"==s)o=r=null;else if(s){var c=s.split(",");if(o=r=null,1==c.length){var l=(core.status.hero.followers||[])[parseInt(c[0])-1];l&&(o=l.x,r=l.y)}else o=parseInt(c[0]),r=parseInt(c[1]),a=null==core.getBlockId(o,r)}return"hero"!=t&&"null"!=t||(t=null==r?"center":r>=core.__HALF_SIZE__?"up":"down"),""})),position:t,px:o,py:r,noPeak:a}},ui.prototype.drawWindowSelector=function(e,t,o,r,a){r=Math.round(r),a=Math.round(a);var n=core.ui.createCanvas("_selector",t,o,r,a,165);this._drawSelector(n,e,r,a)},ui.prototype._uievent_drawSelector=function(e){var t="_uievent_selector_"+(e.code||0);if(null==e.image)return core.deleteCanvas(t);var o=e.image||core.status.textAttribute.background;if("string"==typeof o){var r=core.calValue(e.x),a=core.calValue(e.y),n=core.calValue(e.width),i=core.calValue(e.height);if(n=Math.round(n),i=Math.round(i),"editor"!=main.mode){var s=136;core.dymCanvas.uievent&&(s=(parseInt(core.dymCanvas.uievent.canvas.style.zIndex)||135)+1);var c=core.createCanvas(t,r,a,n,i,s);c.canvas.classList.add("_uievent_selector"),this._drawSelector(c,o,n,i)}else this._drawSelector("uievent",o,n,i,r,a)}},ui.prototype._drawSelector=function(e,t,o,r,a,n){a=a||0,n=n||0,(e=this.getContextByName(e))&&("string"==typeof t&&(t=core.material.images.images[t]),t instanceof Image&&(e.drawImage(t,130,66,28,28,a+2,n+2,o-4,r-4),e.drawImage(t,128,64,2,2,a,n,2,2),e.drawImage(t,158,64,2,2,a+o-2,n,2,2),e.drawImage(t,128,94,2,2,a,n+r-2,2,2),e.drawImage(t,158,94,2,2,a+o-2,n+r-2,2,2),e.drawImage(t,130,64,28,2,a+2,n,o-4,2),e.drawImage(t,130,94,28,2,a+2,n+r-2,o-4,2),e.drawImage(t,128,66,2,28,a,n+2,2,r-4),e.drawImage(t,158,66,2,28,a+o-2,n+2,2,r-4)))},ui.prototype.drawWindowSkin=function(e,t,o,r,a,n,i,s,c){"string"==typeof(e=e||core.status.textAttribute.background)&&(e=core.getMappedName(e),e=core.material.images.images[e]);var l=core.getContextByName(t);if(l){l.drawImage(e,0,0,128,128,o+2,r+2,a-4,n-4),l.drawImage(e,128,0,16,16,o,r,16,16);for(var u=0;u<a-64;u+=32)l.drawImage(e,144,0,32,16,o+u+16,r,32,16),l.drawImage(e,144,48,32,16,o+u+16,r+n-16,32,16);l.drawImage(e,144,0,a-u-32,16,o+u+16,r,a-u-32,16),l.drawImage(e,144,48,a-u-32,16,o+u+16,r+n-16,a-u-32,16),l.drawImage(e,176,0,16,16,o+a-16,r,16,16);for(var p=0;p<n-64;p+=32)l.drawImage(e,128,16,16,32,o,r+p+16,16,32),l.drawImage(e,176,16,16,32,o+a-16,r+p+16,16,32);l.drawImage(e,128,16,16,n-p-32,o,r+p+16,16,n-p-32),l.drawImage(e,176,16,16,n-p-32,o+a-16,r+p+16,16,n-p-32),l.drawImage(e,128,48,16,16,o,r+n-16,16,16),l.drawImage(e,176,48,16,16,o+a-16,r+n-16,16,16),null!=s&&null!=c&&("up"==i?l.drawImage(e,128,96,32,32,s,r+n-3,32,32):"down"==i&&l.drawImage(e,160,96,32,32,s,r-29,32,32))}},ui.prototype.drawBackground=function(e,t,o,r,a){var n=null==(a=a||{}).px||a.noPeak?null:32*a.px-core.bigmap.offsetX,i=null==a.py||a.noPeak?null:32*a.py-core.bigmap.offsetY,s=a.xoffset||0,c=a.yoffset||0,l=core.status.textAttribute.background;return!!this._drawBackground_drawWindowSkin(l,e,t,o,r,a.position,n,i)||("string"==typeof l&&(l=core.initStatus.textAttribute.background),this._drawBackground_drawColor(l,e,t,o,r,a.position,n,i,s,c),!1)},ui.prototype._uievent_drawBackground=function(e){this._createUIEvent();var t=e.background||core.status.textAttribute.background,o=core.calValue(e.x),r=core.calValue(e.y),a=core.calValue(e.width),n=core.calValue(e.height);"string"==typeof t?this.drawWindowSkin(t,"uievent",o,r,a,n):t instanceof Array&&(this.fillRect("uievent",o,r,a,n,core.arrayToRGBA(t)),this.strokeRect("uievent",o,r,a,n))},ui.prototype._drawWindowSkin_getOpacity=function(){return core.getFlag("__winskin_opacity__",.85)},ui.prototype._drawBackground_drawWindowSkin=function(e,t,o,r,a,n,i,s){if("string"==typeof e&&core.material.images.images[e]){var c=core.material.images.images[e];if(192==c.width&&128==c.height)return core.setAlpha("ui",this._drawWindowSkin_getOpacity()),this.drawWindowSkin(c,"ui",t,o,r-t,a-o,n,i,s),core.setAlpha("ui",1),!0}return!1},ui.prototype._drawBackground_drawColor=function(e,t,o,r,a,n,i,s,c,l){var u=e[3];core.setAlpha("ui",u),core.setStrokeStyle("ui",core.status.globalAttribute.borderColor),core.setFillStyle("ui",core.arrayToRGB(e)),core.setLineWidth("ui",2);var p=core.canvas.ui;p.beginPath(),p.moveTo(t,o),"down"==n&&null!=i&&null!=s&&(p.lineTo(i+c,o),p.lineTo(i+16,o-l),p.lineTo(i+32-c,o)),p.lineTo(r,o),p.lineTo(r,a),"up"==n&&null!=i&&null!=s&&(p.lineTo(i+32-c,a),p.lineTo(i+16,a+l),p.lineTo(i+c,a)),p.lineTo(t,a),p.closePath(),p.fill(),p.stroke(),core.setAlpha("ui",1)},ui.prototype._calTextBoxWidth=function(e,t,o,r,a){var n=core.splitLines(e,t,null,a);if(1==n.length){var i=core.calWidth(e,n[0])+10;return i<2.3*o?core.clamp(i/1.4,o,r):i<2.2*r?core.clamp(i/2.4,o,r):core.clamp(i/3.4,o,r)}return core.clamp(n.reduce((function(t,o){return Math.max(t,core.calWidth(e,o)+10)}),0),o,r)},ui.prototype._getDrawableIconInfo=function(e){e&&0===e.indexOf("flag:")&&(e=core.getFlag(e.substring(5),e));var t=null,o=null;return["terrains","animates","items","npcs","enemys"].forEach((function(r){null!=core.material.icons[r][e]&&(t=core.material.images[r],o=core.material.icons[r][e])})),null==t&&e in core.statusBar.icons&&(t=core.statusBar.icons[e],o=0),[t,o]},ui.prototype._buildFont=function(e,t,o){var r=core.status.textAttribute||core.initStatus.textAttribute,a=core.status.globalAttribute||core.initStatus.globalAttribute;return null==t&&(t=r.bold),(t?"bold ":"")+(o?"italic ":"")+(e||r.textfont)+"px "+a.font},ui.prototype.drawTextContent=function(e,t,o){e=core.getContextByName(e);var r=core.status.textAttribute||core.initStatus.textAttribute;(o=core.clone(o||{})).left=o.left||0,o.right=o.left+(null==o.maxWidth?null!=e?e.canvas.width:core.__PIXELS__:o.maxWidth),o.top=o.top||0,o.color=o.color||r.text,o.color instanceof Array&&(o.color=core.arrayToRGBA(o.color)),null==o.bold&&(o.bold=r.bold),o.italic=!1,o.align=o.align||r.align||"left",o.fontSize=o.fontSize||r.textfont,o.lineHeight=o.lineHeight||1.3*o.fontSize,o.time=o.time||0,o.interval=null==o.interval?r.interval||0:o.interval,o.index=0,o.currcolor=o.color,o.currfont=o.fontSize,o.lineMargin=Math.max(0,o.lineHeight-o.fontSize),o.topMargin=parseInt(o.lineMargin/2),o.lineMaxHeight=o.lineMargin+o.fontSize,o.offsetX=0,o.offsetY=0,o.line=0,o.blocks=[];var a=core.createCanvas("__temp__",0,0,null==e?1:e.canvas.width,null==e?1:e.canvas.height,-1);return a.textBaseline="top",a.font=this._buildFont(o.fontSize,o.bold,o.italic),a.fillStyle=o.color,o=this._drawTextContent_draw(e,a,t,o),core.deleteCanvas("__temp__"),o},ui.prototype._uievent_drawTextContent=function(e){this._createUIEvent(),e.left=core.calValue(e.left),e.top=core.calValue(e.top),this.drawTextContent("uievent",core.replaceText(e.text),e)},ui.prototype._drawTextContent_draw=function(e,t,o,r){for(;this._drawTextContent_next(t,o,r););if(null==e)return r;r.index=0;var a=function(){if(r.index>=r.blocks.length)return!1;var o=r.blocks[r.index++];return e.drawImage(t.canvas,o.left,o.top,o.width,o.height,r.left+o.left+o.marginLeft,r.top+o.top+o.marginTop,o.width,o.height),!0};if(0==r.time)for(;a(););else core.status.event.interval=setInterval((function(){a()||(clearInterval(core.status.event.interval),core.status.event.interval=null)}),r.time);return r},ui.prototype._drawTextContent_next=function(e,t,o){if(o.index>=t.length)return this._drawTextContent_newLine(e,o),!1;var r=t.charAt(o.index++);return this._drawTextContent_drawChar(e,t,o,r)},ui.prototype._drawTextContent_drawChar=function(e,t,o,r){if("\n"==r||"\\"==r&&"n"==t.charAt(o.index))return this._drawTextContent_newLine(e,o),"\\"==r&&o.index++,this._drawTextContent_next(e,t,o);if("\r"==r||"\\"==r&&"r"==t.charAt(o.index))return"\\"==r&&o.index++,this._drawTextContent_changeColor(e,t,o);if("\\"==r){var a=t.charAt(o.index);if("i"==a)return this._drawTextContent_drawIcon(e,t,o);if("c"==a)return this._drawTextContent_changeFont(e,t,o);if("d"==a||"e"==a)return o.index++,"d"==a&&(o.bold=!o.bold),"e"==a&&(o.italic=!o.italic),e.font=this._buildFont(o.currfont,o.bold,o.italic),!0}"\\"==r&&"e"==t.charAt(o.index)&&(o.italic=!o.italic,e.font=this._buildFont(o.fontSize,o.bold,o.italic));var n=core.calWidth(e,r)+o.interval;if(null!=o.maxWidth&&o.offsetX+n>o.maxWidth)return this._drawTextContent_newLine(e,o),o.index--,this._drawTextContent_next(e,t,o);var i=o.offsetX,s=o.offsetY+o.topMargin;return core.fillText(e,r,i,s),o.blocks.push({left:o.offsetX,top:o.offsetY,width:n,height:o.currfont+o.lineMargin,line:o.line,marginLeft:0}),o.offsetX+=n,!0},ui.prototype._drawTextContent_newLine=function(e,t){var o=t.offsetX,r=t.right-t.left,a=0;"center"==t.align?a=(r-o)/2:"right"==t.align&&(a=r-o),t.blocks.forEach((function(e){e.line==t.line&&(e.marginLeft=a,e.marginTop=(t.lineMaxHeight-e.height)/2)})),t.offsetX=0,t.offsetY+=t.lineMaxHeight,t.lineMaxHeight=t.currfont+t.lineMargin,t.line++},ui.prototype._drawTextContent_changeColor=function(e,t,o){var r,a=o.index;if("["==t.charAt(a)&&(r=t.indexOf("]",a))>=0){var n=t.substring(a+1,r);e.fillStyle=""==n?o.color:n,o.index=r+1}else e.fillStyle=o.color;return this._drawTextContent_next(e,t,o)},ui.prototype._drawTextContent_changeFont=function(e,t,o){o.index++;var r,a=o.index;if("["==t.charAt(a)&&(r=t.indexOf("]",a))>=0){var n=t.substring(a+1,r);/^\d+$/.test(n)?o.currfont=parseInt(n):o.currfont=o.fontSize,o.index=r+1}else o.currfont=o.fontSize;return o.lineMaxHeight=Math.max(o.lineMaxHeight,o.currfont+o.lineMargin),e.font=this._buildFont(o.currfont,o.bold,o.italic),this._drawTextContent_next(e,t,o)},ui.prototype._drawTextContent_drawIcon=function(e,t,o){var r,a=o.index;if("["==t.charAt(o.index+1)&&(r=t.indexOf("]",a+1))>=0){var n=t.substring(a+2,r),i=core.ui._getDrawableIconInfo(n),s=i[0],c=i[1];if(null==s)return this._drawTextContent_next(e,t,o);var l=o.currfont+2,u=o.offsetX+2,p=o.offsetY+o.topMargin-1;return null!=o.maxWidth&&u+l>o.maxWidth?(this._drawTextContent_newLine(e,o),o.index--,this._drawTextContent_next(e,t,o)):(core.drawImage(e,s,0,32*c,32,32,u,p,l,l),o.blocks.push({left:u,top:o.offsetY,width:l,height:l+o.lineMargin,line:o.line,marginLeft:0}),o.offsetX+=l+6,o.index=r+1,!0)}return this._drawTextContent_next(e,t,o)},ui.prototype.getTextContentHeight=function(e,t){return this.drawTextContent(null,e,t).offsetY},ui.prototype._getRealContent=function(e){return e.replace(/(\r|\\(r|c|d|e))(\[.*?])?/g,"").replace(/(\\i)(\[.*?])?/g,"占1")},ui.prototype.drawTextBox=function(e,t){core.status.event&&"action"==core.status.event.id&&(core.status.event.ui=e),this.clearUI(),e=core.replaceText(e);var o=core.status.textAttribute,r=this._getTitleAndIcon(e),a=this._getPosition(r.content);"up"!=a.position&&"down"!=a.position&&(a.px=a.py=null),a.position||(a.position=o.position),e=this._drawTextBox_drawImages(a.content);var n=this._drawTextBox_getHorizontalPosition(e,r,a),i=this._drawTextBox_getVerticalPosition(e,r,a,n.validWidth),s=core.clone(a);s.xoffset=n.xoffset,s.yoffset=i.yoffset-4;var c=this.drawBackground(n.left,i.top,n.right,i.bottom,s)?this._drawWindowSkin_getOpacity():o.background[3],l=this._drawTextBox_drawTitleAndIcon(r,n,i,c),u=this.drawTextContent("ui",e,{left:n.content_left,top:l,maxWidth:n.validWidth,lineHeight:i.lineHeight,time:t||o.time<=0||"action"!=core.status.event.id?0:o.time}),p=(n.left+n.right)/2;return"up"==s.position&&!s.noPeak&&null!=s.px&&Math.abs(32*s.px+16-p)<50&&(p=n.right-64),u},ui.prototype._drawTextBox_drawImages=function(e){return e.replace(/(\f|\\f)\[(.*?)]/g,(function(e,t,o){var r=o.split(",");if(3!=r.length&&5!=r.length&&9!=r.length)return"";r[0]=core.getMappedName(r[0]);var a=core.material.images.images[r[0]];return a?(3==r.length?core.drawImage("ui",a,parseFloat(r[1]),parseFloat(r[2])):5==r.length?core.drawImage("ui",a,0,0,a.width,a.height,parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3]),parseFloat(r[4])):9!=r.length&&10!=r.length||(10==r.length&&core.setAlpha("ui",parseFloat(r[9])),core.drawImage("ui",a,parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3]),parseFloat(r[4]),parseFloat(r[5]),parseFloat(r[6]),parseFloat(r[7]),parseFloat(r[8])),core.setAlpha("ui",1)),""):""}))},ui.prototype._drawTextBox_getHorizontalPosition=function(e,t,o){var r=this._getRealContent(e),a=25;null!=o.px&&null!=o.py&&(a=20),null!=t.icon?a=62:t.image&&(a=90);var n=7+3*(this.HSIZE-6),i=this.PIXEL-n,s=i-n,c=s-a-12;if(null!=o.px&&null!=o.py){var l=220-a,u=c;null==t.image&&(l=160),s=(c=this._calTextBoxWidth("ui",r,l,u,this._buildFont()))+a+12,i=(n=core.clamp(32*o.px+16-s/2-core.bigmap.offsetX,n,i-s))+s}return{left:n,right:i,width:s,validWidth:c,xoffset:11,content_left:n+a}},ui.prototype._drawTextBox_getVerticalPosition=function(e,t,o,r){var a=core.status.textAttribute||core.initStatus.textAttribute,n=a.textfont+6,i=45+this.getTextContentHeight(e,{lineHeight:n,maxWidth:r});t.title&&(i+=a.titlefont+5),null!=t.icon?i=t.title?Math.max(i,t.height+50):Math.max(i,t.height+30):t.image&&(i=Math.max(i,90));var s=parseInt((this.PIXEL-i)/2);switch(o.position){case"center":s=parseInt((this.PIXEL-i)/2);break;case"up":s=null==o.px||null==o.py?5+a.offset:32*o.py-i-(t.height-32)-16-core.bigmap.offsetY;break;case"down":s=null==o.px||null==o.py?this.PIXEL-i-5-a.offset:32*o.py+32+16-core.bigmap.offsetY}return{top:s,height:i,bottom:s+i,yoffset:16,lineHeight:n}},ui.prototype._drawTextBox_drawTitleAndIcon=function(e,t,o,r){core.setTextAlign("ui","left");var a=core.status.textAttribute,n=o.top+15,i=o.top+15;if(null!=e.title){var s=a.titlefont;n+=s+5,i=o.top+40,core.setFillStyle("ui",core.arrayToRGB(a.title)),core.setStrokeStyle("ui",core.arrayToRGB(a.title));var c=core.calWidth("ui",e.title,this._buildFont(s,!0)),l=t.content_left;"center"==a.align?l=t.left+(t.width-c)/2:"right"==a.align&&(l=t.right-c-12),core.fillText("ui",e.title,l,o.top+8+s)}return null!=e.icon&&(core.setAlpha("ui",r),core.strokeRect("ui",t.left+15-1,i-1,34,e.height+2,null,2),core.setAlpha("ui",1),core.status.boxAnimateObjs=[],e.image==core.material.images.hero?(core.clearMap("ui",t.left+15,i,32,e.height),core.fillRect("ui",t.left+15,i,32,e.height,core.material.groundPattern),core.drawImage("ui",e.image,0,0,core.material.icons.hero.width||32,core.material.icons.hero.height,t.left+15,i,32,e.height)):core.status.boxAnimateObjs.push({bgx:t.left+15,bgy:i,bgWidth:32,bgHeight:e.height,x:t.left+15,y:i,height:e.height,animate:e.animate,image:e.image,pos:e.icon*e.height}),core.drawBoxAnimate()),null!=e.image&&null==e.icon&&core.drawImage("ui",e.image,0,0,e.image.width,e.image.height,t.left+10,o.top+10,70,70),n},ui.prototype._createTextCanvas=function(e,t){var o=this.PIXEL,r=30+this.getTextContentHeight(e,{lineHeight:t}),a=document.createElement("canvas").getContext("2d");return a.canvas.width=o,a.canvas.height=r,a.clearRect(0,0,o,r),a},ui.prototype.drawScrollText=function(e,t,o,r){e=core.replaceText(e||""),o=o||1.4,t=t||5e3,this.clearUI();var a=core.status.textAttribute.offset||15;o*=core.status.textAttribute.textfont;var n=this._createTextCanvas(e,o),i={align:core.status.textAttribute.align,lineHeight:o};"right"==i.align?i.left=this.PIXEL-a:"center"!=i.align&&(i.left=a),this.drawTextContent(n,e,i),this._drawScrollText_animate(n,t,r)},ui.prototype._drawScrollText_animate=function(e,t,o){t/=Math.max(core.status.replay.speed,1);var r=e.canvas.height,a=1*t/(this.PIXEL+r),n=this.PIXEL;core.drawImage("ui",e.canvas,0,n);var i=setInterval((function(){if(core.clearMap("ui"),(n-=1)<-r)return delete core.animateFrame.asyncId[i],clearInterval(i),void(o&&o());core.drawImage("ui",e.canvas,0,n)}),a);core.animateFrame.asyncId[i]=!0},ui.prototype.textImage=function(e,t){e=core.replaceText(e||""),t=t||1.4,t*=core.status.textAttribute.textfont;var o=this._createTextCanvas(e,t);return this.drawTextContent(o,e,{align:core.status.textAttribute.align,lineHeight:t}),o.canvas},ui.prototype.drawChoices=function(e,t){t=core.clone(t||[]),core.status.event.ui={text:e,choices:t},this.clearUI(),e=core.replaceText(e||"");var o=this._getTitleAndIcon(e);o.content=this._drawTextBox_drawImages(o.content);var r=this._drawChoices_getHorizontalPosition(o,t),a=this._drawChoices_getVerticalPosition(o,t,r);core.status.event.ui.offset=a.offset;var n=this.drawBackground(r.left,a.top,r.right,a.bottom);this._drawChoices_drawTitle(o,r,a),this._drawChoices_drawChoices(t,n,r,a)},ui.prototype._drawChoices_getHorizontalPosition=function(e,t){var o=246;core.setFont("ui",this._buildFont(17,!0));for(var r=0;r<t.length;r++)"string"==typeof t[r]&&(t[r]={text:t[r]}),t[r].text=core.replaceText(t[r].text),t[r].width=core.calWidth("ui",core.replaceText(t[r].text)),null!=t[r].icon&&(t[r].width+=28),o=Math.max(o,t[r].width+30);var a=(this.PIXEL-o)/2,n=a+o,i=a+(null==e.icon?15:60);return{left:a,right:n,width:o,content_left:i,validWidth:n-i-10}},ui.prototype._drawChoices_getVerticalPosition=function(e,t,o){var r=t.length,a=32*(r+2),n=this.HPIXEL+a/2;r%2==0&&(n+=16);var i=0,s=n-a+56;if(e.content){var c=0;e.title&&(c+=25),n-(a+=c+=this.getTextContentHeight(e.content,{lineHeight:20,maxWidth:o.validWidth,fontSize:15,bold:!0}))<=32&&(n+=32*(i=Math.floor(c/64)),s+=32*i)}return{top:n-a,height:a,bottom:n,choice_top:s,offset:i}},ui.prototype._drawChoices_drawTitle=function(e,t,o){if(e.content){var r=o.top+21;if(null!=e.title){core.setTextAlign("ui","center"),r=o.top+41;var a=t.left+t.width/2;null!=e.icon&&(a+=12,core.strokeRect("ui",t.left+15-1,o.top+30-1,34,e.height+2,"#DDDDDD",2),core.status.boxAnimateObjs=[],core.status.boxAnimateObjs.push({bgx:t.left+15,bgy:o.top+30,bgWidth:32,bgHeight:e.height,x:t.left+15,y:o.top+30,height:e.height,animate:e.animate,image:e.image,pos:e.icon*e.height}),core.drawBoxAnimate()),core.fillText("ui",e.title,a,o.top+27,core.arrayToRGBA(core.status.textAttribute.title),this._buildFont(19,!0))}core.setTextAlign("ui","left"),this.drawTextContent("ui",e.content,{left:t.content_left,top:r,maxWidth:t.validWidth,fontSize:15,lineHeight:20,bold:!0})}},ui.prototype._drawChoices_drawChoices=function(e,t,o,r){core.setTextAlign("ui","center"),core.setFont("ui",this._buildFont(17,!0));for(var a=0;a<e.length;a++){var n=e[a].color||core.status.textAttribute.text;n instanceof Array&&(n=core.arrayToRGBA(n)),core.setFillStyle("ui",n);var i=this.HPIXEL;if(e[a].icon){var s=this._getDrawableIconInfo(e[a].icon),c=s[0],l=s[1];null!=c&&(core.drawImage("ui",c,0,32*l,32,32,this.HPIXEL-e[a].width/2,r.choice_top+32*a-17,22,22),i+=14)}core.fillText("ui",e[a].text,i,r.choice_top+32*a,n)}if(e.length>0){for(core.status.event.selection=core.status.event.selection||0;core.status.event.selection<0;)core.status.event.selection+=e.length;for(;core.status.event.selection>=e.length;)core.status.event.selection-=e.length;var u=e[core.status.event.selection].width;t?this.drawWindowSelector(core.status.textAttribute.background,this.HPIXEL-u/2-5,r.choice_top+32*core.status.event.selection-20,u+10,28):core.strokeRect("ui",this.HPIXEL-u/2-5,r.choice_top+32*core.status.event.selection-20,u+10,28,"#FFD700",2)}},ui.prototype.drawConfirmBox=function(e,t,o){core.lockControl(),e=core.replaceText(e||""),"action"!=core.status.event.id&&(core.status.event.id="confirmBox",core.status.event.ui=e,core.status.event.data={yes:t,no:o}),0!=core.status.event.selection&&(core.status.event.selection=1),this.clearUI(),core.setFont("ui",this._buildFont(19,!0));var r=e.split("\n"),a=this._drawConfirmBox_getRect(r),n=this.drawBackground(a.left,a.top,a.right,a.bottom);for(var i in core.setTextAlign("ui","center"),core.setFillStyle("ui",core.arrayToRGBA(core.status.textAttribute.text)),r)core.fillText("ui",r[i],this.HPIXEL,a.top+50+30*i);core.fillText("ui","确定",this.HPIXEL-38,a.bottom-35,null,this._buildFont(17,!0)),core.fillText("ui","取消",this.HPIXEL+38,a.bottom-35);var s=core.calWidth("ui","确定"),c=this.HPIXEL+(76*core.status.event.selection-38)-parseInt(s/2)-5;n?this.drawWindowSelector(core.status.textAttribute.background,c,a.bottom-35-20,s+10,28):core.strokeRect("ui",c,a.bottom-35-20,s+10,28,"#FFD700",2)},ui.prototype._drawConfirmBox_getRect=function(e){var t=e.reduce((function(e,t){return Math.max(e,core.calWidth("ui",t))}),0),o=Math.min(this.HPIXEL-40-parseInt(t/2),100),r=this.PIXEL-o,a=this.HPIXEL-68-30*(e.length-1),n=this.HPIXEL+68;return{top:a,left:o,bottom:n,right:r,width:r-o,height:n-a}},ui.prototype.drawWaiting=function(e){core.lockControl(),core.status.event.id="waiting",core.clearUI(),e=core.replaceText(e||"");var t=core.calWidth("ui",e,this._buildFont(19,!0)),o=Math.max(t+80,220),r=this.HPIXEL-parseInt(o/2),a=r+o,n=this.HPIXEL-48,i=n+96;this.drawBackground(r,n,a,i),core.setTextAlign("ui","center"),core.fillText("ui",e,this.HPIXEL,n+56,core.arrayToRGBA(core.status.textAttribute.text))},ui.prototype.drawSwitchs=function(){core.status.event.id="switchs";var e=["背景音乐： "+(core.musicStatus.bgmStatus?"[ON]":"[OFF]"),"背景音效： "+(core.musicStatus.soundStatus?"[ON]":"[OFF]")," <     音量："+Math.round(Math.sqrt(100*core.musicStatus.userVolume))+"     > "," <   步时："+core.values.moveSpeed+"   > ","怪物显伤： "+(core.flags.displayEnemyDamage?"[ON]":"[OFF]"),"临界显伤： "+(core.flags.displayCritical?"[ON]":"[OFF]"),"领域显伤： "+(core.flags.displayExtraDamage?"[ON]":"[OFF]"),"新版存档： "+(core.platform.useLocalForage?"[ON]":"[OFF]"),"单击瞬移： "+(core.hasFlag("__noClickMove__")?"[OFF]":"[ON]"),"返回主菜单"];this.drawChoices(null,e)},ui.prototype.drawSettings=function(){core.status.event.id="settings",this.drawChoices(null,["系统设置","虚拟键盘","浏览地图","绘图模式","同步存档","游戏信息","返回标题","返回游戏"])},ui.prototype.drawQuickShop=function(){core.status.event.id="selectShop";var e=core.status.shops,t=Object.keys(e).filter((function(t){return e[t].visited||!e[t].mustEnable})).map((function(t){return{text:e[t].textInList,color:e[t].visited?null:"#999999"}}));t.push("返回游戏"),this.drawChoices(null,t)},ui.prototype.drawSyncSave=function(){core.status.event.id="syncSave",this.drawChoices(null,["同步存档到服务器","从服务器加载存档","存档至本地文件","从本地文件读档","回放和下载录像","清空本地存档","返回主菜单"])},ui.prototype.drawSyncSelect=function(){core.status.event.id="syncSelect",this.drawChoices(null,["同步本地所有存档","只同步当前单存档","返回上级菜单"])},ui.prototype.drawLocalSaveSelect=function(){core.status.event.id="localSaveSelect",this.drawChoices(null,["下载所有存档","只下载当前单存档","返回上级菜单"])},ui.prototype.drawStorageRemove=function(){core.status.event.id="storageRemove",this.drawChoices(null,["清空全部塔的存档","只清空当前塔的存档","返回上级菜单"])},ui.prototype.drawReplay=function(){core.lockControl(),core.status.event.id="replay",this.drawChoices(null,["从头回放录像","从存档开始回放","接续播放剩余录像","选择录像文件","下载当前录像","返回游戏"])},ui.prototype.drawGameInfo=function(){core.status.event.id="gameInfo",this.drawChoices(null,["数据统计","查看工程","游戏主页","操作帮助","关于本塔","下载离线版本","返回主菜单"])},ui.prototype.drawPagination=function(e,t,o){if(!(t<=1)){null==o&&(o=this.LAST),core.setFillStyle("ui","#DDDDDD");var r=core.calWidth("ui",e+" / "+e,this._buildFont(15,!0));core.setTextAlign("ui","left"),core.fillText("ui",e+" / "+t,parseInt((this.PIXEL-r)/2),32*o+19),core.setTextAlign("ui","center"),e>1&&core.fillText("ui","上一页",this.HPIXEL-80,32*o+19),e<t&&core.fillText("ui","下一页",this.HPIXEL+80,32*o+19)}},ui.prototype.drawCursor=function(){var e=core.status.automaticRoute;null==e.cursorX&&(e.cursorX=core.getHeroLoc("x")),null==e.cursorY&&(e.cursorY=core.getHeroLoc("y")),e.cursorX=core.clamp(e.cursorX,0,this.LAST),core.status.event.id="cursor",core.lockControl(),core.clearUI();core.strokeRect("ui",32*e.cursorX+2,32*e.cursorY+2,28,28,"#FFD700",4)},ui.prototype.drawBook=function(e){var t=core.floorIds[(core.status.event.ui||{}).index]||core.status.floorId,o=core.enemys.getCurrentEnemys(t);if(core.clearUI(),core.clearMap("data"),this._drawBook_drawBackground(),core.setAlpha("ui",1),0==o.length)return core.setTextAlign("ui","center"),core.fillText("ui","本层无怪物",this.HPIXEL,this.HPIXEL+14,"#999999",this._buildFont(50,!0)),void core.fillText("ui","返回游戏",this.PIXEL-46,this.PIXEL-13,"#DDDDDD",this._buildFont(15,!0));e=core.clamp(e,0,o.length-1),core.status.event.data=e;var r=this._drawBook_pageinfo(),a=r.per_page,n=parseInt(e/a)+1,i=Math.ceil(o.length/a),s=(n-1)*a;o=o.slice(s,n*a);for(var c=0;c<o.length;c++)this._drawBook_drawOne(t,c,o[c],r,e==s+c);core.drawBoxAnimate(),this.drawPagination(n,i),core.setTextAlign("ui","center"),core.fillText("ui","返回游戏",this.PIXEL-46,this.PIXEL-13,"#DDDDDD",this._buildFont(15,!0))},ui.prototype._drawBook_pageinfo=function(){var e=this.HSIZE;return{per_page:e,padding_top:12,per_height:(this.PIXEL-32-12)/e}},ui.prototype._drawBook_drawBackground=function(){core.setAlpha("ui",.8),core.setFillStyle("ui","#000000"),core.fillRect("ui",0,0,this.PIXEL,this.PIXEL)},ui.prototype._drawBook_drawOne=function(e,t,o,r,a){var n=r.per_height*t+r.padding_top;this._drawBook_drawBox(t,o,n,r);var i=10*(this.PIXEL-64)/35;this._drawBook_drawName(t,o,n,64,i),this._drawBook_drawContent(t,o,n,64+i),a&&core.strokeRect("ui",10,n+1,this.PIXEL-20,r.per_height,"#FFD700")},ui.prototype._drawBook_drawBox=function(e,t,o,r){var a=o+(r.per_height-42)/2,n=a+5;core.strokeRect("ui",22,a,42,42,"#DDDDDD",2);var i=core.getBlockInfo(t.id);this.drawImage("ui",i.texture,27,n)},ui.prototype._drawBook_drawName=function(e,t,o,r,a){core.setTextAlign("ui","center"),""==t.specialText?core.fillText("ui",t.name,r+a/2,o+35,"#DDDDDD",this._buildFont(17,!0),a):(core.fillText("ui",t.name,r+a/2,o+28,"#DDDDDD",this._buildFont(17,!0),a),core.fillText("ui",t.specialText,r+a/2,o+50,"#FF6A6A",this._buildFont(15,!0),a))},ui.prototype._drawBook_drawContent=function(e,t,o,r){var a=this.PIXEL-r;this._drawBook_drawRow1(e,t,o,r,a,o+20),this._drawBook_drawRow2(e,t,o,r,a,o+38),this._drawBook_drawRow3(e,t,o,r,a,o+56)},ui.prototype._drawBook_drawRow1=function(e,t,o,r,a,n){core.setTextAlign("ui","left");var i=this._buildFont(13,!0),s=this._buildFont(13,!1),c=r,l=r+9*a/25,u=r+17*a/25;core.fillText("ui","生命",c,n,"#DDDDDD",s),core.fillText("ui",core.formatBigNumber(t.hp||0),c+30,n,null,i),core.fillText("ui","攻击",l,n,null,s),core.fillText("ui",core.formatBigNumber(t.atk||0),l+30,n,null,i),core.fillText("ui","防御",u,n,null,s),core.fillText("ui",core.formatBigNumber(t.def||0),u+30,n,null,i)},ui.prototype._drawBook_drawRow2=function(e,t,o,r,a,n){core.setTextAlign("ui","left");var i=this._buildFont(13,!0),s=this._buildFont(13,!1),c=r,l=r+9*a/25,u=r+17*a/25,p=[];core.flags.enableMoney&&p.push(["金币",core.formatBigNumber(t.money||0)]),core.flags.enableAddPoint&&p.push(["加点",core.formatBigNumber(t.point||0)]),core.flags.enableExperience&&p.push(["经验",core.formatBigNumber(t.experience||0)]);var d=c+(this.PIXEL-c)/2-12;if(p.length>0){var f=p.shift();core.fillText("ui",f[0],c,n,"#DDDDDD",s),core.fillText("ui",f[1],c+30,n,null,i),d=l+(this.PIXEL-l)/2-12}if(p.length>0){f=p.shift();core.fillText("ui",f[0],l,n,"#DDDDDD",s),core.fillText("ui",f[1],l+30,n,null,i),d=u+(this.PIXEL-u)/2-12}this._drawBook_drawDamage(e,t,d,n)},ui.prototype._drawBook_drawRow3=function(e,t,o,r,a,n){core.setTextAlign("ui","left");var i=this._buildFont(13,!0),s=this._buildFont(13,!1),c=r,l=r+9*a/25,u=r+17*a/25;core.fillText("ui","临界",c,n,"#DDDDDD",s),core.fillText("ui",core.formatBigNumber(t.critical||0),c+30,n,null,i),core.fillText("ui","减伤",l,n,null,s),core.fillText("ui",core.formatBigNumber(t.criticalDamage||0),l+30,n,null,i),core.fillText("ui","1防",u,n,null,s),core.fillText("ui",core.formatBigNumber(t.defDamage||0),u+30,n,null,i)},ui.prototype._drawBook_drawDamage=function(e,t,o,r){core.setTextAlign("ui","center");var a=t.damage,n="#FFFF00";null==a?(a="无法战斗",n="#FF0000"):(a>=core.status.hero.hp&&(n="#FF0000"),a<=0&&(n="#00FF00"),a=core.formatBigNumber(a),core.enemys.hasSpecial(t,19)&&(a+="+"),core.enemys.hasSpecial(t,21)&&(a+="-"),core.enemys.hasSpecial(t,11)&&(a+="^")),t.notBomb&&(a+="[b]"),core.fillText("ui",a,o,r,n,this._buildFont(13,!0))},ui.prototype.drawBookDetail=function(e){var t=this._drawBookDetail_getInfo(e),o=t[0];if(o){var r=t[1].join("\n");core.status.event.id="book-detail",core.clearTip(),core.clearMap("data");var a=this.PIXEL-20,n=10+a-35-13,i=core.splitLines("data",r,n,this._buildFont(16,!1)),s=Math.max(24*i.length+55,80),c=(this.PIXEL-s)/2,l=c+s;core.setAlpha("data",.9),core.fillRect("data",10,c,a,s,"#000000"),core.setAlpha("data",1),core.strokeRect("data",9,c-1,a+1,s+1,core.status.globalAttribute.borderColor,2),this._drawBookDetail_drawContent(o,i,{top:c,content_left:35,bottom:l})}},ui.prototype._drawBookDetail_getInfo=function(e){var t=core.floorIds[(core.status.event.ui||{}).index]||core.status.floorId,o=core.enemys.getCurrentEnemys(t);if(0==o.length)return[];var r=o[e=core.clamp(e,0,o.length-1)],a=r.id,n=core.enemys.getSpecialHint(a);return 0==n.length&&n.push("该怪物无特殊属性。"),n.push(""),this._drawBookDetail_getTexts(r,t,n),[r,n]},ui.prototype._drawBookDetail_getTexts=function(e,t,o){this._drawBookDetail_mofang(e,o),this._drawBookDetail_vampire(e,o),this._drawBookDetail_hatred(e,o),this._drawBookDetail_turnAndCriticals(e,t,o)},ui.prototype._drawBookDetail_mofang=function(e,t){if(core.enemys.hasSpecial(e.special,10)){var o=e.hp,r=core.status.hero.atk-core.status.hero.def;if(r<o&&o<=1e4&&o>0){t.push("模仿临界计算器：（当前攻防差"+core.formatBigNumber(r)+"）");var a=[];this._drawBookDetail_mofang_getArray(o).forEach((function(e){a.length<20?a.push(e):Math.abs(e[0]-r)<Math.abs(a[0][0]-r)&&(a.shift(),a.push(e))})),t.push(JSON.stringify(a.map((function(e){return core.formatBigNumber(e[0])+":"+e[1]}))))}}},ui.prototype._drawBookDetail_mofang_getArray=function(e){for(var t=[],o=0,r=0,a=1;a<e;a++){var n=parseInt((e-1)/a);n!=o&&(0!=o&&t.push([r,o+"x"]),o=n,r=a)}return 0!=o&&(t.push([r,"1x"]),t.push([e,"0"])),t},ui.prototype._drawBookDetail_vampire=function(e,t){if(core.enemys.hasSpecial(e.special,11)){var o=core.getDamage(e.id);if(null!=o){for(var r=1,a=100*o,n=core.status.hero.hp;r<a;){var i=Math.floor((r+a)/2);core.status.hero.hp=i,core.canBattle(e.id)?a=i:r=i+1}core.status.hero.hp=r,core.canBattle(e.id)&&t.push("打死该怪物最低需要生命值："+core.formatBigNumber(r)),core.status.hero.hp=n}}},ui.prototype._drawBookDetail_hatred=function(e,t){core.enemys.hasSpecial(e.special,17)&&t.push("当前仇恨伤害值："+core.getFlag("hatred",0))},ui.prototype._drawBookDetail_turnAndCriticals=function(e,t,o){var r=core.getDamageInfo(e,null,null,null,t);o.push("战斗回合数："+((r||{}).turn||0));for(var a=core.enemys.nextCriticals(e,8,null,null,t).map((function(e){return core.formatBigNumber(e[0])+":"+core.formatBigNumber(e[1])}));"0:0"==a[0];)a.shift();o.push("临界表："+JSON.stringify(a));var n=core.getDamageInfo(e,{atk:core.status.hero.atk-1},null,null,t);null!=n&&null!=r&&(null!=r.damage&&(r=r.damage),null!=n.damage&&(n=n.damage),n>r&&o.push("（当前攻击力正位于临界点上）"))},ui.prototype._drawBookDetail_drawContent=function(e,t,o){core.setTextAlign("data","left"),core.fillText("data",e.name,o.content_left,o.top+30,"#FFD700",this._buildFont(22,!0));for(var r=o.top+57,a=0;a<t.length;a++){var n=t[a],i=n.indexOf("：");if(i>=0){var s=n.substring(0,i+1);core.fillText("data",s,o.content_left,r,"#FF6A6A",this._buildFont(16,!0));var c=core.calWidth("data",s);core.fillText("data",n.substring(i+1),o.content_left+c,r,"#FFFFFF",this._buildFont(16,!1))}else core.fillText("data",t[a],o.content_left,r,"#FFFFFF",this._buildFont(16,!1));r+=24}},ui.prototype.drawFly=function(e){core.status.event.data=e;var t=core.floorIds[e],o=core.status.maps[t].title;core.clearMap("ui"),core.setAlpha("ui",.85),core.fillRect("ui",0,0,this.PIXEL,this.PIXEL,"#000000"),core.setAlpha("ui",1),core.setTextAlign("ui","center"),core.fillText("ui","楼层跳跃",this.HPIXEL,60,"#FFFFFF",this._buildFont(28,!0)),core.fillText("ui","返回游戏",this.HPIXEL,this.PIXEL-13,null,this._buildFont(15,!0));var r=this.HPIXEL+39,a=core.splitLines("ui",o,120,this._buildFont(19,!0)),n=r-11*(a.length-1);for(var i in a)core.fillText("ui",a[i],this.PIXEL-60,n),n+=22;core.actions._getNextFlyFloor(1)!=e&&(core.fillText("ui","▲",this.PIXEL-60,r-64,null,this._buildFont(17,!1)),core.fillText("ui","▲",this.PIXEL-60,r-96),core.fillText("ui","▲",this.PIXEL-60,r-96-7)),core.actions._getNextFlyFloor(-1)!=e&&(core.fillText("ui","▼",this.PIXEL-60,r+64,null,this._buildFont(17,!1)),core.fillText("ui","▼",this.PIXEL-60,r+96),core.fillText("ui","▼",this.PIXEL-60,r+96+7));var s=this.PIXEL-143;core.strokeRect("ui",20,100,s,s,"#FFFFFF",2),core.drawThumbnail(t,null,null,{ctx:"ui",x:20,y:100,size:s})},ui.prototype.drawCenterFly=function(){core.lockControl(),core.status.event.id="centerFly";var e="rgba(255,0,0,0.5)";core.canUseItem("centerFly")&&(e="rgba(0,255,0,0.5)");var t=core.bigmap.width-1-core.getHeroLoc("x"),o=core.bigmap.height-1-core.getHeroLoc("y");core.drawThumbnail(null,null,{heroLoc:core.status.hero.loc,heroIcon:core.getFlag("heroIcon","hero.png")},{ctx:"ui",centerX:t,centerY:o});var r=core.clamp(t-core.__HALF_SIZE__,0,core.bigmap.width-core.__SIZE__),a=core.clamp(o-core.__HALF_SIZE__,0,core.bigmap.height-core.__SIZE__);core.fillRect("ui",32*(t-r),32*(o-a),32,32,e),core.status.event.data={x:t,y:o,posX:t-r,posY:o-a},core.drawTip("请确认当前中心对称飞行器的位置")},ui.prototype.drawShop=function(e){var t=core.status.shops[e],o=[],r=(core.status.event.data||{}).fromList,a=core.status.event.selection;core.status.event.data&&core.status.event.data.actions&&(o=core.status.event.data.actions),core.ui.closePanel(),core.lockControl(),core.status.event.id="shop",core.status.event.data={id:e,shop:t,actions:o,fromList:r},core.status.event.selection=a;for(var n=t.times,i=core.calValue(t.need,null,null,n),s="\t["+t.name+","+t.icon+"]"+core.replaceText(t.text,i,n),c="experience"==t.use?"经验":"金币",l=[],u=0;u<t.choices.length;u++){var p=t.choices[u],d=core.replaceText(p.text,i,n);null!=p.need&&(d+="（"+core.calValue(p.need,null,null,n)+c+"）"),l.push({text:d,color:t.visited?null:"#999999"})}l.push("离开"),core.ui.drawChoices(s,l)},ui.prototype.drawMaps=function(e,t,o){if(core.lockControl(),core.status.event.id="viewMaps",this.clearUI(),null==e)return this._drawMaps_drawHint();core.status.checkBlock.cache={};var r=this._drawMaps_buildData(e,t,o);if(core.drawThumbnail(r.floorId,null,{damage:r.damage},{ctx:"ui",centerX:r.x,centerY:r.y,all:r.all}),r.paint){var a=32*(r.x-this.HSIZE),n=32*(r.y-this.HSIZE),i=core.paint[r.floorId];i&&(i=lzw_decode(i).split(",")),core.utils._decodeCanvas(i,32*r.mw,32*r.mh),core.drawImage("ui",core.bigmap.tempCanvas.canvas,32*a,32*n,this.PIXEL,this.PIXEL,0,0,this.PIXEL,this.PIXEL)}core.clearMap("data"),core.setTextAlign("data","left"),core.setFont("data","16px Arial");var s=core.status.maps[r.floorId].title;!r.all&&(r.mw>this.SIZE||r.mh>this.SIZE)&&(s+=" ["+(r.x-this.HSIZE)+","+(r.y-this.HSIZE)+"]");var c=16+core.calWidth("data",s)+16;core.fillRect("data",5,5,c,42,"rgba(0,0,0,0.4)"),core.fillText("data",s,21,33,"rgba(255,255,255,0.6)")},ui.prototype._drawMaps_drawHint=function(){core.fillRect("ui",0,0,this.PIXEL,this.PIXEL,"rgba(0,0,0,0.4)"),core.setTextAlign("ui","center");var e=function(e,t,o,r,a,n){core.strokeRect("ui",32*e+2,32*t+2,32*o-4,32*r-4,a,n)},t=this.HSIZE-4;e(t,0,9,t,"#FFD700",4),e(0,t,t,9),e(t,this.SIZE-t,9,t),e(this.SIZE-t,t,t,9),e(t,t,9,3),e(t,this.SIZE-t-3,9,3),e(0,0,t-1,t-1),e(this.SIZE-(t-1),0,t-1,t-1),e(0,this.SIZE-(t-1),t-1,t-1),core.setTextBaseline("ui","middle"),core.fillText("ui","上移地图 [W]",this.HPIXEL,16*t,"#FFD700","20px Arial"),core.fillText("ui","下移地图 [S]",this.HPIXEL,this.PIXEL-16*t),core.fillText("ui","V",16*(t-1),16*(t-1)),core.fillText("ui","Z",this.PIXEL-16*(t-1),16*(t-1)),core.fillText("ui","M",16*(t-1),this.PIXEL-16*(t-1));for(var o=this.HPIXEL-66,r=16*t,a=this.PIXEL-r,n=["左","移","地","图","[A]"],i=["右","移","地","图","[D]"],s=0;s<5;++s)core.fillText("ui",n[s],r,o+32*s),core.fillText("ui",i[s],a,o+32*s);core.fillText("ui","前张地图 [▲ / PGUP]",this.HPIXEL,32*t+48),core.fillText("ui","后张地图 [▼ / PGDN]",this.HPIXEL,this.PIXEL-(32*t+48)),core.fillText("ui","退出 [ESC / ENTER]",this.HPIXEL,this.HPIXEL),core.fillText("ui","[X] 可查看怪物手册",this.HPIXEL+77,this.HPIXEL+32,null,"13px Arial"),core.setTextBaseline("ui","alphabetic")},ui.prototype._drawMaps_buildData=function(e,t,o){var r=(core.status.event.data||{}).damage,a=(core.status.event.data||{}).paint,n=(core.status.event.data||{all:!0}).all;null!=e.damage&&(r=e.damage),null!=e.paint&&(a=e.paint),null!=e.all&&(n=e.all),null!=e.index&&(t=e.x,o=e.y,e=e.index),e=core.clamp(e,0,core.floorIds.length-1),null==r&&(r=!0);var i=core.floorIds[e],s=core.floors[i].width,c=core.floors[i].height;return null==t&&(t=parseInt(s/2)),null==o&&(o=parseInt(c/2)),t=core.clamp(t,this.HSIZE,s-this.HSIZE-1),o=core.clamp(o,this.HSIZE,c-this.HSIZE-1),core.status.event.data={index:e,x:t,y:o,floorId:i,mw:s,mh:c,damage:r,paint:a,all:n},core.status.event.data},ui.prototype.drawToolbox=function(e){var t=this._drawToolbox_getInfo(e);this._drawToolbox_drawBackground(),core.setAlpha("ui",1),core.setStrokeStyle("ui","#DDDDDD"),core.canvas.ui.lineWidth=2,core.canvas.ui.strokeWidth=2,core.setTextAlign("ui","right");var o=this.PIXEL-306;this._drawToolbox_drawLine(o,"消耗道具");var r=this.PIXEL-146;this._drawToolbox_drawLine(r,"永久道具"),this._drawToolbox_drawDescription(t,o),this._drawToolbox_drawContent(t,o,t.tools,t.toolsPage,!0),this.drawPagination(t.toolsPage,t.toolsTotalPage,this.LAST-5),this._drawToolbox_drawContent(t,r,t.constants,t.constantsPage),this.drawPagination(t.constantsPage,t.constantsTotalPage),core.setTextAlign("ui","center"),core.fillText("ui","[装备栏]",this.PIXEL-46,25,"#DDDDDD",this._buildFont(15,!0)),core.fillText("ui","返回游戏",this.PIXEL-46,this.PIXEL-13)},ui.prototype._drawToolbox_getInfo=function(e){core.status.event.data&&null!=core.status.event.data.toolsPage||(core.status.event.data={toolsPage:1,constantsPage:1,selectId:null});var t,o,r=Object.keys(core.status.hero.items.tools).sort(),a=Object.keys(core.status.hero.items.constants).sort(),n=core.status.event.data.toolsPage,i=core.status.event.data.constantsPage,s=Math.ceil(r.length/this.LAST),c=Math.ceil(a.length/this.LAST);return null==e&&(e=0==r.length&&a.length>0?this.LAST:0),core.status.event.selection=e,e<this.LAST?((t=e+(n-1)*this.LAST)>=r.length&&(t=Math.max(0,r.length-1)),o=r[t]):((t=e%this.LAST+(i-1)*this.LAST)>=a.length&&(t=Math.max(0,a.length-1)),o=a[t]),core.hasItem(o)||(o=null),core.status.event.data.selectId=o,{index:e,tools:r,constants:a,toolsPage:n,constantsPage:i,toolsTotalPage:s,constantsTotalPage:c,selectId:o}},ui.prototype._drawToolbox_drawBackground=function(){core.clearMap("ui"),core.setAlpha("ui",.85),core.fillRect("ui",0,0,this.PIXEL,this.PIXEL,"#000000")},ui.prototype._drawToolbox_drawLine=function(e,t){core.setFillStyle("ui","#DDDDDD"),core.canvas.ui.beginPath(),core.canvas.ui.moveTo(0,e),core.canvas.ui.lineTo(this.PIXEL,e),core.canvas.ui.stroke(),core.canvas.ui.beginPath(),core.canvas.ui.moveTo(this.PIXEL,e-1),core.canvas.ui.lineTo(this.PIXEL,e-25),core.canvas.ui.lineTo(this.PIXEL-72,e-25),core.canvas.ui.lineTo(this.PIXEL-102,e-1),core.canvas.ui.fill(),core.fillText("ui",t,this.PIXEL-5,e-6,"#333333",this._buildFont(16,!0))},ui.prototype._drawToolbox_drawDescription=function(e,t){if(core.setTextAlign("ui","left"),e.selectId){var o=core.material.items[e.selectId];core.fillText("ui",o.name,10,32,"#FFD700",this._buildFont(20,!0));var r=o.text||"该道具暂无描述。";try{r=core.replaceText(r)}catch(e){}for(var a=17;a>=14;a-=3){var n=core.splitLines("ui",r,this.PIXEL-15,this._buildFont(a,!1)),i=parseInt(1.4*a),s=37+i;if(s+n.length*i<t)break}core.setFillStyle("ui","#FFFFFF");for(var c=0;c<n.length&&(core.fillText("ui",n[c],10,s),!((s+=i)>=t));++c);s<t&&core.fillText("ui","<继续点击该道具即可进行使用>",10,s,"#CCCCCC",this._buildFont(14,!1))}},ui.prototype._drawToolbox_drawContent=function(e,t,o,r,a){core.setTextAlign("ui","right");for(var n=0;n<this.LAST;n++){var i=o[this.LAST*(r-1)+n];if(i){var s=t+54*Math.floor(n/this.HSIZE)+19;core.drawImage("ui",i,n%this.HSIZE*64+21,s,32,32),a&&core.fillText("ui",core.itemCount(i),n%this.HSIZE*64+56,s+33,"#FFFFFF",this._buildFont(14,!0)),e.selectId==i&&core.strokeRect("ui",n%this.HSIZE*64+17,s-4,40,40,"#FFD700")}}},ui.prototype.drawEquipbox=function(e){var t=this._drawEquipbox_getInfo(e);this._drawToolbox_drawBackground(),core.setAlpha("ui",1),core.setStrokeStyle("ui","#DDDDDD"),core.canvas.ui.lineWidth=2,core.canvas.ui.strokeWidth=2,core.setTextAlign("ui","right");var o=this.PIXEL-306;this._drawToolbox_drawLine(o,"当前装备");var r=this.PIXEL-146;this._drawToolbox_drawLine(r,"拥有装备"),this._drawEquipbox_description(t,o),this._drawEquipbox_drawEquiped(t,o),this._drawToolbox_drawContent(t,r,t.ownEquipment,t.page,!0),this.drawPagination(t.page,t.totalPage),core.setTextAlign("ui","center"),core.fillText("ui","[道具栏]",this.PIXEL-46,25,"#DDDDDD",this._buildFont(15,!0)),core.fillText("ui","返回游戏",this.PIXEL-46,this.PIXEL-13)},ui.prototype._drawEquipbox_getInfo=function(e){core.status.event.data&&null!=core.status.event.data.page||(core.status.event.data={page:1,selectId:null});var t=core.status.globalAttribute.equipName,o=t.length;core.status.hero.equipment||(core.status.hero.equipment=[]);var r=core.status.hero.equipment,a=Object.keys(core.status.hero.items.equips).sort(),n=core.status.event.data.page,i=Math.ceil(a.length/this.LAST);null==e&&(e=o>0&&r[0]?0:a.length>0?this.LAST:0),e>=this.LAST&&0==a.length&&(e=0);var s=null;return e<this.LAST?(e>=o&&(e=Math.max(0,o-1)),s=r[e]||null):(n==i&&(e=Math.min(e,(a.length+this.LAST-1)%this.LAST+this.LAST)),s=a[e-this.LAST+(n-1)*this.LAST],core.hasItem(s)||(s=null)),core.status.event.selection=e,core.status.event.data.selectId=s,{index:e,selectId:s,page:n,totalPage:i,allEquips:t,equipLength:o,equipEquipment:r,ownEquipment:a}},ui.prototype._drawEquipbox_description=function(e,t){if(core.setTextAlign("ui","left"),e.selectId){var o=core.material.items[e.selectId];o.equip||(o.equip={type:0});var r,a=o.equip.type;"string"==typeof a?(r=a||"未知部位",a=core.items.getEquipTypeByName(a)):r=e.allEquips[a]||"未知部位",core.fillText("ui",o.name+"（"+r+"）",10,32,"#FFD700",this._buildFont(20,!0));var n=o.text||"该装备暂无描述。";try{n=core.replaceText(n)}catch(e){}for(var i=17;i>=11;i-=3){var s=core.splitLines("ui",n,this.PIXEL-15,this._buildFont(i,!1)),c=parseInt(1.4*i),l=37+c;if(l+s.length*c<t)break}core.setFillStyle("ui","#FFFFFF");for(var u=0;u<s.length&&(core.fillText("ui",s[u],10,l),!((l+=c)>=t));++u);l>=t||this._drawEquipbox_drawStatusChanged(e,l,o,a)}},ui.prototype._drawEquipbox_getStatusChanged=function(e,t,o,r){var a,n=null;if(e.index<this.LAST)a=core.compareEquipment(null,e.selectId);else if(o<0)n="<当前没有该装备的空位，请先卸下装备>";else{var i=core.material.items[e.equipEquipment[o]]||{};i.equip&&(i.equip.percentage||!1)!=(t.equip.percentage||!1)?n="<数值和比例模式之间的切换不显示属性变化>":a=core.compareEquipment(e.selectId,e.equipEquipment[o])}if(null==n)return a;core.fillText("ui",n,10,r,"#CCCCCC",this._buildFont(14,!1))},ui.prototype._drawEquipbox_drawStatusChanged=function(e,t,o,r){var a=this._drawEquipbox_getStatusChanged(e,o,r,t);if(null!=a){var n={drawOffset:10,y:t};for(var i in core.setFont("ui",this._buildFont(14,!0)),a){var s=core.statusBar.icons[i],c=core.getStatusName(i);s&&core.flags.iconInEquipbox?(core.drawImage("ui",s,0,0,32,32,n.drawOffset,n.y-13,16,16),n.drawOffset+=20):this._drawEquipbox_drawStatusChanged_draw(c+" ","#CCCCCC",n);var l=core.getStatus(i)*core.getBuff(i),u=(core.getStatus(i)+a[i])*core.getBuff(i);if(o.equip.percentage){var p=core.getBuff(i),d=p+a[i]/100;l=Math.floor(p*core.getStatus(i)),u=Math.floor(d*core.getStatus(i))}l=core.formatBigNumber(l),u=core.formatBigNumber(u),this._drawEquipbox_drawStatusChanged_draw(l+"->","#CCCCCC",n),this._drawEquipbox_drawStatusChanged_draw(u,a[i]>0?"#00FF00":"#FF0000",n),n.drawOffset+=8}}},ui.prototype._drawEquipbox_drawStatusChanged_draw=function(e,t,o){var r=core.calWidth("ui",e);o.drawOffset+r>=core.__PIXELS__&&(o.y+=19,o.drawOffset=10),core.fillText("ui",e,o.drawOffset,o.y,t),o.drawOffset+=r},ui.prototype._drawEquipbox_drawEquiped=function(e,t){core.setTextAlign("ui","center");for(var o=this.HSIZE-3,r=Math.floor(this.PIXEL/(o+.25)),a=0;a<e.equipLength;a++){var n=e.equipEquipment[a]||null,i=r*(a%o)+2*r/3,s=i-(r-32)/2,c=t+54*Math.floor(a/o)+19;if(n){var l=core.material.icons.items[n];core.drawImage("ui",core.material.images.items,0,32*l,32,32,i,c,32,32)}core.fillText("ui",e.allEquips[a]||"未知",s,c+27,"#FFFFFF",this._buildFont(16,!0)),core.strokeRect("ui",i-4,c-4,40,40,e.index==a?"#FFD700":"#FFFFFF")}},ui.prototype.drawSLPanel=function(e,t){core.control._loadFavoriteSaves(),null==e&&(e=1),e<0&&(e=0);var o=parseInt(e/10),r=e%10,a=main.savePages||30;core.status.event.data&&"fav"==core.status.event.data.mode&&(a=Math.ceil((core.saves.favorite||[]).length/5)),o>=a&&(o=a-1),r>5&&(r=5),core.status.event.data&&"fav"==core.status.event.data.mode&&o==a-1&&(r=Math.min(r,(core.saves.favorite||[]).length-5*o));var n=-1,i="all";core.status.event.data&&(n=core.status.event.data.page,i=core.status.event.data.mode),core.status.event.data={page:o,offset:r,mode:i},core.status.event.ui=core.status.event.ui||[],t||o!=n?(core.status.event.ui=[],this._drawSLPanel_loadSave(o,(function(){core.ui._drawSLPanel_draw(o,a)}))):this._drawSLPanel_draw(o,a)},ui.prototype._drawSLPanel_draw=function(e,t){this._drawSLPanel_drawBackground(),core.ui.drawPagination(e+1,t),core.setTextAlign("ui","center");var o=this.PIXEL-13;core.fillText("ui","返回游戏",this.PIXEL-48,o,"#DDDDDD",this._buildFont(15,!0)),core.status.event.selection&&core.setFillStyle("ui","#FF6A6A"),"save"==core.status.event.id?core.fillText("ui","删除模式",48,o):"all"==core.status.event.data.mode?core.fillText("ui","[E]显示收藏",52,o):core.fillText("ui","[E]显示全部",52,o),this._drawSLPanel_drawRecords()},ui.prototype._drawSLPanel_drawBackground=function(){core.clearMap("ui"),core.setAlpha("ui",.85),core.fillRect("ui",0,0,this.PIXEL,this.PIXEL,"#000000"),core.setAlpha("ui",1)},ui.prototype._drawSLPanel_loadSave=function(e,t){for(var o=[0],r=1;r<=5;++r){var a=5*e+r;"fav"==core.status.event.data.mode&&(a=core.saves.favorite[a-1]),o.push(a)}core.getSaves(o,(function(e){for(var r=1;r<o.length;++r)core.status.event.ui[r]=e[r];core.status.event.ui[0]=null==e[0]?null:e[0][e[0].length-1],t()}))},ui.prototype._drawSLPanel_drawRecord=function(e,t,o,r,a,n,i){var s="#FFD700";if(core.status.event.selection&&(s="#FF6A6A"),t&&t.floorId||(i=!1),core.fillText("ui",e,o,r,i?"#FFD700":"#FFFFFF",this._buildFont(17,!0)),core.strokeRect("ui",o-a/2,r+15,a,a,n?s:"#FFFFFF",n?6:2),t&&t.floorId){core.drawThumbnail(t.floorId,core.maps.loadMap(t.maps,t.floorId).blocks,{heroLoc:t.hero.loc,heroIcon:t.hero.flags.heroIcon,flags:t.hero.flags},{ctx:"ui",x:o-a/2,y:r+15,size:a,centerX:t.hero.loc.x,centerY:t.hero.loc.y}),core.isPlaying()&&core.getFlag("hard")!=t.hero.flags.hard&&(core.fillRect("ui",o-a/2,r+15,a,a,[0,0,0,.4],2),core.fillText("ui",t.hard,o,parseInt(r+22+a/2),core.dom.hard.style.color,this._buildFont(30,!0)));var c=core.formatBigNumber(t.hero.hp,!0)+"/"+core.formatBigNumber(t.hero.atk,!0)+"/"+core.formatBigNumber(t.hero.def,!0),l="/"+core.formatBigNumber(t.hero.mdef,!0);core.calWidth("ui",c+l,this._buildFont(10,!1))<=a&&(c+=l),core.fillText("ui",c,o,r+30+a,"#FFD700"),core.fillText("ui",core.formatDate(new Date(t.time)),o,r+43+a,t.hero.flags.__consoleOpened__||t.hero.flags.debug?"#FF6A6A":"#FFFFFF")}else core.fillRect("ui",o-a/2,r+15,a,a,"#333333",2),core.fillText("ui","空",o,parseInt(r+22+a/2),"#FFFFFF",this._buildFont(30,!0))},ui.prototype._drawSLPanel_drawRecords=function(e){for(var t=core.status.event.data.page,o=core.status.event.data.offset,r=Math.floor(this.PIXEL/6),a=Math.floor(this.PIXEL/3-20),n="save"==core.status.event.id?"存档":"load"==core.status.event.id?"读档":"回放",i=0;i<(e||6);i++){var s=core.status.event.ui[i],c=5*t+i,l=i>0&&core.saves.favorite.indexOf(c)>=0||"fav"==core.status.event.data.mode,u=(l?"★ ":"☆ ")+(core.saves.favoriteName[c]||n+c);if(0!=i&&"fav"==core.status.event.data.mode){if(!s)break;var p=core.saves.favorite[c-1];u=(core.saves.favoriteName[p]||n+p)+" ✐"}var d=parseInt((this.PIXEL-32-2*(64+a))/3),f=d+parseInt(16)+8,m=f+64+a+d;i<3?this._drawSLPanel_drawRecord(0==i?"自动存档":u,s,(2*i+1)*r,f,a,i==o,l):this._drawSLPanel_drawRecord(u,s,(2*i-5)*r,m,a,i==o,l)}},ui.prototype.drawKeyBoard=function(){core.lockControl(),core.status.event.id="keyBoard",core.clearUI();var e=(this.PIXEL-384)/2,t=e+384,o=(this.PIXEL-320)/2,r=o+320,a=this.drawBackground(e,o,t,r);core.setTextAlign("ui","center"),core.setFillStyle("ui",core.arrayToRGBA(core.status.textAttribute.title)),core.fillText("ui","虚拟键盘",this.HPIXEL,o+35,null,this._buildFont(22,!0)),core.setFont("ui",this._buildFont(17,!1)),core.setFillStyle("ui",core.arrayToRGBA(core.status.textAttribute.text));var n=this.HPIXEL-89;[["F1","F2","F3","F4","F5","F6","F7","F8","F9","10","11"],["1","2","3","4","5","6","7","8","9","0"],["Q","W","E","R","T","Y","U","I","O","P"],["A","S","D","F","G","H","J","K","L"],["Z","X","C","V","B","N","M"],["-","=","[","]","\\",";","'",",",".","/","`"],["ES","TA","CA","SH","CT","AL","SP","BS","EN","DE"]].forEach((function(e){for(var t=0;t<e.length;t++)core.fillText("ui",e[t],core.ui.HPIXEL+32*(t-5),n);n+=32})),core.fillText("ui","返回游戏",this.HPIXEL+128,n-3,"#FFFFFF",this._buildFont(15,!0)),a?this.drawWindowSelector(core.status.textAttribute.background,this.HPIXEL+92,n-22,72,27):core.strokeRect("ui",this.HPIXEL+92,n-22,72,27,"#FFD700",2)},ui.prototype.drawStatusBar=function(){this.uidata.drawStatusBar()},ui.prototype.drawStatistics=function(e){var t=this._drawStatistics_buildObj();"string"==typeof e&&(e=[e]),(e||core.floorIds).forEach((function(e){core.ui._drawStatistics_floorId(e,t)}));var o=core.status.hero.statistics;core.setFlag("__replayText__",!0),core.drawText([this._drawStatistics_generateText(t,"全塔",t.total),this._drawStatistics_generateText(t,"当前",t.current),"当前总步数："+core.status.hero.steps+"，当前游戏时长："+core.formatTime(o.currTime)+"，总游戏时长"+core.formatTime(o.totalTime)+"。\n瞬间移动次数："+o.moveDirectly+"，共计少走"+o.ignoreSteps+"步。\n\n总计通过血瓶恢复生命值为"+core.formatBigNumber(o.hp)+"点。\n\n总计打死了"+o.battle+"个怪物，得到了"+core.formatBigNumber(o.money)+"金币，"+core.formatBigNumber(o.experience)+"点经验。\n\n受到的总伤害为"+core.formatBigNumber(o.battleDamage+o.poisonDamage+o.extraDamage)+"，其中战斗伤害"+core.formatBigNumber(o.battleDamage)+"点"+(core.flags.enableDebuff?"，中毒伤害"+core.formatBigNumber(o.poisonDamage)+"点":"")+"，领域/夹击/阻击/血网伤害"+core.formatBigNumber(o.extraDamage)+"点。","\t[说明]1. 地图数据统计的效果仅模拟当前立刻获得该道具的效果。\n2. 不会计算“不可被浏览地图”的隐藏层的数据。\n3. 不会计算任何通过事件得到的道具（显示事件、改变图块、或直接增加道具等）。\n4. 在自定义道具（例如其他宝石）后，需在脚本编辑的drawStatistics中注册，不然不会进行统计。\n5. 所有统计信息仅供参考，如有错误，概不负责。"]),core.removeFlag("__replayText__")},ui.prototype._drawStatistics_buildObj=function(){var e=this.uidata.drawStatistics(),t=e.filter((function(e){return e.endsWith("Door")||core.material.items[e]})),o={},r={};t.forEach((function(e){e.endsWith("Door")?r[e]="doors":r[e]=core.material.items[e].cls,o[e]=0}));var a=["doors","keys","items","tools","constants","equips"];t.sort((function(t,o){var n=a.indexOf(r[t]),i=a.indexOf(r[o]);return n==i?e.indexOf(t)-e.indexOf(o):n-i}));var n={monster:{count:0,money:0,experience:0,point:0},count:o,add:{hp:0,atk:0,def:0,mdef:0}};return{ids:t,cls:r,ext:{},total:core.clone(n),current:core.clone(n)}},ui.prototype._drawStatistics_add=function(e,t,o,r,a){t.total[o][r]+=a||0,e==core.status.floorId&&(t.current[o][r]+=a||0)},ui.prototype._drawStatistics_floorId=function(e,t){var o=core.status.maps[e],r=o.blocks;o.cannotViewMap&&e!=core.status.floorId||r.forEach((function(r){if(!r.disable){var a=r.event;if(0==a.cls.indexOf("enemy"))core.ui._drawStatistics_enemy(e,a.id,t);else{var n=a.id;null!=t.total.count[n]&&core.ui._drawStatistics_items(e,o,n,t)}}}))},ui.prototype._drawStatistics_enemy=function(e,t,o){var r=core.material.enemys[t];this._drawStatistics_add(e,o,"monster","money",r.money),this._drawStatistics_add(e,o,"monster","experience",r.experience),this._drawStatistics_add(e,o,"monster","point",r.point),this._drawStatistics_add(e,o,"monster","count",1)},ui.prototype._drawStatistics_items=function(floorId,floor,id,obj){var hp=0,atk=0,def=0,mdef=0;if("items"==obj.cls[id]&&"superPotion"!=id){var temp=core.clone(core.status.hero);core.setFlag("__statistics__",!0);var ratio=floor.item_ratio||1;try{eval(core.items.itemEffect[id])}catch(e){}hp=core.status.hero.hp-temp.hp,atk=core.status.hero.atk-temp.atk,def=core.status.hero.def-temp.def,mdef=core.status.hero.mdef-temp.mdef,core.status.hero=temp}else if("equips"==obj.cls[id]){var values=core.material.items[id].equip||{};atk=values.atk||0,def=values.def||0,mdef=values.mdef||0}if(0==id.indexOf("sword")||0==id.indexOf("shield")||"equips"==obj.cls[id]){var t="";atk>0&&(t+=atk+"攻"),def>0&&(t+=def+"防"),mdef>0&&(t+=mdef+"魔防"),""!=t&&(obj.ext[id]=t)}this._drawStatistics_add(floorId,obj,"count",id,1),this._drawStatistics_add(floorId,obj,"add","hp",hp),this._drawStatistics_add(floorId,obj,"add","atk",atk),this._drawStatistics_add(floorId,obj,"add","def",def),this._drawStatistics_add(floorId,obj,"add","mdef",mdef)},ui.prototype._drawStatistics_generateText=function(e,t,o){var r=t+"地图中：\n";r+="共有怪物"+o.monster.count+"个",core.flags.enableMoney&&(r+="，总金币数"+o.monster.money),core.flags.enableExperience&&(r+="，总经验数"+o.monster.experience),core.flags.enableAddPoint&&(r+="，总加点数"+o.monster.point),r+="。\n";var a="";return e.ids.forEach((function(t){var n=o.count[t];0!=n&&(e.cls[t]!=a?(""!=a&&(r+="。"),r+="\n"):r+="，",a=e.cls[t],r+=core.ui._drawStatistics_getName(t)+n+"个",e.ext[t]&&(r+="("+e.ext[t]+")"))})),""!=a&&(r+="。"),r+="\n\n",r+="共加生命值"+core.formatBigNumber(o.add.hp)+"点，攻击"+core.formatBigNumber(o.add.atk)+"点，防御"+core.formatBigNumber(o.add.def)+"点，魔防"+core.formatBigNumber(o.add.mdef)+"点。"},ui.prototype._drawStatistics_getName=function(e){return{yellowDoor:"黄门",blueDoor:"蓝门",redDoor:"红门",greenDoor:"绿门",steelDoor:"铁门"}[e]||core.material.items[e].name},ui.prototype.drawAbout=function(){return this.uidata.drawAbout()},ui.prototype.drawPaint=function(){core.drawText("\t[进入绘图模式]你可以在此页面上任意进行绘图和标记操作。\nM键可以进入或退出此模式。\n\n绘图的内容会自动保存，且以页面为生命周期，和存读档无关，重新开始游戏或读档后绘制的内容仍有效，但刷新页面就会消失。\n你可以将绘制内容保存到文件，也可以从文件读取保存的绘制内容。\n浏览地图页面可以按楼传按钮或M键来开启/关闭该层的绘图显示。\n\n更多功能请详见文档-元件-绘图模式。",this._drawPaint_draw)},ui.prototype._drawPaint_draw=function(){core.drawTip("打开绘图模式，现在可以任意在界面上绘图标记"),core.lockControl(),core.status.event.id="paint",core.status.event.data={x:null,y:null,erase:!1},core.clearUI(),core.createCanvas("paint",-core.bigmap.offsetX,-core.bigmap.offsetY,32*core.bigmap.width,32*core.bigmap.height,95);var e=core.paint[core.status.floorId];e&&(e=lzw_decode(e).split(",")),core.utils._decodeCanvas(e,32*core.bigmap.width,32*core.bigmap.height),core.drawImage("paint",core.bigmap.tempCanvas.canvas,0,0),core.setLineWidth("paint",3),core.setStrokeStyle("paint","#FF0000"),core.statusBar.image.keyboard.style.opacity=0,core.statusBar.image.shop.style.opacity=0,core.statusBar.image.book.src=core.statusBar.icons.paint.src,core.statusBar.image.fly.src=core.statusBar.icons.erase.src,core.statusBar.image.toolbox.src=core.statusBar.icons.empty.src,core.statusBar.image.settings.src=core.statusBar.icons.exit.src,core.statusBar.image.book.style.opacity=1,core.statusBar.image.fly.style.opacity=1},ui.prototype.drawHelp=function(){core.clearUI(),core.material.images.keyboard?(core.status.event.id="help",core.lockControl(),core.setAlpha("ui",1),core.fillRect("ui",0,0,this.PIXEL,this.PIXEL,"#FFFFFF"),core.drawImage("ui",core.material.images.keyboard,32*(this.HSIZE-6),32*(this.HSIZE-6))):core.drawText(["\t[键盘快捷键列表][CTRL] 跳过对话   [Z] 转向\n[X] 怪物手册   [G] 楼层传送\n[A] 读取自动存档   [S/D] 存读档页面\n[V] 快捷商店   [ESC] 系统菜单\n[T] 道具页面   [Q] 装备页面\n[B] 数据统计   [H] 帮助页面\n[R] 回放录像   [E] 显示光标\n[SPACE] 轻按   [M] 绘图模式\n[N] 返回标题页面   [P] 游戏主页\n[O] 查看工程   [F7] 打开debug穿墙模式\n[PgUp/PgDn] 浏览地图\n[1~4] 快捷使用破炸飞和其他道具\n[Alt+0~9] 快捷换装","\t[鼠标操作]点状态栏中图标： 进行对应的操作\n点任意块： 寻路并移动\n点任意块并拖动： 指定寻路路线\n双击空地： 瞬间移动\n单击勇士： 转向\n双击勇士： 轻按（仅在轻按开关打开时有效）\n长按任意位置：跳过剧情对话或打开虚拟键盘"])},ui.prototype.createCanvas=function(e,t,o,r,a,n){if(core.dymCanvas[e])return this.relocateCanvas(e,t,o),this.resizeCanvas(e,r,a),core.dymCanvas[e].canvas.style.zIndex=n,core.dymCanvas[e];var i=document.createElement("canvas");return i.id=e,i.style.display="block",i.width=r,i.height=a,i.setAttribute("_left",t),i.setAttribute("_top",o),i.style.zIndex=n,_pixi_resize__WEBPACK_IMPORTED_MODULE_1__.a.reLocDymCanvas(i),core.dymCanvas[e]=i.getContext("2d"),main.dom.body.appendChild(i),core.dymCanvas[e]},ui.prototype.relocateCanvas=function(e,t,o){var r=core.getContextByName(e);return r?(null==t&&null==o||(r.canvas.setAttribute("_left",t),r.canvas.setAttribute("_top",o),_pixi_resize__WEBPACK_IMPORTED_MODULE_1__.a.reLocDymCanvas(r)),r):null},ui.prototype.resizeCanvas=function(e,t,o,r){var a=core.getContextByName(e);return a?(null==t&&null==o||(r||(a.canvas.width=t,a.canvas.height=o),_pixi_resize__WEBPACK_IMPORTED_MODULE_1__.a.reLocDymCanvas(a)),a):null},ui.prototype.deleteCanvas=function(e){if(!core.dymCanvas[e])return null;main.dom.body.removeChild(core.dymCanvas[e].canvas),delete core.dymCanvas[e]},ui.prototype.deleteAllCanvas=function(){var e=this;Object.keys(core.dymCanvas).forEach((function(t){e.deleteCanvas(t)}))}},function(e,t,o){"use strict";o(0);var r=o(2),a=o(1),n=o(4);function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==o)return;var r,a,n=[],i=!0,s=!1;try{for(o=o.call(e);!(i=(r=o.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(s)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var c=r.d.getScene("show"),l=a.a.TextStyle.tip,u={offsetX:5,offsetY:5,padding:a.a.getPadding([8,10])},p={draw:function(e,t){var o=a.a.calText(e,l),r=o.width,n=o.height,s=i(u.padding,4),c=s[0],p=s[1],d=s[2],f=s[3],m=null;null!=t&&((m=a.a.getBlockNode(t)).anchor.set(.5,.5),r+=m.width);var h={node:m,text:e,x:u.offsetX,y:u.offsetY,width:r+f+p,height:n+c+d,zone:[f,c,r,n],textStyle:l,opacity:.7};return this.drawOne(h)},drawOne:function(e){var t=e.x,o=e.y,r=e.width,s=e.height,l=e.zone,u=e.textStyle,p=e.opacity,d=e.node,f=e.text,m=a.a.fillRect(c,t,o,r,s,{radius:.2,fillAlpha:p}),h=i(l,4),y=h[0],g=h[1],v=(h[2],h[3]),_=y;return d&&(m.addNode(d),d.position.set(y+d.width/2,g+v/2),_+=d.width),m.addNode("text",{text:f,style:u,data:{x:_,y:g}}),n.a.setNode(m,{init:function(){var e=this;this.changeTo({alpha:0},{alpha:1},500,(function(){e.getTween({alpha:0},500).onComplete((function(){e.remove()})).delay(800).start()}))}})}};t.a=p},function(e,t,o){},function(e,t,o){"use strict";o.r(t);var r=o(0),a=o(7),n=o(14),i=o(17),s=o(23),c=o(2),l=o(3),u=o(16),p=o(5),d=o(1),f=o(4),m=o(6),h=o(8),y=o(15);o(56),o(57),o(70),o(71),o(72),o(26),o(73),console.log("loadFirst"),window.$=r,c.a.ticker.add((function(){i.a.update(),a.a.update(),f.a.update(),c.b.text=c.a.ticker.FPS}));var g={TWEEN:a.a,app:c.a,loader:n.a,event:l.a,nodes:f.a,resize:m.a,game:c.c,scenes:c.d,maps:u.a,ui:d.a,Block:y.a,utils:p.a,weather:s.a,hero:h.a,interaction:c.a.renderer.plugins.interaction,canvasRenderer:new r.CanvasRenderer({transparent:!0}),Easing:a.a.Easing.Quadratic.InOut,main:c.a.stage,ticker:c.a.ticker,textures:n.a.textures};document.body.appendChild(c.a.view),window.pixi=g},,,,,,,,,function(e,t,o){"use strict";o.r(t);var r=o(7),a=o(0),n=o(5);function i(e){var t=document.createElement("canvas");t.width=32,t.height=32;var o=t.getContext("2d");return n.a.fillRoundRect(o,0,0,32,32,8,e),new a.Texture(new a.BaseTexture(new a.resources.CanvasResource(t)))}r.a.Tween.prototype.destroy=function(){this._isPlaying&&this.stop(),this._group=null,this._object=null,this._valuesStart=null,this._onUpdateCallback=null,this._onCompleteCallback=null,this._valuesEnd=null,this._easingFunction=null},console.log("extend"),a.Texture.ROUNDWHITE=i("white"),a.Texture.BLACK=i("black"),a.Texture.RED=i("red")},function(e,t,o){"use strict";o.r(t);var r=o(2),a=o(16),n=o(1);r.c.on("show",(function(){window.pixi.textures;n.a.setMask(this)})),r.c.getScene("bg").on("show",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:core.status.floorId;a.a.drawBg(this,e)})),r.c.getScene("event").on("show",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:core.status.floorId,t=core.status.maps[e].blocks;a.a.drawEvents(this,t,e),n.a.setHero("hero",this)})),r.c.getScene("fg").on("show",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:core.status.floorId;a.a.drawFg(this,e)})),r.c.getScene("damage").on("show",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:core.status.floorId;core.status.gameOver||(a.a.drawDamage(this,e),a.a.drawExtraDamage(this,e))}))},function(e,t,o){var r={"./_info.json":59,"./_maps.json":60,"./animates.json":61,"./bg.jpg":62,"./bgWhite.jpg":63,"./packer-0.json":64,"./packer-0.png":65,"./packer-1.json":66,"./packer-1.png":67,"./packer-2.json":68,"./packer-2.png":69};function a(e){var t=n(e);return o(t)}function n(e){if(!o.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=n,e.exports=a,a.id=58},function(e){e.exports=JSON.parse('{"yellowWall":{"num":1,"animate":1},"whiteWall":{"num":2,"animate":1},"blueWall":{"num":3,"animate":1},"star":{"num":4,"animate":4},"lava":{"num":5,"animate":4},"ice":{"num":6,"animate":1},"blueShop-left":{"num":7,"animate":1},"blueShop-right":{"num":8,"animate":1},"pinkShop-left":{"num":9,"animate":1},"pinkShop-right":{"num":10,"animate":1},"lavaNet":{"num":11,"animate":4},"poisonNet":{"num":12,"animate":4},"weakNet":{"num":13,"animate":4},"curseNet":{"num":14,"animate":4},"autotile":{"num":20,"animate":1},"yellowKey":{"num":21,"animate":1},"blueKey":{"num":22,"animate":1},"redKey":{"num":23,"animate":1},"greenKey":{"num":24,"animate":1},"steelKey":{"num":25,"animate":1},"bigKey":{"num":26,"animate":1},"redJewel":{"num":27,"animate":1},"blueJewel":{"num":28,"animate":1},"greenJewel":{"num":29,"animate":1},"yellowJewel":{"num":30,"animate":1},"redPotion":{"num":31,"animate":1},"bluePotion":{"num":32,"animate":1},"greenPotion":{"num":33,"animate":1},"yellowPotion":{"num":34,"animate":1},"sword1":{"num":35,"animate":1},"shield1":{"num":36,"animate":1},"sword2":{"num":37,"animate":1},"shield2":{"num":38,"animate":1},"sword3":{"num":39,"animate":1},"shield3":{"num":40,"animate":1},"sword4":{"num":41,"animate":1},"shield4":{"num":42,"animate":1},"sword5":{"num":43,"animate":1},"shield5":{"num":44,"animate":1},"book":{"num":45,"animate":1},"fly":{"num":46,"animate":1},"pickaxe":{"num":47,"animate":1},"icePickaxe":{"num":48,"animate":1},"bomb":{"num":49,"animate":1},"centerFly":{"num":50,"animate":1},"upFly":{"num":51,"animate":1},"downFly":{"num":52,"animate":1},"coin":{"num":53,"animate":1},"snow":{"num":54,"animate":1},"cross":{"num":55,"animate":1},"superPotion":{"num":56,"animate":1},"earthquake":{"num":57,"animate":1},"poisonWine":{"num":58,"animate":1},"weakWine":{"num":59,"animate":1},"curseWine":{"num":60,"animate":1},"superWine":{"num":61,"animate":1},"knife":{"num":62,"animate":1},"moneyPocket":{"num":63,"animate":1},"shoes":{"num":64,"animate":1},"hammer":{"num":65,"animate":1},"yellowDoor":{"num":81,"animate":1},"blueDoor":{"num":82,"animate":1},"redDoor":{"num":83,"animate":1},"greenDoor":{"num":84,"animate":1},"specialDoor":{"num":85,"animate":1},"steelDoor":{"num":86,"animate":1},"upFloor":{"num":87,"animate":1},"downFloor":{"num":88,"animate":1},"portal":{"num":89,"animate":4},"starPortal":{"num":90,"animate":4},"upPortal":{"num":91,"animate":4},"leftPortal":{"num":92,"animate":4},"downPortal":{"num":93,"animate":4},"rightPortal":{"num":94,"animate":4},"man":{"num":121,"animate":2},"woman":{"num":122,"animate":2},"thief":{"num":123,"animate":2},"fairy":{"num":124,"animate":2},"magician":{"num":125,"animate":2},"womanMagician":{"num":126,"animate":2},"pinkShop":{"num":130,"animate":2},"blueShop":{"num":131,"animate":2},"princess":{"num":132,"animate":2},"npc0":{"num":133,"animate":4},"autotile4":{"num":140,"animate":1},"autotile1":{"num":151,"animate":4},"autotile2":{"num":152,"animate":1},"autotile3":{"num":153,"animate":1},"arrowUp":{"num":161,"animate":1},"arrowDown":{"num":162,"animate":1},"arrowLeft":{"num":163,"animate":1},"arrowRight":{"num":164,"animate":1},"light":{"num":165,"animate":1},"darkLight":{"num":166,"animate":1},"greenSlime":{"num":201,"animate":2},"redSlime":{"num":202,"animate":2},"slimelord":{"num":204,"animate":2},"redBat":{"num":207,"animate":2},"ghostSkeleton":{"num":212,"animate":2},"slimeMan":{"num":216,"animate":2},"bluePriest":{"num":217,"animate":2},"brownWizard":{"num":219,"animate":2},"redWizard":{"num":220,"animate":2},"yellowGuard":{"num":221,"animate":2},"swordsman":{"num":224,"animate":2},"tree1":{"num":229,"animate":1},"poisonBat":{"num":235,"animate":2},"skeletonPriest":{"num":237,"animate":2},"redKing":{"num":245,"animate":2},"whiteKing":{"num":246,"animate":2},"blackMagician":{"num":247,"animate":2},"silverSlime":{"num":248,"animate":2},"redSwordsman":{"num":254,"animate":2},"angel":{"num":261,"animate":4},"elemental":{"num":262,"animate":4},"steelGuard":{"num":263,"animate":4},"evilBat":{"num":264,"animate":4},"X10185":{"num":10185,"animate":1},"X10186":{"num":10186,"animate":1},"X10187":{"num":10187,"animate":1},"X10188":{"num":10188,"animate":1},"X10189":{"num":10189,"animate":1},"X10193":{"num":10193,"animate":1},"X10194":{"num":10194,"animate":1},"X10195":{"num":10195,"animate":1},"X10196":{"num":10196,"animate":1},"X10197":{"num":10197,"animate":1}}')},function(e){e.exports=JSON.parse('{"1":{"cls":"terrains","id":"yellowWall","canBreak":true},"2":{"cls":"terrains","id":"whiteWall","canBreak":true},"3":{"cls":"terrains","id":"blueWall","canBreak":true},"4":{"cls":"animates","id":"star","noPass":true},"5":{"cls":"animates","id":"lava","noPass":true},"6":{"cls":"terrains","id":"ice"},"7":{"cls":"terrains","id":"blueShop-left"},"8":{"cls":"terrains","id":"blueShop-right"},"9":{"cls":"terrains","id":"pinkShop-left"},"10":{"cls":"terrains","id":"pinkShop-right"},"11":{"cls":"animates","id":"lavaNet","noPass":false,"trigger":"passNet"},"12":{"cls":"animates","id":"poisonNet","noPass":false,"trigger":"passNet"},"13":{"cls":"animates","id":"weakNet","noPass":false,"trigger":"passNet"},"14":{"cls":"animates","id":"curseNet","noPass":false,"trigger":"passNet"},"20":{"cls":"autotile","id":"autotile","noPass":true},"21":{"cls":"items","id":"yellowKey"},"22":{"cls":"items","id":"blueKey"},"23":{"cls":"items","id":"redKey"},"24":{"cls":"items","id":"greenKey"},"25":{"cls":"items","id":"steelKey"},"26":{"cls":"items","id":"bigKey"},"27":{"cls":"items","id":"redJewel"},"28":{"cls":"items","id":"blueJewel"},"29":{"cls":"items","id":"greenJewel"},"30":{"cls":"items","id":"yellowJewel"},"31":{"cls":"items","id":"redPotion"},"32":{"cls":"items","id":"bluePotion"},"33":{"cls":"items","id":"greenPotion"},"34":{"cls":"items","id":"yellowPotion"},"35":{"cls":"items","id":"sword1"},"36":{"cls":"items","id":"shield1"},"37":{"cls":"items","id":"sword2"},"38":{"cls":"items","id":"shield2"},"39":{"cls":"items","id":"sword3"},"40":{"cls":"items","id":"shield3"},"41":{"cls":"items","id":"sword4"},"42":{"cls":"items","id":"shield4"},"43":{"cls":"items","id":"sword5"},"44":{"cls":"items","id":"shield5"},"45":{"cls":"items","id":"book"},"46":{"cls":"items","id":"fly"},"47":{"cls":"items","id":"pickaxe"},"48":{"cls":"items","id":"icePickaxe"},"49":{"cls":"items","id":"bomb"},"50":{"cls":"items","id":"centerFly"},"51":{"cls":"items","id":"upFly"},"52":{"cls":"items","id":"downFly"},"53":{"cls":"items","id":"coin"},"54":{"cls":"items","id":"snow"},"55":{"cls":"items","id":"cross"},"56":{"cls":"items","id":"superPotion"},"57":{"cls":"items","id":"earthquake"},"58":{"cls":"items","id":"poisonWine"},"59":{"cls":"items","id":"weakWine"},"60":{"cls":"items","id":"curseWine"},"61":{"cls":"items","id":"superWine"},"62":{"cls":"items","id":"knife"},"63":{"cls":"items","id":"moneyPocket"},"64":{"cls":"items","id":"shoes"},"65":{"cls":"items","id":"hammer"},"81":{"cls":"terrains","id":"yellowDoor","trigger":"openDoor"},"82":{"cls":"terrains","id":"blueDoor","trigger":"openDoor"},"83":{"cls":"terrains","id":"redDoor","trigger":"openDoor"},"84":{"cls":"terrains","id":"greenDoor","trigger":"openDoor"},"85":{"cls":"terrains","id":"specialDoor","trigger":"openDoor"},"86":{"cls":"terrains","id":"steelDoor","trigger":"openDoor"},"87":{"cls":"terrains","id":"upFloor","noPass":false},"88":{"cls":"terrains","id":"downFloor","noPass":false},"89":{"cls":"animates","id":"portal","noPass":false},"90":{"cls":"animates","id":"starPortal","noPass":false},"91":{"cls":"animates","id":"upPortal","noPass":false},"92":{"cls":"animates","id":"leftPortal","noPass":false},"93":{"cls":"animates","id":"downPortal","noPass":false},"94":{"cls":"animates","id":"rightPortal","noPass":false},"121":{"cls":"npcs","id":"man"},"122":{"cls":"npcs","id":"woman"},"123":{"cls":"npcs","id":"thief"},"124":{"cls":"npcs","id":"fairy"},"125":{"cls":"npcs","id":"magician"},"126":{"cls":"npcs","id":"womanMagician"},"130":{"cls":"npcs","id":"pinkShop"},"131":{"cls":"npcs","id":"blueShop"},"132":{"cls":"npcs","id":"princess"},"133":{"cls":"npc48","id":"npc0","faceIds":{"down":"npc0","left":"npc1","right":"npc2","up":"npc3"}},"140":{"cls":"autotile","id":"autotile4","noPass":true},"151":{"cls":"autotile","id":"autotile1","noPass":true},"152":{"cls":"autotile","id":"autotile2","noPass":true},"153":{"cls":"autotile","id":"autotile3","noPass":true},"161":{"cls":"terrains","id":"arrowUp","noPass":false,"cannotOut":["left","right","down"],"cannotIn":["down"]},"162":{"cls":"terrains","id":"arrowDown","noPass":false,"cannotOut":["left","right","up"],"cannotIn":["up"]},"163":{"cls":"terrains","id":"arrowLeft","noPass":false,"cannotOut":["up","down","right"],"cannotIn":["right"]},"164":{"cls":"terrains","id":"arrowRight","noPass":false,"cannotOut":["up","down","left"],"cannotIn":["left"]},"165":{"cls":"terrains","id":"light","trigger":"changeLight","noPass":false},"166":{"cls":"terrains","id":"darkLight","noPass":true},"201":{"cls":"enemys","id":"greenSlime"},"202":{"cls":"enemys","id":"redSlime"},"204":{"cls":"enemys","id":"slimelord"},"207":{"cls":"enemys","id":"redBat"},"212":{"cls":"enemys","id":"ghostSkeleton"},"216":{"cls":"enemys","id":"slimeMan"},"217":{"cls":"enemys","id":"bluePriest"},"219":{"cls":"enemys","id":"brownWizard"},"220":{"cls":"enemys","id":"redWizard"},"221":{"cls":"enemys","id":"yellowGuard"},"224":{"cls":"enemys","id":"swordsman"},"229":{"cls":"enemys","id":"tree1"},"235":{"cls":"enemys","id":"poisonBat"},"237":{"cls":"enemys","id":"skeletonPriest"},"245":{"cls":"enemys","id":"redKing"},"246":{"cls":"enemys","id":"whiteKing"},"247":{"cls":"enemys","id":"blackMagician"},"248":{"cls":"enemys","id":"silverSlime"},"254":{"cls":"enemys","id":"redSwordsman"},"261":{"cls":"enemy48","id":"angel"},"262":{"cls":"enemy48","id":"elemental"},"263":{"cls":"enemy48","id":"steelGuard"},"264":{"cls":"enemy48","id":"evilBat"},"10185":{"cls":"tileset","id":"X10185"},"10186":{"cls":"tileset","id":"X10186"},"10187":{"cls":"tileset","id":"X10187"},"10188":{"cls":"tileset","id":"X10188"},"10189":{"cls":"tileset","id":"X10189"},"10193":{"cls":"tileset","id":"X10193"},"10194":{"cls":"tileset","id":"X10194"},"10195":{"cls":"tileset","id":"X10195"},"10196":{"cls":"tileset","id":"X10196"},"10197":{"cls":"tileset","id":"X10197"}}')},function(e){e.exports=JSON.parse('{"hand":{"ratio":2,"se":"attack.mp3","bitmaps":[1,1,1,0,0,0,0,0,0,0],"frame_max":8,"frames":[[[0,0,0,30,120]],[[0,0,0,50,255]],[[0,0,0,70,255]],[[1,0,0,80,255]],[[1,0,0,90,255]],[[2,0,0,90,120]],[],[]]},"sword":{"ratio":2,"bitmaps":[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"frame_max":5,"frames":[[[0,8,32,30,100]],[[0,-16,32,50,130]],[[0,-24,40,80,150]],[[0,-48,24,90,180],[1,-8,40,100,255]],[[0,-56,24,100,200],[1,-8,24,100,255]]]},"zone":{"ratio":2,"se":"zone.mp3","bitmaps":[1,1,0,0,0,0,0,0,0,0],"frame_max":6,"frames":[[[0,0,32,30,100]],[[0,0,16,50,130]],[[0,0,0,80,150]],[[0,0,-8,90,180],[1,24,24,100,255]],[[0,0,-8,100,200],[1,24,8,100,255]],[[0,0,-8,100,255]]]}}')},function(e,t,o){"use strict";o.r(t),t.default=o.p+"bg.jpg"},function(e,t,o){"use strict";o.r(t),t.default=o.p+"bgWhite.jpg"},function(e){e.exports=JSON.parse('{"frames":{"autotile1":{"frame":{"x":0,"y":0,"w":384,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":384,"h":128},"sourceSize":{"w":384,"h":128},"pivot":{"x":0.5,"y":0.5}},"winskin":{"frame":{"x":384,"y":0,"w":192,"h":128},"rotated":true,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":192,"h":128},"sourceSize":{"w":192,"h":128},"pivot":{"x":0.5,"y":0.5}},"hero1":{"frame":{"x":0,"y":192,"w":120,"h":186},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":4,"w":120,"h":186},"sourceSize":{"w":128,"h":192},"pivot":{"x":0.5,"y":0.5}},"blackMagician":{"frame":{"x":0,"y":128,"w":64,"h":32},"rotated":true,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":32},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"redKing":{"frame":{"x":32,"y":128,"w":64,"h":32},"rotated":true,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":32},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"redSwordsman":{"frame":{"x":64,"y":128,"w":64,"h":32},"rotated":true,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":32},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"swordsman":{"frame":{"x":96,"y":128,"w":64,"h":32},"rotated":true,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":32},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"animateDoor":{"frame":{"x":0,"y":378,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128},"pivot":{"x":0.5,"y":0.5}},"route":{"frame":{"x":120,"y":192,"w":128,"h":128},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":128},"sourceSize":{"w":128,"h":128},"pivot":{"x":0.5,"y":0.5}},"whiteKing":{"frame":{"x":128,"y":128,"w":64,"h":32},"rotated":true,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":32},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"blueShop":{"frame":{"x":160,"y":128,"w":64,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":64,"h":30},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"pinkShop":{"frame":{"x":190,"y":128,"w":64,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":64,"h":30},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"thief":{"frame":{"x":120,"y":320,"w":58,"h":32},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":58,"h":32},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"magician":{"frame":{"x":220,"y":128,"w":63,"h":31},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":63,"h":31},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"autotile3":{"frame":{"x":251,"y":128,"w":96,"h":128},"rotated":true,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":96,"h":128},"sourceSize":{"w":96,"h":128},"pivot":{"x":0.5,"y":0.5}},"autotile4":{"frame":{"x":379,"y":192,"w":96,"h":128},"rotated":true,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":96,"h":128},"sourceSize":{"w":96,"h":128},"pivot":{"x":0.5,"y":0.5}},"lava":{"frame":{"x":248,"y":224,"w":128,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":32},"sourceSize":{"w":128,"h":32},"pivot":{"x":0.5,"y":0.5}},"portal":{"frame":{"x":248,"y":256,"w":128,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":32},"sourceSize":{"w":128,"h":32},"pivot":{"x":0.5,"y":0.5}},"star":{"frame":{"x":128,"y":378,"w":128,"h":32},"rotated":true,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":128,"h":32},"sourceSize":{"w":128,"h":32},"pivot":{"x":0.5,"y":0.5}},"princess":{"frame":{"x":152,"y":320,"w":55,"h":32},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":5,"y":0,"w":55,"h":32},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"autotile":{"frame":{"x":160,"y":375,"w":96,"h":127},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":96,"h":127},"sourceSize":{"w":96,"h":128},"pivot":{"x":0.5,"y":0.5}},"fairy":{"frame":{"x":184,"y":320,"w":55,"h":24},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":5,"y":6,"w":55,"h":24},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"zone-1":{"frame":{"x":248,"y":288,"w":86,"h":79},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":5,"y":5,"w":86,"h":79},"sourceSize":{"w":96,"h":96},"pivot":{"x":0.5,"y":0.5}},"sword-0":{"frame":{"x":160,"y":502,"w":25,"h":9},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":55,"y":28,"w":25,"h":9},"sourceSize":{"w":96,"h":96},"pivot":{"x":0.5,"y":0.5}},"redSlime":{"frame":{"x":208,"y":320,"w":53,"h":19},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":6,"y":8,"w":53,"h":19},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"X10185":{"frame":{"x":227,"y":320,"w":14,"h":21},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":9,"y":7,"w":14,"h":21},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"X10187":{"frame":{"x":227,"y":334,"w":14,"h":21},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":9,"y":7,"w":14,"h":21},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"X10188":{"frame":{"x":227,"y":348,"w":14,"h":21},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":9,"y":7,"w":14,"h":21},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"X10195":{"frame":{"x":227,"y":362,"w":12,"h":21},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":10,"y":7,"w":12,"h":21},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"X10186":{"frame":{"x":185,"y":502,"w":7,"h":21},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":11,"y":7,"w":7,"h":21},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"autotile2":{"frame":{"x":256,"y":374,"w":92,"h":127},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":0,"w":92,"h":127},"sourceSize":{"w":96,"h":128},"pivot":{"x":0.5,"y":0.5}},"snowNode":{"frame":{"x":327,"y":288,"w":84,"h":92},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":9,"y":4,"w":84,"h":92},"sourceSize":{"w":100,"h":100},"pivot":{"x":0.5,"y":0.5}},"hand-2":{"frame":{"x":419,"y":288,"w":84,"h":84},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":4,"w":84,"h":84},"sourceSize":{"w":96,"h":96},"pivot":{"x":0.5,"y":0.5}},"angel":{"frame":{"x":348,"y":372,"w":127,"h":37},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":1,"y":3,"w":127,"h":37},"sourceSize":{"w":128,"h":48},"pivot":{"x":0.5,"y":0.5}},"hero":{"frame":{"x":385,"y":372,"w":125,"h":126},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":125,"h":126},"sourceSize":{"w":128,"h":128},"pivot":{"x":0.5,"y":0.5}},"X10193":{"frame":{"x":385,"y":497,"w":14,"h":22},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":9,"y":7,"w":14,"h":22},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"X10189":{"frame":{"x":407,"y":497,"w":14,"h":21},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":9,"y":7,"w":14,"h":21},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"X10194":{"frame":{"x":428,"y":497,"w":14,"h":21},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":9,"y":7,"w":14,"h":21},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"X10196":{"frame":{"x":449,"y":497,"w":14,"h":21},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":9,"y":7,"w":14,"h":21},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"X10197":{"frame":{"x":470,"y":497,"w":14,"h":21},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":9,"y":7,"w":14,"h":21},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}}},"meta":{"app":"http://github.com/odrick/free-tex-packer-core","version":"0.3.1","image":"packer-0.png","format":"RGBA8888","size":{"w":512,"h":511},"scale":1}}')},function(e,t,o){"use strict";o.r(t),t.default=o.p+"packer-0.png"},function(e){e.exports=JSON.parse('{"frames":{"curseNet":{"frame":{"x":0,"y":0,"w":126,"h":32},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":126,"h":32},"sourceSize":{"w":128,"h":32},"pivot":{"x":0.5,"y":0.5}},"lavaNet":{"frame":{"x":126,"y":0,"w":126,"h":32},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":126,"h":32},"sourceSize":{"w":128,"h":32},"pivot":{"x":0.5,"y":0.5}},"poisonNet":{"frame":{"x":252,"y":0,"w":126,"h":32},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":126,"h":32},"sourceSize":{"w":128,"h":32},"pivot":{"x":0.5,"y":0.5}},"weakNet":{"frame":{"x":378,"y":0,"w":126,"h":32},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":126,"h":32},"sourceSize":{"w":128,"h":32},"pivot":{"x":0.5,"y":0.5}},"cat":{"frame":{"x":0,"y":32,"w":124,"h":125},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":3,"w":124,"h":125},"sourceSize":{"w":128,"h":128},"pivot":{"x":0.5,"y":0.5}},"evilBat":{"frame":{"x":0,"y":157,"w":125,"h":36},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":2,"y":4,"w":125,"h":36},"sourceSize":{"w":128,"h":48},"pivot":{"x":0.5,"y":0.5}},"elemental":{"frame":{"x":0,"y":282,"w":124,"h":42},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":124,"h":42},"sourceSize":{"w":128,"h":48},"pivot":{"x":0.5,"y":0.5}},"rightPortal":{"frame":{"x":36,"y":157,"w":124,"h":21},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":0,"y":5,"w":124,"h":21},"sourceSize":{"w":128,"h":32},"pivot":{"x":0.5,"y":0.5}},"tree1":{"frame":{"x":0,"y":406,"w":96,"h":119},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":0,"y":4,"w":96,"h":119},"sourceSize":{"w":96,"h":128},"pivot":{"x":0.5,"y":0.5}},"steelGuard":{"frame":{"x":42,"y":281,"w":121,"h":44},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":4,"y":3,"w":121,"h":44},"sourceSize":{"w":128,"h":48},"pivot":{"x":0.5,"y":0.5}},"npc0":{"frame":{"x":57,"y":157,"w":119,"h":44},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":4,"y":2,"w":119,"h":44},"sourceSize":{"w":128,"h":48},"pivot":{"x":0.5,"y":0.5}},"starPortal":{"frame":{"x":86,"y":276,"w":118,"h":23},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":6,"y":6,"w":118,"h":23},"sourceSize":{"w":128,"h":32},"pivot":{"x":0.5,"y":0.5}},"leftPortal":{"frame":{"x":101,"y":157,"w":118,"h":21},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":7,"y":5,"w":118,"h":21},"sourceSize":{"w":128,"h":32},"pivot":{"x":0.5,"y":0.5}},"downPortal":{"frame":{"x":109,"y":275,"w":117,"h":31},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":6,"y":0,"w":117,"h":31},"sourceSize":{"w":128,"h":32},"pivot":{"x":0.5,"y":0.5}},"upPortal":{"frame":{"x":122,"y":157,"w":117,"h":31},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":6,"y":1,"w":117,"h":31},"sourceSize":{"w":128,"h":32},"pivot":{"x":0.5,"y":0.5}},"hand-0":{"frame":{"x":119,"y":392,"w":70,"h":74},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":13,"y":10,"w":70,"h":74},"sourceSize":{"w":96,"h":96},"pivot":{"x":0.5,"y":0.5}},"sword-1":{"frame":{"x":140,"y":466,"w":43,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":35,"y":28,"w":43,"h":30},"sourceSize":{"w":96,"h":96},"pivot":{"x":0.5,"y":0.5}},"speedDown":{"frame":{"x":119,"y":466,"w":25,"h":20},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":3,"y":6,"w":25,"h":20},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"play":{"frame":{"x":119,"y":491,"w":20,"h":20},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":6,"w":20,"h":20},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"skeletonPriest":{"frame":{"x":170,"y":466,"w":61,"h":32},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":61,"h":32},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"womanMagician":{"frame":{"x":231,"y":466,"w":60,"h":32},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":0,"w":60,"h":32},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"hand-1":{"frame":{"x":140,"y":274,"w":72,"h":71},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":13,"y":13,"w":72,"h":71},"sourceSize":{"w":96,"h":96},"pivot":{"x":0.5,"y":0.5}},"airwall":{"frame":{"x":140,"y":346,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"blueDoor":{"frame":{"x":172,"y":346,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"zone-0":{"frame":{"x":189,"y":378,"w":65,"h":61},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":17,"y":13,"w":65,"h":61},"sourceSize":{"w":96,"h":96},"pivot":{"x":0.5,"y":0.5}},"blueWall":{"frame":{"x":204,"y":346,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"up":{"frame":{"x":189,"y":443,"w":23,"h":27},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":5,"y":2,"w":23,"h":27},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"hammer":{"frame":{"x":216,"y":443,"w":22,"h":22},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":5,"y":5,"w":22,"h":22},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"speedUp":{"frame":{"x":238,"y":443,"w":25,"h":20},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":6,"w":25,"h":20},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"hp":{"frame":{"x":263,"y":443,"w":24,"h":20},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":6,"w":24,"h":20},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"ghostSkeleton":{"frame":{"x":124,"y":32,"w":62,"h":31},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":62,"h":31},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"yellowGuard":{"frame":{"x":124,"y":94,"w":62,"h":31},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":62,"h":31},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"bluePriest":{"frame":{"x":153,"y":156,"w":62,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":62,"h":30},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"greenSlime":{"frame":{"x":153,"y":218,"w":51,"h":17},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":6,"y":8,"w":51,"h":17},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"silverSlime":{"frame":{"x":170,"y":218,"w":51,"h":17},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":6,"y":9,"w":51,"h":17},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"man":{"frame":{"x":155,"y":32,"w":62,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":62,"h":30},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"slimelord":{"frame":{"x":155,"y":94,"w":62,"h":28},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":62,"h":28},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"slimeMan":{"frame":{"x":183,"y":94,"w":61,"h":31},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":61,"h":31},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"brownWizard":{"frame":{"x":185,"y":32,"w":61,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":61,"h":30},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"redWizard":{"frame":{"x":183,"y":155,"w":61,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":61,"h":30},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"btn1":{"frame":{"x":187,"y":216,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"shop":{"frame":{"x":187,"y":248,"w":32,"h":26},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":3,"w":32,"h":26},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"mdef":{"frame":{"x":219,"y":248,"w":26,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":3,"y":1,"w":26,"h":30},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"money":{"frame":{"x":249,"y":248,"w":26,"h":29},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":3,"y":0,"w":26,"h":29},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"shield4":{"frame":{"x":278,"y":248,"w":26,"h":29},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":3,"y":2,"w":26,"h":29},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"woman":{"frame":{"x":213,"y":155,"w":60,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":60,"h":30},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"btn2":{"frame":{"x":219,"y":215,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"poisonBat":{"frame":{"x":214,"y":93,"w":60,"h":24},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":1,"y":3,"w":60,"h":24},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"redBat":{"frame":{"x":215,"y":32,"w":60,"h":24},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":1,"y":4,"w":60,"h":24},"sourceSize":{"w":64,"h":32},"pivot":{"x":0.5,"y":0.5}},"btn3":{"frame":{"x":238,"y":92,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"blueShop-left":{"frame":{"x":238,"y":124,"w":32,"h":31},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":32,"h":31},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"blueShop-right":{"frame":{"x":270,"y":124,"w":32,"h":31},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":32,"h":31},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"btn4":{"frame":{"x":243,"y":155,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"bomb":{"frame":{"x":243,"y":187,"w":31,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":31,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"btn5":{"frame":{"x":251,"y":215,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"steelDoor":{"frame":{"x":274,"y":187,"w":28,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":28,"h":30},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"btn6":{"frame":{"x":275,"y":155,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"btn7":{"frame":{"x":307,"y":155,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"btn8":{"frame":{"x":283,"y":215,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"arrowDown":{"frame":{"x":307,"y":187,"w":28,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":28,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"arrowLeft":{"frame":{"x":335,"y":187,"w":28,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":28,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"cross":{"frame":{"x":239,"y":32,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"arrowRight":{"frame":{"x":239,"y":64,"w":28,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":28,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"arrowUp":{"frame":{"x":267,"y":64,"w":28,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":3,"w":28,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"darkLight":{"frame":{"x":271,"y":32,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"equipbox":{"frame":{"x":270,"y":92,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"bigKey":{"frame":{"x":295,"y":64,"w":28,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":28,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"erase":{"frame":{"x":303,"y":32,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"exit":{"frame":{"x":302,"y":92,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"curseWine":{"frame":{"x":323,"y":64,"w":28,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":28,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"floor":{"frame":{"x":351,"y":64,"w":28,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":1,"w":28,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"icePickaxe":{"frame":{"x":379,"y":64,"w":28,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":28,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"greenDoor":{"frame":{"x":335,"y":32,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"ground":{"frame":{"x":367,"y":32,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"ice":{"frame":{"x":399,"y":32,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"knife":{"frame":{"x":302,"y":124,"w":32,"h":31},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":31},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"keyboard":{"frame":{"x":334,"y":92,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"pinkShop-left":{"frame":{"x":334,"y":124,"w":32,"h":31},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":32,"h":31},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"pinkShop-right":{"frame":{"x":366,"y":124,"w":32,"h":31},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":32,"h":31},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"light":{"frame":{"x":366,"y":92,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"load":{"frame":{"x":339,"y":155,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"mana":{"frame":{"x":211,"y":274,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"moneyPocket":{"frame":{"x":211,"y":306,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"paint":{"frame":{"x":236,"y":338,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"redDoor":{"frame":{"x":243,"y":274,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"save":{"frame":{"x":243,"y":306,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"settings":{"frame":{"x":275,"y":306,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"skill":{"frame":{"x":307,"y":306,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"specialDoor":{"frame":{"x":275,"y":274,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"sword5":{"frame":{"x":307,"y":247,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"whiteWall":{"frame":{"x":315,"y":215,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"blueKey":{"frame":{"x":307,"y":279,"w":27,"h":26},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":2,"y":3,"w":27,"h":26},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"greenKey":{"frame":{"x":333,"y":279,"w":27,"h":26},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":2,"y":3,"w":27,"h":26},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"yellowDoor":{"frame":{"x":339,"y":247,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"yellowWall":{"frame":{"x":371,"y":247,"w":32,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":32},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"shield5":{"frame":{"x":403,"y":247,"w":32,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":32,"h":30},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"shoes":{"frame":{"x":433,"y":247,"w":32,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":32,"h":30},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"toolbox":{"frame":{"x":347,"y":215,"w":32,"h":29},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":0,"y":2,"w":32,"h":29},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"pickaxe":{"frame":{"x":363,"y":187,"w":28,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":28,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"book":{"frame":{"x":376,"y":155,"w":31,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":0,"y":1,"w":31,"h":30},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"snow":{"frame":{"x":406,"y":155,"w":31,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":0,"y":0,"w":31,"h":30},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"fly":{"frame":{"x":436,"y":155,"w":29,"h":31},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":29,"h":31},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"downFloor":{"frame":{"x":465,"y":155,"w":30,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":30,"h":30},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"blueJewel":{"frame":{"x":495,"y":32,"w":16,"h":24},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":4,"w":16,"h":24},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"greenJewel":{"frame":{"x":495,"y":56,"w":16,"h":24},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":4,"w":16,"h":24},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"redJewel":{"frame":{"x":495,"y":80,"w":16,"h":24},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":4,"w":16,"h":24},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"yellowJewel":{"frame":{"x":495,"y":104,"w":16,"h":24},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":8,"y":4,"w":16,"h":24},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"redKey":{"frame":{"x":398,"y":128,"w":27,"h":26},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":2,"y":3,"w":27,"h":26},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"yellowKey":{"frame":{"x":424,"y":128,"w":27,"h":26},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":2,"y":3,"w":27,"h":26},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"hpmax":{"frame":{"x":450,"y":128,"w":24,"h":27},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":2,"w":24,"h":27},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"centerFly":{"frame":{"x":474,"y":128,"w":28,"h":26},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":3,"w":28,"h":26},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"sword2":{"frame":{"x":376,"y":215,"w":30,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":30,"h":30},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"downFly":{"frame":{"x":391,"y":186,"w":30,"h":29},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":30,"h":29},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"earthquake":{"frame":{"x":421,"y":186,"w":29,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":29,"h":30},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"experience":{"frame":{"x":406,"y":215,"w":29,"h":30},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":29,"h":30},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"upFly":{"frame":{"x":435,"y":215,"w":30,"h":29},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":30,"h":29},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"atk":{"frame":{"x":451,"y":186,"w":29,"h":29},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":1,"w":29,"h":29},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"lv":{"frame":{"x":480,"y":186,"w":24,"h":30},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":4,"y":1,"w":24,"h":30},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"sword1":{"frame":{"x":480,"y":210,"w":29,"h":29},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":2,"w":29,"h":29},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"sword3":{"frame":{"x":398,"y":92,"w":29,"h":29},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":2,"w":29,"h":29},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"poisonWine":{"frame":{"x":407,"y":64,"w":28,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":28,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"sword4":{"frame":{"x":431,"y":32,"w":29,"h":29},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":1,"y":2,"w":29,"h":29},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"steelKey":{"frame":{"x":460,"y":32,"w":28,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":28,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"superPotion":{"frame":{"x":460,"y":60,"w":28,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":28,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"shield3":{"frame":{"x":435,"y":61,"w":28,"h":25},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":2,"y":4,"w":28,"h":25},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"superWine":{"frame":{"x":460,"y":88,"w":28,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":28,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"coin":{"frame":{"x":435,"y":89,"w":26,"h":25},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":3,"y":3,"w":26,"h":25},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"weakWine":{"frame":{"x":464,"y":239,"w":28,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":28,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"stop":{"frame":{"x":492,"y":239,"w":20,"h":20},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":6,"y":6,"w":20,"h":20},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"pause":{"frame":{"x":492,"y":259,"w":18,"h":20},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":7,"y":6,"w":18,"h":20},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"upFloor":{"frame":{"x":463,"y":267,"w":28,"h":26},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":3,"w":28,"h":26},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"rewind":{"frame":{"x":491,"y":277,"w":18,"h":20},"rotated":true,"trimmed":true,"spriteSourceSize":{"x":7,"y":6,"w":18,"h":20},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"shield2":{"frame":{"x":250,"y":370,"w":24,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":2,"w":24,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"bluePotion":{"frame":{"x":268,"y":338,"w":18,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":2,"w":18,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"greenPotion":{"frame":{"x":250,"y":398,"w":18,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":2,"w":18,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"redPotion":{"frame":{"x":268,"y":398,"w":18,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":2,"w":18,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"yellowPotion":{"frame":{"x":274,"y":366,"w":18,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":7,"y":2,"w":18,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"empty":{"frame":{"x":286,"y":338,"w":24,"h":26},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":4,"w":24,"h":26},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"def":{"frame":{"x":286,"y":394,"w":24,"h":24},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":5,"w":24,"h":24},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}},"shield1":{"frame":{"x":286,"y":418,"w":24,"h":24},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":4,"y":5,"w":24,"h":24},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}}},"meta":{"app":"http://github.com/odrick/free-tex-packer-core","version":"0.3.1","image":"packer-1.png","format":"RGBA8888","size":{"w":512,"h":511},"scale":1}}')},function(e,t,o){"use strict";o.r(t),t.default=o.p+"packer-1.png"},function(e){e.exports=JSON.parse('{"frames":{"weakWine":{"frame":{"x":1,"y":1,"w":28,"h":28},"rotated":false,"trimmed":true,"spriteSourceSize":{"x":2,"y":2,"w":28,"h":28},"sourceSize":{"w":32,"h":32},"pivot":{"x":0.5,"y":0.5}}},"meta":{"app":"http://github.com/odrick/free-tex-packer-core","version":"0.3.1","image":"packer-2.png","format":"RGBA8888","size":{"w":30,"h":30},"scale":1}}')},function(e,t,o){"use strict";o.r(t),t.default=o.p+"packer-2.png"},function(e,t,o){"use strict";o.r(t);var r=o(0),a=o(3),n=o(23);function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==o)return;var r,a,n=[],i=!0,s=!1;try{for(o=o.call(e);!(i=(r=o.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(s)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}o(17).a.get((function(e){e.hide()}),"debounce");var c=function(e,t){if(0===e.time)return t();!function(e,t,o,a){console.log("node");for(var n=i(e.container.zone,4),s=(n[0],n[1],n[2]),c=n[3],l=s/t,u=c/o,p=0;p<t;p++)for(var d=function(t){var o=p*l,a=t*u;e.addNode("sprite",{texture:r.Texture.BLACK,init:function(){var e=this;this.position.set(o+l/2,a+u/2),this.anchor.set(.5,.5),this.loop({alpha:0},{alpha:.9,angle:90},500,1).onUpdate((function(e){e.scale.set(1.5*e.alpha,1.5*e.alpha)})).onComplete((function(){e.remove()}))}})},f=0;f<o;f++)d(f);setTimeout(a,500)}(n.a.getScene("changeFloor",{particleContainer:!0}),10,10,t)};a.a.on("changeFloor",(function(e,t){console.log("changeFloor"),core.playSound("floor.mp3"),c(e,(function(){!function(e,t){core.changingFloor(e.floorId,e.heroLoc,e.fromLoad)}(e),function(e,t){if(0===e.time)return t();t()}(e,(function(){core.events._changeFloor_afterChange(e,t)}))}))}))},function(e,t,o){"use strict";o.r(t);o(0);var r=o(2),a=o(1),n=o(6),i=r.d.getScene("toolBar");i.useButton=!1;var s={width:40,fontStyle:a.a.TextStyle.toolBar},c={book:function(e){e.stopPropagation(),core.isReplaying()?core.triggerReplay():main.core.isPlaying()&&"paint"==(core.status.event||{}).id?core.actions.setPaintMode("paint"):main.core.isPlaying()&&main.core.openBook(!0)},fly:function(e){e.stopPropagation(),core.isReplaying()?core.stopReplay():main.core.isPlaying()&&"paint"==(core.status.event||{}).id?core.actions.setPaintMode("erase"):main.core.isPlaying()&&(main.core.flags.equipboxButton?main.core.openEquipbox(!0):main.core.useFly(!0))},toolbox:function(e){e.stopPropagation(),core.isReplaying()?core.rewindReplay():main.core.isPlaying()&&"paint"==(core.status.event||{}).id?core.actions.clearPaint():main.core.isPlaying()&&main.core.openToolbox("equipbox"!=core.status.event.id)},keyboard:function(e){e.stopPropagation(),core.isReplaying()?core.bookReplay():main.core.isPlaying()&&main.core.openKeyBoard(!0)},shop:function(e){e.stopPropagation(),core.isReplaying()?core.viewMapReplay():main.core.isPlaying()&&main.core.openQuickShop(!0)},money:function(e){e.stopPropagation(),main.core.isPlaying()&&main.core.openQuickShop(!0)},save:function(e){e.stopPropagation(),core.isReplaying()?core.speedDownReplay():main.core.isPlaying()&&"paint"==(core.status.event||{}).id?core.actions.savePaint():main.core.isPlaying()&&main.core.save(!0)},load:function(e){e.stopPropagation(),core.isReplaying()?core.speedUpReplay():main.core.isPlaying()&&"paint"==(core.status.event||{}).id?core.actions.loadPaint():main.core.isPlaying()&&main.core.load(!0)},settings:function(e){e.stopPropagation(),core.isReplaying()?core.saveReplay():main.core.isPlaying()&&"paint"==(core.status.event||{}).id?core.actions.exitPaint():main.core.isPlaying()&&main.core.openSettings(!0)},hard:function(){core.isReplaying()||(i.useButton=!i.useButton,i.flash())},btn1:function(e){e.stopPropagation(),main.core.onkeyUp({keyCode:49})},btn2:function(e){e.stopPropagation(),main.core.onkeyUp({keyCode:50})},btn3:function(e){e.stopPropagation(),main.core.onkeyUp({keyCode:51})},btn4:function(e){e.stopPropagation(),main.core.onkeyUp({keyCode:52})},btn5:function(e){e.stopPropagation(),main.core.onkeyUp({keyCode:53})},btn6:function(e){e.stopPropagation(),main.core.onkeyUp({keyCode:54})},btn7:function(e){e.stopPropagation(),main.core.onkeyUp({keyCode:55})},btn8:function(e){e.stopPropagation(),main.core.onkeyUp({keyCode:56})}},l={};i.on("show",(function(){var e,t=i.useButton,o=core.statusBar.icons,r=(this.container.zone,(e=t?["btn1","btn2","btn3","btn4","btn5","btn6","btn7","btn8"]:n.a.style.isVertical?["book","fly","toolbox","keyboard","shop","save","load","settings"]:["book","fly","toolbox","save","load","settings"]).length+2),u=n.a.style.isVertical?r:3,p=Math.ceil(r/u),d=n.a.style.toolBar[2]/u,f=n.a.style.toolBar[3]/p,m={x:.5,y:.5},h=0,y=-f/2;e.forEach((function(e,t){h+=d,t%u==0&&(h=d/2,y+=f),l[e]=i.addNode("sprite",{texture:o[e],data:{x:h,y:y,anchor:m},event:{pointerdown:c[e]}})})),y-=f/2,(h+=d/2)+2*d>u*d&&(h=d/2,y+=f),window.text=i.addNode("text",{text:core.status.hard,style:s.fontStyle,start:function(){a.a.center(this,h,y,2*d,f,{maxRatio:1})},event:{pointerdown:c.hard}})})),i.update=function(){l.book.alpha=core.hasItem("book")?1:.3,l.fly.alpha=core.hasItem("fly")?1:.3}},function(e,t,o){"use strict";o.r(t);o(0);var r=o(2),a=o(1),n=o(6),i=r.d.getScene("statusBar"),s={},c=function(){var e=[];return["floor","name","lv","hpmax","hp","atk","def","mana","mdef","money","experience","up","skill","key","pzf","debuff"].forEach((function(t){(function(e){switch(e){case"floor":return core.flags.enableFloor;case"name":return core.flags.enableName;case"lv":return core.flags.enableLv;case"hpmax":return core.flags.enableHPMax;case"mana":return core.flags.enableMana;case"mdef":return core.flags.enableMDef;case"money":return core.flags.enableMoney;case"experience":return core.flags.enableExperience&&!core.flags.levelUpLeftMode;case"up":return core.flags.enableLevelUp;case"skill":return core.flags.enableSkill;case"key":return core.flags.enableKeys;case"pzf":return core.flags.enablePZF;case"debuff":return core.flags.enableDebuff;default:return!0}})(t)&&e.push(t)})),e},l=3,u=a.a.TextStyle.statusBar;i.on("show",(function(){var e=c(),t=n.a.style.statusBar[2],o=n.a.style.statusBar[3],r=n.a.style.isVertical?l:1,p=Math.ceil(e.length/r),d={};d.w=t,d.h=o,d.row=p,d.col=r,d.lineHeight=d.isVertical?o/p:36,d.barWidth=t/r;var f=core.statusBar.icons,m=0,h=0,y=["rgb(255,204,170)","rgb(170,170,221)","rgb(255,136,136)"];e.forEach((function(e,t){"key"!==e?(i.addNode("sprite",{texture:f[e],start:function(){a.a.center(this,m,h,d.lineHeight,d.lineHeight,{padding:[5,0],minRatio:.5,maxRatio:1})}}),m+=d.lineHeight,s[e]=i.addNode("text",{id:e,text:"0",style:u,start:function(){a.a.center(this,m,h,d.barWidth-d.lineHeight,d.lineHeight,{padding:[5,0],minRatio:.6,maxRatio:1})}}),(m+=d.barWidth-d.lineHeight)>=d.w&&(m=0,h+=d.lineHeight)):["yellowKey","blueKey","redKey"].forEach((function(e,t){var o=i.addNode("sprite",{texture:a.a.getTexture(e),start:function(){a.a.fitZone(this,[m,h,d.barWidth/3,d.lineHeight],"left",{padding:[5,0],maxRatio:1})}});s[e]=i.addNode("text",{text:"0",style:a.a.getTextStyle(u,{fill:y[t],stroke:"black",fontWeight:"bold"}),start:function(){a.a.center(this,m+o.width+3,h+3,0,d.lineHeight,{padding:[10,0],minRatio:.8,maxRatio:1})}}),m+=d.barWidth/3}))}))}));var p=function(e,t){var o=s[e];if(o){var r=o.text||"0",a=t.toString();r!==a&&(o.text=a,data[e]=a)}};i.update=function(){var e=core,t=e.flags,o=e.getStatus,r=e.status,a=r.floorId,n=r.hero;core.events.checkLvUp(),t.enableHPMax&&p("hp",Math.min(o("hpmax"),o("hp"))),a&&p("floor",core.status.maps[a].name),p("name",o("name")),p("lv",core.getLvName());if(["hpmax","hp","mana","atk","def","mdef","money","experience"].forEach((function(e){n[e]=Math.floor(n[e]),p(e,core.getRealStatus(e))})),t.enableMana&&(null!=n.manamax&&core.getRealStatus("manamax")>=0?(n.mana=Math.min(n.mana,core.getRealStatus("manamax")),p("mana","".concat(n.mana,"/").concat(core.getRealStatus("manamax")))):p("mana",n.mana)),t.enableSkill&&p("skill",core.getFlag("skillName","无")),t.enableLevelUp&&n.lv<core.firstData.levelUp.length){var i=core.calValue(core.firstData.levelUp[n.lv].need);t.levelUpLeftMode?p("up",core.formatBigNumber(i-o("experience"))||""):p("up",core.formatBigNumber(i)||"")}else p("up","");["yellowKey","blueKey","redKey"].forEach((function(e){p(e,core.setTwoDigits(core.itemCount(e)))})),t.enableDebuff&&(p("poison",core.hasFlag("poison")?"毒":""),p("weak",core.hasFlag("weak")?"衰":""),p("curse",core.hasFlag("curse")?"咒":"")),t.enablePZF&&(p("pickaxe","破".concat(core.itemCount("pickaxe"))),p("bomb","炸".concat(core.itemCount("bomb"))),p("fly","飞".concat(core.itemCount("centerFly"))))}},function(e,t,o){"use strict";o.r(t);var r=o(3),a=o(2);r.a.setFresh("updateStatusBar",(function(){null!=core.status.floorId&&(a.e.update(),core.updateCheckBlock(),core.updateDamage(),pixi.game.getScene("damage").active&&pixi.game.getScene("damage").emit("flash"))}),"debounce")},function(e,t,o){var r={"./attack.mp3":75,"./bgm.mp3":76,"./bomb.mp3":77,"./centerFly.mp3":78,"./door.mp3":79,"./equip.mp3":80,"./floor.mp3":81,"./item.mp3":82,"./jump.mp3":83,"./pickaxe.mp3":84,"./zone.mp3":85};function a(e){var t=n(e);return o(t)}function n(e){if(!o.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=n,e.exports=a,a.id=74},function(e,t,o){"use strict";o.r(t),t.default=o.p+"c73137ef8c9ad5baa0b3843521e5fe6e.mp3"},function(e,t,o){"use strict";o.r(t),t.default=o.p+"5be91007548244d50721c92d0c0512ed.mp3"},function(e,t,o){"use strict";o.r(t),t.default=o.p+"105f429f5bdca509e16dc43f4669fd12.mp3"},function(e,t,o){"use strict";o.r(t),t.default=o.p+"7d2246e4812d0d0868318eb2547485c4.mp3"},function(e,t,o){"use strict";o.r(t),t.default=o.p+"756a0792d86b60056b9c5a1221984806.mp3"},function(e,t,o){"use strict";o.r(t),t.default=o.p+"c7b9c943df5688c568be5a12b091e6b7.mp3"},function(e,t,o){"use strict";o.r(t),t.default=o.p+"e652c47bea4706cf3f922d10bc8aa4a1.mp3"},function(e,t,o){"use strict";o.r(t),t.default=o.p+"c7b9c943df5688c568be5a12b091e6b7.mp3"},function(e,t,o){"use strict";o.r(t),t.default=o.p+"395ef8eec192b6008b63895020aebb4f.mp3"},function(e,t,o){"use strict";o.r(t),t.default=o.p+"6156fb299185075aad5511030f29bcfb.mp3"},function(e,t,o){"use strict";o.r(t),t.default=o.p+"8f151bd5248ec9968639b9d7553b4c1f.mp3"},function(e,t,o){var r={"./MT0.js":87,"./sample0.js":88,"./sample1.js":89,"./sample2.js":90,"./sample3.js":91};function a(e){var t=n(e);return o(t)}function n(e){if(!o.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=n,e.exports=a,a.id=86},function(e,t){main.floors.MT0={floorId:"MT0",title:"主塔 0 层",name:"0",canFlyTo:!0,canUseQuickShop:!0,cannotViewMap:!1,defaultGround:"ground",images:[],item_ratio:1,map:[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0]],firstArrive:[],parallelDo:"",events:{},changeFloor:{},afterBattle:{},afterGetItem:{},afterOpenDoor:{},cannotMove:{},bgmap:[],fgmap:[]}},function(e,t){main.floors.sample0={floorId:"sample0",title:"样板 0 层",name:"0",canFlyTo:!0,canUseQuickShop:!0,defaultGround:"ground",images:[],bgm:"bgm.mp3",item_ratio:1,map:[[0,0,220,0,0,20,87,3,65,64,44,43,42],[0,246,0,246,0,20,0,3,58,59,60,61,41],[219,0,0,0,219,20,0,3,57,26,62,63,40],[20,20,125,20,20,20,0,3,53,54,55,56,39],[216,247,263,235,248,6,0,3,49,50,51,52,38],[6,6,125,6,6,6,0,229,45,46,47,48,37],[224,254,212,262,204,5,0,1,31,32,34,33,36],[201,261,217,264,207,5,0,1,27,28,29,30,35],[5,5,125,5,5,5,0,1,21,22,23,24,25],[0,0,237,0,0,0,45,1,1,1,121,1,1],[4,4,133,4,4,4,0,0,0,0,0,85,124],[87,11,12,13,14,4,4,2,2,2,122,2,2],[88,89,90,91,92,93,94,2,81,82,83,84,86]],firstArrive:["\t[样板提示]首次到达某层可以触发 firstArrive 事件，该事件可类似于RMXP中的“自动执行脚本”。\n\n本事件支持一切的事件类型，常常用来触发对话，例如：","本层主要对道具、门、怪物等进行介绍，有关事件的各种信息在下一层会有更为详细的说明。"],events:{"10,9":["\t[老人,man]这些是本样板支持的所有的道具。\n\n道具分为四类：items, constants, tools，equips。\nitems 为即捡即用类道具，例如宝石、血瓶、剑盾等。\nconstants 为永久道具，例如怪物手册、楼层传送器、幸运金币等。\ntools 为消耗类道具，例如破墙镐、炸弹、中心对称飞行器等。\nequips 为装备，例如剑盾等。","\t[老人,man]\b[up]有关道具效果，定义在items.js中。\n目前大多数道具已有默认行为，如有自定义的需求则需在items.js中修改代码。","\t[老人,man]\b[up]拾取道具结束后可触发 afterGetItem 事件。\n\n有关事件的各种信息在下一层会有更为详细的说明。",{type:"hide",time:500}],"10,11":["\t[老人,woman]这些是门，需要对应的钥匙打开。\n机关门必须使用特殊的开法。","\t[老人,woman]开门后可触发 afterOpenDoor 事件。\n\n有关事件的各种信息在下一层会有更为详细的说明。",{type:"hide",time:500}],"2,10":["\t[少女,npc0]这些是路障、楼梯、传送门。","\t[少女,npc0]血网的伤害数值、中毒后每步伤害数值、衰弱时攻防下降的数值，都在 data.js 内定义。\n\n路障同样会尽量被自动寻路绕过。","\t[少女,npc0]楼梯和传送门需要在changeFloor中定义目标楼层和位置，可参见样板里已有的的写法。",{type:"hide",time:500}],"2,8":["\t[老人,magician]这些都是各种各样的怪物，所有怪物的数据都在enemys.js中设置。","\t[老人,magician]这批怪物分别为：普通、先攻、魔攻、坚固、2连击、3连击、4连击、破甲、反击、净化。","\t[老人,magician]打败怪物后可触发 afterBattle 事件。\n\n有关事件的各种信息在下一层会有更为详细的说明。",{type:"hide",time:500}],"2,5":["\t[老人,magician]模仿、吸血、中毒、衰弱、诅咒。\n\n请注意吸血怪需要设置value为吸血数值，可参见样板中黑暗大法师的写法。",{type:"hide",time:500}],"2,3":["\t[老人,magician]领域、夹击。\n请注意领域怪需要设置value为伤害数值，可参见样板中初级巫师的写法。","\t[老人,magician]夹击和领域同时发生时先计算领域，再夹击。\n自动寻路同样会尽量绕过你设置的这些点。",{type:"hide",time:500}],"12,10":{enable:!1,data:["\t[仙子,fairy]只有楼上启用事件后，才能看到我并可以和我对话来触发事件。",{type:"hide",time:500}]}},changeFloor:{"6,0":{floorId:"sample1",stair:"downFloor"},"0,11":{floorId:"sample0",loc:[0,12]},"0,12":{floorId:"sample0",stair:"upFloor"},"1,12":{floorId:"sample0",loc:[1,12]},"2,12":{floorId:"sample0",loc:[2,12]},"3,12":{floorId:"sample0",loc:[6,1],direction:"up"},"4,12":{floorId:"sample0",loc:[0,9],direction:"left",time:1e3},"5,12":{floorId:"sample0",loc:[6,10],time:0,portalWithoutTrigger:!1},"6,12":{floorId:"sample0",loc:[10,10],direction:"left",time:1e3}},afterBattle:{"2,6":["\t[ghostSkeleton]不可能，你怎么可能打败我！\n（一个打败怪物触发的事件）"]},afterGetItem:{"11,8":["由于状态栏放不下，绿钥匙和铁门钥匙均视为tools，放入工具栏中。\n碰到绿门和铁门仍然会自动使用开门。"],"8,6":["由于吸血和夹击等的存在，血瓶默认自动被绕路。\n你可以修改data.js中的系统Flag来设置这一项。"],"8,7":["如需修改消耗品的效果，请前往 data.js ，找到并修改values内对应的具体数值即可。\n如果有更高级的需求（如每个区域宝石数值变化），详见doc文档内的做法说明。"],"9,5":["每层楼的 canFlyTo 决定了该楼层能否被飞到。\n\n不能被飞到的楼层也无法使用楼层传送器。","飞行的楼层顺序由 main.js 中 floorIds 加载顺序所决定。\n\n是否必须在楼梯边使用楼传器由 data.js 中的系统Flag所决定。"],"10,5":["破墙镐是破面前的墙壁还是四个方向的墙壁，由data.js中的系统Flag所决定。"],"8,4":["炸弹是只能炸面前的怪物还是四个方向的怪物，由data.js中的系统Flag所决定。\n如只能炸前方怪物则和上面的圣锤等价。\n不能被炸的怪物在enemys中可以定义，可参见样板里黑衣魔王和黑暗大法师的写法。"],"10,4":["“上楼”和“下楼”的目标层由 main.js 的 floorIds顺序所决定。"],"9,2":["该道具默认是大黄门钥匙，如需改为钥匙盒直接修改 data.js 中的系统Flag即可。"],"10,2":["屠龙匕首目前未被定义，可能需要自行实现功能。\n有关如何实现一个道具功能参见doc文档。"],"12,7":["在 data.js 的系统Flag中设置是否启用装备栏。\n如果不启用则装备会直接增加属性。"],"12,6":["在 data.js 的系统Flag中设置是否启用装备栏按钮。\n如果启用则装备栏按钮会替代楼传按钮。"],"12,5":["装备的种类由全塔属性中的equipName决定,type的值就是该类型在equipName中的位次，例如默认情况下equiptype为0代表武器，同时只有type为0的装备的animate属性生效"]},afterOpenDoor:{"11,12":["你开了一个绿门，触发了一个afterOpenDoor事件"]},cannotMove:{},bgmap:[[10188,10189,10193,10194,10195,0,0,0,0,0,0,0,0],[10196,10197,10185,0,0,0,10185,10186,10187,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,140,0,0,0,0,0,0],[0,0,0,0,0,0,140,0,0,0,0,0,0],[0,0,0,0,0,0,140,0,0,0,0,0,0],[0,0,0,0,0,0,140,0,0,0,0,0,0],[0,0,0,0,0,0,140,0,0,0,0,0,0],[0,0,0,0,0,0,140,0,0,0,0,0,0],[0,0,0,140,140,140,140,140,140,140,0,0,0],[0,0,0,140,140,140,140,140,140,140,140,140,0],[0,0,0,0,140,140,140,140,140,140,140,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0]],fgmap:[],width:13,height:13,autoEvent:{}}},function(e,t){main.floors.sample1={floorId:"sample1",title:"样板 1 层",name:"1",canFlyTo:!0,canUseQuickShop:!0,defaultGround:"grass",images:[[0,0,"bg.jpg",0]],weather:["snow",6],item_ratio:1,map:[[7,131,8,152,9,130,10,152,166,165,132,165,166],[0,0,0,0,0,0,0,152,165,164,0,162,165],[152,152,152,152,121,152,152,152,0,0,229,0,0],[43,33,44,151,0,0,0,152,165,161,0,163,165],[21,22,21,151,0,0,0,152,166,165,0,165,166],[151,245,151,151,0,87,0,152,152,152,85,153,153],[0,246,0,151,0,0,0,152,152,221,0,221,153],[246,0,246,151,0,0,0,121,85,0,0,0,153],[151,246,151,151,0,153,153,153,153,153,153,153,153],[0,0,0,0,0,0,0,164,0,0,163,0,0],[1,1,1,1,0,20,0,0,0,162,0,161,0],[1,0,123,1,0,20,124,0,121,0,122,0,126],[1,0,0,1,88,20,86,0,0,0,0,0,122]],firstArrive:[],events:{"4,10":["\t[样板提示]本层楼将会对各类事件进行介绍。","左边是一个仿50层的陷阱做法，上方是商店、快捷商店的使用方法，右上是一个典型的杀怪开门的例子，右下是各类可能的NPC事件。","本样板目前支持的事件列表大致有：\ntext: 显示一段文字（比如你现在正在看到的）\ntip: 左上角显示提示\nshow: 使一个事件有效（可见、可被交互）\nhide: 使一个事件失效（不可见、不可被交互）\ntrigger: 触发另一个地点的事件\nanimate: 显示动画\nbattle: 强制和某怪物战斗\nopenDoor: 无需钥匙开门（例如机关门、暗墙）","openShop: 打开一个全局商店\ndisableShop: 禁用一个全局商店\nchangeFloor: 传送勇士到某层某位置\nchangePos: 传送勇士到当层某位置；转向\nshowImage: 显示图片\nsetFg: 更改画面色调\nsetWeather: 更改天气\nmove: 移动事件效果\nmoveHero: 移动勇士效果\nplayBgm: 播放某个背景音乐\npauseBgm: 暂停背景音乐\nresumeBgm: 恢复背景音乐的播放\nplaySound: 播放某个音频","if: 条件判断\nchoices: 提供选项\nsetValue: 设置勇士属性道具，或某个变量/flag\nupdate: 更新状态栏和地图显伤\nwin: 获得胜利（游戏通关）\nlose: 游戏失败\nsleep: 等待多少毫秒\nexit: 立刻结束当前事件\nrevisit: 立刻结束事件并重新触发\nfunction: 自定义JS脚本\n\n更多支持的事件还在编写中，欢迎您宝贵的意见。",'有关各事件的样例，可参见本层一些NPC的写法。\n所有事件样例本层都有介绍。\n\n一个自定义事件处理完后，需要调用{"type": "hide"}该事件才不会再次出现。',{type:"hide"}],"1,5":{enable:!1,data:[]},"1,6":{enable:!1,data:[]},"0,7":{enable:!1,data:[]},"2,7":{enable:!1,data:[]},"1,8":{enable:!1,data:[]},"1,7":[{type:"show",loc:[1,5],time:1500},{type:"sleep",time:500},"\t[redKing]欢迎来到魔塔，你是第一百位挑战者。\n若你能打败我所有的手下，我就与你一对一的决斗。\n现在你必须接受我的安排。",{type:"show",loc:[[1,6],[0,7],[1,8],[2,7]],time:500},"\t[hero]什么？",{type:"playSound",name:"attack.mp3"},{type:"setValue",name:"status:atk",value:"status:atk/10"},{type:"setValue",name:"status:def",value:"status:def/10"},{type:"hide",loc:[[1,6],[0,7],[2,7],[1,8]]},{type:"hide",loc:[1,5],time:500},{type:"hide"},{type:"setCurtain",color:[0,0,0],time:1250},{type:"sleep",time:700},{type:"changeFloor",floorId:"sample1",loc:[1,11],direction:"right",time:1e3},{type:"trigger",loc:[2,11]}],"2,11":["\t[杰克,thief]喂！醒醒！快醒醒！",{type:"setCurtain",time:1500},"\t[hero]额，我这是在什么地方？","\t[杰克,thief]你被魔王抓了起来扔进了监狱，和我关在了一起，但是幸运的是我在昨天刚刚挖好一条越狱的暗道！",{type:"openDoor",loc:[3,11]},{type:"sleep",time:300},"\t[杰克,thief]我先走了，祝你好运！",{type:"move",time:750,steps:["right","right","down"]},"上面是个move事件，可以对NPC等进行移动。\n详见样板中小偷事件的写法。","\t[hero]怎么跑的这么快..."],"4,2":["\t[老人,man]本塔的商店有两类，全局商店和非全局商店。\n\n所谓非全局商店，就类似于右下角那个卖钥匙的老人一样，一定要碰到才能触发事件。\n\n而全局商店，则能在快捷商店中直接使用。","\t[老人,man]要注册一个全局商店，你需要在 data.js 中，找到 shops，并在内添加你的商店信息。",'\t[老人,man]商店信息添加后，可以在需要的事件处调用{"type": "openShop"}来打开你添加的全局商店。',"\t[老人,man]在上面的例子里，左边是一个仿50层的金币商店，右边是一个仿24层的经验商店。\n\n商店被访问后即可在快捷商店中进行使用。",'\t[老人,man]如果你需要在某层暂时禁用快捷商店，可以在data.js中设置cannotUseQuickShop。\n如果需要永久禁用商店，请使用{"type":"disableShop"}',{type:"hide",time:500}],"1,0":[{type:"openShop",id:"moneyShop1"}],"5,0":[{type:"openShop",id:"expShop1"}],"7,7":["\t[老人,man]这是一个典型的杀怪开门、强制战斗事件。",{type:"hide"}],"8,7":{enable:!1,data:[]},"9,7":[{type:"show",loc:[8,7]},{type:"hide"}],"10,4":["\t[blackKing]你终于还是来了。","\t[hero]放开我们的公主！","\t[blackKing]如果我不愿意呢？","\t[hero]无需多说，拔剑吧！",{type:"battle",id:"blackKing"},{type:"hide",loc:[10,2]},{type:"openDoor",loc:[8,7]},"\t[blackKing]没想到你已经变得这么强大了... 算你厉害。\n公主就交给你了，请好好对她。",{type:"hide"}],"10,0":["\t[hero]公主，我来救你了~","\t[公主,princess]快救我出去！我受够这里了！","\t[hero]公主别怕，我们走吧~",{type:"win",reason:"救出公主"}],"6,12":{enable:!1,data:[]},"6,11":['\t[仙子,fairy]通过调用 {"type": "show"} 可以使隐藏的事件显示出来。\n比如我下面这个机关门。',{type:"show",loc:[6,12]},'\t[仙子,fairy]通过调用 {"type": "openDoor"} 可以无需钥匙打开一扇门或暗墙。',{type:"openDoor",loc:[6,12]},"\t[仙子,fairy]同时，也可以对其它层进行操作，比如楼下的机关门，现在已经为你打开了。",{type:"openDoor",loc:[11,10],floorId:"sample0"},"\t[仙子,fairy]如果 show 或 hide 指定了 time 参数，则以动画效果显示，指定的参数作为消失时间（毫秒）来计算。","\t[仙子,fairy]现在到楼下来找我吧~",{type:"show",loc:[12,10],floorId:"sample0"},{type:"hide",time:500}],"8,11":[{type:"setValue",name:"flag:man_times",value:"flag:man_times+1"},"\t[老人,man]在文字中使用${' ${ '}和 } 可以计算并显示一个表达式的结果。\n","\t[老人,man]例如：\n你的当前攻击力是${status:atk}，防御力是${status:def}。\n攻防和的十倍是${10*(status:atk+status:def)}，攻防之积是${status:atk*status:def}。\n你有${item:yellowKey}把黄钥匙，${item:blueKey}把蓝钥匙，${item:redKey}把红钥匙。\n你有${item:pickaxe}个破，${item:bomb}个炸，${item:centerFly}个飞。\n这是你第${flag:man_times}次和我对话。",'\t[老人,man]同时，你也可以通过{"type": "setValue"}来设置一个勇士的属性、道具，或某个Flag。',"\t[老人,man]例如：\n现在我将让你的攻防提升50%，再将攻防和的十倍加到生命值上。",{type:"setValue",name:"status:atk",value:"status:atk*1.5"},{type:"setValue",name:"status:def",value:"status:def*1.5"},{type:"setValue",name:"status:hp",value:"status:hp+10*(status:atk+status:def)"},"\t[老人,man]再送你500金币，1000经验，1破2炸3飞！",{type:"setValue",name:"status:money",value:"status:money+500"},{type:"setValue",name:"status:experience",value:"status:experience+1000"},{type:"setValue",name:"item:pickaxe",value:"item:pickaxe+1"},{type:"setValue",name:"item:bomb",value:"item:bomb+2"},{type:"setValue",name:"item:centerFly",value:"item:centerFly+3"},"\t[老人,man]status:xxx 代表勇士的某个属性。\n其中xxx可取hp, atk, def, mdef, money,experience这几项。\n\nitem:xxx 代表勇士的某个道具的个数。\nxxx为道具ID，具体可参见items.js中的定义。\n\nflag:xxx 代表某个自定义Flag或变量。\nxxx为Flag/变量名，可以自行定义，由字母、数字和下划线组成。\n未定义过而直接取用的Flag默认值为false。","\t[老人,man]你现在可以重新和我进行对话，进一步看到属性值的改变。"],"10,11":[{type:"if",condition:"flag:woman_times==0",true:["\t[老人,woman]这是个很复杂的例子，它将教会你如何使用if 语句进行条件判断，以及 choices 提供选项来供用户进行选择。","\t[老人,woman]第一次访问我将显示这段文字；从第二次开始将会向你出售钥匙。\n钥匙价格将随着访问次数递增。\n当合计出售了七把钥匙后，将送你一把大黄门钥匙，并消失不再出现。","\t[老人,woman]这部分的逻辑比较长，请细心看样板的写法，是很容易看懂并理解的。"],false:[{type:"if",condition:"flag:woman_times==8",true:["\t[老人,woman]你购买的钥匙已经够多了，再继续卖给你的话我会有危险的。","\t[老人,woman]看在你贡献给我这么多钱的份上，送你一把大黄门钥匙吧，希望你能好好用它。",{type:"setValue",name:"item:bigKey",value:"item:bigKey+1"},"\t[老人,woman]我先走了，拜拜~",{type:"hide",time:500},{type:"exit"}],false:[{type:"choices",text:"\t[老人,woman]少年，你需要钥匙吗？\n我这里有大把的！",choices:[{text:"黄钥匙（${9+flag:woman_times}金币）",action:[{type:"if",condition:"status:money>=9+flag:woman_times",true:[{type:"setValue",name:"status:money",value:"status:money-(9+flag:woman_times)"},{type:"setValue",name:"item:yellowKey",value:"item:yellowKey+1"}],false:["\t[老人,woman]你的金钱不足！",{type:"revisit"}]}]},{text:"蓝钥匙（${18+2*flag:woman_times}金币）",action:[{type:"if",condition:"status:money>=18+2*flag:woman_times",true:[{type:"setValue",name:"status:money",value:"status:money-(18+2*flag:woman_times)"},{type:"setValue",name:"item:blueKey",value:"item:blueKey+1"}],false:["\t[老人,woman]你的金钱不足！",{type:"revisit"}]}]},{text:"红钥匙（${36+4*flag:woman_times}金币）",action:[{type:"if",condition:"status:money>=36+4*flag:woman_times",true:[{type:"setValue",name:"status:money",value:"status:money-(36+4*flag:woman_times)"},{type:"setValue",name:"item:redKey",value:"item:redKey+1"}],false:["\t[老人,woman]你的金钱不足！",{type:"revisit"}]}]},{text:"离开",action:[{type:"exit"}]}]}]}]},{type:"setValue",name:"flag:woman_times",value:"flag:woman_times+1"},{type:"revisit"}],"12,11":['\t[老人,womanMagician]使用 {"type":"function"} 可以写自定义的JS脚本。\n本塔支持的所有主要API会在doc文档内给出。',"\t[老人,womanMagician]例如这个例子：即将弹出一个输入窗口，然后会将你的输入结果直接加到你的攻击力上。",{type:"input",text:"请输入你要加攻击力的数值："},{type:"if",condition:"flag:input>0",true:[{type:"setValue",name:"status:atk",value:"status:atk+flag:input"},{type:"tip",text:"操作成功，攻击+${flag:input}"},"操作成功，攻击+${flag:input}"],false:[]},"\t[老人,womanMagician]具体可参见样板中本事件的写法。"],"10,12":null,"12,12":[{type:"switch",condition:"flag:woman_times",caseList:[{case:"0",action:["\t[老人,woman]现在使用switch改写这个例子"]},{case:"8",action:["\t[老人,woman]你购买的钥匙已经够多了，再继续卖给你的话我会有危险的。","\t[老人,woman]看在你贡献给我这么多钱的份上，送你一把大黄门钥匙吧，希望你能好好用它。",{type:"setValue",name:"item:bigKey",value:"item:bigKey+1"},"\t[老人,woman]我先走了，拜拜~",{type:"hide",time:500},{type:"exit"}]},{case:"default",action:[{type:"comment",text:"当没有符合的值的场合执行此事件"},{type:"choices",text:"\t[老人,woman]少年，你需要钥匙吗？\n我这里有大把的！",choices:[{text:"黄钥匙（${9+flag:woman_times}金币）",action:[{type:"if",condition:"status:money>=9+flag:woman_times",true:[{type:"setValue",name:"status:money",value:"status:money-(9+flag:woman_times)"},{type:"setValue",name:"item:yellowKey",value:"item:yellowKey+1"}],false:["\t[老人,woman]你的金钱不足！",{type:"revisit"}]}]},{text:"蓝钥匙（${18+2*flag:woman_times}金币）",action:[{type:"if",condition:"status:money>=18+2*flag:woman_times",true:[{type:"setValue",name:"status:money",value:"status:money-(18+2*flag:woman_times)"},{type:"setValue",name:"item:blueKey",value:"item:blueKey+1"}],false:["\t[老人,woman]你的金钱不足！",{type:"revisit"}]}]},{text:"红钥匙（${36+4*flag:woman_times}金币）",action:[{type:"if",condition:"status:money>=36+4*flag:woman_times",true:[{type:"setValue",name:"status:money",value:"status:money-(36+4*flag:woman_times)"},{type:"setValue",name:"item:redKey",value:"item:redKey+1"}],false:["\t[老人,woman]你的金钱不足！",{type:"revisit"}]}]},{text:"离开",action:[{type:"exit"}]}]}]}]},{type:"setValue",name:"flag:woman_times",value:"flag:woman_times+1"},{type:"revisit"}]},changeFloor:{"4,12":{floorId:"sample0",loc:[6,0]},"5,5":{floorId:"sample2",stair:"downFloor",direction:"up"},"10,12":null},afterBattle:{"9,6":[{type:"setValue",name:"flag:door",value:"flag:door+1"}],"11,6":[{type:"setValue",name:"flag:door",value:"flag:door+1"}]},afterGetItem:{},afterOpenDoor:{},cannotMove:{},bgmap:[],fgmap:[],autoEvent:{"10,5":{0:{condition:"flag:door==2",currentFloor:!0,priority:0,delayExecute:!1,multiExecute:!1,data:[{type:"openDoor"}]}}}}},function(e,t){main.floors.sample2={floorId:"sample2",title:"样板 2 层",name:"2",canFlyTo:!0,canUseQuickShop:!0,cannotViewMap:!1,defaultGround:"ground",images:[],item_ratio:1,map:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,121,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,202,0,0,0,0,0,0,0,0,1,0,0,0,202,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0],[0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0],[0,0,0,0,1,1,45,0,1,0,202,202,0,0,0,0,0,1,1,0,0,1,0,202,202,0],[0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,88,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,202,0,0,0,0,0,0,0,0,0,0,0,0,202,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,87,0,0,0,0,122,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,202,0,0,0,0,0,0,0,0,1,0,0,0,202,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0],[0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0],[0,0,0,0,1,1,0,0,1,0,202,202,0,0,0,0,0,1,1,0,0,1,0,202,202,0],[0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,202,0,0,0,0,0,0,0,0,0,0,0,0,202,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],width:26,height:26,firstArrive:[],events:{"3,2":["123"],"12,12":["234"]},changeFloor:{"6,10":{floorId:"sample1",stair:"upFloor"},"7,12":{floorId:"sample3",stair:"downFloor"}},afterBattle:{},afterGetItem:{},afterOpenDoor:{},cannotMove:{},upFloor:null,bgmap:[[140,140,140,140,140,140,140,140,140,140,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[140,140,140,140,140,140,140,140,140,140,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[140,140,140,140,140,140,140,140,140,140,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[140,140,140,140,140,140,140,140,140,140,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[140,140,140,140,140,140,140,140,140,140,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[140,140,140,140,140,140,140,140,140,140,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[140,140,140,140,140,140,140,140,140,140,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[140,140,140,140,140,140,140,140,140,140,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[140,140,140,140,140,140,140,140,140,140,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[140,140,140,140,140,140,140,140,140,140,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],fgmap:[],autoEvent:{}}},function(e,t){main.floors.sample3={floorId:"sample3",title:"主塔 40 层",name:"40",canFlyTo:!1,canUseQuickShop:!0,defaultGround:"snowGround",images:[],color:[255,0,0,.3],weather:["rain",10],bgm:"bgm.mp3",item_ratio:1,map:[[5,5,5,5,5,5,87,5,5,5,5,5,5],[5,4,4,4,4,1,0,1,4,4,4,4,5],[5,4,4,4,4,1,85,1,4,4,4,4,5],[5,4,4,4,247,1,247,1,247,4,4,4,5],[5,4,4,4,1,247,247,247,1,4,4,4,5],[5,4,4,4,1,247,30,247,1,4,4,4,5],[5,4,4,4,247,1,124,1,247,4,4,4,5],[5,4,4,4,4,1,123,1,4,4,4,4,5],[5,4,4,4,4,1,0,1,4,4,4,4,5],[5,4,4,4,4,1,0,1,4,4,4,4,5],[5,4,4,4,4,4,0,4,4,4,4,4,5],[5,4,4,4,4,4,85,4,4,4,4,4,5],[5,5,5,5,5,5,88,5,5,5,5,5,5]],firstArrive:["\t[实战！]本楼将尝试复刻《宿命的旋律》40F剧情。"],events:{"6,11":{enable:!1,data:[]},"6,10":[{type:"playSound",name:"door.mp3"},{type:"show",loc:[6,11]},{type:"hide"},{type:"trigger",loc:[6,7]}],"6,7":[{type:"playSound",name:"item.mp3"},"\t[hero]杰克，你究竟是什么人？",{type:"playSound",name:"item.mp3"},"\t[杰克,thief]……",{type:"playSound",name:"item.mp3"},"\t[hero]我们……是朋友对吧？\n是朋友就应该相互信任对吧？",{type:"playSound",name:"item.mp3"},"\t[杰克,thief]……事到如今也没有什么好隐瞒的了。",{type:"playSound",name:"item.mp3"},"\t[杰克,thief]没错，我就是这一切的背后主谋。",{type:"move",steps:[{direction:"up",value:3}],time:1e3},{type:"show",loc:[6,4],time:1e3},{type:"sleep",time:500},{type:"playSound",name:"item.mp3"},"\t[blackMagician]我的真名为——黑暗大法师，第四区域的头目。",{type:"playSound",name:"item.mp3"},"\t[hero]呵呵，不知道为什么，我竟然对事情走到现在这一步毫不感觉意外。",{type:"playSound",name:"item.mp3"},"\t[blackMagician]以杰克的名义利用了你这么久，真是抱歉啊。",{type:"playSound",name:"item.mp3"},"\t[hero]真正的杰克现在在哪里？",{type:"playSound",name:"item.mp3"},"\t[blackMagician]盗贼杰克这个人类从未存在过，他只是我用来接近你的一副皮囊而已。",{type:"playSound",name:"item.mp3"},"\t[hero]……这样啊，呵呵。",{type:"playSound",name:"item.mp3"},"\t[blackMagician]为什么你看上去丝毫不生气？",{type:"playSound",name:"item.mp3"},"\t[hero]多亏了鬼帝，我现在的脾气好得连我自己都害怕。",{type:"playSound",name:"item.mp3"},"\t[hero]说起来我还得好好感谢你呢，如果没有杰克……你的帮助，我早就死在第一区域了。",{type:"playSound",name:"item.mp3"},"\t[hero]不论你的目的如何，你的所作所为都是对我有利的。不是吗？",{type:"playSound",name:"item.mp3"},"\t[blackMagician]能够如此淡定的面对背叛，看来跟五年前相比，你确实成长了很多啊。",{type:"playSound",name:"item.mp3"},"\t[hero]五年前？……黑暗大法师，在这之前，我们好像素未谋面吧？",{type:"playSound",name:"item.mp3"},"\t[blackMagician]五年前那场屠城你应该这一生都不会忘记吧。",{type:"playSound",name:"item.mp3"},"\t[blackMagician]很不巧，那场屠城的主谋，也是我。",{type:"playSound",name:"item.mp3"},"\t[hero]……",{type:"playSound",name:"item.mp3"},"\t[hero]这么说，击中我双亲的那道紫色闪电，也就是你释放的吧……",{type:"playSound",name:"item.mp3"},"\t[blackMagician]你的双亲？这种事情我怎么可能会记得？\n你难道在踩死蚂蚁的时候还会一只只记下他们的样子吗？",{type:"playSound",name:"item.mp3"},"\t[hero]老 子 要 你 的 命",{type:"playSound",name:"item.mp3"},"\t[blackMagician]你应该对我心怀感激才对，如果不是那时的我看出了你隐藏的稀有勇者体质，你绝对不可能活到今天。",{type:"playSound",name:"item.mp3"},"\t[blackMagician]在暗中动手脚让你通过勇者选拔的人也是我，我一直一直在暗中引导你走到今天这一步。",{type:"playSound",name:"item.mp3"},"\t[blackMagician]是我救赎了一无是处的你。",{type:"playSound",name:"item.mp3"},"\t[hero]为什么只有我一个人活了下来！！！！",{type:"playSound",name:"item.mp3"},"\t[hero]为什么偏偏是我！！！！",{type:"playSound",name:"item.mp3"},"\t[blackMagician]我刚才不是说过了吗？因为我看出了你有稀有勇者体质啊。",{type:"playSound",name:"item.mp3"},"\t[blackMagician]你刚刚跟鬼帝交过手，应该已经很清楚这稀有勇者体质意味着什么了吧？",{type:"playSound",name:"item.mp3"},"\t[hero]……就因为我有这种体质，就不得不背负如此残酷的宿命吗？",{type:"playSound",name:"item.mp3"},"\t[blackMagician]愚蠢！这意味着只要我对你加以引导跟培养，你就能成为这世间实力最强的存在！",{type:"playSound",name:"item.mp3"},"\t[hero]……所以，你究竟想利用我干什么？",{type:"playSound",name:"item.mp3"},"\t[blackMagician]我利用你干的事情，你不是已经完成了吗？",{type:"playSound",name:"item.mp3"},"\t[hero]……你说什么？",{type:"playSound",name:"item.mp3"},"\t[blackMagician]不知不觉间，你已经在我的指引下跟鬼帝正面交手并且杀掉了他啊。",{type:"playSound",name:"item.mp3"},"\t[hero]就连我跟鬼帝的对决……也是被你安排好了的？",{type:"playSound",name:"item.mp3"},"\t[blackMagician]你们两个一个是人类勇者，一个是魔物勇者，迟早会有交手的一天。",{type:"playSound",name:"item.mp3"},"\t[blackMagician]我只不过是操纵了一系列的连锁事件让这一天提早了数十年到来而已。",{type:"playSound",name:"item.mp3"},"\t[hero]……你这样做对谁有好处？他可是你们魔物世界的救世主啊。",{type:"playSound",name:"item.mp3"},"\t[blackMagician]一个惧怕征战，爱好和平的懦夫，也配叫救世主？",{type:"playSound",name:"item.mp3"},"\t[blackMagician]获得了力量，却只会被动挨打而不主动向人类世界出击，龟缩在第二区域惶惶度日，他根本就不配拥有稀有勇者体质。",{type:"playSound",name:"item.mp3"},"\t[blackMagician]为了不让这种人霸占着积累多年的庞大灵魂能量无作为，我设计让你杀掉了他。",{type:"playSound",name:"item.mp3"},"\t[blackMagician]你没有辜负我的期待，成功战胜了那个废物，现在你体内累积的灵魂能量……也就是魔力，已经达到了能跟魔王匹敌的地步。",{type:"playSound",name:"item.mp3"},"\t[hero]……是吗？现在的我能与魔王匹敌？",{type:"playSound",name:"item.mp3"},"\t[blackMagician]不止如此，你现在的力量之强就算是统治世界也是绰绰有余！",{type:"playSound",name:"item.mp3"},"\t[blackMagician]怎么样？要不要加入我的麾下，跟随我去征战人类世界？",{type:"playSound",name:"item.mp3"},"\t[hero]能与魔王匹敌的话，也就是说。",{type:"playSound",name:"item.mp3"},"\t[hero]我 现 在 对 付 你 这 种 杂 碎 也 绰 绰 有 余 吧 ？",{type:"playSound",name:"item.mp3"},"\t[blackMagician]……什么？！",{type:"playSound",name:"item.mp3"},"\t[blackMagician]等一下！别冲动！你先等我把这利害关系理一理——",{type:"playSound",name:"item.mp3"},"\t[hero]你给老子闭嘴。",{type:"playSound",name:"item.mp3"},"\t[hero]老子什么都不想听。",{type:"playSound",name:"item.mp3"},"\t[hero]老子现在想做的事情只有一件——",{type:"playSound",name:"item.mp3"},"\t[hero]剁掉你的头，把它放回我双亲的墓前。",{type:"update"}],"6,4":{enable:!1,data:[]},"5,4":{enable:!1,data:[]},"7,4":{enable:!1,data:[]},"5,5":{enable:!1,data:[]},"7,5":{enable:!1,data:[]},"6,3":{trigger:"action",enable:!1,data:["\t[blackMagician]听不进去人话的蠢货，就要用疼痛来管教！",{type:"changePos",direction:"up"},{type:"playSound",name:"item.mp3"},"\t[blackMagician]出来吧！禁忌——紫电凶杀阵！",{type:"show",loc:[[4,3],[4,6],[8,6],[8,3]],time:500},{type:"sleep",time:500},"\t[blackMagician]感受绝望吧！冥顽不化的蠢货！",{type:"animate",name:"yongchang",loc:[4,3]},{type:"animate",name:"yongchang",loc:[4,6]},{type:"animate",name:"yongchang",loc:[8,6]},{type:"animate",name:"yongchang",loc:[8,3]},{type:"sleep",time:200},{type:"playSound",name:"attack.mp3"},{type:"animate",name:"thunder",loc:"hero"},{type:"sleep",time:200},"\t[hero]唔……！！（吐血）",{type:"playSound",name:"item.mp3"},"\t[blackMagician]我的魔力可是充足的很啊！我会一直折磨到你屈服于我为止！",{type:"playSound",name:"item.mp3"},"\t[blackMagician]人类！好好感受吧！当初你们施加于我的痛苦！如今我要百倍奉还！",{type:"show",loc:[6,6],time:1e3},{type:"sleep",time:700},{type:"trigger",loc:[6,6]}]},"4,3":{trigger:"action",displayDamage:!1,enable:!1,data:[]},"8,3":{trigger:"action",displayDamage:!1,enable:!1,data:[]},"4,6":{trigger:"action",displayDamage:!1,enable:!1,data:[]},"8,6":{trigger:"action",displayDamage:!1,enable:!1,data:[]},"6,6":{enable:!1,data:[{type:"playSound",name:"item.mp3"},"\t[hero]…妖精…小姐……是你吗？",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]不要绝望，也不要悲伤。",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]你从来都不是独自一人在前进。",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]咱一直，一直都在注视着你。",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]耍小聪明的你、笨笨的你呆呆的你、胆小的你、勇敢的你帅气的你……全部全部都是你。",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]所以放心吧，无论发生什么，咱都会陪伴在你身边的。",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]因为你要是离开我的话，立刻就会死掉吧？",{type:"playSound",name:"item.mp3"},"\t[hero]…妖精…小姐……其实一直以来，我都非常感激你……",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]笨蛋！都这种时候了就不要作出像是临终遗言的发言了啊！！",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]喂！那边穿衣品味差到极点的黑暗大法师，别左顾右盼说的就是你！你应该知道咱的身份吧？\n还不速速退下！",{type:"playSound",name:"item.mp3"},"\t[blackMagician]可恶…多管闲事的妖精族…明明只要再让他承受一点疼痛来瓦解他的意志力，我的计划就成功了！",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]哼哼哼~抱歉哦，这个笨蛋的意志力可不像你想象的那么薄弱哦！",{type:"playSound",name:"item.mp3"},"\t[blackMagician]不甘心！我不甘心！妖精公主又如何！\n只要是阻挡我的，不管是谁我都要铲除！",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]终于露出狐狸尾巴了，其实咱早就看出你有谋反的念头。你的计划就是拉拢这家伙入伙然后推翻魔王对魔塔的统治对吧？",{type:"playSound",name:"item.mp3"},"\t[blackMagician]呵呵呵……那个昏庸的魔王，掌握着那么庞大的魔物军队却只知道固守魔塔，而不主动侵略人类世界扩张领土！",{type:"playSound",name:"item.mp3"},"\t[blackMagician]我实在是看不过眼，所以我才决定把这个具备稀有勇者体质的家伙培养成新一任魔王！\n来让这个世界的势力重新洗牌！",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]你觉得一个满脑子想着回家种田的废柴勇者会成为改变世界的魔王？你晃晃脑袋试试，是不是能听到大海的声音？",{type:"playSound",name:"item.mp3"},"\t[blackMagician]恼人至极的妖精族！呵呵呵……我干脆一不做二不休，连你也一块收拾了吧！",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]别小瞧咱！咱好歹也是妖精族里实力数一数二的存在！",{type:"playSound",name:"item.mp3"},"\t[blackMagician]只会耍嘴皮子的恼人苍蝇！我倒要看看一块焦炭会不会说话！\n——招雷弹！！",{type:"animate",name:"yongchang",loc:[4,3]},{type:"animate",name:"yongchang",loc:[4,6]},{type:"animate",name:"yongchang",loc:[8,6]},{type:"animate",name:"yongchang",loc:[8,3]},{type:"playSound",name:"attack.mp3"},{type:"animate",name:"thunder",loc:[6,6]},{type:"sleep",time:500},"\t[小妖精,fairy]切，这点伤痛跟他刚才经历的身心地狱相比根本就不算什么。",{type:"playSound",name:"item.mp3"},"\t[blackMagician]哼！翅膀都被烧焦了还要嘴硬？你难不成真以为我不会对你动真格？",{type:"playSound",name:"item.mp3"},"\t[hero]……你这混蛋！给我离她远点！！",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]！…你现在受了很严重的致命伤，乱动什么？\n乖。别怕，这里有咱顶着！",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]对了，咱再问你一遍，你是很珍惜自己性命的对吧？",{type:"playSound",name:"item.mp3"},"\t[hero]！…等等…妖精小姐，你不会是……？",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]喂，黑暗大法师，你作为魔塔里最博学多识的蠢货，应该对咱妖精族的特殊能力再清楚不过吧？",{type:"playSound",name:"item.mp3"},"\t[blackMagician]什么？！难不成你是想！！不可能……\n就为了一个渺小的人类，不可理喻！！",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]哼哼哼！你害怕的表情可真美味！",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]不过比起这个，咱更期待你吃到“妖精自灭冲击”之后的死状哦！~",{type:"playSound",name:"item.mp3"},"\t[blackMagician]不！！不应该是这样的！我完美的计划竟然会被一只小小的妖精破坏！",{type:"playSound",name:"item.mp3"},"\t[hero]不要！……千万不要！……为了我这种人……唔！",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]笨蛋，动都动不了了就不要强撑着站起来了啊。",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]真是的，都到最后一刻了，你这家伙好歹也让咱省点心吧。",{type:"playSound",name:"item.mp3"},"\t[小妖精,fairy]那么，再见了……我的勇者大人。",{type:"move",time:700,steps:[{direction:"up",value:3}]},{type:"playSound",name:"attack.mp3"},{type:"sleep",time:200},"\t[blackMagician]不可能！！！！！",{type:"hide",loc:[6,3]},{type:"hide",loc:[4,3]},{type:"hide",loc:[4,6]},{type:"hide",loc:[8,6]},{type:"hide",loc:[8,3]},{type:"changeFloor",floorId:"sample3",loc:[6,6],direction:"up",time:1e3},{type:"show",loc:[6,5]},{type:"sleep",time:200},{type:"playSound",name:"item.mp3"},{type:"sleep",time:200},"\t[hero]…妖精…小姐……",{type:"playSound",name:"item.mp3"},"\t[hero]……妖精小姐！",{type:"playSound",name:"item.mp3"},"\t[hero]是梦吗？……不对，为什么我在流泪？",{type:"playSound",name:"item.mp3"},"\t[hero]这颗漂亮的宝石是……？",{type:"playSound",name:"item.mp3"},"\t[hero]我全都想起来了……妖精小姐为了我……\n牺牲了自己的性命。",{type:"playSound",name:"item.mp3"},"\t[hero]在这颗宝石上，我能感受到你的温度……\n熟悉而又令人安心，这就是你最后留给我的东西吗……",{type:"playSound",name:"item.mp3"},"\t[hero]好温暖……",{type:"setValue",name:"item:yellowJewel",value:"1"},{type:"hide",loc:[6,5]},{type:"playSound",name:"item.mp3"},"\t[hero]……",{type:"openDoor",loc:[6,2]},{type:"openDoor",loc:[6,11]}]},"6,5":{enable:!1,data:[]}},changeFloor:{"6,0":{floorId:"sample3",stair:"upFloor"},"6,12":{floorId:"sample2",stair:"upFloor"}},afterBattle:{"6,4":["\t[blackMagician]天真！你以为这样就能战胜我吗？",{type:"show",loc:[7,5],time:500},{type:"update"}],"7,5":["\t[blackMagician]你打败的不过是我众多分身中的其中一个而已。",{type:"show",loc:[5,4],time:500},{type:"update"}],"5,4":["\t[blackMagician]你的身体已经伤痕累累了，可我还留有着九成多的魔力。",{type:"show",loc:[5,5],time:500},{type:"update"}],"5,5":["\t[blackMagician]顽固的家伙！放弃抵抗吧！",{type:"show",loc:[7,4],time:500},{type:"update"}],"7,4":["\t[blackMagician]哈哈哈哈！我的灵魂远比你想象的强大！\n我即是永恒！",{type:"show",loc:[6,3],time:500},{type:"trigger",loc:[6,3]}]},afterGetItem:{},afterOpenDoor:{},cannotMove:{},bgmap:[],fgmap:[]}},function(e,t,o){"use strict";o.r(t);var r=o(36),a=o(11),n=o.n(a),i=o(19),s=o.n(i),c=o(12),l=o(8);function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==o)return;var r,a,n=[],i=!0,s=!1;try{for(o=o.call(e);!(i=(r=o.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(s)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return p(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var d=f;function f(){this._init()}f.prototype._init=function(){this.controldata=n.a.control,this.renderFrameFuncs=[],this.replayActions=[],this.resizes=[],this.registerAnimationFrame("totalTime",!1,this._animationFrame_totalTime),this.registerAnimationFrame("autoSave",!0,this._animationFrame_autoSave),this.registerAnimationFrame("parallelDo",!1,this._animationFrame_parallelDo),this.registerReplayAction("move",this._replayAction_move),this.registerReplayAction("item",this._replayAction_item),this.registerReplayAction("equip",this._replayAction_equip),this.registerReplayAction("unEquip",this._replayAction_unEquip),this.registerReplayAction("fly",this._replayAction_fly),this.registerReplayAction("shop",this._replayAction_shop),this.registerReplayAction("turn",this._replayAction_turn),this.registerReplayAction("getNext",this._replayAction_getNext),this.registerReplayAction("moveDirectly",this._replayAction_moveDirectly),this.registerReplayAction("key",this._replayAction_key)},f.prototype.registerAnimationFrame=function(e,t,o){this.unregisterAnimationFrame(e),this.renderFrameFuncs.push({name:e,needPlaying:t,func:o})},f.prototype.unregisterAnimationFrame=function(e){this.renderFrameFuncs=this.renderFrameFuncs.filter((function(t){return t.name!=e}))},f.prototype._setRequestAnimationFrame=function(){this._checkRequestAnimationFrame(),core.animateFrame.totalTime=Math.max(core.animateFrame.totalTime,core.getLocalStorage("totalTime",0));window.requestAnimationFrame((function e(t){core.control.renderFrameFuncs.forEach((function(e){if(e.func)try{!core.isPlaying()&&e.needPlaying||core.doFunc(e.func,core.control,t)}catch(t){main.log(t),main.log("ERROR in requestAnimationFrame["+e.name+"]：已自动注销该项。"),core.unregisterAnimationFrame(e.name)}})),window.requestAnimationFrame(e)}))},f.prototype._checkRequestAnimationFrame=function(){!function(){for(var e=0,t=["webkit","moz"],o=0;o<t.length&&!window.requestAnimationFrame;++o)window.requestAnimationFrame=window[t[o]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[o]+"CancelAnimationFrame"]||window[t[o]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,o){var r=(new Date).getTime(),a=Math.max(0,16.7-(r-e)),n=window.setTimeout((function(){t(r+a)}),a);return e=r+a,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}()},f.prototype._animationFrame_totalTime=function(e){core.animateFrame.totalTime+=e-core.animateFrame.totalTimeStart,core.animateFrame.totalTimeStart=e,core.isPlaying()&&(core.status.hero.statistics.totalTime=core.animateFrame.totalTime,core.status.hero.statistics.currTime+=e-(core.status.hero.statistics.start||e),core.status.hero.statistics.start=e)},f.prototype._animationFrame_autoSave=function(e){e-core.saves.autosave.time<=5e3||(core.control.checkAutosave(),core.saves.autosave.time=e)},f.prototype._animationFrame_globalAnimate=function(e){e-core.animateFrame.globalTime<=core.values.animateSpeed||(core.status.globalAnimateStatus++,core.status.floorId&&(core.status.globalAnimateObjs.forEach((function(e){core.drawBlock(e,core.status.globalAnimateStatus%(e.event.animate||1))})),core.maps._drawFloorImages(core.status.floorId,core.canvas.bg,"bg",core.status.floorAnimateObjs||[],core.status.globalAnimateStatus),core.maps._drawFloorImages(core.status.floorId,core.canvas.fg,"fg",core.status.floorAnimateObjs||[],core.status.globalAnimateStatus),core.status.autotileAnimateObjs.blocks.forEach((function(e){core.maps._drawAutotileAnimate(e,core.status.globalAnimateStatus)}))),core.drawBoxAnimate(),core.animateFrame.globalTime=e)},f.prototype._animationFrame_animate=function(e){if(!(e-core.animateFrame.animateTime<50)&&core.status.animateObjs&&0!=core.status.animateObjs.length){core.clearMap("animate");for(var t=0;t<core.status.animateObjs.length;t++){var o=core.status.animateObjs[t];o.index==o.animate.frames.length&&function(e){setTimeout((function(){e&&e()}))}(o.callback)}core.status.animateObjs=core.status.animateObjs.filter((function(e){return e.index<e.animate.frames.length})),core.status.animateObjs.forEach((function(e){e.hero?core.maps._drawAnimateFrame(e.animate,core.status.heroCenter.px,core.status.heroCenter.py,e.index++):core.maps._drawAnimateFrame(e.animate,e.centerX,e.centerY,e.index++)})),core.animateFrame.animateTime=e}},f.prototype._animationFrame_heroMoving=function(e){core.status.heroMoving<=0||(e-core.animateFrame.moveTime>(core.values.moveSpeed||100)&&(core.animateFrame.leftLeg=!core.animateFrame.leftLeg,core.animateFrame.moveTime=e),core.drawHero(core.animateFrame.leftLeg?"leftFoot":"rightFoot",4*core.status.heroMoving))},f.prototype._animationFrame_weather=function(e){var t=core.animateFrame.weather;e-t.time<=30||!core.dymCanvas.weather||(core.control["_animationFrame_weather_"+t.type](),t.time=e)},f.prototype._animationFrame_weather_rain=function(){var e=core.dymCanvas.weather,t=core.bigmap.offsetX,o=core.bigmap.offsetY;core.clearMap("weather"),e.strokeStyle="rgba(174,194,224,0.8)",e.lineWidth=1,e.lineCap="round",core.animateFrame.weather.nodes.forEach((function(r){e.beginPath(),e.moveTo(r.x-t,r.y-o),e.lineTo(r.x+r.l*r.xs-t,r.y+r.l*r.ys-o),e.stroke(),r.x+=r.xs,r.y+=r.ys,(r.x>32*core.bigmap.width||r.y>32*core.bigmap.height)&&(r.x=Math.random()*core.bigmap.width*32,r.y=-10)})),e.fill()},f.prototype._animationFrame_weather_snow=function(){var e=core.dymCanvas.weather,t=core.bigmap.offsetX,o=core.bigmap.offsetY;core.clearMap("weather"),e.fillStyle="rgba(255, 255, 255, 0.8)",e.beginPath(),core.animateFrame.weather.data=core.animateFrame.weather.data||0,core.animateFrame.weather.data+=.01;var r=core.animateFrame.weather.data;core.animateFrame.weather.nodes.forEach((function(a){e.moveTo(a.x-t,a.y-o),e.arc(a.x-t,a.y-o,a.r,0,2*Math.PI,!0),a.x+=2*Math.sin(r),a.y+=Math.cos(r+a.d)+1+a.r/2,(a.x>32*core.bigmap.width+5||a.x<-5||a.y>32*core.bigmap.height)&&(Math.random()>1/3?(a.x=Math.random()*core.bigmap.width*32,a.y=-10):(Math.sin(r)>0?a.x=-5:a.x=32*core.bigmap.width+5,a.y=Math.random()*core.bigmap.height*32))})),e.fill()},f.prototype._animationFrame_weather_fog=function(){var e=core.dymCanvas.weather,t=core.bigmap.offsetX,o=core.bigmap.offsetY;if(core.clearMap("weather"),core.animateFrame.weather.fog){var r=core.__PIXELS__,a=core.__PIXELS__;core.setAlpha("weather",.5),core.animateFrame.weather.nodes.forEach((function(n){e.drawImage(core.animateFrame.weather.fog,n.x-t,n.y-o,r,a),n.x+=n.xs,n.y+=n.ys,n.x>32*core.bigmap.width-r/2&&(n.x=32*core.bigmap.width-r/2-1,n.xs=-n.xs),n.x<-r/2&&(n.x=-r/2+1,n.xs=-n.xs),n.y>32*core.bigmap.height-a/2&&(n.y=32*core.bigmap.height-a/2-1,n.ys=-n.ys),n.y<-a/2&&(n.y=-a/2+1,n.ys=-n.ys)})),core.setAlpha("weather",1)}},f.prototype._animateFrame_tips=function(e){var t=core.animateFrame.tips;if(!(e-t.time<=30)){var o=e-t.time;if(t.time=e,0!=t.list.length){var r=Math.max(t.offset-5,0),a=null,n=[];for(core.setFont("data","16px Arial"),core.setTextAlign("data","left"),core.clearMap("data",0,0,this.PIXEL,50*t.lastSize),t.lastLength=t.list.length;t.list.length>0;){var i=t.list.shift();core.ui._drawTip_drawOne(i,r),1==i.stage?(i.opacity+=.05,i.opacity>=.7&&(i.stage=2)):2==i.stage?(i.time+=o,i.time>=2e3&&(i.stage=3)):i.opacity-=.05,i.opacity>0&&(n.push(i),null==a&&(a=r)),r+=50}t.list=n,t.offset=a||0}}},f.prototype._animationFrame_parallelDo=function(e){core.control.controldata.parallelDo(e)},f.prototype._animationFrame_checkConsoleOpened=function(e){core.consoleOpened()&&core.setFlag("__consoleOpened__",!0)},f.prototype.showStartAnimate=function(e,t){return core.events.startGame("easy",void 0,void 0,(function(){}))},f.prototype._showStartAnimate_resetDom=function(){core.dom.startPanel.style.opacity=1,core.dom.startPanel.style.display="block",core.dom.startTop.style.opacity=1,core.dom.startTop.style.display="block",core.dom.startButtonGroup.style.display="none",core.dom.startButtons.style.display="block",core.dom.levelChooseButtons.style.display="none",core.status.played=!1,core.clearStatus(),core.clearMap("all"),core.dom.musicBtn.style.display="block",core.setMusicBtn(),core.events.setVolume(1,0),core.updateStatusBar()},f.prototype._showStartAnimate_finished=function(e,t){core.dom.startTop.style.display="none",core.dom.startButtonGroup.style.display="block",main.selectedButton=null,main.selectButton(0),e&&core.startGame(),t&&t()},f.prototype.hideStartAnimate=function(e){core.hideWithAnimate(core.dom.startPanel,20,e)},f.prototype.isPlaying=function(){return core.status.played},f.prototype.clearStatus=function(){for(var e in core.timeout)clearTimeout(core.timeout[e]),core.timeout[e]=null;for(var e in core.interval)clearInterval(core.interval[e]),core.interval[e]=null;core.status={},core.clearStatusBar(),core.deleteAllCanvas(),core.status.played=!1},f.prototype._initStatistics=function(e){core.isset(core.status.hero.statistics)||(core.status.hero.statistics={totalTime:e,currTime:0,hp:0,battle:0,money:0,experience:0,battleDamage:0,poisonDamage:0,extraDamage:0,moveDirectly:0,ignoreSteps:0})},f.prototype.stopAutomaticRoute=function(){core.status.played&&(core.status.automaticRoute.autoHeroMove=!1,core.status.automaticRoute.autoStep=0,core.status.automaticRoute.destStep=0,core.status.automaticRoute.movedStep=0,core.status.automaticRoute.autoStepRoutes=[],core.status.automaticRoute.destX=null,core.status.automaticRoute.destY=null,core.status.automaticRoute.lastDirection=null,core.status.heroStop=!0,0==core.status.automaticRoute.moveStepBeforeStop.length&&c.a.clear())},f.prototype.saveAndStopAutomaticRoute=function(){var e=core.status.automaticRoute;0==e.moveStepBeforeStop.length&&(e.moveStepBeforeStop=e.autoStepRoutes.slice(e.autoStep-1),e.moveStepBeforeStop.length>=1&&(e.moveStepBeforeStop[0].step-=e.movedStep)),this.stopAutomaticRoute()},f.prototype.continueAutomaticRoute=function(){var e=core.status.automaticRoute.moveStepBeforeStop;0===e.length||1===e.length&&1===e[0].step?core.status.automaticRoute.moveStepBeforeStop=[]:core.setAutoHeroMove(e)},f.prototype.clearContinueAutomaticRoute=function(e){c.a.clear(),core.status.automaticRoute.moveStepBeforeStop=[],e&&e()},f.prototype.fillPosWithPoint=function(e){c.a.fillPosWithPoint(e)},f.prototype.setAutomaticRoute=function(e,t,o){if(c.a.clear(),core.status.played&&!core.status.lockControl&&!this._setAutomaticRoute_isMoving(e,t)&&!this._setAutomaticRoute_isTurning(e,t,o)&&!this._setAutomaticRoute_clickMoveDirectly(e,t,o)){var r=core.automaticRoute(e,t);if(0==r.length&&(e!=core.status.hero.loc.x||t!=core.status.hero.loc.y||0==o.length))return c.a.wrong(e,t);r=r.concat(o),core.status.automaticRoute.destX=e,core.status.automaticRoute.destY=t,this._setAutomaticRoute_drawRoute(r),this._setAutomaticRoute_setAutoSteps(r),this.setAutoHeroMove()}},f.prototype._setAutomaticRoute_isMoving=function(e,t){if(core.status.automaticRoute.autoHeroMove){var o=core.status.automaticRoute.destX,r=core.status.automaticRoute.destY;return core.stopAutomaticRoute(),o==e&&r==t&&(core.status.automaticRoute.moveDirectly=!0,setTimeout((function(){core.status.automaticRoute.moveDirectly&&0==core.status.heroMoving&&core.control.tryMoveDirectly(e,t),core.status.automaticRoute.moveDirectly=!1}),core.values.moveSpeed||100)),!0}return!1},f.prototype._setAutomaticRoute_isTurning=function(e,t,o){return e==core.status.hero.loc.x&&t==core.status.hero.loc.y&&0==o.length?(null==core.timeout.turnHeroTimeout?core.timeout.turnHeroTimeout=setTimeout((function(){core.turnHero(),clearTimeout(core.timeout.turnHeroTimeout),core.timeout.turnHeroTimeout=null}),250):(clearTimeout(core.timeout.turnHeroTimeout),core.timeout.turnHeroTimeout=null,core.getNextItem()),!0):null!=core.timeout.turnHeroTimeout},f.prototype._setAutomaticRoute_clickMoveDirectly=function(e,t,o){return!!(core.status.heroStop&&0==core.status.heroMoving&&o.length<=1&&!core.hasFlag("__noClickMove__")&&core.control.tryMoveDirectly(e,t))},f.prototype._setAutomaticRoute_drawRoute=function(e){c.a.drawRoute(e)},f.prototype._setAutomaticRoute_setAutoSteps=function(e){var t=0,o=null;e.forEach((function(e){var r=e.direction;null==o||o==r?t++:(core.status.automaticRoute.autoStepRoutes.push({direction:o,step:t}),t=1),o=r})),core.status.automaticRoute.autoStepRoutes.push({direction:o,step:t})},f.prototype.setAutoHeroMove=function(e){0!=(e=e||core.status.automaticRoute.autoStepRoutes).length&&(core.status.automaticRoute.autoStepRoutes=e,core.status.automaticRoute.autoHeroMove=!0,core.status.automaticRoute.autoStep=1,core.status.automaticRoute.destStep=e[0].step,this.moveHero(e[0].direction))},f.prototype.setHeroMoveInterval=function(e){var t=this;if(!(core.status.heroMoving>0)){if(24==core.status.replay.speed)return core.moveOneStep(core.nextX(),core.nextY()),void(e&&e());core.status.heroMoving=1,l.a.move((core.values.moveSpeed||100)/core.status.replay.speed,(function(){core.status.heroMoving=0,t.moveOneStep(core.nextX(),core.nextY()),e instanceof Function&&e()}))}},f.prototype.moveOneStep=function(e,t){return this.controldata.moveOneStep(e,t)},f.prototype.moveAction=function(e){if(!(core.status.heroMoving>0)){var t=core.noPass(core.nextX(),core.nextY()),o=core.canMoveHero();if(t||!o)return this._moveAction_noPass(o,e);this._moveAction_moving(e)}},f.prototype._moveAction_noPass=function(e,t){core.status.route.push(core.getHeroLoc("direction")),core.status.automaticRoute.moveStepBeforeStop=[],core.status.automaticRoute.lastDirection=core.getHeroLoc("direction"),e&&core.events._trigger(core.nextX(),core.nextY()),l.a.draw(),l.a.stop(),0==core.status.automaticRoute.moveStepBeforeStop.length&&(this.clearContinueAutomaticRoute(),core.stopAutomaticRoute()),t&&t()},f.prototype._moveAction_moving=function(e){this.setHeroMoveInterval((function(){var t=core.getHeroLoc("direction");core.control._moveAction_popAutomaticRoute(),core.status.route.push(t);var o=core.getHeroLoc("x"),r=core.getHeroLoc("y");c.a.clearAutomaticRouteNode(o,r);var a=core.getBlock(o,r),n=!1;null==a||"getItem"!=a.block.event.trigger||core.floors[core.status.floorId].afterGetItem[o+","+r]||(n=!0,core.events._trigger(o,r)),core.checkBlock(),n||core.events._trigger(o,r),core.updateStatusBar(),167==core.getBgNumber()&&core.insertAction("滑冰事件",null,null,null,!0),e&&e()}))},f.prototype._moveAction_popAutomaticRoute=function(){var e=core.status.automaticRoute;e.autoHeroMove&&(e.movedStep++,e.lastDirection=core.getHeroLoc("direction"),e.destStep==e.movedStep&&(e.autoStep==e.autoStepRoutes.length?(core.clearContinueAutomaticRoute(),core.stopAutomaticRoute()):(e.movedStep=0,e.destStep=e.autoStepRoutes[e.autoStep].step,core.setHeroLoc("direction",e.autoStepRoutes[e.autoStep].direction),core.status.automaticRoute.autoStep++)))},f.prototype.moveHero=function(e,t){if(0==core.status.heroMoving){if(core.isset(e)&&core.setHeroLoc("direction",e),t)return this.moveAction(t);this._moveHero_moving()}},f.prototype._moveHero_moving=function(){core.status.heroStop=!1,core.status.automaticRoute.moveDirectly=!1;!function e(){if(!core.status.heroStop)if(core.hasFlag("debug")&&core.status.ctrlDown){if(0!=core.status.heroMoving)return;var t=core.nextX(),o=core.nextY();if(t<0||t>=core.bigmap.width||o<0||o>=core.bigmap.height)return;core.status.heroMoving=-1,core.eventMoveHero([core.getHeroLoc("direction")],core.values.moveSpeed,(function(){core.status.heroMoving=0,e()}))}else l.a.dirty(),setTimeout(e,50)}()},f.prototype.isMoving=function(){return!core.status.heroStop||core.status.heroMoving>0},f.prototype.waitHeroToStop=function(e){var t=core.status.automaticRoute.lastDirection;core.stopAutomaticRoute(),core.clearContinueAutomaticRoute(),e&&(core.status.replay.animate=!0,core.lockControl(),core.status.automaticRoute.moveDirectly=!1,setTimeout((function(){core.status.replay.animate=!1,core.isset(t)&&core.setHeroLoc("direction",t),core.drawHero(),e()}),30))},f.prototype.turnHero=function(e){if(e)return core.setHeroLoc("direction",e),core.drawHero(),void core.status.route.push("turn:"+e);core.setHeroLoc("direction",{up:"right",right:"down",down:"left",left:"up"}[core.getHeroLoc("direction")]),core.drawHero(),core.status.route.push("turn")},f.prototype.moveDirectly=function(e,t,o){return this.controldata.moveDirectly(e,t,o)},f.prototype.tryMoveDirectly=function(e,t){if(this.nearHero(e,t))return!1;for(var o=core.maps.generateMovableArray(),r=[[e,t],[e-1,t,"right"],[e,t-1,"down"],[e,t+1,"up"],[e+1,t,"left"]],a=core.canMoveDirectlyArray(r),n=0;n<r.length;++n){var i=r[n],s=i[0],c=i[1],l=i[2];if(!(s<0||s>=core.bigmap.width||c<0||c>=core.bigmap.height)&&((!l||core.inArray(o[s][c],l))&&!(a[n]<0)&&core.control.moveDirectly(s,c,a[n])))return l&&core.moveHero(l,(function(){})),!0}return!1},f.prototype.drawHero=function(e,t){l.a.draw()},f.prototype._drawHero_getDrawObjs=function(e,t,o,r,a){var n=core.material.icons.hero,i=[],s=0;return i.push({img:core.material.images.hero,width:core.material.icons.hero.width||32,height:core.material.icons.hero.height,heroIcon:n[e],posx:32*t-core.bigmap.offsetX+core.utils.scan[e].x*a,posy:32*o-core.bigmap.offsetY+core.utils.scan[e].y*a,status:r,index:s++}),(core.status.hero.followers||[]).forEach((function(e){i.push({img:core.material.images.images[e.name],width:core.material.images.images[e.name].width/4,height:core.material.images.images[e.name].height/4,heroIcon:n[e.direction],posx:32*e.x-core.bigmap.offsetX+(e.stop?0:core.utils.scan[e.direction].x*a),posy:32*e.y-core.bigmap.offsetY+(e.stop?0:core.utils.scan[e.direction].y*a),status:e.stop?"stop":r,index:s++})})),i.sort((function(e,t){return e.posy==t.posy?t.index-e.index:e.posy-t.posy}))},f.prototype.addGameCanvasTranslate=function(e,t){},f.prototype.updateViewport=function(){var e=pixi.game.container,t=u(e.zone,2),o=t[0],r=t[1],a=o-core.bigmap.offsetX,n=r-core.bigmap.offsetY;e.x===a&&e.y===n||e.position.set(a,n)},f.prototype.setViewport=function(e,t){core.bigmap.offsetX=core.clamp(e,0,32*core.bigmap.width-core.__PIXELS__),core.bigmap.offsetY=core.clamp(t,0,32*core.bigmap.height-core.__PIXELS__),this.updateViewport()},f.prototype.moveViewport=function(e,t,o){t=t||core.values.moveSpeed||300;var r=0,a=(e||[]).filter((function(e){return["up","down","left","right"].indexOf(e)>=0})),n=window.setInterval((function(){0==a.length?(delete core.animateFrame.asyncId[n],clearInterval(n),o&&o()):core.control._moveViewport_moving(++r,a)&&(r=0)}),t/16/core.status.replay.speed);core.animateFrame.asyncId[n]=!0},f.prototype._moveViewport_moving=function(e,t){var o=t[0],r=core.utils.scan[o];return core.setViewport(core.bigmap.offsetX+2*r.x,core.bigmap.offsetY+2*r.y),16==e&&(t.shift(),!0)},f.prototype.nextX=function(e){return null==e&&(e=1),core.getHeroLoc("x")+core.utils.scan[core.getHeroLoc("direction")].x*e},f.prototype.nextY=function(e){return null==e&&(e=1),core.getHeroLoc("y")+core.utils.scan[core.getHeroLoc("direction")].y*e},f.prototype.nearHero=function(e,t,o){return null==o&&(o=1),Math.abs(e-core.getHeroLoc("x"))+Math.abs(t-core.getHeroLoc("y"))<=o},f.prototype.gatherFollowers=function(){var e=core.getHeroLoc("x"),t=core.getHeroLoc("y"),o=core.getHeroLoc("direction");(core.status.hero.followers||[]).forEach((function(r){r.x=e,r.y=t,r.stop=!0,r.direction=o}))},f.prototype.updateFollowers=function(){(core.status.hero.followers||[]).forEach((function(e){e.stop||(e.x+=core.utils.scan[e.direction].x,e.y+=core.utils.scan[e.direction].y)}));var e=core.getHeroLoc("x"),t=core.getHeroLoc("y");(core.status.hero.followers||[]).forEach((function(o){o.stop=!0;var r=e-o.x,a=t-o.y;for(var n in core.utils.scan)core.utils.scan[n].x==r&&core.utils.scan[n].y==a&&(o.stop=!1,o.direction=n);e=o.x,t=o.y}))},f.prototype.updateCheckBlock=function(e){return this.controldata.updateCheckBlock(e)},f.prototype.checkBlock=function(){var e=core.getHeroLoc("x")+","+core.getHeroLoc("y"),t=core.status.checkBlock.damage[e];if(t&&(core.status.hero.hp-=t,core.drawTip("受到"+(core.status.checkBlock.type[e]||"伤害")+t+"点"),core.drawHeroAnimate("zone"),this._checkBlock_disableQuickShop(),core.status.hero.statistics.extraDamage+=t,core.status.hero.hp<=0))return core.status.hero.hp=0,core.updateStatusBar(),void core.events.lose();this._checkBlock_snipe(core.status.checkBlock.snipe[e]),this._checkBlock_ambush(core.status.checkBlock.ambush[e])},f.prototype._checkBlock_disableQuickShop=function(){if(core.flags.disableShopOnDamage)for(var e in core.status.shops)core.status.shops[e].visited=!1},f.prototype._checkBlock_snipe=function(e){if(e&&0!=e.length){var t=[];e.forEach((function(e){t.push({type:"move",loc:[e[0],e[1]],steps:[e[3]],time:500,keep:!0,async:!0})})),t.push({type:"waitAsync"}),core.insertAction(t)}},f.prototype._checkBlock_ambush=function(e){if(e&&0!=e.length){var t=[];e.forEach((function(e){t.push({type:"move",loc:[e[0],e[1]],steps:[e[3]],time:500,keep:!1,async:!0})})),t.push({type:"waitAsync"}),e.forEach((function(e){t.push({type:"battle",id:e[2]})})),core.insertAction(t)}},f.prototype.updateDamage=function(e,t){},f.prototype._updateDamage_damage=function(e,t){core.setTextAlign(t,"left"),core.status.maps[e].blocks.forEach((function(o){var r=o.x,a=o.y;if(!o.disable&&0==o.event.cls.indexOf("enemy")&&!1!==o.event.displayDamage){if(core.flags.displayEnemyDamage){var n=core.enemys.getDamageString(o.event.id,r,a,e),i=n.damage,s=n.color;core.fillBoldText(t,i,32*r+1,32*(a+1)-1,s)}if(core.flags.displayCritical){var c=core.enemys.nextCriticals(o.event.id,1,r,a,e);"???"==(c=core.formatBigNumber((c[0]||[])[0],!0))&&(c="?"),core.fillBoldText(t,c,32*r+1,32*(a+1)-11,"#FFFFFF")}}}))},f.prototype._updateDamage_extraDamage=function(e,t,o){if(core.setTextAlign(t,"center"),o&&this.updateCheckBlock(e),core.flags.displayExtraDamage)for(var r=core.floors[e].width,a=core.floors[e].height,n=0;n<r;n++)for(var i=0;i<a;i++){var s=core.status.checkBlock.damage[n+","+i]||0;s>0?(s=core.formatBigNumber(s,!0),core.fillBoldText(t,s,32*n+16,32*(i+1)-14,"#FF7F00")):core.status.checkBlock.ambush[n+","+i]&&core.fillBoldText(t,"!",32*n+16,32*(i+1)-14,"#FF7F00")}},f.prototype.chooseReplayFile=function(){core.readFile((function(e){if(e.name!=core.firstData.name)return alert("存档和游戏不一致！");if(!e.route)return alert("无效的录像！");var t=function(){core.startGame(core.flags.startUsingCanvas?"":e.hard||"",e.seed,core.decodeRoute(e.route))};e.version&&e.version!=core.firstData.version?core.myconfirm("游戏版本不一致！\n你仍然想播放录像吗？",t):t()}),null,".h5route")},f.prototype.startReplay=function(e){core.isPlaying()&&(core.status.replay.replaying=!0,core.status.replay.pausing=!0,core.status.replay.speed=1,core.status.replay.toReplay=core.clone(e),core.status.replay.totalList=core.status.route.concat(e),core.status.replay.steps=0,core.status.replay.save=[],core.updateStatusBar(),core.drawTip("开始播放"),this.replay())},f.prototype.triggerReplay=function(){core.status.replay.pausing?this.resumeReplay():this.pauseReplay()},f.prototype.pauseReplay=function(){core.isPlaying()&&core.isReplaying()&&(core.status.replay.pausing=!0,core.updateStatusBar(),core.drawTip("暂停播放"))},f.prototype.resumeReplay=function(){if(core.isPlaying()&&core.isReplaying()){if(core.isMoving()||core.status.replay.animate||core.status.event.id)return core.drawTip("请等待当前事件的处理结束");core.status.replay.pausing=!1,core.updateStatusBar(),core.drawTip("恢复播放"),core.replay()}},f.prototype.stepReplay=function(){if(core.isPlaying()&&core.isReplaying())return core.status.replay.pausing?core.isMoving()||core.status.replay.animate||core.status.event.id?core.drawTip("请等待当前事件的处理结束"):void core.replay(!0):core.drawTip("请先暂停录像")},f.prototype.speedUpReplay=function(){if(core.isPlaying()&&core.isReplaying()){for(var e=[.2,.5,1,2,3,6,12,24],t=e.length-2;t>=0;t--)if(e[t]<=core.status.replay.speed){core.status.replay.speed=e[t+1];break}core.drawTip("x"+core.status.replay.speed+"倍")}},f.prototype.speedDownReplay=function(){if(core.isPlaying()&&core.isReplaying()){for(var e=[.2,.5,1,2,3,6,12,24],t=1;t<=e.length;t++)if(e[t]>=core.status.replay.speed){core.status.replay.speed=e[t-1];break}core.drawTip("x"+core.status.replay.speed+"倍")}},f.prototype.setReplaySpeed=function(e){core.isPlaying()&&core.isReplaying()&&(core.status.replay.speed=e,core.drawTip("x"+core.status.replay.speed+"倍"))},f.prototype.stopReplay=function(e){core.isPlaying()&&(core.isReplaying()||e)&&(core.status.replay.toReplay=[],core.status.replay.totalList=[],core.status.replay.replaying=!1,core.status.replay.pausing=!1,core.status.replay.speed=1,core.status.replay.steps=0,core.status.replay.save=[],core.updateStatusBar(),core.drawTip("停止播放并恢复游戏"))},f.prototype.rewindReplay=function(){if(core.isPlaying()&&core.isReplaying()){if(!core.status.replay.pausing)return core.drawTip("请先暂停录像");if(core.isMoving()||core.status.replay.animate||core.status.event.id)return core.drawTip("请等待当前事件的处理结束");if(0==core.status.replay.save.length)return core.drawTip("无法再回到上一个节点");var e=core.status.replay.save,t=e.pop();core.loadData(t.data,(function(){core.status.replay={replaying:!0,pausing:!0,animate:!1,toReplay:t.replay.toReplay,totalList:t.replay.totalList,speed:t.replay.speed,steps:t.replay.steps,save:e},core.updateStatusBar(),core.drawTip("成功回退到上一个节点")}))}},f.prototype.saveReplay=function(){if(core.isPlaying()&&core.isReplaying()){if(!core.status.replay.pausing)return core.drawTip("请先暂停录像");if(core.isMoving()||core.status.replay.animate||core.status.event.id)return core.drawTip("请等待当前事件的处理结束");core.lockControl(),core.status.event.id="save";var e=core.saves.saveIndex,t=parseInt((e-1)/5),o=e-5*t;core.ui.drawSLPanel(10*t+o)}},f.prototype.bookReplay=function(){if(core.isPlaying()&&core.isReplaying()){if(!core.status.replay.pausing)return core.drawTip("请先暂停录像");if(core.isMoving()||core.status.replay.animate||core.status.event.id&&"viewMaps"!=core.status.event.id)return core.drawTip("请等待当前事件的处理结束");if(!core.hasItem("book"))return core.drawTip("你没有怪物手册");"viewMaps"==core.status.event.id&&(core.status.event.ui=core.status.event.data),core.lockControl(),core.status.event.id="book",core.useItem("book",!0)}},f.prototype.viewMapReplay=function(){if(core.isPlaying()&&core.isReplaying()){if(!core.status.replay.pausing)return core.drawTip("请先暂停录像");if(core.isMoving()||core.status.replay.animate||core.status.event.id)return core.drawTip("请等待当前事件的处理结束");core.lockControl(),core.status.event.id="viewMaps",core.ui.drawMaps()}},f.prototype.toolboxReplay=function(){if(core.isPlaying()&&core.isReplaying()){if(!core.status.replay.pausing)return core.drawTip("请先暂停录像");if(core.isMoving()||core.status.replay.animate||core.status.event.id)return core.drawTip("请等待当前事件的处理结束");core.lockControl(),core.status.event.id="toolbox",core.ui.drawToolbox()}},f.prototype.equipboxReplay=function(){if(core.isPlaying()&&core.isReplaying()){if(!core.status.replay.pausing)return core.drawTip("请先暂停录像");if(core.isMoving()||core.status.replay.animate||core.status.event.id)return core.drawTip("请等待当前事件的处理结束");core.lockControl(),core.status.event.id="equipbox",core.ui.drawEquipbox()}},f.prototype.isReplaying=function(){return(core.status.replay||{}).replaying},f.prototype.replay=function(e){if(core.isPlaying()&&core.isReplaying()&&!core.status.replay.animate&&!core.status.event.id&&(!core.status.replay.pausing||e)){if(0==core.status.replay.toReplay.length)return this._replay_finished();this._replay_save();var t=core.status.replay.toReplay.shift();this._doReplayAction(t)||this._replay_error(t)}},f.prototype.registerReplayAction=function(e,t){this.unregisterReplayAction(e),this.replayActions.push({name:e,func:t})},f.prototype.unregisterReplayAction=function(e){this.replayActions=this.replayActions.filter((function(t){return t.name!=e}))},f.prototype._doReplayAction=function(e){for(var t in this.replayActions)try{if(core.doFunc(this.replayActions[t].func,this,e))return!0}catch(e){main.log(e),main.log("ERROR in replayActions["+this.replayActions[t].name+"]：已自动注销该项。"),core.unregisterReplayAction(this.replayActions[t].name)}return!1},f.prototype._replay_finished=function(){core.status.replay.replaying=!1,core.status.event.selection=0;var e="录像播放完毕，你想退出播放吗？";core.status.route.length==core.status.replay.totalList.length&&null!=core.subarray(core.status.route,core.status.replay.totalList)||(e="录像播放完毕，但记录不一致。\n请检查录像播放时的二次记录问题。\n你想退出播放吗？"),core.ui.drawConfirmBox(e,(function(){core.ui.closePanel(),core.stopReplay(!0)}),(function(){core.status.replay.replaying=!0,core.ui.closePanel(),core.pauseReplay()}))},f.prototype._replay_save=function(){core.status.replay.steps++,core.status.replay.steps%40==1&&(30==core.status.replay.save.length&&core.status.replay.save.shift(),core.status.replay.save.push({data:core.saveData(),replay:{totalList:core.clone(core.status.replay.totalList),toReplay:core.clone(core.status.replay.toReplay),speed:core.status.replay.speed,steps:core.status.replay.steps}}))},f.prototype._replay_error=function(e){core.ui.closePanel(),core.status.replay.replaying=!1;var t=core.status.replay.toReplay.length,o=core.status.replay.totalList.slice(-t-11,-t-1),r=core.status.replay.toReplay.slice(0,10);main.log("录像文件出错，当前操作："+e),main.log("之前的10个操作是：\n"+o.toString()),main.log("接下来10个操作是：\n"+r.toString()),core.ui.drawConfirmBox("录像文件出错，你想回到上个节点吗？",(function(){core.ui.closePanel(),core.status.replay.save.length>0?(core.status.replay.replaying=!0,core.status.replay.pausing=!0,core.rewindReplay()):(core.drawTip("无法回到上一个节点"),core.stopReplay(!0))}),(function(){core.ui.closePanel(),core.stopReplay(!0)}))},f.prototype.__replay_getTimeout=function(){return 24==core.status.replay.speed?0:750/Math.max(1,core.status.replay.speed)},f.prototype._replayAction_move=function(e){return!(["up","down","left","right"].indexOf(e)<0)&&(core.moveHero(e,core.replay),!0)},f.prototype._replayAction_item=function(e){if(0!=e.indexOf("item:"))return!1;var t=e.substring(5);if(!core.canUseItem(t))return!1;if(core.material.items[t].hideInReplay)return core.useItem(t,!1,core.replay),!0;var o,r=Object.keys(core.status.hero.items.tools).sort(),a=Object.keys(core.status.hero.items.constants).sort(),n=core.__SIZE__-1;return(o=r.indexOf(t))>=0?(core.status.event.data={toolsPage:Math.floor(o/n)+1,constantsPage:1},o%=n):(o=a.indexOf(t))>=0&&(core.status.event.data={toolsPage:1,constantsPage:Math.floor(o/n)+1},o=o%n+n),!(o<0)&&(core.ui.drawToolbox(o),setTimeout((function(){core.ui.closePanel(),core.useItem(t,!1,core.replay)}),core.control.__replay_getTimeout()),!0)},f.prototype._replayAction_equip=function(e){if(0!=e.indexOf("equip:"))return!1;var t=e.substring(6),o=Object.keys(core.status.hero.items.equips).sort().indexOf(t),r=core.__SIZE__-1;return!(o<0)&&(core.status.route.push(e),core.material.items[t].hideInReplay?(core.loadEquip(t,core.replay),!0):(core.status.event.data={page:Math.floor(o/r)+1,selectId:null},o=o%r+r,core.ui.drawEquipbox(o),setTimeout((function(){core.ui.closePanel(),core.loadEquip(t,core.replay)}),core.control.__replay_getTimeout()),!0))},f.prototype._replayAction_unEquip=function(e){if(0!=e.indexOf("unEquip:"))return!1;var t=parseInt(e.substring(8));return!!core.isset(t)&&(core.ui.drawEquipbox(t),core.status.route.push(e),setTimeout((function(){core.ui.closePanel(),core.unloadEquip(t,core.replay)}),core.control.__replay_getTimeout()),!0)},f.prototype._replayAction_fly=function(e){if(0!=e.indexOf("fly:"))return!1;var t=e.substring(4),o=core.floorIds.indexOf(t);return!!core.canUseItem("fly")&&(core.ui.drawFly(o),setTimeout((function(){core.flyTo(t,core.replay)||core.control._replay_error(e)}),core.control.__replay_getTimeout()),!0)},f.prototype._replayAction_shop=function(e){if(0!=e.indexOf("shop:"))return!1;var t=e.substring(5).split(":"),o=t[0],r=t[1].split("");if(0==r.length)return!1;var a=core.status.shops[o];if(!a||!a.visited)return!1;if(a.commonEvent||a.item)return core.openShop(o,!1),setTimeout(core.replay),!0;var n=a.choices;core.status.event.selection=parseInt(r.shift()),core.events.openShop(o,!1);var i=core.__HALF_SIZE__-parseInt(n.length/2)+(core.status.event.ui.offset||0),s=setInterval((function(){return core.actions._clickShop(core.__HALF_SIZE__,i+core.status.event.selection)?0==r.length?(clearInterval(s),core.actions._clickShop(core.__HALF_SIZE__,i+n.length),void core.replay()):(core.status.event.selection=parseInt(r.shift()),void core.events.openShop(o,!1)):(clearInterval(s),void core.control._replay_error(e))}),core.control.__replay_getTimeout());return!0},f.prototype._replayAction_turn=function(e){return("turn"==e||0==e.indexOf("turn:"))&&("turn"==e?core.turnHero():core.turnHero(e.substring(5)),setTimeout(core.replay),!0)},f.prototype._replayAction_getNext=function(e){return"getNext"==e&&(!!core.getNextItem()&&(setTimeout(core.replay),!0))},f.prototype._replayAction_moveDirectly=function(e){if(0!=e.indexOf("move:"))return!1;for(;core.status.replay.toReplay.length>0&&0==core.status.replay.toReplay[0].indexOf("move:");)core.status.route.push(e),e=core.status.replay.toReplay.shift();var t=e.substring(5).split(":"),o=parseInt(t[0]),r=parseInt(t[1]),a=core.getHeroLoc("x"),n=core.getHeroLoc("y");return!!core.moveDirectly(o,r)&&(core.ui.drawArrow("ui",32*a+16-core.bigmap.offsetX,32*n+16-core.bigmap.offsetY,32*o+16-core.bigmap.offsetX,32*r+16-core.bigmap.offsetY,"#FF0000",3),setTimeout((function(){core.clearMap("ui"),core.replay()}),core.control.__replay_getTimeout()),!0)},f.prototype._replayAction_key=function(e){return 0==e.indexOf("key:")&&(core.actions.keyUp(parseInt(e.substring(4)),!1,!0),setTimeout(core.replay),!0)},f.prototype.autosave=function(e){var t=null;e&&(t=core.status.route.pop(),core.status.route.push("turn:"+core.getHeroLoc("direction"))),"action"==core.status.event.id&&core.setFlag("__events__",core.clone(core.status.event.data)),null==core.saves.autosave.data&&(core.saves.autosave.data=[]),core.saves.autosave.data.push(core.saveData()),core.saves.autosave.data.length>core.saves.autosave.max&&core.saves.autosave.data.shift(),core.saves.autosave.updated=!0,core.saves.ids[0]=!0,core.removeFlag("__events__"),e&&(core.status.route.pop(),t&&core.status.route.push(t))},f.prototype.checkAutosave=function(){if(core.animateFrame&&core.saves&&core.saves.autosave){core.setLocalStorage("totalTime",core.animateFrame.totalTime);var e=core.saves.autosave;null!=e.data&&e.updated&&e.storage&&(e.updated=!1,e.data.length>=1&&core.setLocalForage("autoSave",e.data[e.data.length-1]))}},f.prototype.doSL=function(e,t){switch(t){case"save":this._doSL_save(e);break;case"load":this._doSL_load(e,this._doSL_load_afterGet);break;case"replayLoad":this._doSL_load(e,this._doSL_replayLoad_afterGet);break;case"replayRemain":this._doSL_load(e,this._doSL_replayRemain_afterGet)}},f.prototype._doSL_save=function(e){if("autoSave"==e)return core.drawTip("不能覆盖自动存档！");null!=core.status.event.interval&&core.setFlag("__events__",core.status.event.interval),core.setLocalForage("save"+e,core.saveData(),(function(){core.saves.saveIndex=e,core.setLocalStorage("saveIndex",core.saves.saveIndex),core.events.recoverEvents(core.status.event.interval)||core.ui.closePanel(),core.drawTip("存档成功！")}),(function(e){main.log(e),core.platform.useLocalForage?alert("存档失败，错误信息：\n"+e):alert("存档失败，错误信息：\n"+e+"\n建议使用垃圾存档清理工具进行清理！")})),core.removeFlag("__events__")},f.prototype._doSL_load=function(e,t){if("autoSave"==e&&null!=core.saves.autosave.data){var o=core.saves.autosave.data.pop();0==core.saves.autosave.data.length&&core.saves.autosave.data.push(core.clone(o)),t(e,o)}else core.getLocalForage("autoSave"==e?e:"save"+e,null,(function(o){if("autoSave"==e&&null!=o)return core.saves.autosave.data=o,core.saves.autosave.data instanceof Array||(core.saves.autosave.data=[core.saves.autosave.data]),core.control._doSL_load(e,t);t(e,o)}),(function(e){main.log(e),alert("无效的存档")}))},f.prototype._doSL_load_afterGet=function(e,t){if(!t)return alert("无效的存档");var o=function(){core.startGame(t.hard,t.hero.flags.__seed__,core.decodeRoute(t.route))};core.flags.checkConsole&&null!=t.hashCode&&t.hashCode!=core.hashCode(t.hero)?core.myconfirm("存档校验失败，请勿修改存档文件！\n你想回放此存档的录像吗？\n可以随时停止录像播放以继续游戏。",o):t.version==core.firstData.version?(core.ui.closePanel(),core.loadData(t,(function(){core.drawTip("读档成功"),"autoSave"!=e&&(core.saves.saveIndex=e,core.setLocalStorage("saveIndex",core.saves.saveIndex))}))):core.myconfirm("存档版本不匹配！\n你想回放此存档的录像吗？\n可以随时停止录像播放以继续游戏。",o)},f.prototype._doSL_replayLoad_afterGet=function(e,t){if(!t)return core.drawTip("无效的存档");if(t.version!=core.firstData.version)return core.drawTip("存档版本不匹配");if(t.hard!=core.status.hard&&core.drawTip("游戏难度不匹配！"),null!=t.hashCode&&t.hashCode!=core.utils.hashCode(t.hero))return alert("存档校验失败，请勿修改存档文件！");var o=core.subarray(core.status.route,core.decodeRoute(t.route));if(null==o||t.hero.flags.__seed__!=core.getFlag("__seed__"))return core.drawTip("无法从此存档回放录像");core.loadData(t,(function(){core.startReplay(o),core.drawTip("回退到存档节点")}))},f.prototype._doSL_replayRemain_afterGet=function(e,t){if(!t)return core.drawTip("无效的存档");var o=core.decodeRoute(t.route);if(core.status.tempRoute){var r=core.subarray(o,core.status.tempRoute);return null==r?alert("无法接续播放录像！\n该存档必须是前一个选择的存档的后续内容。"):(delete core.status.tempRoute,core.ui.closePanel(),core.startReplay(r),void core.drawTip("接续播放录像"))}if(t.floorId!=core.status.floorId||t.hero.loc.x!=core.getHeroLoc("x")||t.hero.loc.y!=core.getHeroLoc("y"))return alert("楼层或坐标不一致！");core.status.tempRoute=o,core.ui.closePanel(),core.drawText("\t[步骤2]请选择第二个存档。\n\r[yellow]该存档必须是前一个存档的后续。\r\n将尝试播放到此存档。",(function(){core.status.event.id="replayRemain",core.lockControl();var e=core.saves.saveIndex,t=parseInt((e-1)/5),o=e-5*t;core.ui.drawSLPanel(10*t+o)}))},f.prototype.syncSave=function(e){core.ui.drawWaiting("正在同步，请稍后...");var t=function(t){core.control._syncSave_http(e,t)};"all"==e?core.getAllSaves(t):core.getSave(core.saves.saveIndex,t)},f.prototype._syncSave_http=function(e,t){if(!t)return core.drawText("没有要同步的存档");var o=new FormData;o.append("type","save"),o.append("name",core.firstData.name),o.append("data",JSON.stringify(t)),core.http("POST","/games/sync.php",o,(function(t){var o=JSON.parse(t);o.code<0?core.drawText("出错啦！\n无法同步存档到服务器。\n错误原因："+o.msg):core.drawText(("all"==e?"所有存档":"存档"+core.saves.saveIndex)+"同步成功！\n\n您的存档编号： "+o.code+"\n您的存档密码： "+o.msg+"\n\n请牢记以上两个信息（如截图等），在从服务器\n同步存档时使用。\n\r[yellow]另外请注意，存档同步只会保存一个月的时间。\r")}),(function(e){core.drawText("出错啦！\n无法同步存档到服务器。\n错误原因："+e)}))},f.prototype.syncLoad=function(){core.myprompt("请输入存档编号",null,(function(e){if(!e)return core.ui.drawSyncSave();core.myprompt("请输入存档密码：",null,(function(t){if(!t)return core.ui.drawSyncSave();core.ui.drawWaiting("正在同步，请稍后..."),core.control._syncLoad_http(e,t)}))}))},f.prototype._syncLoad_http=function(e,t){var o=new FormData;o.append("type","load"),o.append("name",core.firstData.name),o.append("id",e),o.append("password",t),core.http("POST","/games/sync.php",o,(function(e){var t=JSON.parse(e);0==t.code?core.control._syncLoad_write(JSON.parse(t.msg)):core.drawText("出错啦！\n无法从服务器同步存档。\n错误原因："+t.msg)}),(function(e){core.drawText("出错啦！\n无法从服务器同步存档。\n错误原因："+e)}))},f.prototype._syncLoad_write=function(e){e instanceof Array?(core.status.event.selection=1,core.ui.drawConfirmBox("所有本地存档都将被覆盖，确认？",(function(){for(var t=1;t<=5*(main.savePages||30);t++)t<=e.length?core.setLocalForage("save"+t,e[t-1]):core.saves.ids[t]&&core.removeLocalForage("save"+t);core.ui.closePanel(),core.drawText("同步成功！\n你的本地所有存档均已被覆盖。")}),(function(){core.status.event.selection=0,core.ui.drawSyncSave()}))):core.setLocalForage("save"+core.saves.saveIndex,e,(function(){core.drawText("同步成功！\n单存档已覆盖至存档"+core.saves.saveIndex)}))},f.prototype.saveData=function(){return this.controldata.saveData()},f.prototype.loadData=function(e,t){return this.controldata.loadData(e,t)},f.prototype.getSave=function(e,t){0!=e?core.getLocalForage("save"+e,null,(function(e){t&&t(e)}),(function(e){main.log(e),t&&t(null)})):null!=core.saves.autosave.data?t(core.saves.autosave.data):core.getLocalForage("autoSave",null,(function(e){null!=e&&(core.saves.autosave.data=e,core.saves.autosave.data instanceof Array||(core.saves.autosave.data=[core.saves.autosave.data])),t(core.saves.autosave.data)}),(function(e){main.log(e),t(null)}))},f.prototype.getSaves=function(e,t){if(!(e instanceof Array))return this.getSave(e,t);for(var o=e.length,r={},a=0;a<e.length;++a)!function(a){core.getSave(e[a],(function(e){r[a]=e,Object.keys(r).length==o&&t(r)}))}(a)},f.prototype.getAllSaves=function(e){var t=Object.keys(core.saves.ids).filter((function(e){return 0!=e})).sort((function(e,t){return e-t})),o=[];this.getSaves(t,(function(r){for(var a=0;a<t.length;++a)null!=r[a]&&o.push(r[a]);e(o)}))},f.prototype.getSaveIndexes=function(e){var t={};core.platform.useLocalForage?s.a.iterate((function(e,o,r){core.control._getSaveIndexes_getIndex(t,o)}),(function(){e(t)})):(Object.keys(localStorage).forEach((function(e){core.control._getSaveIndexes_getIndex(t,e)})),e(t))},f.prototype._getSaveIndexes_getIndex=function(e,t){var o=new RegExp("^"+core.firstData.name+"_(save\\d+|autoSave)$").exec(t);o&&("autoSave"==o[1]?e[0]=!0:e[parseInt(o[1].substring(4))]=!0)},f.prototype.hasSave=function(e){return core.saves.ids[e]||!1},f.prototype.removeSave=function(e,t){if(0==e||"autoSave"==e)return e="autoSave",void core.removeLocalForage(e,(function(){core.saves.autosave.data=null,core.saves.autosave.updated=!1,t&&t()}));core.removeLocalForage("save"+e,(function(){core.saves.favorite=core.saves.favorite.filter((function(e){return core.hasSave(e)})),delete core.saves.favoriteName[e],core.control._updateFavoriteSaves(),t&&t()}),(function(){core.drawTip("无法删除存档！"),t&&t()}))},f.prototype._loadFavoriteSaves=function(){core.saves.favorite=core.getLocalStorage("favorite",[]),core.saves.favorite=core.saves.favorite.filter((function(e){return core.hasSave(e)})),core.saves.favoriteName=core.getLocalStorage("favoriteName",{})},f.prototype._updateFavoriteSaves=function(){core.setLocalStorage("favorite",core.saves.favorite),core.setLocalStorage("favoriteName",core.saves.favoriteName)},f.prototype.setStatus=function(e,t){core.status.hero&&("exp"==e&&(e="experience"),"x"==e||"y"==e||"direction"==e?this.setHeroLoc(e,t):core.status.hero[e]=t)},f.prototype.addStatus=function(e,t){this.setStatus(e,this.getStatus(e)+t)},f.prototype.getStatus=function(e){return core.status.hero?"x"==e||"y"==e||"direction"==e?this.getHeroLoc(e):("exp"==e&&(e="experience"),core.status.hero[e]):null},f.prototype.getStatusOrDefault=function(e,t){return e&&t in e?Math.floor(e[t]):Math.floor(this.getStatus(t))},f.prototype.getRealStatus=function(e){return this.getRealStatusOrDefault(null,e)},f.prototype.getRealStatusOrDefault=function(e,t){return Math.floor(this.getStatusOrDefault(e,t)*this.getBuff(t))},f.prototype.setBuff=function(e,t){this.setFlag("__"+e+"_buff__",t)},f.prototype.addBuff=function(e,t){this.setFlag("__"+e+"_buff__",this.getBuff(e)+t)},f.prototype.getBuff=function(e){return core.getFlag("__"+e+"_buff__",1)},f.prototype.setHeroLoc=function(e,t,o){core.status.hero&&(core.status.hero.loc[e]=t,"x"!=e&&"y"!=e||o||this.gatherFollowers())},f.prototype.getHeroLoc=function(e){if(core.status.hero)return null==e?core.status.hero.loc:core.status.hero.loc[e]},f.prototype.getStatusName=function(e){return{name:"名称",lv:"等级",hpmax:"生命上限",hp:"生命",manamax:"魔力上限",mana:"魔力",atk:"攻击",def:"防御",mdef:"魔防",money:"金币",exp:"经验",experience:"经验",steps:"步数"}[e]||e},f.prototype.getLvName=function(e){return core.status.hero?(null==e&&(e=core.status.hero.lv),((core.firstData.levelUp||[])[e-1]||{}).title||e):null},f.prototype.setFlag=function(e,t){if(null==t)return this.removeFlag(e);core.status.hero&&(core.status.hero.flags[e]=t)},f.prototype.addFlag=function(e,t){core.status.hero&&core.setFlag(e,core.getFlag(e,0)+t)},f.prototype.getFlag=function(e,t){if(!core.status.hero)return t;var o=core.status.hero.flags[e];return null!=o?o:t},f.prototype.hasFlag=function(e){return!!core.getFlag(e)},f.prototype.removeFlag=function(e){core.status.hero&&delete core.status.hero.flags[e]},f.prototype.lockControl=function(){core.status.lockControl=!0},f.prototype.unLockControl=function(){core.status.lockControl=!1},f.prototype.debug=function(){core.setFlag("debug",!0),core.drawText("\t[调试模式开启]此模式下按住Ctrl键（或Ctrl+Shift键）可以穿墙并忽略一切事件。\n此模式下将无法上传成绩。")},f.prototype.getMappedName=function(e){return(main.nameMap||{})[e]||e},f.prototype.setWeather=function(e,t){null!=e&&(e==core.animateFrame.weather.type&&null==t||(t=core.clamp(parseInt(t)||5,1,10),t*=parseInt(20*core.bigmap.width*core.bigmap.height/(core.__SIZE__*core.__SIZE__)),pixi.weather.add(e,t)))},f.prototype._setWeather_createNodes=function(e,t){switch(e){case"rain":for(var o=0;o<t;o++)core.animateFrame.weather.nodes.push({x:Math.random()*core.bigmap.width*32,y:Math.random()*core.bigmap.height*32,l:2.5*Math.random(),xs:4*Math.random()-4+2,ys:10*Math.random()+10});break;case"snow":for(o=0;o<t;o++)core.animateFrame.weather.nodes.push({x:Math.random()*core.bigmap.width*32,y:Math.random()*core.bigmap.height*32,r:5*Math.random()+1,d:Math.random()*Math.min(t,200)});break;case"fog":if(core.animateFrame.weather.fog)for(o=0;o<t/10;o++)core.animateFrame.weather.nodes.push({x:Math.random()*core.bigmap.width*32-208,y:Math.random()*core.bigmap.height*32-208,xs:4*Math.random()-2,ys:4*Math.random()-2})}},f.prototype.setCurtain=function(e,t,o){if(null==t&&(t=750),t<=0&&(t=0),core.status.curtainColor||(core.status.curtainColor=[0,0,0,0]),e||(e=[0,0,0,0]),null==e[3]&&(e[3]=1),e[3]=core.clamp(e[3],0,1),0==t)return core.clearMap("curtain"),core.fillRect("curtain",0,0,core.__PIXELS__,core.__PIXELS__,core.arrayToRGBA(e)),core.status.curtainColor=e,void(o&&o());this._setCurtain_animate(core.status.curtainColor,e,t,o)},f.prototype._setCurtain_animate=function(e,t,o,r){o/=Math.max(core.status.replay.speed,1);var a=parseInt(o/10);a<=0&&(a=1);var n=setInterval((function(){e=[(e[0]*(a-1)+t[0])/a,(e[1]*(a-1)+t[1])/a,(e[2]*(a-1)+t[2])/a,(e[3]*(a-1)+t[3])/a],core.clearMap("curtain"),core.fillRect("curtain",0,0,core.__PIXELS__,core.__PIXELS__,core.arrayToRGBA(e)),--a<=0&&(delete core.animateFrame.asyncId[n],clearInterval(n),core.status.curtainColor=t,core.isset(r)&&r())}),10);core.animateFrame.asyncId[n]=!0},f.prototype.screenFlash=function(e,t,o,r){o=o||1,t/=3;var a=core.clone(core.status.curtainColor);core.setCurtain(e,t,(function(){core.setCurtain(a,2*t,(function(){o>1?core.screenFlash(e,3*t,o-1,r):r&&r()}))}))},f.prototype.playBgm=function(e,t){if(e=core.getMappedName(e),"play"==main.mode&&core.material.bgms[e])if(core.musicStatus.bgmStatus){this.setMusicBtn();try{this._playBgm_play(e,t)}catch(t){console.log("无法播放BGM "+e),main.log(t),core.musicStatus.playingBgm=null}}else try{core.musicStatus.playingBgm=e,core.musicStatus.lastBgm=e,core.material.bgms[e].pause()}catch(e){main.log(e)}},f.prototype._playBgm_play=function(e,t){(core.musicStatus.playingBgm!=e||core.material.bgms[core.musicStatus.playingBgm].paused)&&(core.musicStatus.playingBgm&&core.material.bgms[core.musicStatus.playingBgm].pause(),core.loader.loadBgm(e),core.material.bgms[e].volume=core.musicStatus.userVolume*core.musicStatus.designVolume,core.material.bgms[e].currentTime=t||0,core.material.bgms[e].play(),core.musicStatus.playingBgm=e,core.musicStatus.lastBgm=e)},f.prototype.pauseBgm=function(){if("play"==main.mode){try{core.musicStatus.playingBgm&&(core.material.bgms[core.musicStatus.playingBgm].pause(),core.musicStatus.playingBgm=null)}catch(e){console.log("无法暂停BGM"),main.log(e)}this.setMusicBtn()}},f.prototype.resumeBgm=function(){if("play"==main.mode){try{core.playBgm(core.musicStatus.playingBgm||core.musicStatus.lastBgm||main.startBgm)}catch(e){console.log("无法恢复BGM"),main.log(e)}this.setMusicBtn()}},f.prototype.setMusicBtn=function(){core.musicStatus.bgmStatus?core.dom.musicBtn.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAMAAADzN3VRAAABWVBMVEX///9iYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmL///8AAAC5ubn+/v6xsbEtLS0MDAxmZmZoaGhvb2/c3Nzd3d38/Pz9/f0oKCgpKSl0dHR1dXW6urrb29v7+/v09PTv7+/39/cgICACAgImJibh4eGFhYWGhoaHh4eOjo5paWm7u7vDw8PMzMwyMjI7OztAQEDe3t5FRUVMTEzj4+Pl5eXm5ubp6enr6+tcXFzi4uL19fVeXl74+PgjIyNkZGQGBgaSkpKYmJiampqenp4DAwMwMDBnZ2cICAivr68eHh63t7cLCwsSEhLw8PBhYWEUFBQVFRXNzc3Pz8/Z2dna2toaGhqkpKSlpaWpqamrq6tFOUNAAAAAc3RSTlMAAwQFBhUWGxwkJSYyO0dISVBRUmpvj5CSk5SVoaOlpqiysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKyA0IuUgAAAVdJREFUeF5NkVVbw0AQRTcQrLR4IIEGcidJoaUuQHF3d3d3+P/CkuxCzss8nG++mbnDBJXhNt2CpbeFK1kQpSEKidlc8S9qdATRa6UIdQMoxEpDA0Ov3wUAPfW+qLWACydNv9zMrzkJwPK6FB3oHyOfXfuNxvoBQ+GmBYinhHB77TmiVBxoYUw1AYcEq332AS8OYKosAuTT0nza9uU2USYPRJgGxEiSOFywJ3mNARozgBJJzkfLvfu8JgGDWcC9FEsjWzR+y80gYDEAA8QZ3N6kmP1Fs3fEASB7pob7Hh+Wz5L0ci17Or05J7bH6B6dZv05XWK3rG+myV05Ert592Qo55sPuoIr7hEZHHtieIPWy0RU9DLwc3Mnck/vi8/E8XNrDWQtEVnL/ySKMrv0jPwPp870fprcyYifmiEmqGpHkI5q9ofSFIUk2qiwIGpEMyxYhhZRRcMPz89RJ2s9W8wAAAAASUVORK5CYII=":core.dom.musicBtn.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAMAAADzN3VRAAABYlBMVEX///9iYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmL////8/PwAAABmZmZoaGihoaGioqKxsbG5ubnb29vc3Nzd3d3h4eHi4uL9/f3+/v4tLS1nZ2d0dHSUlJSenp66uroMDAz7+/spKSkoKCgUFBRpaWkVFRVvb291dXU7OzuVlZWYmJhkZGQgICAjIyOkpKQCAgK3t7cGBgbv7++pqamrq6seHh4mJiZhYWGamprp6enr6+saGhpeXl7j4+Pl5eXm5uZKSkrw8PD09PT19fW7u7vDw8PMzMwICAgwMDAyMjILCwtAQECGhoaHh4eBgYGFhYUSEhJXV1dZWVlcXFyOjo6SkpLNzc339/fPz8/Z2dna2tqTk5OlpaWxOPeTAAAAdnRSTlMAAwQFBhUWGxwkJSYyO0dISVBRUmpvj5CSk5SVoaOlpqiysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKyNuo+uwAAAWJJREFUeF5NkmV34zAQReUm7WbTuJBNunY3bvXGDjNTkZkZlpn5/9eR5FPfbzr3jGb0RkwRiMQMDm7EIgHmRxtLwMOaHHoQjwz4MUKeCM8AWMrmd7u7f/aXAMyOShHiQD1n04DtN5e5FMBFlSauIsm585dKi4CpuSYKJIv1tBDVmvOSqJgEoowFLSBHaQh10XHWiCgHWEGmAw2blPrvOK/KRJUGoLM4kCVSKrWz7HwgoiwQZyaQJ0+9PvxV23BNATAZB25IqX9b3+jTW9fcApwB6NLgUD5NY3mPXnwmFwBezff1ztzRFzTp94FXMy36HDuCa2RafdnnmZqtL818Gl9/qNnEeyrUk2aTPiKj3qMyWBVi/YSuWq5qiwxkbtX3vYWzdz/l8M0k8ERlvViiB1Ygslb7SbVtJezncj+Cx5bYaeGuonZqhZlieAp+no74/s5EAh6JcY35Cepxk4ObcT3IJPe/1lKsDpFCFQAAAABJRU5ErkJggg=="},f.prototype.triggerBgm=function(){"play"==main.mode&&(core.musicStatus.bgmStatus=!core.musicStatus.bgmStatus,core.musicStatus.bgmStatus?this.resumeBgm():this.pauseBgm(),core.setLocalStorage("bgmStatus",core.musicStatus.bgmStatus))},f.prototype.playSound=function(e){if(e=core.getMappedName(e),"play"==main.mode&&core.musicStatus.soundStatus&&core.material.sounds[e])try{if(null!=core.musicStatus.audioContext){var t=core.musicStatus.audioContext.createBufferSource();t.buffer=core.material.sounds[e],t.connect(core.musicStatus.gainNode);var o=setTimeout(null);t.onended=function(){delete core.musicStatus.playingSounds[o]},t.start?t.start(0):t.noteOn&&t.noteOn(0),core.musicStatus.playingSounds[o]=t}else core.material.sounds[e].volume=core.musicStatus.userVolume,core.material.sounds[e].play()}catch(t){console.log("无法播放SE "+e),main.log(t)}},f.prototype.stopSound=function(){for(var e in core.musicStatus.playingSounds){var t=core.musicStatus.playingSounds[e];try{t.stop?t.stop():t.noteOff&&t.noteOff()}catch(e){main.log(e)}}core.musicStatus.playingSounds={}},f.prototype.checkBgm=function(){core.playBgm(core.musicStatus.playingBgm||main.startBgm)},f.prototype.clearStatusBar=function(){},f.prototype.updateStatusBar=function(e){core.isPlaying()&&(this.controldata.updateStatusBar(),e||core.checkAutoEvents(),this._updateStatusBar_setToolboxIcon())},f.prototype._updateStatusBar_setToolboxIcon=function(){},f.prototype.showStatusBar=function(){if("editor"!=main.mode&&!core.domStyle.showStatusBar){var e=core.dom.status;core.domStyle.showStatusBar=!0,core.removeFlag("hideStatusBar");for(var t=0;t<e.length;++t)e[t].style.opacity=1;this.setToolbarButton(!1),core.dom.tools.hard.style.display="block"}},f.prototype.hideStatusBar=function(e){if("editor"!=main.mode){core.domStyle.showStatusBar||this.showStatusBar(),core.isReplaying()&&(e=!0);var t=core.dom.status,o=core.dom.tools;core.domStyle.showStatusBar=!1,core.setFlag("hideStatusBar",!0),core.setFlag("showToolbox",e||null);for(var r=0;r<t.length;++r)t[r].style.opacity=0;if(!core.domStyle.isVertical||!e)for(r=0;r<o.length;++r)o[r].style.display="none"}},f.prototype.updateHeroIcon=function(e){e=e||"hero.png",core.statusBar.icons.name!=e&&(core.statusBar.icons.name=e)},f.prototype.updateGlobalAttribute=function(e){if(null==e&&(e=Object.keys(core.status.globalAttribute)),e instanceof Array)e.forEach((function(e){core.control.updateGlobalAttribute(e)}));else{var t=core.status.globalAttribute||core.initStatus.globalAttribute;if(null!=t);}},f.prototype.setToolbarButton=function(e){},f.prototype._shouldDisplayStatus=function(e){if(null==e){for(var t=[],o=core.dom.status,r=0;r<o.length;++r){var a=core.dom.status[r].id;if(a.indexOf("Col")==a.length-3){e=a.substring(0,a.length-3);this._shouldDisplayStatus(e)&&t.push(e)}}return t}switch(e){case"floor":return core.flags.enableFloor;case"name":return core.flags.enableName;case"lv":return core.flags.enableLv;case"hpmax":return core.flags.enableHPMax;case"mana":return core.flags.enableMana;case"mdef":return core.flags.enableMDef;case"money":return core.flags.enableMoney;case"experience":return core.flags.enableExperience&&!core.flags.levelUpLeftMode;case"up":return core.flags.enableLevelUp;case"skill":return core.flags.enableSkill;case"key":return core.flags.enableKeys;case"pzf":return core.flags.enablePZF;case"debuff":return core.flags.enableDebuff;default:return!0}},f.prototype.registerResize=function(e,t){this.unregisterResize(e),this.resizes.push({name:e,func:t})},f.prototype.unregisterResize=function(e){this.resizes=this.resizes.filter((function(t){return t.name!=e}))},f.prototype._doResize=function(e){for(var t in this.resizes)try{if(core.doFunc(this.resizes[t].func,this,e))return!0}catch(e){main.log(e),main.log("ERROR in resizes["+this.resizes[t].name+"]：已自动注销该项。"),this.unregisterResize(this.resizes[t].name)}return!1},f.prototype.resize=function(){if("editor"!=main.mode){var e=main.dom.body.clientWidth,t=main.dom.body.clientHeight,o=core.__PIXELS__+6,r=Math.round(.31*core.__PIXELS__)+3;e>=o+r||e>t&&t<o?(core.domStyle.isVertical=!1,core.domStyle.scale=Math.min(1,t/o)):(core.domStyle.isVertical=!0,core.domStyle.scale=Math.min(1,e/o));var a=this._shouldDisplayStatus(),n=a.length,i=core.flags.statusCanvas,s=core.flags.statusCanvasRowsOnMobile||3,c=i?s:Math.ceil(n/3);c>4&&(i?alert("自绘状态栏的在竖屏下的行数应不超过4！"):alert("当前状态栏数目("+n+")大于12，请调整到不超过12以避免手机端出现显示问题。"));var l=core.status.globalAttribute||core.initStatus.globalAttribute,u={clientWidth:e,clientHeight:t,CANVAS_WIDTH:o,BAR_WIDTH:r,outerSize:o*core.domStyle.scale,globalAttribute:l,border:"3px "+l.borderColor+" solid",statusDisplayArr:a,count:n,col:c,statusBarHeightInVertical:core.domStyle.isVertical?(32*c+6)*core.domStyle.scale+6:0,toolbarHeightInVertical:core.domStyle.isVertical?44*core.domStyle.scale+6:0,is15x15:15==core.__SIZE__};this._doResize(u),this.setToolbarButton(),core.updateStatusBar()}},f.prototype._resize_gameGroup=function(e){var t,o,r=core.dom.gameGroup;core.domStyle.isVertical?(t=e.outerSize,o=e.outerSize+e.statusBarHeightInVertical+e.toolbarHeightInVertical):(t=(e.CANVAS_WIDTH+e.BAR_WIDTH)*core.domStyle.scale,o=e.outerSize),r.style.width=t+"px",r.style.height=o+"px",r.style.left=(e.clientWidth-t)/2+"px",r.style.top=(e.clientHeight-o)/2+"px";var a=core.dom.floorMsgGroup;a.style.width=e.outerSize-6+"px",a.style.height=o-6+"px",a.style.background=e.globalAttribute.floorChangingBackground,a.style.color=e.globalAttribute.floorChangingTextColor,core.domStyle.isVertical||core.domStyle.scale<1?core.dom.musicBtn.style.right=core.dom.musicBtn.style.bottom="3px":(core.dom.musicBtn.style.right=(e.clientWidth-t)/2+"px",core.dom.musicBtn.style.bottom=(e.clientHeight-o)/2-27+"px")},f.prototype._resize_canvas=function(e){for(var t=e.outerSize-6+"px",o=0;o<core.dom.gameCanvas.length;++o)core.dom.gameCanvas[o].style.width=core.dom.gameCanvas[o].style.height=t;for(var r in core.dom.gif.style.width=core.dom.gif.style.height=t,core.dom.gif2.style.width=core.dom.gif2.style.height=t,core.dom.gameDraw.style.width=core.dom.gameDraw.style.height=t,core.dom.gameDraw.style.top=e.statusBarHeightInVertical+"px",core.dom.gameDraw.style.right=0,core.dom.gameDraw.style.border=e.border,core.bigmap.canvas.forEach((function(e){core.canvas[e].canvas.style.width=32*core.bigmap.width*core.domStyle.scale+"px",core.canvas[e].canvas.style.height=32*core.bigmap.height*core.domStyle.scale+"px"})),core.dymCanvas){var a=core.dymCanvas[r].canvas;a.style.width=a.width*core.domStyle.scale+"px",a.style.height=a.height*core.domStyle.scale+"px",a.style.left=parseFloat(a.getAttribute("_left"))*core.domStyle.scale+"px",a.style.top=parseFloat(a.getAttribute("_top"))*core.domStyle.scale+"px"}main.dom.next.style.width=main.dom.next.style.height=5*core.domStyle.scale+"px",main.dom.next.style.borderBottomWidth=main.dom.next.style.borderRightWidth=4*core.domStyle.scale+"px"},f.prototype._resize_statusBar=function(e){var t=core.dom.statusBar;core.domStyle.isVertical?(t.style.width=e.outerSize+"px",t.style.height=e.statusBarHeightInVertical+"px",t.style.background=e.globalAttribute.statusTopBackground,t.style.fontSize=16*core.domStyle.scale+"px"):(t.style.width=e.BAR_WIDTH*core.domStyle.scale+"px",t.style.height=e.outerSize+"px",t.style.background=e.globalAttribute.statusLeftBackground,t.style.fontSize=16*Math.min(1,(core.__HALF_SIZE__+3)/e.count)*core.domStyle.scale+"px"),t.style.display="block",t.style.borderTop=t.style.borderLeft=e.border,t.style.borderRight=core.domStyle.isVertical?e.border:"",t.style.borderBottom=core.domStyle.isVertical?"":e.border,core.domStyle.isVertical?(core.dom.statusCanvas.style.width=e.outerSize-6+"px",core.dom.statusCanvas.width=core.__PIXELS__,core.dom.statusCanvas.style.height=e.statusBarHeightInVertical-3+"px",core.dom.statusCanvas.height=32*e.col+9):(core.dom.statusCanvas.style.width=e.BAR_WIDTH*core.domStyle.scale-3+"px",core.dom.statusCanvas.width=e.BAR_WIDTH-3,core.dom.statusCanvas.style.height=e.outerSize-6+"px",core.dom.statusCanvas.height=core.__PIXELS__),core.dom.statusCanvas.style.display=core.flags.statusCanvas?"block":"none"},f.prototype._resize_status=function(e){for(var t=32*(core.domStyle.isVertical?1:(core.__HALF_SIZE__+3)/e.count)*core.domStyle.scale*.8,o=0;o<core.dom.status.length;++o){var r=core.dom.status[o].id,a=core.dom.status[o].style;r.endsWith("Col")&&(r=r.substring(0,r.length-3)),a.display=core.flags.statusCanvas||e.statusDisplayArr.indexOf(r)<0?"none":"block",a.margin=3*core.domStyle.scale+"px",a.height=t+"px",a.maxWidth=e.BAR_WIDTH*core.domStyle.scale*(core.domStyle.isVertical?.95:1)+"px",e.is15x15&&!core.domStyle.isVertical&&(a.marginLeft=11*core.domStyle.scale+"px")}for(o=0;o<core.dom.statusLabels.length;++o)core.dom.statusLabels[o].style.lineHeight=t+"px",core.dom.statusLabels[o].style.marginLeft=6*core.domStyle.scale+"px";for(o=0;o<core.dom.statusTexts.length;++o)core.dom.statusTexts[o].style.color=e.globalAttribute.statusBarColor},f.prototype._resize_toolBar=function(e){var t=core.dom.toolBar;core.domStyle.isVertical?(t.style.width=e.outerSize+"px",t.style.top=e.statusBarHeightInVertical+e.outerSize+"px",t.style.height=e.toolbarHeightInVertical+"px",t.style.background=e.globalAttribute.toolsBackground):(t.style.width=e.BAR_WIDTH*core.domStyle.scale+"px",t.style.top=.718*e.outerSize+"px",t.style.height=.281*e.outerSize+"px",t.style.background="transparent"),t.style.display="block",t.style.borderLeft=e.border,t.style.borderRight=t.style.borderBottom=core.domStyle.isVertical?e.border:"",t.style.fontSize=16*core.domStyle.scale+"px"},f.prototype._resize_tools=function(e){var t,o=32*core.domStyle.scale*(core.domStyle.isVertical&&!e.is15x15?.95:1);t=core.domStyle.isVertical?3*(core.__HALF_SIZE__-3)*core.domStyle.scale:(e.BAR_WIDTH*core.domStyle.scale-9-3*o)/4;for(var r=0;r<core.dom.tools.length;++r){var a=core.dom.tools[r].style;a.height=o+"px",a.marginLeft=t+"px",a.marginTop=6*core.domStyle.scale+"px"}core.dom.hard.style.lineHeight=o+"px",core.dom.hard.style.color=e.globalAttribute.hardLabelColor,core.domStyle.isVertical?core.dom.hard.style.width=e.outerSize-9*t-8.5*o-12+"px":(core.dom.hard.style.width=e.BAR_WIDTH*core.domStyle.scale-9-2*t+"px",e.is15x15||(core.dom.hard.style.marginTop=0))};var m=o(35),h=o(27),y=o(37),g=o.n(y),v=_;function _(){this._init()}_.prototype._init=function(){if(this.enemys=g.a,this.enemydata=n.a.enemys,"play"==main.mode)for(var e in this.enemydata.hasSpecial=function(e,t){return core.enemys.hasSpecial(e,t)},this.enemys)this.enemys[e].id=e},_.prototype.getEnemys=function(){var e=core.clone(this.enemys),t=core.getFlag("enemyInfo");if(t)for(var o in t)for(var r in t[o])e[o][r]=core.clone(t[o][r]);return e},_.prototype.hasSpecial=function(e,t){return null!=e&&(e instanceof Array?e.indexOf(t)>=0:"number"==typeof e?e===t:"string"==typeof e?this.hasSpecial(core.material.enemys[e],t):null!=e.special&&this.hasSpecial(e.special,t))},_.prototype.getSpecials=function(){return this.enemydata.getSpecials()},_.prototype.getSpecialText=function(e){if("string"==typeof e&&(e=core.material.enemys[e]),!e)return[];var t=e.special,o=[],r=this.getSpecials();if(r)for(var a=0;a<r.length;a++)this.hasSpecial(t,r[a][0])&&o.push(this._calSpecialContent(e,r[a][1]));return o},_.prototype.getSpecialHint=function(e,t){var o=this.getSpecials();if(null==t){if(null==o)return[];for(var r=[],a=0;a<o.length;a++)this.hasSpecial(e,o[a][0])&&r.push(this._calSpecialContent(e,o[a][1])+"："+this._calSpecialContent(e,o[a][2]));return r}if(null==o)return"";for(a=0;a<o.length;a++)if(t==o[a][0])return this._calSpecialContent(e,o[a][1])+"："+this._calSpecialContent(e,o[a][2]);return""},_.prototype._calSpecialContent=function(e,t){return"string"==typeof t?t:("string"==typeof e&&(e=core.material.enemys[e]),t instanceof Function?t(e):"")},_.prototype.canBattle=function(e,t,o,r){"string"==typeof e&&(e=core.material.enemys[e]);var a=this.getDamage(e,t,o,r);return null!=a&&a<core.status.hero.hp},_.prototype.getDamage=function(e,t,o,r){"string"==typeof e&&(e=core.material.enemys[e]);var a=this._calDamage(e,null,t,o,r);return null==a?null:a+this.getExtraDamage(e,t,o,r)},_.prototype.getExtraDamage=function(e,t,o,r){"string"==typeof e&&(e=core.material.enemys[e]);var a=0;return this.hasSpecial(e.special,17)&&(a+=core.getFlag("hatred",0)),this.hasSpecial(e.special,22)&&(a+=e.damage||0),a},_.prototype.getDamageString=function(e,t,o,r){"string"==typeof e&&(e=core.material.enemys[e]);var a=this.getDamage(e,t,o,r),n="#000000",i="blue";return null==a?(a="???",n="#FF0000",i="black"):(a<=0?n="#00FF00":a<core.status.hero.hp/3?n="#FFFFFF":a<2*core.status.hero.hp/3?n="#FFFF00":a<core.status.hero.hp?n="#FF7F00":(n="red",i="#111111"),a=core.formatBigNumber(a,!0),core.enemys.hasSpecial(e,19)&&(a+="+"),core.enemys.hasSpecial(e,21)&&(a+="-"),core.enemys.hasSpecial(e,11)&&(a+="^")),{damage:a,color:n,stroke:i}},_.prototype.nextCriticals=function(e,t,o,r,a){if("string"==typeof e&&(e=core.material.enemys[e]),t=t||1,this.hasSpecial(e.special,10))return[];var n=this.getDamageInfo(e,null,o,r,a);if(null==n||this.hasSpecial(e.special,3))return n=this.getEnemyInfo(e,null,o,r,a),core.status.hero.atk<=n.def?[[n.def+1-core.status.hero.atk,"?"]]:[];if("number"==typeof n||n.damage<=0&&!core.flags.enableNegativeDamage)return[[0,0]];if(core.flags.useLoop){return core.status.hero.atk<=1?this._nextCriticals_useLoop(e,n,t,o,r,a):this._nextCriticals_useBinarySearch(e,n,t,o,r,a)}return this._nextCriticals_useTurn(e,n,t,o,r,a)},_.prototype._nextCriticals_useLoop=function(e,t,o,r,a,n){for(var i=t.mon_hp,s=core.status.hero.atk,c=t.mon_def,l=t.damage,u=[],p=s+1;p<=i+c;p++){var d=this.getDamageInfo(e,{atk:p},r,a,n);if(null==d||"number"==typeof d)break;if(l>d.damage){if(l=d.damage,u.push([p-s,t.damage-d.damage]),d.damage<=0&&!core.flags.enableNegativeDamage)break;if(u.length>=o)break}}return 0==u.length&&u.push([0,0]),u},_.prototype._nextCriticals_useBinarySearch=function(e,t,o,r,a,n){for(var i=t.mon_hp,s=core.status.hero.atk,c=t.mon_def,l=t.damage,u=[],p=function(t,o){var i=Math.floor(t),s=Math.floor(o);if(i>s)return null;for(;i<s;){var c,u=Math.floor((i+s)/2);if(null==(c=core.enemys.getDamageInfo(e,{atk:u},r,a,n))||"number"==typeof c)return null;l>c.damage?s=u:i=u+1}return null==(c=core.enemys.getDamageInfo(e,{atk:i},r,a,n))||"number"==typeof c||c.damage>=l?null:[i,c.damage]},d=s;;){var f=p(d+1,i+c);if(null==f)break;if(d=f[0],l=f[1],u.push([d-s,t.damage-l]),l<=0&&!core.flags.enableNegativeDamage)break;if(u.length>=o)break}return 0==u.length&&u.push([0,0]),u},_.prototype._nextCriticals_useTurn=function(e,t,o,r,a,n){var i=t.mon_hp,s=core.status.hero.atk,c=t.mon_def,l=t.turn;if(l>=1e6)return this._nextCriticals_useBinarySearch(e,t,o,r,a,n);for(var u=[],p=null,d=l-1;d>=1;d--){var f=Math.ceil(i/d)+c;if((f=Math.ceil(f/core.getBuff("atk")))<=s)break;if(f!=p){var m=this.getDamageInfo(e,{atk:f},r,a,n);if(null==m||"number"==typeof m)break;if(u.push([f-s,Math.floor(t.damage-m.damage)]),m.damage<=0&&!core.flags.enableNegativeDamage)break;p=f}if(u.length>=o)break}return 0==u.length&&u.push([0,0]),u},_.prototype.getDefDamage=function(e,t,o,r,a){"string"==typeof e&&(e=core.material.enemys[e]),t=t||1;var n=this._calDamage(e,null,o,r,a),i=this._calDamage(e,{def:core.status.hero.def+t},o,r,a);return null==n||null==i?"???":n-i},_.prototype.getEnemyInfo=function(e,t,o,r,a){return"string"==typeof e&&(e=core.material.enemys[e]),this.enemydata.getEnemyInfo(e,t,o,r,a)},_.prototype.getDamageInfo=function(e,t,o,r,a){return"string"==typeof e&&(e=core.material.enemys[e]),this.enemydata.getDamageInfo(e,t,o,r,a)},_.prototype._calDamage=function(e,t,o,r,a){"string"==typeof e&&(e=core.material.enemys[e]);var n=this.getDamageInfo(e,t,o,r,a);return null==n?null:"number"==typeof n?n:n.damage},_.prototype.updateEnemys=function(){},_.prototype.getCurrentEnemys=function(e){e=e||core.status.floorId;for(var t=[],o={},r=core.status.maps[e].blocks,a=0;a<r.length;a++)r[a].disable||0!=r[a].event.cls.indexOf("enemy")||this._getCurrentEnemys_addEnemy(r[a].event.id,t,o,e);return this._getCurrentEnemys_sort(t)},_.prototype._getCurrentEnemys_getEnemy=function(e){var t=core.material.enemys[e];return t?core.material.enemys[t.displayIdInBook]||t:null},_.prototype._getCurrentEnemys_addEnemy=function(e,t,o,r){var a=this._getCurrentEnemys_getEnemy(e);if(null!=a&&!o[a.id]){var n=this.getEnemyInfo(a,null,null,null,r),i=core.enemys.getSpecialText(a);i=i.length>=3?"多属性...":i.join("  ");var s=this.nextCriticals(a,1,null,null,r);s.length>0&&(s=s[0]);var c=core.clone(a);for(var l in n)c[l]=n[l];c.specialText=i,c.damage=this.getDamage(a,null,null,r),c.critical=s[0],c.criticalDamage=s[1],c.defDamage=this.getDefDamage(a,1,null,null,r),t.push(c),o[a.id]=!0}},_.prototype._getCurrentEnemys_sort=function(e){return e.sort((function(e,t){return e.damage==t.damage?e.money-t.money:null==e.damage?1:null==t.damage?-1:e.damage-t.damage}))},_.prototype.hasEnemyLeft=function(e,t){if(null==t&&(t=core.status.floorId),t instanceof Array){for(var o=0;o<t.length;++o)if(core.hasEnemyLeft(e,t[o]))return!0;return!1}return core.getCurrentEnemys(t).filter((function(t){return null==e||t.id==e})).length>0};var w=o(38),x=b;function b(){}b.prototype._load=function(e){if(main.replayChecking)return e();window.fs?this._listExtensions(e):this._loadJs("_server/fs.js",(function(){core.extensions._listExtensions(e)}),e)},b.prototype._loadJs=function(e,t,o){var r=document.createElement("script");r.src=e+"?v="+main.version,r.onload=t,r.onerror=o,main.dom.body.appendChild(r)},b.prototype._listExtensions=function(e){if(!window.fs)return e();fs.readdir("extensions",(function(t,o){if(t||!(o instanceof Array))return e();var r=[];o.forEach((function(e){/^[\w.-]+\.js$/.test(e)&&r.push(e)})),r.sort(),core.extensions._loadExtensions(r,e)}))},b.prototype._loadExtensions=function(e,t){var o=0;!function r(){if(o==e.length)return t();core.extensions._loadJs("extensions/"+e[o++],r,r)}()};var S=o(40),k=o.n(S),I=A;function A(){this._init()}A.prototype._init=function(){this.icons=k.a,this.tilesetStartOffset=1e4},A.prototype.getIcons=function(){return core.clone(this.icons)},A.prototype.getClsFromId=function(e){for(var t in core.material.icons)if("hero"!=t&&e in core.material.icons[t])return t;return null},A.prototype._getAnimateFrames=function(e,t){return"enemys"==e||"npcs"==e?2:"animates"==e||"enemy48"==e||"npc48"==e&&t?4:1},A.prototype.getTilesetOffset=function(e){if("string"==typeof e){if(!/^X\d+$/.test(e))return null;e=parseInt(e.substring(1))}else if("number"!=typeof e)return null;return e>=this.tilesetStartOffset||null};var E=o(41),T=o(0),F=B;function B(){this._init()}B.prototype._init=function(){},B.prototype._setStartProgressVal=function(e){core.dom.startTopProgress.style.width=e+"%"},B.prototype._setStartLoadTipText=function(e){},B.prototype._load=function(e){var t=function(t){var o=Object.keys(main.statusBar.icons),r={};o.forEach((function(e){var o=t[e];o&&(r[e]=o)})),core.statusBar.icons=r,e()};this._loadMusic(),pixi.loader.complete?t(pixi.loader.textures):pixi.event.once("loadComplete",t)},B.prototype._loadIcons=function(){this.loadImage("icons.png",(function(e,t){var o=core.splitImage(t);for(var r in core.statusBar.icons)"number"==typeof core.statusBar.icons[r]&&(core.statusBar.icons[r]=o[core.statusBar.icons[r]],null!=core.statusBar.image[r]&&(core.statusBar.image[r].src=core.statusBar.icons[r].src))}))},B.prototype._loadMaterialImages=function(e){this._setStartLoadTipText("正在加载资源文件..."),main.useCompress?this.loadImagesFromZip("project/images/materials.h5data",core.materials,core.material.images,e):this.loadImages(core.materials,core.material.images,e)},B.prototype._loadExtraImages=function(e){core.material.images.images={};var t=core.clone(core.images);if(t.indexOf("hero.png")<0&&t.push("hero.png"),this._setStartLoadTipText("正在加载图片文件..."),main.useCompress){var o=t.filter((function(e){return e.toLowerCase().endsWith(".gif")}));t=t.filter((function(e){return!e.toLowerCase().endsWith(".gif")})),this.loadImagesFromZip("project/images/images.h5data",t,core.material.images.images,e),o.forEach((function(e){this.loadImage(e,(function(t,o){null!=o&&(core.material.images.images[e]=o)}))}),this)}else this.loadImages(t,core.material.images.images,e)},B.prototype._loadAutotiles=function(e){core.material.images.autotile={};var t=Object.keys(core.material.icons.autotile),o={},r=function(){t.forEach((function(e){core.material.images.autotile[e]=o[e]})),setTimeout((function(){core.maps._makeAutotileEdges()})),e()};this._setStartLoadTipText("正在加载自动元件..."),main.useCompress?this.loadImagesFromZip("project/images/autotiles.h5data",t,o,r):this.loadImages(t,o,r)},B.prototype._loadTilesets=function(e){core.material.images.tilesets={},core.tilesets=core.tilesets||[];var t=function(){for(var t in core.material.images.tilesets){var o=core.material.images.tilesets[t];o.width%32==0&&o.height%32==0||console.warn("警告！"+t+"的宽或高不是32的倍数！"),o.width*o.height>3072e3&&console.warn("警告！"+t+"上的图块素材个数大于3000！")}e()};this._setStartLoadTipText("正在加载额外素材..."),main.useCompress?this.loadImagesFromZip("project/images/tilesets.h5data",core.tilesets,core.material.images.tilesets,t):this.loadImages(core.tilesets,core.material.images.tilesets,t)},B.prototype.loadImages=function(e,t,o){if(e&&0!=e.length)for(var r=0,a=0;a<e.length;a++)this.loadImage(e[a],(function(a,n){core.loader._setStartLoadTipText("正在加载图片 "+a+"..."),void 0===t[a]?(t[a]=n,r++,core.loader._setStartProgressVal(r*(100/e.length)),r==e.length&&o&&o()):null!=n&&(t[a]=n)}));else o&&o()},B.prototype.loadImagesFromZip=function(e,t,o,r){t&&0!=t.length?core.unzip(e+"?v="+main.version,(function(e){var a=1;t.forEach((function(t){var n=t;if(n.indexOf(".")<0&&(n+=".png"),n in e){var i=new Image,s=URL.createObjectURL(e[n]);a++,i.onload=function(){a--,URL.revokeObjectURL(s),0==a&&r&&r()},i.src=s,o[t]=i}})),0==--a&&r&&r()}),null,!1,(function(e){core.loader._setStartProgressVal(100*e)})):r&&r()},B.prototype.loadImage=function(e,t){},B.prototype._loadAnimates=function(e){var t=this,o=pixi.textures.animates;Object.keys(o).forEach((function(r){t._loadAnimate(r,o[r],e)})),core.material.animates=o};B.prototype._loadAnimate=function(e,t,o){var r=t.bitmaps.lastIndexOf(1);t.bitmaps=t.bitmaps.slice(0,r+1),t.bitmaps=t.bitmaps.map((function(t,r){if(t){var a="".concat(e,"-").concat(r),n=o[a];return n?(delete o[a],n):T.Texture.EMPTY}return T.Texture.EMPTY})),t.frame=t.frame_max;var a=t.frames;t.trashFrames=a;var n=[];a.forEach((function(e){var t=[];e.forEach((function(e){t.push({index:e[0],x:e[1],y:e[2],zoom:e[3],opacity:e[4],mirror:e[5]||0,angle:e[6]||0})})),n.push(t)})),t.frames=n},B.prototype._loadMusic=function(){core.bgms.forEach((function(e){core.loader.loadOneMusic(e)})),this._setStartLoadTipText("正在加载音效文件..."),main.useCompress&&core.musicStatus.audioContext?core.unzip("project/sounds/sounds.h5data?v="+main.version,(function(e){for(var t in e)core.sounds.indexOf(t)>=0&&core.loader._loadOneSound_decodeData(t,e[t])})):core.sounds.forEach((function(e){core.loader.loadOneSound(e)})),core.playBgm(main.startBgm)},B.prototype.loadOneMusic=function(e){var t=new Audio;t.preload="none";var o=(0,main.loadFile.sounds)("./"+e).default;main.bgmRemote?t.src=o:t.src="project/sounds/"+e,t.loop="loop",core.material.bgms[e]=t},B.prototype.loadOneSound=function(e){var t=(0,main.loadFile.sounds)("./"+e).default;if(null!=core.musicStatus.audioContext)core.http("GET",t,null,(function(t){core.loader._loadOneSound_decodeData(e,t)}),(function(t){main.log(t),core.material.sounds[e]=null}),null,"arraybuffer");else{var o=new Audio;o.src=t,core.material.sounds[e]=o}},B.prototype._loadOneSound_decodeData=function(e,t){if(t instanceof Blob){var o=new zip.BlobReader(t);o.init((function(){o.readUint8Array(0,o.size,(function(t){core.loader._loadOneSound_decodeData(e,t.buffer)}))}))}else try{core.musicStatus.audioContext.decodeAudioData(t,(function(t){core.material.sounds[e]=t}),(function(t){main.log(t),core.material.sounds[e]=null}))}catch(t){main.log(t),core.material.sounds[e]=null}},B.prototype.loadBgm=function(e){if(e=core.getMappedName(e),core.material.bgms[e]&&core.musicStatus.bgmStatus){var t=core.musicStatus.cachedBgms.indexOf(e);t>=0?core.musicStatus.cachedBgms.splice(t,1):(this._preloadBgm(core.material.bgms[e]),core.musicStatus.cachedBgms.length==core.musicStatus.cachedBgmCount&&this.freeBgm(core.musicStatus.cachedBgms.pop())),core.musicStatus.cachedBgms.unshift(e)}},B.prototype._preloadBgm=function(e){e.volume=0,e.play()},B.prototype.freeBgm=function(e){e=core.getMappedName(e),core.material.bgms[e]&&(core.musicStatus.cachedBgms=core.musicStatus.cachedBgms.filter((function(t){return t!=e})),core.material.bgms[e].removeAttribute("src"),core.material.bgms[e].load(),core.material.bgms[e]=null,e==core.musicStatus.playingBgm&&(core.musicStatus.playingBgm=null),setTimeout((function(){core.loader.loadOneMusic(e)}),3e3))};var C=o(42),P=o.n(C),L=o(43),D=o.n(L),M=o(4),R=o(15),O=o(1);function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==o)return;var r,a,n=[],i=!0,s=!1;try{for(o=o.call(e);!(i=(r=o.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(s)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return H(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return H(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var j=N;function N(){this._init()}N.prototype._init=function(){this.blocksInfo=P.a},N.prototype._setFloorSize=function(e){e?(core.floors[e].width=core.floors[e].width||core.__SIZE__,core.floors[e].height=core.floors[e].height||core.__SIZE__):core.floorIds.forEach((function(e){core.maps._setFloorSize(e)}))},N.prototype.loadFloor=function(e,t){var o=core.floors[e];t||(t=o.map),t instanceof Array&&(t={map:t});var r={},a=["firstArrive","eachArrive","parallelDo","map","bgmap","fgmap","events","changeFloor","afterBattle","afterGetItem","afterOpenDoor","cannotMove"];for(var n in o)-1==a.indexOf(n)&&null!=o[n]&&(r[n]=core.clone(o[n]));for(var n in t)-1==a.indexOf(n)&&null!=t[n]&&(r[n]=core.clone(t[n]));return t=this.decompressMap(t.map,e),r.blocks=this._mapIntoBlocks(t,o,e),r},N.prototype._mapIntoBlocks=function(e,t,o){for(var r=[],a=core.floors[o].width,n=core.floors[o].height,i=0;i<n;i++)for(var s=0;s<a;s++){var c=this.initBlock(s,i,(e[i]||[])[s],!0,t);(0!=c.id||c.event.trigger)&&r.push(c)}return r},N.prototype.getNumberById=function(e){return R.a.getNumberById(e)},N.prototype._getNumberById=function(e){for(var t in this.blocksInfo)if((this.blocksInfo[t]||{}).id==e)return parseInt(t)||0;return/^X\d+$/.test(e)&&core.icons.getTilesetOffset(e)?parseInt(e.substring(1)):"none"==e?0:"airwall"==e?17:0},N.prototype.getBlockByNumber=function(e){return R.a.getBlockByNumber(e)},N.prototype.initBlock=function(e,t,o,r,a){return pixi.Block.get(o,e,t,r,a)},N.prototype._initMaps=function(){for(var e=core.floorIds,t={},o=0;o<e.length;o++){var r=e[o];t[r]=this.loadFloor(r)}return t},N.prototype._initFloorMap=function(e){for(var t=core.clone(core.floors[e].map),o=core.floors[e].width,r=core.floors[e].height,a=0;a<r;a++){null==t[a]&&(t[a]=[]);for(var n=0;n<o;n++){null==t[a][n]&&(t[a][n]=0);var i=core.floors[e].events[n+","+a];i&&!1===i.disable&&"play"==main.mode&&(t[a][n]+=":f")}}return t},N.prototype.compressMap=function(e,t){var o=this._initFloorMap(t);if(core.utils.same(e,o))return null;for(var r=core.floors[t].width,a=core.floors[t].height,n=0;n<a;n++)if(core.utils.same(e[n],o[n]))e[n]=0;else for(var i=0;i<r;i++)e[n][i]===o[n][i]&&(e[n][i]=-1);return e},N.prototype.decompressMap=function(e,t){var o=this._initFloorMap(t);if(!e)return o;for(var r=core.floors[t].width,a=core.floors[t].height,n=0;n<a;n++)if(0===e[n])e[n]=o[n];else for(var i=0;i<r;i++)-1===e[n][i]&&(e[n][i]=o[n][i]);return e},N.prototype.saveMap=function(e){var t=core.status.maps;if(!e){var o={};for(var r in t){var a=this.saveMap(r);Object.keys(a).length>0&&(o[r]=a)}return o}if("play"==main.mode&&(flags.__removed__||[]).indexOf(e)>=0)return{canFlyTo:!1,cannotViewMap:!0};o=t[e];var n=core.floors[e],i=this._getMapArrayFromBlocks(o.blocks,n.width,n.height,!0);if("editor"==main.mode)return i;var s=this._compressFloorData(o,n),c=this.compressMap(i,e);return null!=c&&(s.map=c),s},N.prototype._compressFloorData=function(e,t){var o={};for(var r in e)if("blocks"!=r){var a=t[r];core.utils.same(e[r],a)||(o[r]=core.clone(e[r]))}return o},N.prototype.loadMap=function(e,t){if(!t){var o={};return core.floorIds.forEach((function(t){o[t]=core.maps.loadFloor(t,e[t])})),o}return this.loadFloor(t,e[t])},N.prototype.removeMaps=function(e,t){if(core.isPlaying()){t=t||e;var o=core.floorIds.indexOf(e),r=core.floorIds.indexOf(t);r<0&&(r=core.floorIds.length-1),flags.__removed__=flags.__removed__||[];for(var a=o;a<=r;++a){var n=core.floorIds[a];delete flags.__visited__[n],flags.__removed__.push(n),core.status.maps[n].canFlyTo=!1,core.status.maps[n].cannotViewMap=!0}}},N.prototype.resizeMap=function(e){if(e=e||core.status.floorId){core.bigmap.width=core.floors[e].width,core.bigmap.height=core.floors[e].height;var t=32*core.bigmap.width,o=32*core.bigmap.height;core.bigmap.canvas.forEach((function(e){core.canvas[e].canvas.setAttribute("width",t),core.canvas[e].canvas.setAttribute("height",o),core.canvas[e].canvas.style.width=t*core.domStyle.scale+"px",core.canvas[e].canvas.style.height=o*core.domStyle.scale+"px","editor"===main.mode&&editor.isMobile&&(core.canvas[e].canvas.style.width=32*core.bigmap.width/core.__PIXELS__*96+"vw",core.canvas[e].canvas.style.height=32*core.bigmap.height/core.__PIXELS__*96+"vw")}))}},N.prototype.getMapArray=function(e,t){return e=e||core.status.floorId,this._getMapArrayFromBlocks(core.status.maps[e].blocks,core.floors[e].width,core.floors[e].height,t)},N.prototype._getMapArrayFromBlocks=function(e,t,o,r){if("string"==typeof e){var a=e;e=core.status.maps[a].blocks,t=core.floors[a].width,o=core.floors[a].height}for(var n=[],i=[],s=0;s<t;s++)i.push(0);for(var c=0;c<o;c++)n.push(core.clone(i));return e.forEach((function(e){var t=e.x,o=e.y;e.disable?r&&(n[o][t]=e.id+":f"):(n[o][t]=e.id,r&&!1===e.disable&&(n[o][t]=e.id+":t"))})),n},N.prototype.getMapBlocksObj=function(e,t){e=e||core.status.floorId;var o={};return core.status.maps[e].blocks.forEach((function(e){e.disable&&!t||(o[e.x+","+e.y]=e)})),o},N.prototype._getBgFgMapArray=function(e,t,o){if(!(t=t||core.status.floorId))return[];var r=core.floors[t].width,a=core.floors[t].height;if(!o&&core.status[e+"maps"][t])return core.status[e+"maps"][t];var n=core.clone(core.floors[t][e+"map"]||[]);"editor"!=main.mode||window.editor&&editor.uievent&&editor.uievent.isOpen||(n=core.clone(editor[e+"map"])||n);for(var i=0;i<r;i++)for(var s=0;s<a;s++){n[s]=n[s]||[];var c="__"+e+"Map__"+t+"_"+i+"_"+s,l="__"+e+"Value__"+t+"_"+i+"_"+s;core.hasFlag(c)?n[s][i]=0:n[s][i]=core.getFlag(l,n[s][i]||0),"editor"==main.mode&&(n[s][i]=n[s][i].idnum||n[s][i]||0)}return core.status[e+"maps"]&&(core.status[e+"maps"][t]=core.clone(n)),n},N.prototype.getBgMapArray=function(e,t){return this._getBgFgMapArray("bg",e,t)},N.prototype.getFgMapArray=function(e,t){return this._getBgFgMapArray("fg",e,t)},N.prototype._getBgFgNumber=function(e,t,o,r,a){return null==t&&(t=core.getHeroLoc("x")),null==o&&(o=core.getHeroLoc("y")),this._getBgFgMapArray(e,r,a)[o][t]},N.prototype.getBgNumber=function(e,t,o,r){return this._getBgFgNumber("bg",e,t,o,r)},N.prototype.getFgNumber=function(e,t,o,r){return this._getBgFgNumber("fg",e,t,o,r)},N.prototype.generateMovableArray=function(e,t,o,r){if(!(e=e||core.status.floorId))return null;var a=core.floors[e].width,n=core.floors[e].height,i=this.getBgMapArray(e),s=this.getFgMapArray(e),c=this.getMapArray(e),l=function(t,o,r){return null!=r?core.maps._canMoveHero_checkPoint(t,o,r,e,{bgArray:i,fgArray:s,eventArray:c}):["left","down","up","right"].filter((function(r){return core.maps._canMoveHero_checkPoint(t,o,r,e,{bgArray:i,fgArray:s,eventArray:c})}))};if(null!=t&&null!=o)return l(t,o,r);var u=[];for(t=0;t<a;t++){u[t]=[];for(o=0;o<n;o++)u[t][o]=l(t,o)}return u},N.prototype.canMoveHero=function(e,t,o,r){return null==e&&(e=core.getHeroLoc("x")),null==t&&(t=core.getHeroLoc("y")),o=o||core.getHeroLoc("direction"),this.generateMovableArray(r,e,t,o)},N.prototype._canMoveHero_checkPoint=function(e,t,o,r,a){if(core.inArray((core.floors[r].cannotMove||{})[e+","+t],o))return!1;var n=e+core.utils.scan[o].x,i=t+core.utils.scan[o].y;return!(n<0||i<0||n>=core.floors[r].width||i>=core.floors[r].height)&&(!this._canMoveHero_checkCannotInOut([a.bgArray[t][e],a.fgArray[t][e],a.eventArray[t][e]],"cannotOut",o)&&(!this._canMoveHero_checkCannotInOut([a.bgArray[i][n],a.fgArray[i][n],a.eventArray[i][n]],"cannotIn",o)&&!(r==core.status.floorId&&core.status.hero.hp<=(core.status.checkBlock.damage[n+","+i]||0)&&!core.flags.canGoDeadZone&&0==a.eventArray[i][n])))},N.prototype._canMoveHero_checkCannotInOut=function(e,t,o){if(e instanceof Array){for(var r in e)if(this._canMoveHero_checkCannotInOut(e[r],t,o))return!0;return!1}return core.inArray((this.getBlockByNumber(e).event||{})[t],o)},N.prototype.canMoveDirectly=function(e,t){return this.canMoveDirectlyArray([[e,t]])[0]},N.prototype.canMoveDirectlyArray=function(e){var t=[],o=e.length,r=core.getHeroLoc("x"),a=core.getHeroLoc("y");if(!this._canMoveDirectly_checkGlobal()){for(var n=0;n<o;++n)t.push(-1);return t}for(n=0;n<o;++n)e[n][0]==r&&e[n][1]==a?(t.push(0),o--):e[n][0]<0||e[n][0]>=core.bigmap.width||e[n][1]<0||e[n][1]>=core.bigmap.height?(t.push(-1),o--):t.push(null);if(0==o)return t;if(!this._canMoveDirectly_checkStartPoint(r,a)){for(var n in t)null==t[n]&&(t[n]=-1);return t}return this._canMoveDirectly_bfs(r,a,e,o,t)},N.prototype._canMoveDirectly_checkGlobal=function(){return!!core.flags.enableMoveDirectly&&(!core.status.thisMap.cannotMoveDirectly&&(!core.hasFlag("cannotMoveDirectly")&&!core.hasFlag("poison")))},N.prototype._canMoveDirectly_checkStartPoint=function(e,t){if(core.status.checkBlock.damage[e+","+t])return!1;var o=core.getBlock(e,t);return null==o||"changeFloor"==o.block.event.trigger},N.prototype._canMoveDirectly_bfs=function(e,t,o,r,a){var n=this.generateMovableArray(),i=this.getMapBlocksObj(core.status.floorId),s=this.getBgMapArray(),c=[],l=[];for(c[e+","+t]=0,l.push(e+","+t);l.length>0;){var u=l.shift().split(","),p=parseInt(u[0]),d=parseInt(u[1]);for(var f in core.utils.scan)if(core.inArray(n[p][d],f)){var m=p+core.utils.scan[f].x,h=d+core.utils.scan[f].y,y=m+","+h;if(!c[y]&&167!=s[h][m]&&this._canMoveDirectly_checkNextPoint(i,m,h)){for(var g in c[y]=c[u]+1,a)if(o[g][0]==m&&o[g][1]==h&&null==a[g]&&(a[g]=c[y],0==--r))return a;l.push(y)}}}for(var g in a)null==a[g]&&(a[g]=-1);return a},N.prototype._canMoveDirectly_checkNextPoint=function(e,t,o){var r=t+","+o;return(!e[r]||!e[r].event.trigger&&!e[r].event.noPass)&&(!core.status.checkBlock.damage[r]&&!core.status.checkBlock.ambush[r])},N.prototype.automaticRoute=function(e,t){var o=core.getHeroLoc("x"),r=core.getHeroLoc("y");if(e==o&&t==r)return[];var a=this._automaticRoute_bfs(o,r,e,t);if(null==a[e+","+t])return[];for(var n=[],i=e,s=t;i!=o||s!=r;){var c=a[i+","+s];n.push({direction:c,x:i,y:s}),i-=core.utils.scan[c].x,s-=core.utils.scan[c].y}return n.reverse(),n},N.prototype._automaticRoute_bfs=function(e,t,o,r){var a={},n=this.generateMovableArray(),i=new D.a({comparator:function(e,t){return e.depth-t.depth}});for(a[e+","+t]="",i.queue({depth:0,x:e,y:t});0!=i.length;){var s=i.dequeue(),c=s.depth,l=s.x,u=s.y;for(var p in core.utils.scan)if(core.inArray(n[l][u],p)){var d=l+core.utils.scan[p].x,f=u+core.utils.scan[p].y;if(!(d<0||d>=core.bigmap.width||f<0||f>=core.bigmap.height||null!=a[d+","+f])){if(d==o&&f==r){a[d+","+f]=p;break}core.noPass(d,f)||(a[d+","+f]=p,i.queue({depth:c+this._automaticRoute_deepAdd(d,f),x:d,y:f}))}}if(null!=a[o+","+r])break}return a},N.prototype._automaticRoute_deepAdd=function(e,t){var o=1,r=core.getBlock(e,t);if(null!=r){var a=r.block.event.id;"light"==a&&(o+=100),a.endsWith("Net")&&(o+=100),!core.flags.potionWhileRouting&&a.endsWith("Potion")&&(o+=100)}return o+=100*(core.status.checkBlock.damage[e+","+t]||0),core.status.checkBlock.ambush[e+","+t]&&(o+=1e3),o},N.prototype.drawBlock=function(e,t){},N.prototype._drawBlockInfo=function(e,t,o){var r=e.image,a=e.posX,n=e.posY,i=e.height;core.clearMap("event",32*t,32*o,32,32),core.drawImage("event",r,32*a,n*i+i-32,32,32,32*t,32*o,32,32),i>32&&(core.clearMap("event2",32*t,32*o+32-i,32,i-32),core.drawImage("event2",r,32*a,n*i,32,i-32,32*t,32*o+32-i,32,i-32))},N.prototype._drawBlockInfo_bgfg=function(e,t,o,r){var a=e.image,n=e.posX,i=e.posY,s=e.height;core.clearMap(t,32*o,32*r+32-s,32,s),"bg"==t&&(s>32&&(core.clearMap("bg",32*o,32*r-32,32,32),core.drawImage("bg",core.material.groundCanvas.canvas,32*o,32*r-32)),core.drawImage("bg",core.material.groundCanvas.canvas,32*o,32*r)),core.drawImage(t,a,32*n,i*s,32,s,32*o,32*r+32-s,32,s)},N.prototype.generateGroundPattern=function(e){},N.prototype.drawMap=function(e,t){(e=e||core.status.floorId)?(core.clearMap("all"),this.generateGroundPattern(e),core.status.floorId=e,core.status.thisMap=core.status.maps[e],this._drawMap_drawAll(),core.status.curtainColor&&core.fillRect("curtain",0,0,core.__PIXELS__,core.__PIXELS__,core.arrayToRGBA(core.status.curtainColor)),core.drawHero(),core.updateStatusBar(),t&&t()):t&&t()},N.prototype._drawMap_drawAll=function(e){},N.prototype._drawMap_drawBlockInfo=function(e,t,o,r,a){if(null!=o){if("autotile"==o.cls)return this._drawAutotile(e,r,t,32,0,0),void(a&&this.addGlobalAnimate(t));if(a)this.drawBlock(t),this.addGlobalAnimate(t);else{var n=o.height;core.drawImage(e,o.image,32*o.posX,n*o.posY,32,n,32*t.x,32*t.y+32-n,32,n)}}},N.prototype.drawBg=function(e,t){e=e||core.status.floorId;var o=null==t;o&&(t=core.canvas.bg,core.clearMap(t),core.status.floorAnimateObjs=this._getFloorImages(e)),core.maps._drawBg_drawBackground(e,t),core.maps._drawFloorImages(e,t,"bg"),core.maps._drawBgFgMap(e,t,"bg",o)},N.prototype._drawBg_drawBackground=function(e,t){var o=core.floors[e].width,r=core.floors[e].height,a=(core.status.maps||core.floors)[e].defaultGround||"ground",n=core.material.icons.terrains[a];if(null!=n)for(var i=0;i<o;i++)for(var s=0;s<r;s++)t.drawImage(core.material.images.terrains,0,32*n,32,32,32*i,32*s,32,32)},N.prototype.drawEvents=function(e,t,o){e=e||core.status.floorId,t||(t=core.status.maps[e].blocks);var r=this._getMapArrayFromBlocks(t,core.floors[e].width,core.floors[e].height),a=null==o;a&&(o=core.canvas.event),t.filter((function(e){return e.event&&!e.disable})).forEach((function(e){core.maps._drawMap_drawBlockInfo(o,e,core.maps.getBlockInfo(e),r,a)})),a&&(core.status.autotileAnimateObjs.map=core.clone(r))},N.prototype.drawFg=function(e,t){e=e||core.status.floorId;var o=null==t;o&&(t=core.canvas.fg,core.status.floorAnimateObjs=this._getFloorImages(e)),this._drawFloorImages(e,t,"fg"),this._drawBgFgMap(e,t,"fg",o)},N.prototype._drawBgFgMap=function(e,t,o,r){if(e=e||core.status.floorId){var a=core.floors[e].width,n=core.floors[e].height;core.status[o+"maps"]||(core.status[o+"maps"]={});var i=this._getBgFgMapArray(o,e,!0),s=null;"fg"==o&&r&&this._drawBgFgMap_shouldBlurFg()&&(s=this.getMapArray(e));for(var c=0;c<a;c++)for(var l=0;l<n;l++){var u=this.initBlock(c,l,i[l][c],!0);u.name=o;var p=this.getBlockInfo(u);if(p){var d,f=!1;null!=s&&0!=s[l][c]&&(f=!0,d=t.globalAlpha,t.globalAlpha=.6),this._drawMap_drawBlockInfo(t,u,p,i,r),f&&(t.globalAlpha=d)}}r&&(core.status.autotileAnimateObjs[o+"map"]=core.clone(i))}},N.prototype._drawBgFgMap_shouldBlurFg=function(){return"editor"==main.mode||core.flags.blurFg},N.prototype._drawFloorImages=function(e,t,o,r,a){e=e||core.status.floorId,r||(r=this._getFloorImages(e));var n=null!=a;r.forEach((function(r){"string"==typeof r&&(r=[0,0,r]);var i=parseInt(r[0]),s=parseInt(r[1]),c=r[2],l=core.clamp(parseInt(r[4]),1,8);c=core.getMappedName(c);var u=core.material.images.images[c];if((!n||1!=l)&&core.isset(i)&&core.isset(s)&&u&&!core.hasFlag("__floorImg__"+e+"_"+i+"_"+s)){var p=parseInt(u.width/l),d=(a||0)%l*p;if(/.*\.gif/i.test(c)&&"play"==main.mode){if(n)return;return void this._drawFloorImages_gif(u,i,s)}core.maps._drawFloorImage(t,o,r[3],u,d,p,i,s,n)}}))},N.prototype._getFloorImages=function(e){e=e||core.status.floorId;var t=[];return(core.status.maps||core.floors)[e].images&&"string"==typeof(t=(core.status.maps||core.floors)[e].images)&&(t=[[0,0,t]]),t},N.prototype._drawFloorImages_gif=function(e,t,o){core.dom.gif.innerHTML="";var r=new Image;r.src=e.src,r.style.position="absolute",r.style.left=t*core.domStyle.scale+"px",r.style.top=o*core.domStyle.scale+"px",r.style.width=e.width*core.domStyle.scale+"px",r.style.height=e.height*core.domStyle.scale+"px",core.dom.gif.appendChild(r)},N.prototype._drawFloorImage=function(e,t,o,r,a,n,i,s,c){var l=r.height,u=function(){c&&core.clearMap(e,i,s,n,l),core.drawImage(e,r,a,0,n,l,i,s,n,l)};if(!o){if("bg"!=t)return;return u()}if(1==o){if("fg"!=t)return;return u()}2!=o||("bg"==t?(c&&core.clearMap(e,i,s+l-32,n,32),core.drawImage("bg",r,a,l-32,n,32,i,s+l-32,n,32)):"fg"==t&&(c&&core.clearMap(e,i,s,n,l-32),core.drawImage("fg",r,a,0,n,l-32,i,s,n,l-32)))},N.prototype._drawAutotile=function(e,t,o,r,a,n,i){var s=o.x,c=o.y,l=core.material.images.autotile[o.event.id];i=i||0,i%=parseInt(l.width/96);var u={},p=[];[-1,0,1].forEach((function(e){p[e]=[],[-1,0,1].forEach((function(o){var r,a;p[e][o]=(r=s+e,a=c+o,core.maps._drawAutotile_getAutotileAroundId(t[c][s],r,a,t)?1:0)}))})),p[-1][-1]+p[0][-1]+p[0][0]+p[-1][0]!=3||p[-1][-1]||(this._drawAutotile_render(e,s*r+a,c*r+n,r,l,i,16),u[0]=!0),p[0][-1]+p[1][-1]+p[1][0]+p[0][0]!=3||p[1][-1]||(this._drawAutotile_render(e,s*r+a+r/2,c*r+n,r,l,i,17),u[1]=!0),p[0][0]+p[1][0]+p[1][1]+p[0][1]!=3||p[1][1]||(this._drawAutotile_render(e,s*r+a+r/2,c*r+n+r/2,r,l,i,18),u[3]=!0),p[-1][0]+p[0][0]+p[0][1]+p[-1][1]!=3||p[-1][1]||(this._drawAutotile_render(e,s*r+a,c*r+n+r/2,r,l,i,19),u[2]=!0);var d=p[0][-1]+2*p[-1][0]+4*p[0][1]+8*p[1][0];this._drawAutotile_render(e,s*r,c*r,r,l,i,d,u)},N.prototype._drawAutotile_render=function(e,t,o,r,a,n,i,s){var c=[[[96*n,0,32,32,t,o,r,r]],[[96*n,96,16,32,t,o,r/2,r],[96*n+64+16,96,16,32,t+r/2,o,r/2,r]],[[96*n+64,32,32,16,t,o,r,r/2],[96*n+64,112,32,16,t,o+r/2,r,r/2]],[[96*n+64,96,32,32,t,o,r,r]],[[96*n,32,16,32,t,o,r/2,r],[96*n+64+16,32,16,32,t+r/2,o,r/2,r]],[[96*n,64,16,32,t,o,r/2,r],[96*n+64+16,64,16,32,t+r/2,o,r/2,r]],[[96*n+64,32,32,32,t,o,r,r]],[[96*n+64,64,32,32,t,o,r,r]],[[96*n,32,32,16,t,o,r,r/2],[96*n,112,32,16,t,o+r/2,r,r/2]],[[96*n,96,32,32,t,o,r,r]],[[96*n+32,32,32,16,t,o,r,r/2],[96*n+32,112,32,16,t,o+r/2,r,r/2]],[[96*n+32,96,32,32,t,o,r,r]],[[96*n,32,32,32,t,o,r,r]],[[96*n,64,32,32,t,o,r,r]],[[96*n+32,32,32,32,t,o,r,r]],[[96*n+32,64,32,32,t,o,r,r]],[[96*n+64,0,16,16,t,o,r/2,r/2]],[[96*n+64+16,0,16,16,t,o,r/2,r/2]],[[96*n+64+16,16,16,16,t,o,r/2,r/2]],[[96*n+64,16,16,16,t,o,r/2,r/2]]][i];i>=16?e.drawImage(a,c[0][0],c[0][1],c[0][2],c[0][3],c[0][4],c[0][5],r/2,r/2):this._drawAutotile_renderCut(e,a,t,o,r,c,s)},N.prototype._drawAutotile_renderCut=function(e,t,o,r,a,n,i){var s=[];if(i=i||{},2==n.length){var c=0,l=0;for(var u in n)n[u][2]%32?l=0:n[u][3]%32&&(l=1),c=n[u][0]%32||n[u][1]%32?1:0,l?(i[c*=2]||(s[c]=[n[u][0],n[u][1]]),i[c+1]||(s[c+1]=[parseInt(n[u][0])+16,n[u][1]])):(i[c]||(s[c]=[n[u][0],n[u][1]]),i[c+2]||(s[c+2]=[n[u][0],parseInt(n[u][1])+16]))}else i[0]||(s[0]=[n[0][0],n[0][1]]),i[1]||(s[1]=[n[0][0]+16,n[0][1]]),i[2]||(s[2]=[n[0][0],n[0][1]+16]),i[3]||(s[3]=[n[0][0]+16,n[0][1]+16]);for(u=0;u<4;u++){var p=s[u];p&&e.drawImage(t,p[0],p[1],16,16,o+u%2*a/2,r+parseInt(u/2)*a/2,a/2,a/2)}},N.prototype._drawAutotile_drawBlockByIndex=function(e,t,o,r,a,n,i){var s=(a-1)%6*16,c=16*~~((a-1)/6);i=i||0,i%=parseInt(r.width/96),e.drawImage(r,s+96*i,c,16,16,t,o,n/2,n/2)},N.prototype._drawAutotile_getAutotileAroundId=function(e,t,o,r){return t<0||o<0||t>=r[0].length||o>=r.length?1:core.material.autotileEdges[e].indexOf(r[o][t])>=0},N.prototype._drawAutotile_checkAround=function(e,t,o){for(var r=o[t][e],a=[],n=0;n<4;n++){for(var i=0,s=n%2,c=~~(n/2),l=0;l<4;l++){var u=l%2,p=~~(l/2);i+=this._drawAutotile_getAutotileAroundId(r,e+s+u-1,t+c+p-1,o)*Math.pow(2,3-l)}a.push(i)}return a},N.prototype._drawAutotile_getAutotileIndexs=function(e,t,o,r){for(var a=[],n=this._drawAutotile_checkAround(e,t,o),i=0;i<4;i++){var s=r[n[i]];a.push(s[3-i])}return a},N.prototype._drawAutotileAnimate=function(e,t){var o=e.x,r=e.y;if(!(32*o<core.bigmap.offsetX-64||32*o>core.bigmap.offsetX+core.__PIXELS__+32||32*r<core.bigmap.offsetY-64||32*r>core.bigmap.offsetY+core.__PIXELS__+32+16)){var a=e.name?core.canvas[e.name]:core.canvas.event;a.clearRect(32*o,32*r,32,32),e.name?("bg"==e.name&&core.drawImage("bg",core.material.groundCanvas.canvas,32*o,32*r),this._drawAutotile(a,core.status.autotileAnimateObjs[e.name+"map"],e,32,0,0,t)):this._drawAutotile(a,core.status.autotileAnimateObjs.map,e,32,0,0,t)}},N.prototype._makeAutotileEdges=function(){var e=Object.keys(core.material.images.autotile);core.material.autotileEdges={};var t=document.createElement("canvas"),o=t.getContext("2d");t.width=t.height=32,o.mozImageSmoothingEnabled=!1,o.webkitImageSmoothingEnabled=!1,o.msImageSmoothingEnabled=!1,o.imageSmoothingEnabled=!1,e.forEach((function(r){var a=core.maps.getNumberById(r);core.material.autotileEdges[a]=[a],o.clearRect(0,0,32,32),o.drawImage(core.material.images.autotile[r],0,0,32,32,0,0,32,32);var n=t.toDataURL("image/png");e.forEach((function(e){if(r!=e){var i=core.maps.getNumberById(e);o.clearRect(0,0,32,32),o.drawImage(core.material.images.autotile[e],32,0,32,32,0,0,32,32),n==t.toDataURL("image/png")&&core.material.autotileEdges[a].push(i)}}))}))},N.prototype.drawThumbnail=function(e,t,o,r){(e=e||core.status.floorId)&&(this._drawThumbnail_drawTempCanvas(e,t,o),this._drawThumbnail_drawToTarget(e,r))},N.prototype._drawThumbnail_drawTempCanvas=function(e,t,o){t=t||core.status.maps[e].blocks,o=o||{};var r=core.floors[e].width,a=core.floors[e].height,n=(core.bigmap.tempCanvas,32*r),i=32*a,s=pixi.canvasRenderer;s.resize(n,i);var c=M.a.getNode("sprite"),l=null!=core.status.hero,u=null;o.flags&&(l||(core.status.hero={}),u=core.status.hero.flags,core.status.hero.flags=o.flags),this._drawThumbnail_realDrawTempCanvas(e,t,o,c),c.getBounds(),c.renderCanvas(s),c.destroy(),l?null!=u&&(core.status.hero.flags=u):delete core.status.hero},N.prototype._drawThumbnail_realDrawTempCanvas=function(e,t,o,r){var a=pixi.maps;r.id="bg",r.args=[e],a.drawBg(r,e),r.id="event",r.args=[e,t],a.drawEvents(r,t,e),r.id="fg",r.args=[e],a.drawFg(r,e)},N.prototype._drawThumbnail_drawToTarget=function(e,t){if(null!=t){("string"==typeof t||t.canvas)&&(t={ctx:t});var o=core.getContextByName(t.ctx);if(null!=o){var r=t.x||0,a=t.y||0,n=t.size||core.__PIXELS__,i=core.floors[e].width,s=core.floors[e].height,c=t.centerX,l=t.centerY;null==c&&(c=Math.floor(i/2)),null==l&&(l=Math.floor(s/2));var u=pixi.canvasRenderer.view,p=32*i,d=32*s;if(core.clearMap(o,r,a,n,n),t.all)if(p<=d){var f=(n-(m=(h=n)*p/d))/2;core.fillRect(o,r,a,f,h,"#000000"),core.fillRect(o,r+n-f,a,f,h),o.drawImage(u,0,0,p,d,r+f,a,m,h)}else{var m,h;f=(n-(h=(m=n)*d/p))/2;core.fillRect(o,r,a,m,f,"#000000"),core.fillRect(o,r,a+n-f,m,f),o.drawImage(u,0,0,p,d,r,a+f,m,h)}else{var y=core.clamp(c-core.__HALF_SIZE__,0,i-core.__SIZE__),g=core.clamp(l-core.__HALF_SIZE__,0,s-core.__SIZE__);o.drawImage(u,32*y,32*g,core.__PIXELS__,core.__PIXELS__,r,a,n,n)}}}},N.prototype.noPass=function(e,t,o){var r=core.getBlock(e,t,o);return null!=r&&r.block.event.noPass},N.prototype.npcExists=function(e,t,o){var r=this.getBlock(e,t,o);return null!=r&&0==r.block.event.cls.indexOf("npc")},N.prototype.terrainExists=function(e,t,o,r){var a=this.getBlock(e,t,r);return null!=a&&("terrains"==a.block.event.cls&&(!o||a.block.event.id==o))},N.prototype.stairExists=function(e,t,o){var r=this.getBlockId(e,t,o);if(null==r)return!1;var a=["upFloor","downFloor"];return core.flags.flyRecordPosition&&(a=a.concat(["leftPortal","rightPortal","upPortal","downPortal"])),a.indexOf(r)>=0},N.prototype.nearStair=function(){var e=core.getHeroLoc("x"),t=core.getHeroLoc("y");return this.stairExists(e,t)||this.stairExists(e-1,t)||this.stairExists(e,t-1)||this.stairExists(e+1,t)||this.stairExists(e,t+1)},N.prototype.enemyExists=function(e,t,o,r){var a=this.getBlock(e,t,r);return null!=a&&(0==a.block.event.cls.indexOf("enemy")&&(!o||a.block.event.id==o))},N.prototype.getBlock=function(e,t,o,r){if(!(o=o||core.status.floorId))return null;for(var a=core.status.maps[o].blocks,n=0;n<a.length;n++)if(a[n].x==e&&a[n].y==t)return!r&&a[n].disable?null:{index:n,block:a[n]};return null},N.prototype.getBlockId=function(e,t,o,r){var a=core.getBlock(e,t,o,r);return null==a?null:a.block.event.id},N.prototype.getBlockCls=function(e,t,o,r){var a=core.getBlock(e,t,o,r);return null==a?null:a.block.event.cls},N.prototype.getBlockInfo=function(e){return pixi.Block.getInfo(e)},N.prototype.searchBlock=function(e,t,o){"number"==typeof e&&(e=this.getBlockByNumber(e).event.id),t=t||core.status.floorId;var r=[];if(t instanceof Array)return t.forEach((function(t){r=r.concat(core.searchBlock(e,t,o))})),r;for(var a=0;a<core.status.maps[t].blocks.length;++a){var n=core.status.maps[t].blocks[a];!o&&n.disable||!core.matchWildcard(e,n.event.id)||r.push({floorId:t,index:a,block:n,x:n.x,y:n.y})}return r},N.prototype.showBlock=function(e,t,o){if(o=o||core.status.floorId){var r=core.getBlock(e,t,o,!0);null!=r&&(r=r.block).disable&&(r.disable=!1,o==core.status.floorId&&(core.drawBlock(r),core.addGlobalAnimate(r)),core.updateStatusBar())}},N.prototype.hideBlock=function(e,t,o){if(o=o||core.status.floorId){var r=core.getBlock(e,t,o,!0);if(null!=r){if(o==core.status.floorId){core.removeGlobalAnimate(e,t),core.clearMap("event",32*e,32*t,32,32);var a=r.block.event.height||32;a>32&&core.clearMap("event2",32*e,32*t+32-a,32,a-32)}r.block.disable=!0,core.updateStatusBar()}}},N.prototype.removeBlock=function(e,t,o){if(o=o||core.status.floorId){var r=core.getBlock(e,t,o,!0);if(null!=r){var a=r.index;if(r.block.hide(),o==core.status.floorId){core.removeGlobalAnimate(e,t),core.clearMap("event",32*e,32*t,32,32);var n=r.block.event.height||32;n>32&&core.clearMap("event2",32*e,32*t+32-n,32,n-32)}core.removeBlockById(a,o),core.updateStatusBar()}}},N.prototype.removeBlockById=function(e,t){if(t=t||core.status.floorId){var o=core.status.maps[t].blocks,r=o[e];this.canRemoveBlock(r,t)?o.splice(e,1):r.disable=!0}},N.prototype.removeBlockByIds=function(e,t){(e=e||core.status.floorId)&&t.sort((function(e,t){return t-e})).forEach((function(t){core.removeBlockById(t,e)}))},N.prototype.canRemoveBlock=function(e,t){var o=e.x,r=e.y;return!core.floors[t].events[o+","+r]&&!core.floors[t].changeFloor[o+","+r]&&(!e.event||0!=e.event.cls.indexOf("enemy")||!core.hasSpecial(e.event.id,23))},N.prototype.showBgFgMap=function(e,t,o,r){this._triggerBgFgMap("show",e,t,o,r)},N.prototype.hideBgFgMap=function(e,t,o,r){this._triggerBgFgMap("hide",e,t,o,r)},N.prototype._triggerBgFgMap=function(e,t,o,r,a){"show"!=e&&(e="hide"),"fg"!=t&&(t="bg"),"number"==typeof o[0]&&"number"==typeof o[1]&&(o=[o]),(r=r||core.status.floorId)&&0!=o.length&&(o.forEach((function(o){var a=o[0],n=o[1],i="__"+t+"Map__"+r+"_"+a+"_"+n;"hide"==e?core.setFlag(i,!0):core.removeFlag(i)})),core.status[t+"maps"][r]=null,r==core.status.floorId?core.drawMap(r,a):a&&a())},N.prototype.showFloorImage=function(e,t,o){this._triggerFloorImage("show",e,t,o)},N.prototype.hideFloorImage=function(e,t,o){this._triggerFloorImage("hide",e,t,o)},N.prototype._triggerFloorImage=function(e,t,o,r){"show"!=e&&(e="hide"),"number"==typeof t[0]&&"number"==typeof t[1]&&(t=[t]),(o=o||core.status.floorId)&&0!=t.length&&(t.forEach((function(t){var r=t[0],a=t[1],n="__floorImg__"+o+"_"+r+"_"+a;"hide"==e?core.setFlag(n,!0):core.removeFlag(n)})),o==core.status.floorId?core.drawMap(o,r):r&&r())},N.prototype.setBlock=function(e,t,o,r){if((r=r||core.status.floorId)&&null!=e&&null!=t&&null!=o&&!(t<0||t>=core.floors[r].width||o<0||o>=core.floors[r].height)){"string"==typeof e&&(e=/^\d+$/.test(e)?parseInt(e):core.getNumberById(e));var a=this.initBlock(t,o,e,!0,core.floors[r]);if(0!=a.id||a.event.trigger){var n=core.getBlock(t,o,r,!0);r==core.status.floorId&&null!==n&&n.block.hide(),null==n?core.status.maps[r].blocks.push(a):(n.block.id=e,n.block.event=a.event,a=n.block),r!=core.status.floorId||a.disable||(a.drawTo("event"),core.updateStatusBar())}else core.removeBlock(t,o,r)}},N.prototype.replaceBlock=function(e,t,o){if((o=o||core.status.floorId)instanceof Array)o.forEach((function(o){core.replaceBlock(e,t,o)}));else{var r=this.getBlockByNumber(t,!0);core.status.maps[o].blocks.forEach((function(o){if(o.id==e)for(var a in o.id=t,r.event)o.event[a]=core.clone(r.event[a])}))}},N.prototype.setBgFgBlock=function(e,t,o,r,a){if((a=a||core.status.floorId)&&null!=t&&null!=o&&null!=r&&!(o<0||o>=core.floors[a].width||r<0||r>=core.floors[a].height||"bg"!=e&&"fg"!=e)){"string"==typeof t&&(t=/^\d+$/.test(t)?parseInt(t):core.getNumberById(t));var n="__"+e+"Value__"+a+"_"+o+"_"+r;core.setFlag(n,t),core.status[e+"maps"][a]=null,a==core.status.floorId&&(core.clearMap(e),"bg"==e?core.drawBg(a):core.drawFg(a))}},N.prototype.resetMap=function(e){if(e=e||core.status.floorId){"string"==typeof e&&(e=[e]);var t=!1;e.forEach((function(e){core.status.maps[e]=core.maps.loadFloor(e),e==core.status.floorId&&(t=!0)})),t&&this.drawMap(),core.drawTip("地图重置成功")}},N.prototype._initDetachedBlock=function(e,t,o,r){var a=pixi.game.getScene("event"),n=pixi.game.getScene("damage"),i=pixi.Block.get(e.number,t,o);return{mainNode:i.drawTo(a),damageNode:0==e.cls.indexOf("enemy")&&core.hasItem("book")&&r?pixi.maps.drawOneDamage(n,i.id,t,o):null}},N.prototype._moveDetachedBlock=function(e,t,o,r,a){var n=a.mainNode,i=a.damageNode;n&&(n.position.set(t-core.bigmap.offsetX+16,o+32-n.height/2-core.bigmap.offsetY),n.alpha=r),i&&(i.position.set(t-core.bigmap.offsetX+16,o-core.bigmap.offsetY),i.alpha=r)},N.prototype._deleteDetachedBlock=function(e){var t=e.mainNode,o=e.damageNode;t&&t.remove(),o&&o.remove()},N.prototype._getAndRemoveBlock=function(e,t){var o=core.getBlock(e,t);if(null==o)return null;o=o.block;var r=this.getBlockInfo(o);return null!=r?(core.removeBlock(e,t),[o,r]):void 0},N.prototype.moveBlock=function(e,t,o,r,a,n){r=r||500;var i=this._getAndRemoveBlock(e,t);if(null!=i){var s=z(i,2),c=s[0],l=(s[1],(o||[]).filter((function(e){return["up","down","left","right","forward","backward"].indexOf(e)>=0})));O.a.setAsyncAnimate((function(e){pixi.maps.moveBlock(c,l,r,a,(function(){e(),n instanceof Function&&n()}))}))}else n&&n()},N.prototype._moveBlock_doMove=function(e,t,o,r){var a=core.icons._getAnimateFrames(e.cls,!0),n=0,i=window.setInterval((function(){"tileset"!=e.cls&&(n+=o.per_time)>core.values.animateSpeed&&(n=0,e.posX=(e.posX+1)%a),0!=o.moveSteps.length?core.maps._moveBlock_moving(e,t,o):core.maps._moveJumpBlock_finished(e,t,o,i,r)}),o.per_time);core.animateFrame.asyncId[i]=!0},N.prototype._moveBlock_updateDirection=function(e,t){t.offset=1;var o=t.moveSteps[0];if(null==t.lastDirection)for(var r in e.faceIds)if(e.faceIds[r]==e.id){t.lastDirection=r;break}if("forward"==o||"backward"==o){if(null==t.lastDirection)return t.moveSteps.shift(),!1;"backward"==o&&(t.offset=-1),o=t.lastDirection}t.lastDirection=t.moveSteps[0]=o,t.x+=core.utils.scan[o].x*t.offset,t.y+=core.utils.scan[o].y*t.offset;var a=e.faceIds[o];if(a){var n=core.material.icons[e.cls][a];null!=n&&(e.posY=n)}return!0},N.prototype._moveBlock_moving=function(e,t,o){if(0!=o.step||this._moveBlock_updateDirection(e,o)){var r=o.moveSteps[0];o.step++,o.px+=2*core.utils.scan[r].x*o.offset,o.py+=2*core.utils.scan[r].y*o.offset,this._moveDetachedBlock(e,o.px,o.py,o.opacity,t),16==o.step&&(o.step=0,o.moveSteps.shift())}},N.prototype.jumpBlock=function(e,t,o,r,a,n,i){a=a||500;var s=this._getAndRemoveBlock(e,t);if(null!=s){var c=s[0],l=s[1],u=this._initDetachedBlock(l,e,t,!1!==c.event.animate);this._moveDetachedBlock(l,32*e,32*t,1,u),core.playSound("jump.mp3");var p=this.__generateJumpInfo(e,t,o,r,a);p.keep=n,this._jumpBlock_doJump(l,u,p,i)}else i&&i()},N.prototype.__generateJumpInfo=function(e,t,o,r,a){var n=o-e,i=r-t,s=6+Math.round(Math.sqrt(n*n+i*i)),c=2*s;return{x:e,y:t,ex:o,ey:r,px:32*e,py:32*t,opacity:1,jump_peak:s,jump_count:c,step:0,per_time:(a/=Math.max(core.status.replay.speed,1))/c}},N.prototype._jumpBlock_doJump=function(e,t,o,r){var a=window.setInterval((function(){o.jump_count>0?core.maps._jumpBlock_jumping(e,t,o):core.maps._moveJumpBlock_finished(e,t,o,a,r)}),o.per_time);core.animateFrame.asyncId[a]=!0},N.prototype.__updateJumpInfo=function(e){e.jump_count--,e.x=(e.x*e.jump_count+e.ex)/(e.jump_count+1),e.y=(e.y*e.jump_count+e.ey)/(e.jump_count+1),e.px=32*e.x;var t=Math.abs(e.jump_count-e.jump_peak);e.py=32*e.y-(e.jump_peak*e.jump_peak-t*t)/2},N.prototype._jumpBlock_jumping=function(e,t,o){this.__updateJumpInfo(o),core.maps._moveDetachedBlock(e,o.px,o.py,o.opacity,t)},N.prototype._moveJumpBlock_finished=function(e,t,o,r,a){o.keep?o.opacity=0:o.opacity-=.06,o.opacity<=0?(delete core.animateFrame.asyncId[r],clearInterval(r),this._deleteDetachedBlock(t),o.keep&&(core.setBlock(e.number,o.x,o.y),core.showBlock(o.x,o.y)),a&&a()):this._moveDetachedBlock(e,o.px,o.py,o.opacity,t)},N.prototype.animateBlock=function(e,t,o,r){var a="hide"==t;"number"==typeof e[0]&&"number"==typeof e[1]&&(e=[e]);var n=this._animateBlock_getList(e);0!=n.length?(this._animateBlock_drawList(n,a?1:0),o/=Math.max(core.status.replay.speed,1),this._animateBlock_doAnimate(e,n,a,10/o,r)):r&&r()},N.prototype._animateBlock_doAnimate=function(e,t,o,r,a){var n=o?1:0,i=setInterval((function(){n+=o?-r:r,core.maps._animateBlock_drawList(t,n),(n>=1||n<=0)&&(delete core.animateFrame.asyncId[i],clearInterval(i),t.forEach((function(e){e.blockInfo&&core.maps._deleteDetachedBlock(e.canvases)})),e.forEach((function(e){o?core.removeBlock(e[0],e[1]):core.showBlock(e[0],e[1])})),a&&a())}),10);core.animateFrame.asyncId[i]=!0},N.prototype._animateBlock_getList=function(e){var t=[];return e.forEach((function(e){var o=core.getBlock(e[0],e[1],null,!0);if(null!=o){o=o.block;var r=core.maps.getBlockInfo(o);if(null!=r){var a=core.maps._initDetachedBlock(r,e[0],e[1],!1!==o.event.displayDamage);t.push({x:e[0],y:e[1],blockInfo:r,canvases:a})}else t.push({x:e[0],y:e[1]})}})),t},N.prototype._animateBlock_drawList=function(e,t){e.forEach((function(e){e.blockInfo&&core.maps._moveDetachedBlock(e.blockInfo,32*e.x,32*e.y,t,e.canvases)}))},N.prototype.addGlobalAnimate=function(e){},N.prototype.removeGlobalAnimate=function(e,t,o){},N.prototype.drawBoxAnimate=function(){core.status.boxAnimateObjs.forEach((function(e){core.clearMap("ui",e.bgx,e.bgy,e.bgWidth,e.bgHeight),core.fillRect("ui",e.bgx,e.bgy,e.bgWidth,e.bgHeight,core.material.groundPattern),core.drawImage("ui",e.image,core.status.globalAnimateStatus%e.animate*32,e.pos,32,e.height,e.x,e.y,32,e.height)}))},N.prototype.drawAnimate=function(e,t,o,r){var a=32*t+16,n=32*o+16,i=pixi.game.getScene("event");O.a.drawAnimate(e,i,a,n,{onComplete:function(){r instanceof Function&&r()}})},N.prototype.drawHeroAnimate=function(e,t){if(l.a.sprite){var o=l.a.sprite.x||0,r=l.a.sprite.y||0,a=pixi.game.getScene("event");O.a.drawAnimate(e,a,o,r,{update:function(){this.defaultX=l.a.sprite.x,this.defaultY=l.a.sprite.y},onComplete:function(){t instanceof Function&&t()}})}},N.prototype._drawAnimateFrame=function(e,t,o,r){var a=e.frames[r],n=e.ratio;a.forEach((function(r){var a=e.images[r.index];if(a){var i=a.width*n*r.zoom/100,s=a.height*n*r.zoom/100;core.setAlpha("animate",r.opacity/255);var c=t+r.x,l=o+r.y;r.mirror||r.angle?(core.saveCanvas("animate"),core.canvas.animate.translate(c,l),r.angle&&core.canvas.animate.rotate(-r.angle*Math.PI/180),r.mirror&&core.canvas.animate.scale(-1,1),core.drawImage("animate",a,-i/2-core.bigmap.offsetX,-s/2-core.bigmap.offsetY,i,s),core.loadCanvas("animate")):core.drawImage("animate",a,c-i/2-core.bigmap.offsetX,l-s/2-core.bigmap.offsetY,i,s),core.setAlpha("animate",1)}}))},N.prototype.stopAnimate=function(e,t){for(var o=0;o<core.status.animateObjs.length;o++){var r=core.status.animateObjs[o];r.id==e&&t&&function(e){setTimeout((function(){e&&e()}))}(r.callback)}core.status.animateObjs=core.status.animateObjs.filter((function(t){return t.id!=e})),0==core.status.animateObjs.length&&core.clearMap("animate")};var U=o(44),W=o(29),V=o(18),q=o.n(V);function X(){this.version="2.6.6",this.useCompress=!1,this.bgmRemote=!1,this.bgmRemoteRoot="https://h5mota.com/music/",this.isCompetition=!1,this.savePages=1e3,this.dom={body:document.body,gameGroup:document.getElementById("gameGroup"),mainTips:document.getElementById("mainTips"),musicBtn:document.getElementById("musicBtn"),startPanel:document.getElementById("startPanel"),startTop:document.getElementById("startTop"),startTopProgressBar:document.getElementById("startTopProgressBar"),startTopProgress:document.getElementById("startTopProgress"),startTopLoadTips:document.getElementById("startTopLoadTips"),startBackground:document.getElementById("startBackground"),startLogo:document.getElementById("startLogo"),startButtonGroup:document.getElementById("startButtonGroup"),floorMsgGroup:document.getElementById("floorMsgGroup"),logoLabel:document.getElementById("logoLabel"),versionLabel:document.getElementById("versionLabel"),floorNameLabel:document.getElementById("floorNameLabel"),statusBar:document.getElementById("statusBar"),status:document.getElementsByClassName("status"),toolBar:document.getElementById("toolBar"),tools:document.getElementsByClassName("tools"),gameCanvas:document.getElementsByClassName("gameCanvas"),gif:document.getElementById("gif"),gif2:document.getElementById("gif2"),gameDraw:document.getElementById("gameDraw"),startButtons:document.getElementById("startButtons"),playGame:document.getElementById("playGame"),loadGame:document.getElementById("loadGame"),replayGame:document.getElementById("replayGame"),levelChooseButtons:document.getElementById("levelChooseButtons"),data:document.getElementById("data"),ui:document.getElementById("ui"),statusLabels:document.getElementsByClassName("statusLabel"),statusTexts:document.getElementsByClassName("statusText"),inputDiv:document.getElementById("inputDiv"),inputMessage:document.getElementById("inputMessage"),inputBox:document.getElementById("inputBox"),inputYes:document.getElementById("inputYes"),inputNo:document.getElementById("inputNo"),next:document.getElementById("next")},this.mode="play",this.loadList=["loader","control","utils","items","icons","maps","enemys","events","actions","data","ui","extensions","core"],this.pureData=["data","enemys","icons","maps","items","functions","events","plugins"],this.materials=["animates","enemys","hero","items","npcs","terrains","enemy48","npc48"],this.statusBar={icons:{floor:0,name:null,lv:1,hpmax:2,hp:3,atk:4,def:5,mdef:6,money:7,experience:8,up:9,book:10,fly:11,toolbox:12,keyboard:13,shop:14,save:15,load:16,settings:17,play:18,pause:19,stop:20,speedDown:21,speedUp:22,rewind:23,equipbox:24,mana:25,skill:26,paint:27,erase:28,empty:29,exit:30,btn1:31,btn2:32,btn3:33,btn4:34,btn5:35,btn6:36,btn7:37,btn8:38}},this.floors={},this.canvas={},this.__VERSION__="2.6.6",this.__VERSION_CODE__=99}o(46),o(47),console.log("loadSecond"),X.prototype.init=function(e,t){for(var a=0;a<main.dom.gameCanvas.length;a++)main.canvas[main.dom.gameCanvas[a].id]=main.dom.gameCanvas[a].getContext("2d");main.mode=e;var n=q.a.main;for(var i in n)main[i]=n[i];var s=new m.a;window.core=s,main.core=s,s.actions=new r.a,s.control=new d,s.data=new h.a,s.enemys=new v,s.events=new w.a,s.extensions=new x,s.icons=new I,s.items=new E.a,s.loader=new F,s.maps=new j,s.ui=new U.a,s.utils=new W.a,main.lzw=W.a.lzw,main.loadFile={sounds:o(74)},main.loadFloors((function(){var e={};["dom","statusBar","canvas","images","tilesets","materials","animates","bgms","sounds","floorIds","floors"].forEach((function(t){e[t]=main[t]})),pixi.event.emit("resize"),main.core.init(e,t),main.core.resize()}))},X.prototype.loadJs=function(e,t,o){if(main.setMainTipsText("正在加载核心js文件..."),this.useCompress)main.loadMod(e,e,(function(){o()}));else for(var r=0,a=0;a<t.length;a++)main.loadMod(e,t[a],(function(e){main.setMainTipsText(e+".js 加载完毕"),++r===t.length&&o()}))},X.prototype.loadMod=function(e,t,o,r){var a=document.createElement("script"),n=t;a.src=e+"/"+t+(this.useCompress?".min":"")+".js?v="+this.version,a.onload=function(){o(n)},main.dom.body.appendChild(a)},X.prototype.loadFloors=function(e){if(this.setMainTipsText("正在加载楼层文件..."),this.useCompress){var t=document.createElement("script");t.src="project/floors.min.js?v="+this.version,main.dom.body.appendChild(t),t.onload=function(){main.dom.mainTips.style.display="none",e()}}else for(var o=0;o<main.floorIds.length;o++)main.loadFloor(main.floorIds[o],(function(t){main.setMainTipsText("楼层 "+t+".js 加载完毕"),Object.keys(main.floors).length===main.floorIds.length&&e()}))},X.prototype.loadFloor=function(e,t){o(86)("./".concat(e,".js")),t(e)},X.prototype.setMainTipsText=function(e){},X.prototype.log=function(e){e&&(main.core&&main.core.platform&&!main.core.platform.isPC?console.log(e.stack||e.toString()):console.log(e))},X.prototype.createOnChoiceAnimation=function(){var e=main.dom.startButtonGroup.style.caretColor||"rgb(255, 215, 0)",t=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*\d+\s*)?\)$/.exec(e);if(null!=t){var o=t[1]+", "+t[2]+", "+t[3],r=document.createElement("style");r.type="text/css";var a="onChoice { 0% { border-color: rgba("+o+", 0.9); } 50% { border-color: rgba("+o+", 0.3); } 100% { border-color: rgba("+o+", 0.9); } }";r.innerHTML="@-webkit-keyframes "+a+" @keyframes "+a,document.body.appendChild(r)}},X.prototype.selectButton=function(e){var t=function(t){e=(e+t.length)%t.length;for(var o=0;o<t.length;++o)t[o].classList.remove("onChoiceAnimate");t[e].classList.add("onChoiceAnimate"),main.selectedButton==e?t[e].click():main.selectedButton=e};"block"==core.dom.startPanel.style.display&&("block"==main.dom.startButtons.style.display?t(main.dom.startButtons.children):"block"==main.dom.levelChooseButtons.style.display&&t(main.dom.levelChooseButtons.children))},X.prototype.listen=function(){window.onresize=function(){try{main.core.resize()}catch(e){main.log(e)}},main.dom.body.onkeydown=function(e){try{main.core&&(main.core.isPlaying()||main.core.status.lockControl)&&main.core.onkeyDown(e)}catch(e){main.log(e)}},main.dom.body.onkeyup=function(e){try{if("block"==main.dom.startPanel.style.display&&("block"==main.dom.startButtons.style.display||"block"==main.dom.levelChooseButtons.style.display))return 38==e.keyCode||33==e.keyCode?main.selectButton((main.selectedButton||0)-1):40==e.keyCode||34==e.keyCode?main.selectButton((main.selectedButton||0)+1):67==e.keyCode||13==e.keyCode||32==e.keyCode?main.selectButton(main.selectedButton):27==e.keyCode&&"block"==main.dom.levelChooseButtons.style.display&&main.core.showStartAnimate(!0),void e.stopPropagation();main.core&&main.core.isPlaying&&main.core.status&&(main.core.isPlaying()||main.core.status.lockControl)&&main.core.onkeyUp(e)}catch(e){main.log(e)}},main.dom.data.onmousedown=function(e){try{var t=main.core.actions._getClickLoc(e.clientX,e.clientY);if(null==t)return;main.core.ondown(t)}catch(e){main.log(e)}},main.dom.data.onmousemove=function(e){try{var t=main.core.actions._getClickLoc(e.clientX,e.clientY);if(null==t)return;main.core.onmove(t)}catch(e){main.log(e)}},main.dom.data.onmouseup=function(e){try{var t=main.core.actions._getClickLoc(e.clientX,e.clientY);if(null==t)return;main.core.onup(t)}catch(e){main.log(e)}},main.dom.data.onmousewheel=function(e){try{e.wheelDelta?main.core.onmousewheel(Math.sign(e.wheelDelta)):e.detail&&main.core.onmousewheel(Math.sign(e.detail))}catch(e){main.log(e)}},main.dom.data.ontouchstart=function(e){try{e.preventDefault();var t=main.core.actions._getClickLoc(e.targetTouches[0].clientX,e.targetTouches[0].clientY);if(null==t)return;main.lastTouchLoc=t,main.core.ondown(t)}catch(e){main.log(e)}},main.dom.data.ontouchmove=function(e){try{e.preventDefault();var t=main.core.actions._getClickLoc(e.targetTouches[0].clientX,e.targetTouches[0].clientY);if(null==t)return;main.lastTouchLoc=t,main.core.onmove(t)}catch(e){main.log(e)}},main.dom.data.ontouchend=function(e){try{if(e.preventDefault(),null==main.lastTouchLoc)return;var t=main.lastTouchLoc;delete main.lastTouchLoc,main.core.onup(t)}catch(e){main.log(e)}}},window.main=new X,window.main.init("play"),window.main.listen()}]);